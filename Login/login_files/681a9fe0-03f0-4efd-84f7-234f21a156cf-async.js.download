/*! @permutive/javascript-sdk v20.54.0 (web) (built 2025-10-28T09:38:00.461Z) */(()=>{"use strict";var __webpack_modules__={5654:(e,t,n)=>{function r(e){return e instanceof Error?e:new Error("string"==typeof e?e:JSON.stringify(e))}n.d(t,{w:()=>r})},842:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2169),i=n(8236);function o(e){return(0,r.zG)((0,i.Y3)((()=>JSON.parse(e))),(0,i.fS)(r.gn))}},2945:(e,t,n)=>{n.d(t,{Qt:()=>s,Yt:()=>d,ap:()=>o,gz:()=>l});var r=n(2169),i=n(8614);function o(e,t){return function(n){return function(r){return e.ap(e.map(r,(function(e){return function(n){return t.ap(e,n)}})),n)}}}function s(e){return function(t,n){return function(r){return e.ap(e.map(r,(function(e){return function(n){var r;return Object.assign({},e,((r={})[t]=n,r))}})),n)}}}function a(e,t,n){return function(r){for(var i=Array(n.length+1),o=0;o<n.length;o++)i[o]=n[o];return i[n.length]=r,0===t?e.apply(null,i):a(e,t-1,i)}}var u={1:function(e){return[e]},2:function(e){return function(t){return[e,t]}},3:function(e){return function(t){return function(n){return[e,t,n]}}},4:function(e){return function(t){return function(n){return function(r){return[e,t,n,r]}}}},5:function(e){return function(t){return function(n){return function(r){return function(i){return[e,t,n,r,i]}}}}}};function c(e){return i.e$.call(u,e)||(u[e]=a(r.bc,e-1,[])),u[e]}function l(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=t.length,i=c(r),o=e.map(t[0],i),s=1;s<r;s++)o=e.ap(o,t[s]);return o}}function d(e){return function(t){for(var n=Object.keys(t),r=n.length,i=function(e){var t=e.length;switch(t){case 1:return function(t){var n;return(n={})[e[0]]=t,n};case 2:return function(t){return function(n){var r;return(r={})[e[0]]=t,r[e[1]]=n,r}};case 3:return function(t){return function(n){return function(r){var i;return(i={})[e[0]]=t,i[e[1]]=n,i[e[2]]=r,i}}};case 4:return function(t){return function(n){return function(r){return function(i){var o;return(o={})[e[0]]=t,o[e[1]]=n,o[e[2]]=r,o[e[3]]=i,o}}}};case 5:return function(t){return function(n){return function(r){return function(i){return function(o){var s;return(s={})[e[0]]=t,s[e[1]]=n,s[e[2]]=r,s[e[3]]=i,s[e[4]]=o,s}}}}};default:return a((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i={},o=0;o<t;o++)i[e[o]]=n[o];return i}),t-1,[])}}(n),o=e.map(t[n[0]],i),s=1;s<r;s++)o=e.ap(o,t[n[s]]);return o}}},9912:(e,t,n)=>{n.d(t,{oA:()=>w,t9:()=>p,DZ:()=>y,Ew:()=>c,f2:()=>l,xH:()=>v,jV:()=>g,uK:()=>b,tV:()=>S,u4:()=>E,DY:()=>f});var r=n(2169),i=(n(6289),n(8614)),o=n(4214);i.r1;var s=function(e){return[e]};o.xP,o.Lx,o.u4,o.OE,o.nq,o.iw,o.YM,o.ZN,o.Eh,i.F4,o.YM,o.Z$,o.VV,o.Fp,o.j0;o.ur;var a=n(7812),u=n(7049);n(3226);a.P5,a.YM,a.Z$;a.cx;function c(e){return a.Ew(e)}var l=a.f2;a.JO,a.qr;var d=function(e){return e.slice()},f=function(e){return function(t){return t.length<=1?d(t):t.slice().sort(e.compare)}};var p=a.t9;function g(e){var t=p(e);return function(n,r){if(void 0===r){var i=g(e);return function(e){return i(e,n)}}return n.filter((function(e){return t(e,r)}))}}a.kp,a.Eq;var m=s,h=function(e){return function(t){return(0,r.zG)(t,function(e){return function(t){for(var n=[],r=0;r<t.length;r++)n.push.apply(n,e(r,t[r]));return n}}((function(t,n){return e(n)})))}},v=h(r.yR),_=function(e){return function(t){for(var n=[],r=0;r<t.length;r++){var o=e(r,t[r]);i.pC(o)&&n.push(o.value)}return n}},y=function(e){return _((function(t,n){return e(n)}))},w=y(r.yR),b=function(e){return I((function(t,n){return e(n)}))},I=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=t[i];e(i,o)?r.push(o):n.push(o)}return(0,u.s4)(n,r)}},S=function(e){return k((function(t,n){return e(n)}))},k=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=e(i,t[i]);"Left"===o._tag?n.push(o.left):r.push(o.right)}return(0,u.s4)(n,r)}},E=(a.Lx,a.xP,a.u4);a.OE,a.nq,a.iw,a.ZN,a.Eh,a.pR,a.pJ,a.oR,a.yW,a.j0,i.F4},6335:(e,t,n)=>{function r(e){return function(t){return function(n){return e.chain(n,(function(n){return e.map(t(n),(function(){return n}))}))}}}function i(e){return function(t,n){return function(r){return e.chain(r,(function(r){return e.map(n(r),(function(e){var n;return Object.assign({},r,((n={})[t]=e,n))}))}))}}}n.d(t,{a:()=>i,m:()=>r})},7144:(e,t,n)=>{n.d(t,{G5:()=>v,dO:()=>g,Pd:()=>b,ak:()=>q,tS:()=>y,Y$:()=>C,g_:()=>z,ij:()=>M,DT:()=>k,fS:()=>x,pF:()=>D,nM:()=>E,t$:()=>a,UI:()=>p,Vn:()=>I,EQ:()=>U,F2:()=>u,LF:()=>O,KC:()=>R,i$:()=>A,Y3:()=>T});var r=n(6335),i=n(4906),o=n(2169),s=(n(6289),n(8614)),a=s.t$,u=s.F2,c=function(e,t){return(0,o.zG)(e,p(t))},l=function(e,t){return(0,o.zG)(e,h(t))},d=function(e,t){return(0,o.zG)(e,y(t))},f="Either",p=function(e){return function(t){return E(t)?t:u(e(t.right))}},g={URI:f,map:c},m=u,h=function(e){return function(t){return E(t)?t:E(e)?e:u(t.right(e.right))}},v={URI:f,map:c,ap:l},_=function(e){return function(t){return E(t)?t:e(t.right)}},y=_,w={URI:f,map:c,ap:l,chain:d},b=function(e,t){return function(n){return E(n)?a(e(n.left)):u(t(n.right))}},I=function(e){return function(t){return E(t)?a(e(t.left)):t}},S={URI:f,fromEither:o.yR},k=(0,i.DT)(S),E=s.nM,P=(s.tO,function(e,t){return function(n){return E(n)?e(n.left):t(n.right)}}),G=P,U=P,z=U,D=function(e){return function(t){return E(t)?e(t.left):t.right}},x=D,C=(0,i.Y$)(S,w),O=function(e){return E(e)?u(e.left):a(e.right)},M=function(e){return function(t){return null==t?a(e):u(t)}},T=function(e,t){try{return u(e())}catch(e){return a(t(e))}},A=G(o.yR,o.yR);function R(e){return e instanceof Error?e:new Error(String(e))}s.F4;var q=(0,r.a)(w);s.Xl},7125:(e,t,n)=>{n.d(t,{EQ:()=>w,F2:()=>a,KQ:()=>f,LF:()=>P,LU:()=>E,LV:()=>b,NG:()=>p,Pd:()=>_,UI:()=>g,Vn:()=>y,ap:()=>m,dQ:()=>k,fS:()=>I,i$:()=>G,ij:()=>d,m8:()=>c,pk:()=>l,t$:()=>u,tS:()=>h,vx:()=>S,wp:()=>v});var r=n(2945),i=n(7144),o=n(2169),s=n(6289);function a(e){return(0,o.ls)(i.F2,e.of)}function u(e){return(0,o.ls)(i.t$,e.of)}function c(e){return function(t){return e.map(t,i.F2)}}function l(e){return function(t){return e.map(t,i.t$)}}function d(e){return function(t){return(0,o.ls)(i.ij(t),e.of)}}function f(e){var t=d(e);return function(e){var n=t(e);return function(e){return(0,o.ls)(e,n)}}}function p(e){var t=h(e),n=f(e);return function(e){var r=n(e);return function(e){return t(r(e))}}}function g(e){return(0,s.UI)(e,i.dO)}function m(e){return(0,r.ap)(e,i.G5)}function h(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?e.of(n):t(n.right)}))}}}function v(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?t():e.of(n)}))}}}function _(e){return function(t,n){return function(r){return e.map(r,i.Pd(t,n))}}}function y(e){return function(t){return function(n){return e.map(n,i.Vn(t))}}}function w(e){return function(t,n){return function(r){return e.map(r,i.EQ(t,n))}}}function b(e){return function(t,n){return function(r){return e.chain(r,i.EQ(t,n))}}}function I(e){return function(t){return function(n){return e.chain(n,i.EQ(t,e.of))}}}function S(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?t(n.left):e.of(n)}))}}}function k(e){var t=S(e);return function(n){return t((function(t){return e.map(n(t),(function(e){return i.nM(e)?e:i.t$(t)}))}))}}function E(e){return function(t){return function(n){return e.chain(n,i.EQ((function(n){return e.map(t(n),i.t$)}),(function(t){return e.of(i.F2(t))})))}}}function P(e){return function(t){return e.map(t,i.LF)}}function G(e){return function(t){return e.map(t,i.i$)}}},3689:(e,t,n)=>{n.d(t,{f7:()=>r,n_:()=>i,w4:()=>o});n(2169);var r=function(e){return{equals:function(t,n){return t===n||e(t,n)}}},i=function(e){return r((function(t,n){for(var r in e)if(!e[r].equals(t[r],n[r]))return!1;return!0}))},o={equals:function(e,t){return e===t}};o.equals},4906:(e,t,n)=>{n.d(t,{DT:()=>o,Y$:()=>u,fX:()=>a});var r=n(2169),i=n(8614);function o(e){return function(t,n){return function(r){return e.fromEither(t(r)?i.F2(r):i.t$(n(r)))}}}function s(e){return function(t){return(0,r.ls)(t,e.fromEither)}}function a(e,t){var n=s(e);return function(e){return function(r){return t.chain(r,n(e))}}}function u(e,t){return function(n,r){return function(o){return t.chain(o,(function(t){return e.fromEither(n(t)?i.F2(t):i.t$(r(t)))}))}}}},6289:(e,t,n)=>{function r(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.map(e,n)}))}}}function i(e){return function(t){return function(n){return e.map(n,(function(e){var n;return(n={})[t]=e,n}))}}}function o(e){return function(t,n){return function(r){return e.map(r,(function(e){var r;return Object.assign({},e,((r={})[t]=n(e),r))}))}}}n.d(t,{Hr:()=>o,UI:()=>r,YO:()=>i})},4694:(e,t,n)=>{n.d(t,{G5:()=>l,RD:()=>g,UI:()=>a,of:()=>u});var r=n(2169),i=(n(6289),n(8614)),o=function(e,t){return function(){return t(e())}},s=function(e,t){return function(){return e()(t())}},a=function(e){return function(t){return o(t,e)}},u=r.a9,c="IO",l={URI:c,map:o,ap:s},d=(r.yR,r.yR,i.F4,u(i.Xl)),f=function(e){var t=function(e){return function(t){return function(){for(var n=[e(0,i.YM(t))()],r=1;r<t.length;r++)n.push(e(r,t[r])());return n}}}(e);return function(e){return i.Od(e)?t(e):d}},p=function(e){return f((function(t,n){return e(n)}))},g=p(r.yR)},9144:(e,t,n)=>{n.d(t,{P:()=>o});var r=n(7144),i=n(2169),o=function(e){return(0,r.Y3)((function(){var t=JSON.stringify(e);if("string"!=typeof t)throw new Error("Converting unsupported structure to JSON");return t}),i.yR)}},8236:(e,t,n)=>{n.d(t,{g1:()=>z,G5:()=>U,Ri:()=>q,xu:()=>N,dO:()=>E,wp:()=>C,tS:()=>D,fX:()=>ee,mU:()=>Z,hX:()=>j,DZ:()=>L,xH:()=>X,g_:()=>V,Uo:()=>B,ij:()=>te,KQ:()=>re,DT:()=>f,Eh:()=>S,IS:()=>p,fS:()=>J,EK:()=>g,lo:()=>M,Wi:()=>Q,pC:()=>Y,UI:()=>k,EQ:()=>H,aD:()=>W,YP:()=>l,of:()=>P,RD:()=>ae,G:()=>d,FS:()=>ie,Y3:()=>ne,bM:()=>O});var r=n(6335),i=n(4906),o=n(2169),s=(n(6289),n(8614)),a=n(4327),u=n(7049);n(3226);function c(e,t){return function(n){return n?t.of(void 0):e.zero()}}var l=s.YP,d=s.G;function f(e){return function(t){return e(t)?d(t):l}}var p=function(e){return"Right"===e._tag?l:d(e.left)},g=function(e){return"Left"===e._tag?l:d(e.right)},m=function(e,t){return(0,o.zG)(e,k(t))},h=function(e,t){return(0,o.zG)(e,G(t))},v=function(e,t){return(0,o.zG)(e,D(t))},_=function(e,t){return(0,o.zG)(e,j(t))},y=function(e,t){return(0,o.zG)(e,L(t))},w=function(e,t){return(0,o.zG)(e,$(t))},b=function(e,t){return(0,o.zG)(e,F(t))},I="Option",S=function(e){return{equals:function(t,n){return t===n||(Q(t)?Q(n):!Q(n)&&e.equals(t.value,n.value))}}},k=function(e){return function(t){return Q(t)?l:d(e(t.value))}},E={URI:I,map:m},P=d,G=function(e){return function(t){return Q(t)||Q(e)?l:d(t.value(e.value))}},U={URI:I,map:m,ap:h},z={URI:I,map:m,ap:h,of:P},D=function(e){return function(t){return Q(t)?l:e(t.value)}},x={URI:I,map:m,ap:h,chain:v},C=function(e){return function(t){return Q(t)?e():t}},O=function(){return l},M=c({URI:I,zero:O},{URI:I,of:P}),T=D(o.yR),A=(0,u.s4)(l,l),R=function(e){return Q(e)?A:(0,u.s4)(p(e.value),g(e.value))},q={URI:I,compact:T,separate:R},j=function(e){return function(t){return Q(t)?l:e(t.value)?t:l}},L=function(e){return function(t){return Q(t)?l:e(t.value)}},$=function(e){return function(t){return(0,u.s4)(_(t,(0,a.ff)(e)),_(t,e))}},F=function(e){return(0,o.ls)(k(e),R)},N={URI:I,map:m,compact:T,separate:R,filter:_,filterMap:y,partition:w,partitionMap:b},B=g,K={URI:I,fromEither:B},Y=s.pC,Q=function(e){return"None"===e._tag},W=function(e,t){return function(n){return Q(n)?e():t(n.value)}},H=W,V=H,J=function(e){return function(t){return Q(t)?e():t.value}},X=T,Z=(0,r.m)(x),ee=(0,i.fX)(K,x),te=function(e){return null==e?l:d(e)},ne=function(e){try{return d(e())}catch(e){return l}},re=function(e){return(0,o.ls)(e,te)},ie=H(o.r5,o.yR);s.F4;var oe=P(s.Xl),se=function(e){var t=function(e){return function(t){var n=e(0,s.YM(t));if(Q(n))return l;for(var r=[n.value],i=1;i<t.length;i++){var o=e(i,t[i]);if(Q(o))return l;r.push(o.value)}return d(r)}}(e);return function(e){return s.Od(e)?t(e):oe}},ae=function(e){return se((function(t,n){return e(n)}))}(o.yR)},856:(e,t,n)=>{n.d(t,{Fp:()=>u,VV:()=>a,Zt:()=>s,uZ:()=>c});var r=n(3689),i=n(2169),o=function(e){return function(t,n){return t===n||0===e(t,n)}},s=function(e){return{equals:o(e),compare:function(t,n){return t===n?0:e(t,n)}}},a=(i.W8,function(e){return function(t,n){return t===n||e.compare(t,n)<1?t:n}}),u=function(e){return function(t,n){return t===n||e.compare(t,n)>-1?t:n}},c=function(e){var t=a(e),n=u(e);return function(e,r){return function(i){return n(t(i,r),e)}}};r.w4.equals},4327:(e,t,n)=>{n.d(t,{ff:()=>r});n(2169);var r=function(e){return function(t){return!e(t)}}},7812:(e,t,n)=>{n.d(t,{$R:()=>G,DZ:()=>N,EQ:()=>m,Eh:()=>ie,Eq:()=>O,Ew:()=>b,G:()=>fe,Hr:()=>me,JO:()=>S,Lx:()=>H,OE:()=>V,Od:()=>p,P5:()=>v,Su:()=>j,UI:()=>q,YM:()=>_,YO:()=>ge,Z$:()=>y,ZN:()=>te,bM:()=>T,bj:()=>P,cS:()=>le,cx:()=>w,f2:()=>I,hX:()=>$,hp:()=>E,iw:()=>X,j0:()=>pe,jG:()=>ne,kp:()=>C,nI:()=>ce,nq:()=>J,oA:()=>B,oR:()=>ue,of:()=>M,oh:()=>L,pJ:()=>ae,pR:()=>oe,qr:()=>k,t9:()=>U,tS:()=>A,u4:()=>W,uK:()=>K,uZ:()=>re,vP:()=>Z,xH:()=>R,xP:()=>Q,xb:()=>f,yW:()=>de,zo:()=>z});var r=n(3689),i=n(2169),o=n(6289),s=n(8614),a=n(3052),u=n(856),c=n(4214),l=n(7049),d=(n(3226),function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}),f=function(e){return 0===e.length},p=c.Od,g=(c.Ce,c.ws,c.R3);c.Im;var m=function(e,t){return function(n){return p(n)?t(n):e()}},h=c.dC;function v(e,t){return void 0===t?function(t){return v(e,t)}:h(e,t)?s.YP:s.G(t[e])}var _=function(e){return p(e)?s.G(c.YM(e)):s.YP},y=function(e){return p(e)?s.G(c.Z$(e)):s.YP};var w=function(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return s.G(n);return s.YP}};function b(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return s.G(t[n]);return s.YP}}var I=function(e){return function(t){for(var n=0;n<t.length;n++){var r=e(t[n]);if(s.pC(r))return r}return s.YP}};var S=function(e){return function(t){for(var n=t.length-1;n>=0;n--){var r=e(t[n]);if(s.pC(r))return r}return s.YP}},k=function(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return s.G(n);return s.YP}},E=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"Right"===r._tag&&t.push(r.right)}return t},P=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"Left"===r._tag&&t.push(r.left)}return t};function G(e,t){return void 0===t?function(t){return G(t,e)}:function(e,t,n){for(var r=[],i=Math.min(e.length,t.length),o=0;o<i;o++)r[o]=n(e[o],t[o]);return r}(e,t,(function(e,t){return[e,t]}))}function U(e){return function(t,n){if(void 0===n){var r=U(e);return function(e){return r(t,e)}}for(var i,o=0;o<n.length;o++)if(i=n[o],e.equals(i,t))return!0;return!1}}var z=function(e){return function(t){return f(t)?e:f(e)?t:t.concat(e)}};var D=function(e,t){return(0,i.zG)(e,q(t))},x=function(e,t,n){return(0,i.zG)(e,W(t,n))},C=function(e,t){return(0,i.zG)(e,ae(t))},O=function(e,t){return(0,i.zG)(e,ue(t))},M=c.of,T=function(){return le},A=function(e){return function(t){return(0,i.zG)(t,function(e){return function(t){if(f(t))return le;for(var n=[],r=0;r<t.length;r++)n.push.apply(n,e(r,t[r]));return n}}((function(t,n){return e(n)})))}},R=A(i.yR),q=function(e){return function(t){return t.map((function(t){return e(t)}))}},j=function(e){return function(t){return t.map((function(t,n){return e(n,t)}))}},L=function(e){for(var t=[],n=[],r=0,i=e;r<i.length;r++){var o=i[r];"Left"===o._tag?t.push(o.left):n.push(o.right)}return(0,l.s4)(t,n)},$=function(e){return function(t){return t.filter(e)}},F=function(e){return function(t){for(var n=[],r=0;r<t.length;r++){var i=e(r,t[r]);s.pC(i)&&n.push(i.value)}return n}},N=function(e){return F((function(t,n){return e(n)}))},B=N(i.yR),K=function(e){return Y((function(t,n){return e(n)}))},Y=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=t[i];e(i,o)?r.push(o):n.push(o)}return(0,l.s4)(n,r)}},Q=function(e){return function(t){return function(n){return n.reduce((function(n,r,i){return e.concat(n,t(i,r))}),e.empty)}}},W=function(e,t){return V(e,(function(e,n,r){return t(n,r)}))},H=function(e){var t=Q(e);return function(e){return t((function(t,n){return e(n)}))}},V=function(e,t){return function(n){for(var r=n.length,i=e,o=0;o<r;o++)i=t(o,i,n[o]);return i}},J=function(e,t){return X(e,(function(e,n,r){return t(n,r)}))},X=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}},Z=function(e){return function(t){return x(t,e.of(T()),(function(t,n){return e.ap(e.map(t,(function(e){return function(t){return(0,i.zG)(e,g(t))}})),n)}))}},ee="ReadonlyArray",te=function(e){return{show:function(t){return"[".concat(t.map(e.show).join(", "),"]")}}},ne=function(){return{concat:function(e,t){return f(e)?t:f(t)?e:e.concat(t)}}},re=function(){return{concat:ne().concat,empty:le}},ie=function(e){return(0,r.f7)((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))},oe=function(e){return(0,u.Zt)((function(t,n){for(var r=t.length,i=n.length,o=Math.min(r,i),s=0;s<o;s++){var u=e.compare(t[s],n[s]);if(0!==u)return u}return a.Df.compare(r,i)}))},se={URI:ee,map:D},ae=function(e){return function(t){for(var n=d([],e(t),!0),r=[];n.length>0;){var i=n.shift();s.nM(i)?n.unshift.apply(n,e(i.left)):r.push(i.right)}return r}},ue=function(e){return function(t){var n=e(t),r=[],i=[];function o(t){s.nM(t)?e(t.left).forEach((function(e){return r.push(e)})):i.push(t.right)}for(var a=0,u=n;a<u.length;a++){o(u[a])}for(;r.length>0;)o(r.shift());return i}},ce=(c.oo,function(e){return f(e)?le:e.slice()}),le=c.cS;function de(e){return function(t){return t.every(e)}}var fe=function(e){return function(t){return t.some(e)}},pe=function(e){var t=c.j0(e);return function(n){return m((function(){return e.empty}),t(n))}},ge=(s.F4,(0,o.YO)(se)),me=(0,o.Hr)(se);c.w6,c.QI,c.Ss},4214:(e,t,n)=>{n.d(t,{Ce:()=>f,Eh:()=>M,Fp:()=>j,Im:()=>p,Lx:()=>G,OE:()=>z,Od:()=>c,QI:()=>F,R3:()=>g,Ss:()=>N,UI:()=>k,VV:()=>q,YM:()=>T,Z$:()=>R,ZN:()=>O,c2:()=>h,cS:()=>u,dC:()=>l,iw:()=>x,j0:()=>$,nI:()=>y,nq:()=>U,of:()=>S,oo:()=>m,u4:()=>P,ur:()=>L,vM:()=>b,w6:()=>_,ws:()=>d,xP:()=>D});var r=n(3689),i=n(2169),o=(n(6289),n(8614)),s=n(1340),a=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},u=o.Xl,c=o.Od,l=function(e,t){return e<0||e>=t.length},d=function(e){return function(t){return a([e],t,!0)}},f=d,p=function(e){return function(t){return a(a([],t,!0),[e],!1)}},g=p,m=function(e,t,n){if(c(n)){var r=o.r1(n);return r.splice(e,0,t),r}return[t]},h=function(e){return c(e)?o.G(e):o.YP},v=function(e){return function(t){for(var n=Math.max(0,Math.floor(t)),r=[e(0)],i=1;i<n;i++)r.push(e(i));return r}},_=function(e,t){return e<=t?v((function(t){return e+t}))(t-e+1):[e]},y=function(e){return h(e.slice())};function w(e,t){return t?e.concat(t):function(t){return t.concat(e)}}var b=function(e){return function(t){for(var n={},r=0,i=t;r<i.length;r++){var s=i[r],a=e(s);o.e$.call(n,a)?n[a].push(s):n[a]=[s]}return n}};var I=function(e){return function(t){for(var n=[e,t[0]],r=1;r<t.length;r++)n.push(e,t[r]);return n}},S=o.ri,k=function(e){return E((function(t,n){return e(n)}))},E=function(e){return function(t){for(var n=[e(0,T(t))],r=1;r<t.length;r++)n.push(e(r,t[r]));return n}},P=function(e,t){return z(e,(function(e,n,r){return t(n,r)}))},G=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r){return e.concat(n,t(r))}),t(n[0]))}}},U=function(e,t){return x(e,(function(e,n,r){return t(n,r)}))},z=function(e,t){return function(n){return n.reduce((function(e,n,r){return t(r,e,n)}),e)}},D=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r,i){return e.concat(n,t(i+1,r))}),t(0,n[0]))}}},x=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}},C=o.YM,O=function(e){return{show:function(t){return"[".concat(t.map(e.show).join(", "),"]")}}},M=function(e){return(0,r.f7)((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))},T=(o.F4,C),A=o.Gb,R=function(e){return e[e.length-1]},q=function(e){var t=s.VV(e);return function(e){return e.reduce(t.concat)}},j=function(e){var t=s.Fp(e);return function(e){return e.reduce(t.concat)}},L=function(e){return function(t){return t.reduce(e.concat)}},$=function(e){var t=L(e);return function(e){return(0,i.ls)(function(e){return function(t){var n=A(t);return c(n)?(0,i.zG)(n,I(e),f(T(t))):t}}(e),t)}};function F(e,t){return void 0===t?f(e):(0,i.zG)(t,f(e))}var N=function(e,t){return(0,i.zG)(e,w([t]))}},6450:(e,t,n)=>{n.d(t,{Bu:()=>m,CC:()=>A,DZ:()=>Z,Dv:()=>le,EG:()=>g,EW:()=>N,Eh:()=>ue,G:()=>x,HA:()=>O,Hd:()=>P,I8:()=>q,P5:()=>h,RF:()=>R,RJ:()=>L,SW:()=>K,Su:()=>_,UI:()=>y,Ub:()=>Q,V_:()=>F,XP:()=>d,_Y:()=>$,_r:()=>E,dp:()=>u,dx:()=>f,e$:()=>p,hX:()=>X,jt:()=>G,kp:()=>T,mK:()=>V,mS:()=>j,nn:()=>M,nr:()=>de,nu:()=>B,oA:()=>oe,oh:()=>se,qS:()=>H,ri:()=>S,sq:()=>z,t9:()=>C,tV:()=>te,uK:()=>ee,uZ:()=>ce,vA:()=>W,vP:()=>k,xb:()=>c,yW:()=>D,z7:()=>U,zV:()=>Y});var r=n(3689),i=n(2169),o=n(8614),s=n(7049),a=n(229),u=(n(3226),function(e){return Object.keys(e).length}),c=function(e){for(var t in e)if(o.e$.call(e,t))return!1;return!0},l=function(e){return function(t){return Object.keys(t).sort(e.compare)}},d=l(a.Df);var f=function(e,t){return function(n){if(o.e$.call(n,e)&&n[e]===t)return n;var r=Object.assign({},n);return r[e]=t,r}},p=function(e,t){return o.e$.call(t,e)};function g(e){return function(t){if(!o.e$.call(t,e))return t;var n=Object.assign({},t);return delete n[e],n}}function m(e){return function(t,n){if(void 0===n){var r=m(e);return function(e){return r(e,t)}}for(var i in t)if(!o.e$.call(n,i)||!e.equals(t[i],n[i]))return!1;return!0}}function h(e,t){return void 0===t?function(t){return h(e,t)}:o.e$.call(t,e)?o.G(t[e]):o.YP}var v={};function _(e){return function(t){var n={};for(var r in t)o.e$.call(t,r)&&(n[r]=e(r,t[r]));return n}}function y(e){return _((function(t,n){return e(n)}))}function w(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2===e.length)return w(a.Df).apply(void 0,e);var n=l(e[0]);return function(e,t){return function(r){for(var i=e,o=n(r),s=o.length,a=0;a<s;a++){var u=o[a];i=t(u,i,r[u])}return i}}}function b(e){if("compare"in e){var t=l(e);return function(e){return function(n){return function(r){for(var i=e.empty,o=t(r),s=o.length,a=0;a<s;a++){var u=o[a];i=e.concat(i,n(u,r[u]))}return i}}}}return b(a.Df)(e)}function I(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2===e.length)return I(a.Df).apply(void 0,e);var n=l(e[0]);return function(e,t){return function(r){for(var i=e,o=n(r),s=o.length-1;s>=0;s--){var a=o[s];i=t(a,r[a],i)}return i}}}var S=function(e,t){var n;return(n={})[e]=t,n};function k(e){return V(a.Df)(e)}function E(e){return function(t){var n={},r={};for(var i in t)if(o.e$.call(t,i)){var a=e(i,t[i]);switch(a._tag){case"Left":n[i]=a.left;break;case"Right":r[i]=a.right}}return(0,s.s4)(n,r)}}function P(e){return function(t){var n={},r={};for(var i in t)if(o.e$.call(t,i)){var a=t[i];e(i,a)?r[i]=a:n[i]=a}return(0,s.s4)(n,r)}}function G(e){return function(t){var n={};for(var r in t)if(o.e$.call(t,r)){var i=e(r,t[r]);o.pC(i)&&(n[r]=i.value)}return n}}function U(e){return function(t){var n={},r=!1;for(var i in t)if(o.e$.call(t,i)){var s=t[i];e(i,s)?n[i]=s:r=!0}return r?n:t}}var z=function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[i[0]]=i[1]}return t};function D(e){return function(t){for(var n in t)if(!e(t[n]))return!1;return!0}}function x(e){return function(t){for(var n in t)if(e(t[n]))return!0;return!1}}function C(e){return function(t,n){if(void 0===n){var r=C(e);return function(e){return r(t,e)}}for(var i in n)if(e.equals(n[i],t))return!0;return!1}}var O=function(e,t){return(0,i.zG)(e,y(t))},M=function(e,t){return(0,i.zG)(e,_(t))},T=function(e){var t=ne(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},A=function(e){return function(t){var n=re(e)(t);return function(e,t){return(0,i.zG)(e,n(t))}}},R=function(e){var t=ie(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},q=function(e,t){return(0,i.zG)(e,X(t))},j=function(e,t){return(0,i.zG)(e,Z(t))},L=function(e,t){return(0,i.zG)(e,ee(t))},$=function(e,t){return(0,i.zG)(e,te(t))},F=function(e){var t=w(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},N=function(e){var t=b(e);return function(e){var n=t(e);return function(e,t){return(0,i.zG)(e,n(t))}}},B=function(e){var t=I(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},K=function(e,t){return(0,i.zG)(e,E(t))},Y=function(e,t){return(0,i.zG)(e,P(t))},Q=function(e,t){return(0,i.zG)(e,G(t))},W=function(e,t){return(0,i.zG)(e,U(t))},H=function(e){var t=J(e);return function(e){var n=t(e);return function(e,t){return n(e,(0,i.ls)(i.SK,t))}}},V=function(e){var t=H(e);return function(e){var n=t(e);return function(e){return n(e,i.yR)}}},J=function(e){return function(t){var n=l(e);return function(e,r){var i=n(e);if(0===i.length)return t.of(v);for(var o=t.of({}),s=function(n){o=t.ap(t.map(o,(function(e){return function(t){var r;return Object.assign({},e,((r={})[n]=t,r))}})),r(n,e[n]))},a=0,u=i;a<u.length;a++){s(u[a])}return o}}},X=function(e){return U((function(t,n){return e(n)}))},Z=function(e){return G((function(t,n){return e(n)}))},ee=function(e){return P((function(t,n){return e(n)}))},te=function(e){return E((function(t,n){return e(n)}))};function ne(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=w(e[0]);return function(e,t){return n(e,(function(e,n,r){return t(n,r)}))}}return ne(a.Df).apply(void 0,e)}function re(e){if("compare"in e){var t=b(e);return function(e){var n=t(e);return function(e){return n((function(t,n){return e(n)}))}}}return re(a.Df)(e)}function ie(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=I(e[0]);return function(e,t){return n(e,(function(e,n,r){return t(n,r)}))}}return ie(a.Df).apply(void 0,e)}var oe=function(e){var t={};for(var n in e)if(o.e$.call(e,n)){var r=e[n];o.pC(r)&&(t[n]=r.value)}return t},se=function(e){var t={},n={};for(var r in e)if(o.e$.call(e,r)){var i=e[r];o.nM(i)?t[r]=i.left:n[r]=i.right}return(0,s.s4)(t,n)},ae="ReadonlyRecord";function ue(e){var t=m(e);return(0,r.f7)((function(e,n){return t(e)(n)&&t(n)(e)}))}function ce(e){return{concat:function(t,n){if(c(t))return n;if(c(n))return t;var r=Object.assign({},t);for(var i in n)o.e$.call(n,i)&&(r[i]=o.e$.call(t,i)?e.concat(t[i],n[i]):n[i]);return r},empty:v}}var le=function(e){var t,n=(t=e,function(e){return function(n){if(c(n))return e;if(c(e))return n;var r={};for(var i in n)p(i,e)?r[i]=t.concat(n[i],e[i]):r[i]=n[i];for(var i in e)p(i,r)||(r[i]=e[i]);return r}});return{concat:function(e,t){return n(t)(e)}}};a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df;function de(e,t){return o.e$.call(void 0===t?this:t,e)}a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df},3643:(e,t,n)=>{n.d(t,{H5:()=>a,Kl:()=>u,Lx:()=>l,Pd:()=>o,Yg:()=>i,li:()=>r,nq:()=>d,pL:()=>s,u4:()=>c});n(2169);function r(e){return e[0]}function i(e){return e[1]}var o=function(e,t){return function(n){return[t(r(n)),e(i(n))]}},s=function(e){return function(t){return[e(r(t)),i(t)]}},a=function(e){return function(t){return[r(t),e(i(t))]}},u=r,c=function(e,t){return function(n){return t(e,r(n))}},l=function(){return function(e){return function(t){return e(r(t))}}},d=function(e,t){return function(n){return t(r(n),e)}}},5086:(e,t,n)=>{n.d(t,{ff:()=>r});var r=function(e){return function(t){return!e(t)}}},1340:(e,t,n)=>{n.d(t,{Z$:()=>c,Fp:()=>a,VV:()=>s,n_:()=>u});var r,i=n(8614),o=n(856),s=function(e){return{concat:o.VV(e)}},a=function(e){return{concat:o.Fp(e)}},u=function(e){return{concat:function(t,n){var r={};for(var o in e)i.e$.call(e,o)&&(r[o]=e[o].concat(t[o],n[o]));return r}}},c=function(){return{concat:function(e,t){return t}}};r=void 0},7049:(e,t,n)=>{n.d(t,{Pd:()=>i,s4:()=>r});n(2169);var r=function(e,t){return{left:e,right:t}},i=function(e,t){return function(n){return r(e(o(n)),t(s(n)))}},o=function(e){return e.left},s=function(e){return e.right}},2678:(e,t,n)=>{n.d(t,{qA:()=>b,Hi:()=>w,qo:()=>I,dO:()=>_,UA:()=>S,PM:()=>y,ap:()=>g,Qt:()=>z,ak:()=>U,YO:()=>G,tS:()=>h,mU:()=>k,At:()=>P,tD:()=>c,UI:()=>p,of:()=>m,uU:()=>O,pE:()=>M});var r=n(2945),i=n(6335),o=n(2169);function s(e,t){var n=(0,i.m)(t);return function(t){return n((0,o.ls)(t,e.fromIO))}}var a=n(6289),u=n(8614),c=function(e){return function(){return Promise.resolve().then(e)}};var l=function(e,t){return(0,o.zG)(e,p(t))},d=function(e,t){return(0,o.zG)(e,g(t))},f=function(e,t){return(0,o.zG)(e,h(t))},p=function(e){return function(t){return function(){return Promise.resolve().then(t).then(e)}}},g=function(e){return function(t){return function(){return Promise.all([Promise.resolve().then(t),Promise.resolve().then(e)]).then((function(e){return(0,e[0])(e[1])}))}}},m=function(e){return function(){return Promise.resolve(e)}},h=function(e){return function(t){return function(){return Promise.resolve().then(t).then((function(t){return e(t)()}))}}},v="Task";var _={URI:v,map:l},y={URI:v,of:m},w={URI:v,map:l,ap:d},b={URI:v,map:l,ap:d,of:m},I={URI:v,map:l,ap:d,chain:f},S={URI:v,map:l,of:m,ap:d,chain:f},k=(o.yR,(0,i.m)(I)),E={URI:v,fromIO:c},P=s(E,I),G=(u.F4,(0,a.YO)(_)),U=(0,i.a)(I),z=(0,r.Qt)(w),D=m(u.Xl),x=function(e){var t=function(e){return function(t){return function(){return Promise.all(t.map((function(t,n){return Promise.resolve().then((function(){return e(n,t)()}))})))}}}(e);return function(e){return u.Od(e)?t(e):D}},C=function(e){var t=function(e){return function(t){return function(){return u.Gb(t).reduce((function(t,n,r){return t.then((function(t){return Promise.resolve().then(e(r+1,n)).then((function(e){return t.push(e),t}))}))}),Promise.resolve().then(e(0,u.YM(t))).then(u.ri))}}}(e);return function(e){return u.Od(e)?t(e):D}},O=function(e){return x((function(t,n){return e(n)}))},M=function(e){return C((function(t,n){return e(n)}))}},132:(e,t,n)=>{n.d(t,{Do:()=>V,Qt:()=>Z,ak:()=>X,tS:()=>A,fX:()=>Y,wE:()=>H,Zl:()=>R,Y$:()=>Q,Uo:()=>b,tD:()=>y,fF:()=>w,fS:()=>k,t$:()=>g,Hr:()=>J,UI:()=>C,Vn:()=>M,EQ:()=>I,LV:()=>S,of:()=>j,Ij:()=>ee,Y3:()=>E});var r=n(2945),i=n(6335),o=n(7125),s=n(4906),a=n(2169);function u(e,t){return function(n){var r=(0,a.ls)(n,e.fromTask);return function(e){return t.chain(e,r)}}}var c=n(6289),l=n(8614),d=n(2678),f=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},p=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},g=o.t$(d.PM),m=o.F2(d.PM),h=o.m8(d.dO),v=o.pk(d.dO),_=(0,a.ls)(d.tD,h),y=(d.tD,_),w=h,b=d.of,I=(d.tD,o.EQ(d.dO)),S=o.LV(d.UA),k=o.fS(d.UA),E=function(e,t){return function(){return f(void 0,void 0,void 0,(function(){var n;return p(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e().then(l.F2)];case 1:return[2,r.sent()];case 2:return n=r.sent(),[2,l.t$(t(n))];case 3:return[2]}}))}))}},P=(d.dO,d.PM,d.PM,d.UA,d.UA,d.UA,d.UA,d.dO,function(e,t){return(0,a.zG)(e,C(t))}),G=function(e,t){return(0,a.zG)(e,T(t))},U=function(e,t){return(0,a.zG)(e,A(t))},z=function(e,t,n){return(0,a.zG)(e,O(t,n))},D=function(e,t){return(0,a.zG)(e,M(t))},x=function(e,t){return(0,a.zG)(e,q(t))},C=o.UI(d.dO),O=o.Pd(d.dO),M=o.Vn(d.dO),T=o.ap(d.Hi),A=o.tS(d.UA),R=A,q=o.wp(d.UA),j=m,L=g,$="TaskEither";var F={URI:$,map:P},N={URI:$,map:P,ap:G},B={URI:$,map:P,ap:G,chain:U},K={URI:$,fromEither:b},Y=(0,s.fX)(K,B),Q=(0,s.Y$)(K,B),W={URI:$,fromIO:y,fromTask:w},H=u(W,B);var V=j(l.F4),J=(0,c.Hr)(F),X=(0,i.a)(B),Z=(0,r.Qt)(N),ee=(l.Xl,{URI:$,bimap:z,mapLeft:D,map:P,of:j,ap:G,chain:U,alt:x,fromIO:y,fromTask:w,throwError:L})},3226:(e,t,n)=>{function r(e,t){return function(n){var r=e.traverse(n);return function(e,i){return n.map(r(e,i),t.separate)}}}function i(e,t){return function(n){var r=e.traverse(n);return function(e,i){return n.map(r(e,i),t.compact)}}}n.d(t,{BL:()=>i,Fj:()=>r})},2169:(e,t,n)=>{n.d(t,{MZ:()=>i,Q1:()=>c,SK:()=>p,W8:()=>s,a9:()=>o,bc:()=>d,gn:()=>a,ls:()=>l,r5:()=>u,yR:()=>r,zG:()=>f});function r(e){return e}var i=r;function o(e){return function(){return e}}var s=o(!0),a=o(null),u=o(void 0),c=u;function l(e,t,n,r,i,o,s,a,u){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return r(n(t(e.apply(this,arguments))))};case 5:return function(){return i(r(n(t(e.apply(this,arguments)))))};case 6:return function(){return o(i(r(n(t(e.apply(this,arguments))))))};case 7:return function(){return s(o(i(r(n(t(e.apply(this,arguments)))))))};case 8:return function(){return a(s(o(i(r(n(t(e.apply(this,arguments))))))))};case 9:return function(){return u(a(s(o(i(r(n(t(e.apply(this,arguments)))))))))}}}function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}function f(e,t,n,r,i,o,s,a,u){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return i(r(n(t(e))));case 6:return o(i(r(n(t(e)))));case 7:return s(o(i(r(n(t(e))))));case 8:return a(s(o(i(r(n(t(e)))))));case 9:return u(a(s(o(i(r(n(t(e))))))));default:for(var c=arguments[0],l=1;l<arguments.length;l++)c=arguments[l](c);return c}}var p=function(e,t){return t}},8614:(e,t,n)=>{n.d(t,{F2:()=>d,F4:()=>v,G:()=>a,Gb:()=>m,Od:()=>p,Wi:()=>i,Xl:()=>h,YM:()=>g,YP:()=>s,e$:()=>_,nM:()=>u,pC:()=>o,r1:()=>y,ri:()=>f,t$:()=>l,tO:()=>c});var r=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},i=function(e){return"None"===e._tag},o=function(e){return"Some"===e._tag},s={_tag:"None"},a=function(e){return{_tag:"Some",value:e}},u=function(e){return"Left"===e._tag},c=function(e){return"Right"===e._tag},l=function(e){return{_tag:"Left",left:e}},d=function(e){return{_tag:"Right",right:e}},f=function(e){return[e]},p=function(e){return e.length>0},g=function(e){return e[0]},m=function(e){return e.slice(1)},h=[],v={},_=Object.prototype.hasOwnProperty,y=function(e){return r([e[0]],e.slice(1),!0)}},3052:(e,t,n)=>{n.d(t,{Df:()=>i,Eq:()=>r});var r={equals:function(e,t){return e===t}},i={equals:r.equals,compare:function(e,t){return e<t?-1:e>t?1:0}};r.equals,i.compare},229:(e,t,n)=>{n.d(t,{Df:()=>i,Eq:()=>r,xb:()=>o});var r={equals:function(e,t){return e===t}},i={equals:r.equals,compare:function(e,t){return e<t?-1:e>t?1:0}},o=function(e){return 0===e.length}},3215:(e,t,n)=>{n.d(t,{GL:()=>a,HJ:()=>u,N1:()=>l,NC:()=>r,RP:()=>i,SF:()=>d,UM:()=>c,ho:()=>p,iE:()=>f});const r=performance.now(),i=(new Date).getTime();let o=[],s=!1;const a=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u((()=>e(...n)))},u=(e,t)=>{if(!s){const n=self.setTimeout(e,t);return()=>self.clearTimeout(n)}let n;const r=()=>{void 0!==n&&s&&o.length<1e4&&o.push([n,performance.now()]),n=void 0},i=[self.setTimeout((()=>{n=performance.now(),self.requestAnimationFrame(r),e()}),t),self.setTimeout(r,t)];return()=>{void 0===n&&i.forEach((e=>self.clearTimeout(e)))}},c=(e,t)=>{if(!s){const n=self.setInterval(e,t);return()=>self.clearInterval(n)}let n=!1,r=()=>{};const i=self.setInterval((()=>{r=u((()=>{n||e()}))}),t);return()=>{n=!0,r(),self.clearInterval(i)}},l=e=>()=>{return t=e(),new Promise(((e,n)=>t.then(a(e),a(n))));var t},d=e=>{const t=l(e);return()=>new Promise((e=>u((()=>e(t())))))},f=()=>{const e=o;return o=[],e},p=e=>{s=e}},1561:(e,t,n)=>{n.d(t,{ap:()=>w,a9:()=>v,Ue:()=>g,gS:()=>m,D8:()=>G,VS:()=>b,xH:()=>I,En:()=>h,p4:()=>P,UI:()=>y,Rp:()=>S,vP:()=>k,bw:()=>U,YP:()=>_});var r=n(5654),i=n(7144),o=n(2169),s=n(8236),a=n(7812),u=n(4991);function c(e){let t=e,n=[],r=!1;return{addListener(e){if(r)return()=>{};let i=t;const o=()=>{Object.is(t,i)||(i=t,e(t))};n=[...n,o];return()=>{n=n.filter((e=>e!==o))}},notify(e){if(r)throw new Error("Ref bug: Attempted to notify a terminated notifier");Object.is(e,t)||(t=e,n.forEach((e=>e())))},terminate(){r=!0,n=[]}}}function l(e,t){let n=0;return function(){try{if(n++>0)throw new Error(e);return t(...arguments)}finally{n--}}}function d(e,t){let n=[...new Set(e)].filter((e=>"final"!==e.state));if(0===n.length)return{state:"final",onStateChange:()=>()=>{}};const r=()=>0===n.length?"final":n.some((e=>"might_change"===e.state))?"might_change":"nominal",[i,o]=f(r(),(e=>"might_change"!==e&&t())),s=()=>o(r());return n.forEach((t=>{t.onStateChange((t=>{switch(t){case"final":n=e.filter((e=>"final"!==e.state)),s();break;case"might_change":o("might_change");break;case"nominal":s();break;default:throw new Error(`Ref bug: Invalid state ${t}`)}}))})),i}function f(e,t){if("final"===e)return[{state:"final",onStateChange:()=>()=>{}},()=>{}];const{terminate:n,notify:r,addListener:i}=c(e),o={state:e,onStateChange:i},s=l("Disallowed recursion in Branch.",(e=>{if("final"===o.state){if("final"===e)return;throw new Error(`Attempted to change state of final branch to ${e}.`)}try{t?.(e),o.state=e,r(e)}finally{"final"===e&&n()}}));return[o,s]}var p=n(4694);function g(e){const[t,n,r]=function(){const[e,t]=f("nominal"),n=l("Disallowed recursion in Branch.",(n=>{if("final"===e.state)throw new Error("Attempted to mutate a finalized Ref.");const r=e.state;try{t("might_change"),n()}finally{t(r)}}));return[e,n,()=>t("final")]}(),[i,o]=z(t,e);return[i,e=>n((()=>o(e))),r]}function m(e){let t=e.empty;const n=()=>()=>{const n=t;return t=e.empty,n},[r,i,o]=g(n());return[r,r=>{t=e.concat(t,r),i(n())},o]}function h(e,t){return n=>{let r=new Array(e).fill(t.empty);return new Array(e).fill(null).map(((e,i)=>(0,o.zG)(n,y(p.UI((e=>{const n=t.concat(r[i],e);return r=r.map(((n,r)=>r===i?t.empty:t.concat(n,e))),n}))))))}}function v(e){return{get current(){return e},onChange:()=>()=>{},branch:{state:"final",onStateChange:()=>()=>{}}}}function _(e){return t=>{const n=t.onChange(e);return e(t.current),n}}function y(e,t){if(t){const[n,r]=z(t.branch,e(t.current));return t.onChange((t=>r(e(t)))),n}return t=>y(e,t)}const w=e=>b((t=>y(t)(e)));function b(e,t){return t?I(y(e,t)):t=>I(y(e,t))}function I(e){if("final"===e.branch.state)return e.current;const[t,n]=function(e,t){let n=t;const r=[e.state,n.state].includes("might_change")?"might_change":"nominal",[i,o]=f(r),s=e=>t=>{switch(t){case"final":o(e().state);break;case"might_change":o("might_change");break;case"nominal":"might_change"===e().state?o("might_change"):o("nominal");break;default:throw new Error(`Ref bug: Unexpected upstream state ${t}`)}};e.onStateChange(s((()=>n)));const a=s((()=>e));let u=n.onStateChange(a);return[i,e=>{n=e,u(),u=e.onStateChange(a),a(n.state)}]}(e.branch,e.current.branch),[r,i]=z(t,e.current.current);let o=e.current.onChange(i);return e.onChange((e=>{o(),o=e.onChange(i),n(e.branch),i(e.current)})),r}function S(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{if(2===t.length){let n=t[0];return y((e=>(n=t[1](n,e),n)),e)}let n=s.bM();return y((e=>{const r=t[0](n,e);return n=s.G(r),r}),e)}}function k(){if(0===arguments.length||D(arguments.length<=0?void 0:arguments[0]))return E(...arguments);const e=arguments.length<=0?void 0:arguments[0],t=Object.keys(e);return(0,o.zG)(Object.values(e),(e=>E(...e)),y((0,o.ls)(a.Su(((e,n)=>[t[e],n])),Object.fromEntries)))}function E(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return v([]);if(1===t.length)return y((e=>[e]))(t[0]);let r=!1;t.forEach((e=>e.onChange((()=>{if("might_change"!==e.branch.state)throw new Error("Ref bug: Received a change notification without a `might_change` state.");r=!0}))));const i=t.map((0,u.vg)("branch")),o=()=>{r&&(r=!1,c(t.map((e=>e.current))))},s=d(i,o),[a,c]=z(s,t.map((e=>e.current)));return a}function P(e){const[t,n,a]=g(s.YP);return e.then(i.F2).catch((0,o.ls)(r.w,i.t$)).then((0,o.ls)(s.G,n,a)),t}function G(e){const t=e.hasOwnProperty("equals")?e.equals:e;return function(e){return t=>{if("final"===t.branch.state)return t;let n=s.YP;return y((t=>{if(s.Wi(n))return n=s.G(t),t;const r=e(n.value,t);return n=s.G(r),r}),t)}}(((e,n)=>t(e,n)?e:n))}function U(e){return t=>(_(e)(t),t)}function z(e,t){if("final"===e.state)return[v(t),()=>{}];const n=c(t);e.onStateChange((e=>{"final"===e&&n.terminate()}));let r=t;return[{get current(){return r},onChange:n.addListener,branch:e},l("Disallowed recursion in Ref.",(e=>{r=e,n.notify(r)}))]}function D(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&"function"==typeof e.onChange}},8659:(e,t,n)=>{n.d(t,{Hr:()=>g,K4:()=>a,UI:()=>l,ak:()=>p,bw:()=>d,dQ:()=>u,of:()=>c,vP:()=>f});var r=n(1561),i=n(2169),o=n(4991),s=n(6450);const a=e=>(0,i.ls)((t=>{let{previousState:n,...r}=t;return e(r)}),(e=>({value:e,state:r.a9(void 0)}))),u=i.yR,c=(0,i.ls)(i.a9,a),l=e=>t=>(0,i.ls)(t,(0,o.rO)({value:e})),d=e=>t=>(0,i.ls)(t,(0,o.rO)({value:(0,o.bw)(e)}));function f(e){return t=>{let{previousState:n,...o}=t;const a=h(n)?n:{},u=(0,i.zG)(e,s.Su(((e,t)=>t({previousState:a[e],...o}))));return{value:(0,i.zG)(u,s.UI((e=>e.value))),state:(0,i.zG)(u,s.UI((e=>e.state)),(e=>r.vP(e)))}}}function p(e,t){return n=>(0,i.ls)((0,o.rO)({previousState:m}),(o=>{const s=n(o),a=t(s.value)({...o,previousState:o.previousState[e]});return{value:(0,i.zG)([s.value,a.value],(t=>{let[n,r]=t;if(!h(n))throw new Error("Service.bind() was passed an upstream Service with a non-record value.");return{...n,[e]:r}})),state:(0,i.zG)(r.vP(s.state,a.state),r.UI((t=>{let[n,r]=t;if(void 0===n)return{[e]:r};if(!h(n))throw new Error("Service.bind() was passed an upstream Service with a non-record state.");return{...n,[e]:r}})))}}))}const g=(e,t)=>l((n=>({...n,[e]:t(n)})));function m(e){return h(e)?e:{}}function h(e){return"object"==typeof e&&null!==e}},1828:(e,t,n)=>{n(3339)},4474:(e,t,n)=>{n.d(t,{lg:()=>g,Bt:()=>h});var r=n(9912),i=n(2169),o=n(8236),s=n(229),a=n(4991);var u=n(7144);class c{userId;network;api;logger;tcf;constructor(e,t,n,r,i){this.userId=e,this.network=t,this.api=n,this.logger=r,this.tcf=i}tag="appnexus";ttlInSeconds=86400;usedForThirdPartyData=!0;invalidAliases=["","0","-1"];logPrefix="identities[appnexus]:";async getId(){if((0,a.G6)(navigator.userAgent))return this.logger.debug(this.logPrefix,"skipped for Safari"),{type:"skipped"};const e=await this.tcf.getStatusOrAbortOnTimeout(2e3),t=(0,i.zG)(this.getGDPRParams(e),u.fS((()=>"")),(e=>`https://ib.adnxs.com/getuidj${e.length>0?`?${e}`:""}`));try{this.logger.debug(this.logPrefix,"start HTTP request");const e=await this.api.appnexus(t);return this.logger.debug(this.logPrefix,"end HTTP request"),{type:"attempted",result:(0,i.zG)(o.Y3((()=>e.uid)),o.tS(o.ij),o.hX((e=>this.isValidAlias(e))))}}catch(e){return this.logger.warn(this.logPrefix,"Failed to fetch id",e),{type:"attempted",result:o.YP}}}getGDPRParams(e){return u.Y3((()=>{if("missing"===e.type||"loaded"===e.type&&!e.data.gdprApplies)return"gdpr=0";return`gdpr=1&gdpr_consent=${"loaded"===e.type?e.data.tcString:""}`}),(e=>`Failed to retrieve GDPR query params. Got ${e}`))}reset(){return Promise.resolve()}isValidAlias(e){return!!e&&-1===this.invalidAliases.indexOf(e)}}var l=n(1561),d=n(6450),f=n(5086);const p=f.ff((e=>void 0===e));class g{metrics;trace;permutiveData;identityProviderEnv;logger;ref;setReady;thirdParty;rawRef;identityMapRef;setIdentityMap;providers={};static emailSHA256Regex=/^[a-f0-9]{64}$/;constructor(e,t,n,r,u){this.metrics=e,this.trace=t,this.permutiveData=n,this.identityProviderEnv=r,this.logger=u;const c=this.getCachedIdentitiesAndMigrateIfRequired(),[f,g]=l.Ue(c);this.identityMapRef=f,this.setIdentityMap=g,f.onChange((0,i.ls)(d.z7((e=>!m.has(e))),(0,a.bw)((e=>{this.logger.debug("[identities] Persisting",e),this.permutiveData.setData("identities",e)})))),this.rawRef=(0,i.zG)(f,l.UI((0,i.ls)(d.UI((e=>e.value)),d.hX(p))),l.D8(d.Eh(s.Eq)));const[h,v]=l.Ue(!1);this.ref=(0,i.zG)(l.vP(h,this.rawRef),l.UI((e=>{let[t,n]=e;return(0,i.zG)(n,(0,o.DT)((()=>t)))}))),this.setReady=()=>{e.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"identity_ready",time_origin:"sdk_init"}),v(!0)},this.thirdParty=this.prepareThirdPartyIdentities()}get identities(){return this.identityMapRef.current}prepareThirdPartyIdentities(){this.logger.debug("[Identities]","loading 3rd party identities");const e=this.metrics.startTimer("sdk_get_third_party_identities_task_duration_seconds",{}),t=this.trace.startSpan("load_tpd_ids"),n=[{load:e=>(e.config,e.network,e.api,e.userId,e.logger,o.YP)},{load:e=>{return t=e.userId,n=e.network,r=e.api,i=e.logger,s=e.tcf,o.G(new c(t,n,r,i,s));var t,n,r,i,s}},{load:e=>(e.cookies,e.messages,o.YP)},{load:e=>(e.cookies,o.YP)},{load:e=>(e.metrics,e.permutiveData,e.permutive,e.messages,o.YP)}],s=(0,r.oA)(n.map((e=>e.load(this.identityProviderEnv)))).map((e=>this.shouldAskForNewIdentity(e)?this.retrieveIdentity(e):Promise.resolve((0,i.bc)(e,this.getCachedTPDIdentity(e.tag)))));return Promise.all(s).then((e=>e.map((e=>{let[t,n]=e;return this.providers[t.tag]=t,this.mapTPDIdentityIfPresent(t.tag,n,t.ttlInSeconds)})))).then((e=>this.setIdentities(e))).then((0,a.bw)((()=>{this.metrics.stopTimer("sdk_get_third_party_identities_task_duration_seconds",e),t.finish()})))}getPrioritizedIdentities(e){const t={default:0,appnexus:1},n=Object.entries(e).map((e=>{let[t,{id:n,expiry:r,priority:i}]=e;return{tag:t,...n?{id:n}:{},...r?{expiry:r}:{},...void 0!==i?{priority:i}:{}}})),i=n.filter((e=>((e,t)=>!!e.id&&!(0,r.t9)(s.Eq)(e.tag,t))(e,Object.values(this.providers).map((e=>e.tag))))),a=n.filter((e=>((e,t)=>!!e.id&&!!(0,r.t9)(s.Eq)(e.tag,t))(e,Object.values(this.providers).map((e=>e.tag))))),u=(0,r.DZ)((e=>(0,o.ij)(e.priority)))(i),c=u.length>0?Math.max(...u):0,l=i.map((e=>void 0!==e.priority?{...e,priority:e.priority}:{...e,priority:c+1})),d=a.map((e=>void 0===t[e.tag]?{tag:e.tag,id:e.id,priority:c+v}:{tag:e.tag,id:e.id,priority:c+_}));return l.concat(d)}getIdentitiesMap(){return this.getFilteredIdentities(((e,t)=>!!t.value))}parseCustomerDefinedIdentities(e){const t=`Identify must be passed a non-empty string or list of { tag, id, priority? } tuples, value passed was '${JSON.stringify(e)}'`,n=e=>"string"==typeof e.id&&"string"==typeof e.tag,o=e=>"email_sha256"!==e.tag||g.emailSHA256Regex.test(e.id);return"string"==typeof e?(a=e).length>0?{left:[],right:[{id:a,tag:"default"}]}:{left:[t],right:[]}:Array.isArray(e)?(s=e,(0,i.zG)(s,r.tV((0,i.ls)(u.DT(n,(()=>t)),u.Y$(o,(()=>"Identify called with unsupported format of email_sha256 ID. The support format is hex-encoded 64 character long lowercase string.")))))):{left:[t],right:[]};var s,a}extractIdentifyFromQueue(e){let{global:t}=e;const n=()=>t.q.findIndex((e=>"identify"===e.functionName)),r=(e,i)=>{if(e<0)return i;const o=t.q.splice(e,1)[0],s=this.parseCustomerDefinedIdentities(o.arguments[0]);return r(n(),{left:i.left.concat(s.left),right:i.right.concat(s.right)})},{left:i,right:o}=r(n(),{left:[],right:[]});return i.forEach((e=>this.logger.warn("Invalid identity provided during init",e))),o}setIdentities(e){const t=e.reduce(((e,t)=>{let{tag:n,id:r,expiry:i,priority:o}=t;return void 0===this.identities[n]&&this.logger.debug(`identities[${n}]: added`),e[n]={...r?{value:r}:{},...i?{expiry:i}:{},...void 0!==o?{priority:o}:{}},e}),{}),n=this.rawRef.current;this.setIdentityMap({...this.identities,...t});const r=this.rawRef.current;return{identifyRequestRequired:()=>!d.xb(r)&&!d.Eh(s.Eq).equals(n,r)}}async reset(){this.setIdentityMap({}),await Promise.all(Object.values(this.providers).map((e=>e.reset())))}getFilteredIdentities(e){return(0,a.m8)(...Object.entries(this.identities).filter((t=>{let[n,r]=t;return e(n,r)})).map((e=>{let[t,{value:n,expiry:r,priority:o}]=e;return(0,i.bc)(t,{id:n,...r?{expiry:r}:{},...void 0!==o?{priority:o}:{}})})))}shouldAskForNewIdentity(e){const t=(0,o.ij)(this.identities?.[e.tag]);return(0,o.g_)((()=>!0),this.isIdentityExpired)(t)}getCachedTPDIdentity(e){return this.identities[e]?(0,o.ij)(this.identities[e].value):o.YP}mapTPDIdentityIfPresent(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:86400;const r=()=>Date.now()+Math.floor(1e3*n);return(0,o.g_)((()=>({tag:e,expiry:r()})),(t=>({tag:e,id:t,expiry:r()})))(t)}retrieveIdentity(e){return e.getId().then((t=>"skipped"===t.type?(0,i.bc)(e,o.YP):(0,i.zG)(t.result,(t=>this.metrics.track({name:(0,o.pC)(t)?"sdk_third_party_identity_present_count":"sdk_third_party_identity_missing_count",value:1,labels:{identity_tag:e.tag}})),(n=>(0,i.bc)(e,t.result)))))}isIdentityExpired(e){return"number"==typeof e.expiry&&Date.now()>=e.expiry}getCachedIdentitiesAndMigrateIfRequired(){return(e=>(0,a.m8)(...Object.entries(e).filter((e=>{let[t,n]=e;return!this.isIdentityExpired(n)&&!m.has(t)}))))(this.permutiveData.getData("identities")||{})}}const m=new Set(["public","email","email_md5","ip_address"]),h=(e,t,n,i,o)=>{const a=(e,t)=>{const n=["(null)"];return n.indexOf(e)>-1||!!w[e]||(0,r.jV)(s.Eq)(t,n).length>0},u=e=>"721d6d85-35f0-4e35-bb38-13eb0d465158"===e,c={"be668577-07f5-444d-98e0-222b990951b1":a,"e43c8a90-d17b-4790-bfda-81b069b3b8c2":(e,t,n)=>["thestudentroom.co.uk"].some((e=>n.indexOf(e)>-1))&&(0,r.jV)(s.Eq)(t,["tsr-"]).length>0,"5d79bce7-5d2b-427e-a6c4-b89b6c7bf048":a,"366ab8da-5efa-4355-ab00-84db3b68ded2":e=>"96539955-4d7e-40df-882b-7e2fbacedb1c"===e||"345600e7-fb5f-48b1-9aa6-cde5396419b0"===e,"f3a06674-ebb9-4b9d-ba8f-0052018c0687":u,"38dadd0d-257a-4641-b332-b8b0fd20a6cb":u,"10453011-272d-49cd-9043-1964fdb36fd8":e=>"936ba6ac-9a8b-454d-ba98-facebd7553fe"===e},l={"fe68d1f7-c9f4-45b3-8905-7cda73d3fd74":e=>!!y[e]},d=c[e]||l[t];return!!d&&d(o,n,i)},v=2,_=3,y={},w={}},86:(e,t,n)=>{n.d(t,{z:()=>r});class r{ingestIfEligible(e){return Promise.resolve()}}},9662:(e,t,n)=>{n.d(t,{u6:()=>o});var r=n(8659);n(1561),n(4991);const i={prebid:{onReady:()=>({})}},o=e=>r.of(i)},5696:(e,t,n)=>{n.d(t,{v:()=>s});class r{logger;permutive;id;segmentCode;triggerType;config;workspaceLevelConfig;prefix="[Activation]";constructor(e,t,n,r,i,o,s){this.logger=e,this.permutive=t,this.id=n,this.segmentCode=r,this.triggerType=i,this.config=o,this.workspaceLevelConfig=s}getSegmentCode(){return this.segmentCode}getTriggerType(){return this.triggerType}getConfig(){return this.config}getWorkspaceLevelConfig(){return this.workspaceLevelConfig}trackImpression(e){return this.trackActivation("impression",e)}trackConversion(e){return this.trackActivation("conversion",e)}trackActivation(e,t){const n={reaction_id:this.id,type:e};this.permutive.track("Reaction",n,t),this.logger.log(this.prefix,n.type,n)}}var i=n(4187);const o={dfp:{dfp:[],dfp_legacy:{}},eyeota_pixel:[],dbm:{omitted:0},appnexus:{244785:41131223,244786:41134074,244787:41154503,245780:41167435,245781:41167450,245782:41167454,245901:41227167,245902:41227170,245903:41227168},appnexus_adserver:[244787,244786,244785,245780,245782,245781,245903,245902,245901],nativo:[],rubicon_ssp:[],smart:[],freewheel:[],adswizz_keyvalue:[],curation_platforms:{adv:["adv"]}};class s{logger;permutive;clientContext;constructor(e,t,n){this.logger=e,this.permutive=t,this.clientContext=n}getSpecializedActivations(e){return o[e]}getActivations(e){return(0,i.Hn)(e)("activationConfigs",[]).filter((e=>this.areContextCriteriaSatisfied(e))).map((e=>new r(this.logger,this.permutive,e.id,e.sc,e.tt,e.c,e.wc)))}areContextCriteriaSatisfied(e){const t=e.cc,n=e=>{const t=this.clientContext.getContext()[e.key];switch(e.comparison){case"EQUALS":return t===e.value;case"NOT_EQUALS":return t!==e.value;case"CONTAINS":return"string"==typeof t&&t.indexOf(e.value)>=0;case"NOT_CONTAINS":return"string"==typeof t&&t.indexOf(e.value)<0}};return!t||("AND"===(r=t).operator?r.criteria.every(n):r.criteria.some(n));var r}}},4187:(e,t,n)=>{n.d(t,{$S:()=>s,Hn:()=>i,MU:()=>o});const r={web:{auto_init:!1,track_pageview_engagement:!0,track_form_submission:!1,track_link_click:!0,track_pageview_complete:!0,add_alchemy_taxonomy:!1,add_alchemy_entities:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]},appnexus:{auto_init:!0,member_id:977,activationConfigs:[]},appnexus_adserver:{auto_init:!0,activationConfigs:[]}},i=e=>{const t=r[e];return(e,n)=>t?.[e]??n},o=i("web"),s=i("dfp");i("facebook_pixel_v2")},7911:(e,t,n)=>{n.d(t,{J:()=>u});var r=n(2169),i=n(8236),o=n(7499);const s=e=>t=>class extends t{key=(()=>e)();put(e){return this.db.then((t=>t.put(e,this.key))).then(r.Q1)}getIfPresent(){return this.db.then((e=>e.get(this.key))).then(i.ij)}reset(){return this.db.then((e=>e.delete(this.key)))}},a=e=>(0,r.zG)(class{db;constructor(e){this.db=Promise.resolve((0,o.E)(e.namespace,e.logger,e.consent))}},s(e));class u extends(a("permutive-unprocessed-pba")){constructor(e){super(e)}}},4575:(e,t,n)=>{n.d(t,{Eq:()=>d,X:()=>f,b:()=>l});var r=n(1561),i=n(8659),o=n(3689),s=n(229),a=n(3052),u=n(2169),c=n(8236);const l=()=>({country:void 0,continent:void 0,environment:"",events_count:0,os:"",sample_rate:0,sdk_version:"",segments_count:0,session_count:0,session_init_count:0,session_view_count:0,user_agent:""}),d=o.n_({country:{equals:(e,t)=>e===t},continent:{equals:(e,t)=>e===t},environment:s.Eq,events_count:a.Eq,os:s.Eq,sample_rate:a.Eq,sdk_version:s.Eq,segments_count:a.Eq,session_count:a.Eq,session_init_count:a.Eq,session_view_count:a.Eq,user_agent:s.Eq}),f=e=>{const t=g(e.userId),n=(0,u.zG)(r.vP(e.userId,e.sessionId),r.UI((e=>{let[t,n]=e;return`${t},${n}`})),g),o=String(Math.random()),s=(0,u.zG)(e.sdkVariant,c.UI((e=>`-${e}`)),c.fS((()=>""))),a={environment:"web",events_count:0,os:p(window.navigator.userAgent||""),sample_rate:e.sampleRate,sdk_version:"v20.54.0"+s,segments_count:0,user_agent:window.navigator.userAgent||""};return(0,u.zG)(i.vP({session_count:t(e.sessionId),session_init_count:n(r.a9(o)),session_view_count:n(e.viewId)}),i.UI((0,u.ls)((t=>r.vP({...t,continent:(0,u.zG)(e.geoInfo,r.UI(c.tS((e=>c.ij(e.continent)))),r.UI(c.FS)),country:(0,u.zG)(e.geoInfo,r.UI(c.tS((e=>c.ij(e.country)))),r.UI(c.FS))})),r.UI((e=>({...a,...e}))))))},p=e=>{const t=e.toLowerCase();return t.includes("windows")?"windows":t.includes("iphone")||t.includes("ipad")?"ios":t.includes("android")?"android":t.includes("macintosh")?"macos":t.includes("linux")?"linux":"unknown"},g=e=>t=>i.dQ((n=>{let{previousState:i}=n;const c=(0,u.zG)(r.vP(e,t),r.Rp(function(e){if(null!==e&&"object"==typeof e&&"scope"in e&&"lastValue"in e&&"count"in e)return e;return{scope:"",lastValue:"",count:1}}(i),((e,t)=>{let[n,r]=t;return{scope:n,lastValue:r,count:n!==e.scope?1:r!==e.lastValue?e.count+1:e.count}})),r.D8(o.n_({scope:s.Eq,lastValue:s.Eq,count:a.Eq})));return{state:c,value:(0,u.zG)(c,r.UI((e=>e.count)))}}))},7249:(e,t,n)=>{n.d(t,{p:()=>f});var r=n(5654),i=n(2169),o=n(4991),s=n(4575),a=n(1561),u=n(7812),c=n(132),l=n(2678),d=n(3215);const f=e=>{let t=e.context.current;(0,i.zG)(e.context,a.D8(s.Eq),a.Rp((0,i.bc)(s.b(),s.b()),((e,t)=>{let[,n]=e;return(0,i.bc)(n,t)})),(e=>e.onChange((e=>{let[n,r]=e;s.Eq.equals({...n,continent:void 0,country:void 0},{...r,continent:void 0,country:void 0})||p({beacon:!1}),t=r}))));const n="[Metrics Reporter]";let f=!0;const p=async o=>{let{beacon:s}=o;const a=t,d=(0,i.zG)(c.of(e.metrics.consume()),c.Y$((()=>f),(()=>{})),c.tS(u.EQ((()=>c.of(void 0)),(t=>c.Y3((()=>(async(t,n)=>{if(!t)return e.api.metrics(n);if(!e.api.metricsBeacon(n))throw new Error("Failed to send beacon.")})(s,{context:a,items:t})),(i=>{f=!1,function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];e.logger.error(n,...r)}(`Failed to publish metrics ${(0,r.w)(i).message}`,t)}))))),l.UI(i.Q1));return d()},g=()=>{(0,d.HJ)((()=>p({beacon:!1}).finally((()=>g()))),5e3)};g(),(0,o.Bf)((()=>p({beacon:!0})),{capture:!1})}},7311:(e,t,n)=>{n.d(t,{u:()=>r});class r{trace;metrics;messages;_isRealtime=!1;_isReady=!1;constructor(e,t,n){this.trace=e,this.metrics=t,this.messages=n}isRealtime(){return this._isRealtime}isReady(){return this._isReady}setAsRealtime(e){const t=performance.now();this._isRealtime=!0,this.trace.measureSinceInit("sdk_realtime").finish(),this.messages.emit("permutive:realtime"),this.metrics.trackTimeSinceInit("sdk_realtime_targeting_set_task_duration_seconds",{},t),this.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"sdk_realtime",time_origin:"sdk_init"},t),this.metrics.track({name:"sdk_user_segments_count",value:e,labels:{}})}setAsReady(){const e=performance.now();this._isReady=!0,this.trace.measureSinceInit("sdk_ready").finish(),this.messages.emit("permutive:ready"),this.metrics.trackTimeSinceInit("sdk_initialisation_task_duration_seconds",{},e),this.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"sdk_ready",time_origin:"sdk_init"},e),window.performance&&window.performance.memory&&(this.metrics.track({name:"sdk_heap_memory_bytes_used",value:window.performance.memory.usedJSHeapSize,labels:{}}),this.metrics.track({name:"sdk_heap_memory_limit_fraction_used",value:window.performance.memory.usedJSHeapSize/window.performance.memory.jsHeapSizeLimit,labels:{}}))}}},3697:(e,t,n)=>{n.d(t,{a:()=>y});var r=n(2169),i=n(6450),o=n(229),s=(n(3226),i.dp,i.xb,function(e){return function(t){return Object.keys(t).sort(e.compare)}}),a=s(o.Df);i.dx,i.e$;i.Bu,i.P5,i.Su,i.UI;i.ri;function u(e){return i.vP(e)}i._r;i.jt;i.yW,i.G,i.t9;var c=i.HA,l=(i.nn,i.kp),d=i.CC,f=i.RF,p=(i.I8,i.mS,i.RJ,i._Y,i.V_),g=i.EW,m=i.nu,h=(i.SW,i.zV,i.Ub,i.vA,i.qS),v=(i.mK,function(e){return function(t){var n=s(e);return function(e,r){var i=n(e);if(0===i.length)return t.of({});for(var o=t.of({}),s=function(n){o=t.ap(t.map(o,(function(e){return function(t){return e[n]=t,e}})),r(n,e[n]))},a=0,u=i;a<u.length;a++){s(u[a])}return o}}});i.hX,i.DZ,i.uK,i.tV;i.oA,i.oh;var _="Record";i.Eh,i.uZ,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,i.nr,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df;class y{config;localStorage;logger;permutiveData;cookies;externalData;constructor(e,t,n,r,i,o){this.config=e,this.localStorage=t,this.logger=n,this.permutiveData=r,this.cookies=i,this.externalData=o}async reset(){return this.logger.log("Resetting State"),(0,r.zG)(this.cookies.deleteCookie(this.config.cookieName),(e=>this.externalData.removeExternalData(this.config.cookieName)),(e=>a({_paols:!0,_papns:!0,_pcrdbs:!0,_pcrprs:!0,_pdfps:!0,_pfws:!0,_pnativo:!0,_prps:!0,_prubicons:!0,_psegs:!0,_psmart:!0,"permutive-id":!0,"permutive-loaded":!0,"permutive-prebid-rtd":!0,"permutive-prebid-id":!0,"permutive-events-cache":!0,_pssps:!0,_ppsts:!0,_pamzn_cohorts:!0,_pamzn_ids:!0,_padswizz:!0}).forEach((e=>this.externalData.removeExternalData(e)))),(e=>this.permutiveData.reset()),(e=>Promise.all([this.localStorage.delete(this.config.permutiveDataMiscKey),this.localStorage.delete(this.config.permutiveDataQueriesKey)])),r.Q1)}}},8295:(e,t,n)=>{n.d(t,{u:()=>r});class r{permutiveData;permutiveReset;userId;viewId;logger;constructor(e,t,n,r,i){this.permutiveData=e,this.permutiveReset=t,this.userId=n,this.viewId=r,this.logger=i}getPermutiveData(e){return this.permutiveData.getData(e)}setPermutiveData(e,t){return this.permutiveData.setData(e,t)}getStateSizeInBytes(){return this.logger.warn("getStateSizeInBytes needs to be updated to reflect new event persistence"),this.permutiveData.getDataSize()}reset(){return this.permutiveReset.reset()}}},5876:(e,t,n)=>{n.d(t,{W:()=>r});class r{ref;constructor(e){this.ref=e}get(){return this.ref.current}}},7499:(e,t,n)=>{n.d(t,{E:()=>i});var r=n(7184);const i=(e,t,n)=>{const i=window.localStorage;return(0,r.rK)(i,"[Local Storage]",e,t,n)}},2101:(e,t,n)=>{n.d(t,{u:()=>i});n(1118);var r=n(7184);const i=(e,t,n)=>{const i=window.sessionStorage;return(0,r.rK)(i,"[Session Storage]",e,t,n)}},7184:(e,t,n)=>{n.d(t,{oP:()=>u,rK:()=>d});var r=n(5654),i=n(842),o=n(7144),s=n(2169),a=n(1997);class u{storage;namespace;constructor(e,t){this.storage=e,this.namespace=t}async put(e,t){const n=this.namespace.getNamespacedStorageKey(t.toString());return this.storage.setItem(n,JSON.stringify(e)),t}async get(e){const t=this.namespace.getNamespacedStorageKey(e.toString()),n=this.storage.getItem(t);return null===n?null:(0,i.A)(n)}async delete(e){const t=this.namespace.getNamespacedStorageKey(e.toString());this.storage.removeItem(t)}async deleteStore(){}}const c=e=>{const{logger:t,consent:n,prefix:r}=e,i=(e,n)=>(t.debug(`${r} Failed to write ${String(n)} as consent is revoked`),Promise.resolve(n));return e=>class extends e{put=(()=>(0,a.v)(super.put.bind(this),i,(()=>!n.current)))()}},l=e=>{const{logger:t,prefix:n,storage:i}=e;return e=>class extends e{isSupported=null;isStorageSupported(){return null!==this.isSupported||(this.isSupported=o.Y3((()=>{const e="_permutive_ls_test";return i.setItem(e,e),i.getItem(e),i.removeItem(e),!0}),r.w),(0,s.zG)(this.isSupported,o.EQ((e=>{t.warn(`${n} Is NOT supported`,e)}),(()=>{t.debug(`${n} Is supported`)})))),this.isSupported}async put(e,t){return(0,s.zG)(this.isStorageSupported(),o.EQ((e=>{throw e}),(()=>super.put(e,t))))}async get(e){return(0,s.zG)(this.isStorageSupported(),o.EQ((()=>null),(()=>super.get(e))))}async delete(e){return(0,s.zG)(this.isStorageSupported(),o.EQ(s.Q1,(()=>super.delete(e))))}async deleteStore(){return(0,s.zG)(this.isStorageSupported(),o.EQ(s.Q1,(()=>super.deleteStore())))}}},d=(e,t,n,r,i)=>new((0,s.zG)(u,l({logger:r,prefix:t,storage:e}),c({logger:r,consent:i,prefix:t})))(e,n)},3339:(e,t,n)=>{n.d(t,{SD:()=>f});var r=n(8236),i=n(7144),o=n(7812),s=n(6450),a=n(2169),u=n(1561),c=n(4991);const l={tradedesk:21,ddp:755,appnexus:32,pubmatic:76,neustar_fabrick:468},d="[TCF]",f=(e,t)=>{const[n,f,g]=(0,a.zG)(u.Ue(r.YP),(e=>{let[n,...i]=e;return[(0,a.zG)(n,u.bw(r.UI((e=>{t.debug(d,`Status "${e.type}"`,e)})))),...i]})),m=e.__tcfapi;if(m){const e=new Set(["tcloaded","useractioncomplete"]);m("addEventListener",2,((n,i)=>{i?"loaded"===n.cmpStatus&&e.has(n.eventStatus)&&(t.debug(d,"TCF API loaded",n),f(r.G({type:"loaded",data:n}))):(t.warn(d,"TCF API failed to register event listener"),f(r.G({type:"aborted"})),g())}))}else t.debug(d,"TCF API missing from the page"),f(r.G({type:"missing"})),g();const[h,v]=(0,a.zG)(u.gS(o.uZ()),(e=>{let[t,n]=e;return[t,(0,a.ls)(o.of,n)]}));return(0,a.zG)(u.vP(n,h),u.bw((e=>{let[n,o]=e;return(0,a.zG)(n,r.UI((e=>{const n=o();switch(t.debug(d,`Processing ${n.length} listeners`,n),e.type){case"missing":n.forEach((n=>{let[r,i]=n;t.debug(d,`Invoking ${r} as TCF API missing`),i(e)}));break;case"aborted":n.forEach((e=>{let[n]=e;t.debug(d,`Invoking ${n} skipped as TCF API aborted`)}));break;case"loaded":n.forEach((n=>{let[o,u]=n;(0,a.zG)(p(e.data),r.EQ((()=>{t.debug(d,`Invoking ${o} as GDPR does not apply`),u(e)}),(n=>(0,a.zG)((0,a.zG)(o,i.EQ((e=>r.G(e)),(e=>(0,a.zG)(l,s.P5(e))))),r.tS((e=>(0,a.zG)(n,s.P5(e.toString())))),r.UI((n=>{n?(t.debug(d,`${o} has consent`,{vendor:o}),u(e)):t.debug(d,`${o} does not have consent`,{vendor:o})}))))))}))}})))}))),{registerVendorOnValidConsent:(e,t)=>v([(0,a.zG)(e,i.DT((e=>"string"==typeof e),(()=>e))),t]),getStatusOrAbortOnTimeout:e=>new Promise((t=>{const i=setTimeout((()=>t({type:"aborted"})),e);(0,a.zG)(n,u.UI(r.UI((e=>{clearTimeout(i),t(e)}))))})).then((0,c.bw)((e=>t.debug(d,"TCF status resolved as",{status:e})))),tcfApiStatusRef:n}},p=e=>e.gdprApplies?r.G(e.vendor.consents):r.YP},3832:(e,t,n)=>{n.d(t,{C:()=>a});var r=n(9912),i=n(2169);n(5869),n(9662);const o=(s=[[],[{name:"appnexus_adserver",import:Promise.resolve().then(n.bind(n,2097))}],[],[],[{name:"appnexus",import:Promise.resolve().then(n.bind(n,7806))}],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[{name:"web",import:Promise.resolve().then(n.bind(n,3530))}],[],[],[],[],[],[]],(0,i.zG)((0,r.xH)(s),(0,r.u4)({},((e,t)=>({...e,[t.name]:t.import})))));var s;const a=e=>{const t=Object.entries(o).map((async t=>{let[n,r]=t;return e.logger.log(`Loading addon ${n}`),(await r).load(e)}));return Promise.all(t)}},2097:(e,t,n)=>{n.r(t),n.d(t,{APPNEXUS_SEGMENTS_STORAGE_KEY:()=>f,AppNexusAdServerAddon:()=>v,appnexusAdServer:()=>_,appnexusContextualAdServer:()=>E,load:()=>h});var r=n(4187),i=n(4991),o=n(2169),s=n(7144),a=n(7812),u=n(1561),c=n(3215);const l="[appnexus]",d=(0,r.Hn)("appnexus_adserver")("auto_init",!1),f="_papns",p=()=>{try{return window.apntag.getTag()}catch{return{}}},g=e=>{try{return window.apntag.getTag(e)}catch{return}};let m=s.t$("Not initialised");const h=e=>{if(d&&e.q.push({functionName:"addon",arguments:["appnexus_adserver",{}]}),void 0!==window.apntag&&window.apntag.anq&&window.apntag.anq.push){e.permutive.ready((0,i.Z_)(e.api,e.userId,(()=>{let t=!1;const n=p();Object.keys(n).forEach((e=>{n[e].displayed&&(t=!0)}));const r=t?"sdk_targeting_realtime_fail_count":"sdk_targeting_realtime_success_count";e.metrics.track({name:r,value:1,labels:{target:"appnexus"}})})),"realtime"),m=(0,o.zG)(k(),(0,i.bw)(s.pF((t=>e.logger.error(l,t)))));const t=w({listenerRepository:m,logger:e.logger,permutive:e.permutive});b(t),(0,o.zG)(m,s.UI((e=>I(t,e.signal))))}};class v{options;logger;userId;api;activationManager;externalData;segments={cloudCohorts:[],live:[]};eligibleSegments={};constructor(e){this.options=e,this.logger=e.logger,this.userId=e.userId,this.api=e.api,this.activationManager=e.activationManager,this.externalData=e.externalData;const t=(0,o.zG)(e.nextGenOutput.activations.xandr_ssp??u.a9(a.cS),u.UI((e=>e||[]))),n=(0,o.zG)(e.nextGenOutput.activations.xandr_ssp_contextual??u.a9(void 0));this.segments=this.initSegments(e.externalData,t.current,n.current),this.logger.debug(l,"initialised with segments",this.segments),this.eligibleSegments={};const r=this.activationManager.getSpecializedActivations("appnexus_adserver");for(let e=0;e<r.length;e++){const t=r[e];this.eligibleSegments[t]=1}const s=this.options.nextGenOutput.queryLanguageCohorts.all;if(this.updateSegments(this.filterSegments(s.current)),window.apntag&&window.apntag.anq&&window.apntag.anq.push){const e=this;window.apntag.anq.push((function(){const t=window.apntag.defineTag;window.apntag.defineTag=function(n){const r=t(n);return(0,i.Z_)(e.api,e.userId,(function(){if(n.targetId){const t=s.current;e.updateSegments(e.filterSegments(t),n.targetId)}}))(),r}}))}s.onChange((0,i.Z_)(this.api,this.userId,(e=>this.updateIfNecessary(e)))),t.onChange((e=>{this.logger.debug(l,"received updated cloud cohorts",e),this.segments.cloudCohorts=[...e],this.updateSegments(this.segments.live)})),d&&e.viewId.ref.onChange((()=>{this.reset()}))}reset(){this.logger.debug(l,"resetting"),m=(0,o.zG)(m,(0,i.bw)(s.pF((e=>this.logger.error(l,`Skip listeners due to ${e}`)))),s.tS((e=>(0,o.zG)(e.recreate(),(0,i.bw)(s.pF((e=>this.logger.error(l,e))))))));const e=w({listenerRepository:m,logger:this.options.logger,permutive:this.options.permutive});(0,o.zG)(m,s.UI((t=>I(e,t.signal)))),this.updateSegments(this.segments.live),this.logger.debug(l,"reset")}get liveSegments(){return this.segments.live}initSegments(e,t,n){const r={cloudCohorts:[...t],live:this.externalData.getExternalJsonData(f)??[]};return n&&(r.contextualCohorts=n),r}cacheAppnexusSegments(e){const t=JSON.stringify(e);this.externalData.setExternalData(f,t)}updateIfNecessary(e){const t=this.filterSegments(e);(0,i.cO)(t,this.segments.live)||this.updateSegments(t)}updateSegments(e,t){window.apntag&&window.apntag.anq&&window.apntag.anq.push&&window.apntag.anq.push((()=>{const n={permutive:[...e,...this.segments.cloudCohorts,"rts"]};this.segments.contextualCohorts&&(n.prmtvctx=[...this.segments.contextualCohorts,"rts"]),t?window.apntag.setKeywords(t,n,{overrideKeyValue:!0}):Object.keys(p()).forEach((e=>window.apntag.setKeywords(e,n,{overrideKeyValue:!0})))})),this.cacheAppnexusSegments(e),this.segments.live=e,this.logger.debug(l,"live segments updated to",this.segments.live)}filterSegments(e){return e.filter((e=>e in this.eligibleSegments))}}const _=e=>{const t=(0,o.zG)(Object.values(e)??[],a.UI(String),(e=>new Set(e)));return{id:"xandr_ssp",filterCohorts:a.hX((e=>t.has(e)))}},y=e=>(t,n,r)=>{const i=new AbortController;let o=!1;const s=e=>()=>{o||e()},a=(n,s)=>{g(t)?o||(o=!0,(0,c.HJ)((()=>{o=!1}),1e3),e.logger.debug(l,`click on "${n}" because "${s}"`),e.permutive.track("AppNexusAdClick",r)):i.abort("click on non-registered tag")};i.signal.addEventListener("abort",(()=>{e.logger.debug(l,`aborting click listeners for target "${t}". reason: ${i.signal.reason}`)})),e.logger.debug(l,"registering listeners on dom elements:",n.join(", "));const u={signal:i.signal,capture:!0};return n.forEach((t=>{const n=document.getElementById(t);if(!n)return void e.logger.warn(l,`element not found for ${t}`);n.addEventListener("click",s((()=>a(t,"click"))),u);const r=s((()=>((t,n)=>{try{if(document.activeElement===n)return a(t,"activeElement === element");if(Array.from(n.querySelectorAll("iframe")).some((e=>e===document.activeElement)))return a(t,"activeElement === element>iframe")}catch(t){e.logger.warn(l,"Caught error checking activeElement:",t)}})(t,n)));window.addEventListener("blur",r,u),window.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&r()}),u)})),e=>{i.abort(e)}},w=e=>{const t=y(e);return n=>{try{e.logger.debug(l,'processing "adLoaded" event',n);const r=g(n.targetId),i=((e,t)=>{const n=[];return t?.keywords&&Object.keys(t.keywords).forEach((e=>{n.push({key:e,value:S(t.keywords[e])})})),{slot:{target_id:e.targetId,tag_id:e.tagId,height:e.height,width:e.width,targeting:n},ad:{type:e.adType,source:e.source,creative_id:e.creativeId,auction_id:e.auctionId,buyer_member_id:e.buyerMemberId,brand_category_id:e.brandCategoryId,media_type_id:e.mediaTypeId,media_sub_type_id:e.mediaSubType}}})(n,r);(0,o.zG)(e.listenerRepository,s.UI((e=>{if(r){e.getAbort(r.targetId)?.("re-registering listeners");const n=[r.targetId,r.utDivId,r.utiframeId].filter((e=>"string"==typeof e)),o=t(r.targetId,n,i);e.setAbort(r.targetId,o)}}))),e.permutive.track("AppNexusAdImpression",i)}catch(t){e.logger.error(l,'error processing "adLoaded" event:',t)}}},b=e=>{window.__permutive=window.__permutive||{},window.__permutive.appnexusEvents=window.__permutive.appnexusEvents||[],window.__permutive.appnexusEvents.forEach((function(t){"adLoaded"==t.eventType&&t.arg&&e(t.arg)}))},I=(e,t)=>{let n=!0;window.apntag.anq.push((function(){window.apntag.onEvent("adLoaded",(t=>{t&&n&&e(t)}))})),t.addEventListener("abort",(()=>{n=!1}))};function S(e){return(Array.isArray(e)?e:[e]).map((e=>e.toString()))}const k=()=>s.Y3((()=>{const e=new Map,t=new AbortController;return t.signal.addEventListener("abort",(()=>{e.forEach((e=>e(t.signal.reason))),e.clear()})),{close:()=>t.abort("close called"),getAbort:t=>e.get(t),setAbort:(t,n)=>{e.set(t,n)},get signal(){return t.signal},recreate(){return this.close(),k()}}}),(e=>`Listener repo factory failed with ${s.KC(e)}`)),E=()=>({id:"xandr_ssp_contextual",filterCohorts:o.yR})},7806:(e,t,n)=>{n.r(t),n.d(t,{AppnexusPixel:()=>s,load:()=>a});var r=n(4187);class i{isFirstRun;cachedSegmentsMembership;constructor(e,t){this.isFirstRun=void 0===e.permutiveData.getData(t),this.cachedSegmentsMembership=new Set(e.nextGenOutput.queryLanguageCohorts.all.current),this.isFirstRun&&e.permutiveData.setData(t,!0),e.messages.on("permutive:reset",(()=>e.permutiveData.setData(t,!1)))}}class o extends i{constructor(e,t,n){super(e,n);const r=e.activationManager.getSpecializedActivations(t);this.processSpecialisedActivations(e.permutive,r)}}class s extends o{constructor(e){super(e,"appnexus","addon:appnexus")}processSpecialisedActivations(e,t){if(this.isFirstRun)for(const e of this.cachedSegmentsMembership){const n=String(e);n in t&&this.firePixel(t[n])}e.on("SegmentEntry",(e=>{const n=e.properties.segment_number,r=String(n);r in t&&this.firePixel(t[r])}))}firePixel(e){(new Image).src=`https://secure.adnxs.com/seg?add=${e}&t=1`}}const a=e=>{(0,r.Hn)("appnexus")("auto_init",!1)&&e.q.push({functionName:"addon",arguments:["appnexus",{}]})}},3530:(e,t,n)=>{n.r(t),n.d(t,{WebAddon:()=>S,load:()=>I});var r=n(5654),i=n(7144),o=n(2169),s=n(3052),a=n(8236),u=n(856),c=n(4187);const l=(0,c.MU)("track_form_submission",!0),d=((0,c.MU)("track_pageview_complete",!0),(0,c.MU)("track_pageview_engagement",!0));(0,c.$S)("sync_segments_cookie",!1),(0,c.$S)("track_slot_clicked",!0),(0,c.$S)("track_slot_rendered",!0),(0,c.$S)("track_slot_viewable",!1),(0,c.$S)("track_targeting_keys",!1);var f=n(4991);const p=(0,c.MU)("add_alchemy_entities",!1),g=(0,c.MU)("add_alchemy_taxonomy",!1);function m(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{...e&&g?{taxonomy_labels:"$alchemy_taxonomy_labels"}:{},...e&&p?{entity_names:"$alchemy_entity_names"}:{}}}function h(e,t,n,r){const i={isp_info:"$ip_isp_info",geo_info:"$ip_geo_info",...v(),...e,...t};n.track("Pageview",i).then((e=>{e&&r.emit("permutive:event:pageview",e)}))}function v(){return{}}var _=n(3215);const y=["mousemove","click","scroll"],w=["email","tel","submit","reset","button","file","password","radio","checkbox"],b=["email","e-mail","password","tel","telephone","phone","name_first","name_last","sa_zip"],I=e=>{(0,c.Hn)("web")("auto_init",!1)&&e.q.push({functionName:"addon",arguments:["web",{auto_init:!0}]})};class S{permutive;options;api;clientContext;logger;dirtyState=!1;cancelEngagementTimer=()=>{};totalCompletion=0;totalEngagedTime=0;pageEngagementDetected;cleanupPageEngagementDetection=(()=>o.Q1)();constructor(e){this.permutive=e.permutive,this.options=e,this.api=e.api,this.clientContext=e.clientContext,this.logger=e.logger,this.options.customProperties.setCustomProps(e.page||{});this.pageEngagementDetected=(()=>{this.dirtyState=!0}).bind(this),h(m(this.clientContext.getContext().isArticle),this.options.customProperties.getCustomProps(),this.permutive,this.options.messages),this.enablePageEngagementDetection(),"loading"!==document.readyState?this.attachListeners():window.addEventListener("DOMContentLoaded",this.attachListeners.bind(this),!1),d&&(this.cancelEngagementTimer=this.registerEngagementInterval(this.getEventInterval()))}sendFormSubmissionEvent(e){{const t=e.currentTarget,n={form:{method:t.method||"GET",properties:this.serializeForm(t),..."string"==typeof t.id?{id:t.id}:{},...t.name&&"string"==typeof t.name?{name:t.name}:{},...t.action&&"string"==typeof t.action?{action:t.action}:{}}};this.permutive.track("FormSubmission",n)}}async trackEngagementInterval(e){const t=this.updateState(e);!function(e,t,n,r,i,o){const s={isp_info:"$ip_isp_info",geo_info:"$ip_geo_info",engaged_time:e,total_engaged_time:t,...i,completion:n,total_completion:r};o.track("PageviewEngagement",s)}(t.engaged_time,t.total_engaged_time,t.completion,t.total_completion,this.options.customProperties.getCustomProps(),this.permutive)}async reset(e){this.disablePageEngagementDetection(),this.dirtyState=!1;const t=this.updateWebOptions(e);this.options.pageviewState.setState(((e,n)=>({viewId:t.context?.view_id??(0,f.k$)(),watsonEnabled:t.watson?.enabled??n.watsonEnabled}))),this.totalCompletion=0,this.totalEngagedTime=0,this.options.customProperties.setCustomProps(this.options.page||{}),this.enablePageEngagementDetection(),h(m(this.clientContext.getContext().isArticle),this.options.customProperties.getCustomProps(),this.permutive,this.options.messages),d&&(this.cancelEngagementTimer(),this.cancelEngagementTimer=this.registerEngagementInterval(this.getEventInterval()))}serializeForm(e){return[...e.getElementsByTagName("input")].filter((e=>!(!e.type||!e.id||e.disabled||e.checked||"fieldset"===e.nodeName.toLowerCase()||-1!==w.indexOf(e.type.toLowerCase())||-1!==b.indexOf(e.name.toLowerCase())))).map((e=>({name:e.name||e.id,value:e.value}))).filter((e=>e.value.length<120))}registerEngagementInterval(e){return(0,_.UM)((()=>{this.dirtyState&&this.trackEngagementInterval(e)}),1e3*e)}attachListeners(){const e=e=>"a"===e.tagName.toLowerCase(),t=e=>e instanceof Element,n=t=>e(t)?(0,a.G)(t):t.parentElement?e(t.parentElement)?(0,a.G)(t.parentElement):n(t.parentElement):a.YP;l&&[].slice.call(document.getElementsByTagName("form"),0).forEach((e=>e.addEventListener("submit",(0,o.ls)(a.DT(this.canTrackPermutiveEvent("FormSubmission")),a.UI((0,f.Z_)(this.options.api,this.options.userId,this.sendFormSubmissionEvent.bind(this)))))));(0,c.MU)("track_link_click",!0)&&document.body.addEventListener("click",(0,o.ls)(a.DT(this.canTrackPermutiveEvent("LinkClick")),a.UI((e=>({event:e,anchor:(0,o.zG)(e.target,a.ij,a.tS(a.DT(t)),a.tS(n))}))),a.DZ((e=>{let{event:t,anchor:n}=e;return a.pC(n)?a.G({event:t,anchor:n.value}):a.YP})),a.UI((e=>{let{event:t,anchor:n}=e;return k(this.permutive,n,(r=t,!("_blank"===n.target||r.metaKey||r.ctrlKey||r.shiftKey||2===r.which||3===r.which)));var r}))),{capture:!0})}updateState(e){const t=Math.max(this.totalCompletion,this.getCurrentCompletion()),n=t-this.totalCompletion;return this.totalEngagedTime+=e,this.totalCompletion=t,this.dirtyState=!1,{engaged_time:e,total_engaged_time:this.totalEngagedTime,completion:n,total_completion:this.totalCompletion}}getCurrentCompletion(){if("function"==typeof this.options.getPageCompletion)return(0,o.zG)((0,i.Y3)((0,o.ls)(this.options.getPageCompletion,Number,(e=>isNaN(e)?0:e),(0,u.uZ)(s.Df)(0,1)),r.w),(0,i.EQ)((e=>(this.logger.warn("Web: invoking getPageCompletion threw an error. Got",e),0)),(e=>(this.logger.debug("Web: invoking getPageCompletion returned",e),e))));return(()=>{const e=document.documentElement.scrollHeight,t=window.pageYOffset+window.innerHeight;return t<=0?0:t>=e?1:t/e})()}registerPageEngagementCleanup(e){"function"==typeof e?this.cleanupPageEngagementDetection=()=>(0,i.Y3)((()=>{e(),this.cleanupPageEngagementDetection=o.Q1}),(e=>this.logger.warn("Page detection cleanup threw an error",(0,r.w)(e)))):this.logger.warn("No page detection cleanup was registered")}enablePageEngagementDetection(){this.options.addPageEngagementDetection&&(0,o.zG)(this.options.addPageEngagementDetection(this.pageEngagementDetected),(e=>this.registerPageEngagementCleanup(e))),this.setDirtyEventListenersTo(!0,this.getDirtyEvents())}disablePageEngagementDetection(){this.cleanupPageEngagementDetection(),this.setDirtyEventListenersTo(!1,this.getDirtyEvents())}setDirtyEventListenersTo(e,t){const n=e?window.addEventListener:window.removeEventListener;return t.forEach((e=>n(e,this.pageEngagementDetected))),null}getDirtyEvents(){return this.options.dirtyEvents||y}getEventInterval(){return this.options.eventInterval||5}canTrackPermutiveEvent(e){return t=>(0,o.zG)(this.options?.filterPermutiveEvent?.[e],a.DT((e=>"function"==typeof e)),a.tS((0,o.ls)((e=>i.Y3((()=>e(t)),(e=>new Error(`Threw an unexpected error: ${(0,r.w)(e)}`)))),i.tS(i.DT((e=>"boolean"==typeof e),(()=>new Error("Did not return a boolean")))),(0,f.bw)(i.Vn((t=>this.logger.error(`Filter predicate for "${e}" event failed`,t)))),a.Uo)),a.fS((()=>!0)))}updateWebOptions(e){(0,f.Kn)(e)||(e={}),e.watson&&"object"==typeof e.watson&&"enabled"in e.watson&&"boolean"==typeof e.watson.enabled||delete e.watson,"object"==typeof e.filterPermutiveEvent&&null!==e.filterPermutiveEvent||delete e.filterPermutiveEvent,"context"in e&&!(0,f.Kn)(e.context)&&delete e.context;const t={addPageEngagementDetection:void 0,context:void 0,dirtyEvents:void 0,eventInterval:void 0,filterPermutiveEvent:void 0,getPageCompletion:void 0,page:void 0,watson:void 0};return this.options={...this.options,...t,...e}}}const k=(e,t,n)=>{if(window.location.href&&t.href){const r=0===t.href.indexOf("data:")?"NOT_URL":t.href;e.track("LinkClick",{dest_url:r},{useBeacon:n})}}},4883:(e,t,n)=>{n.d(t,{a:()=>r});class r{messages;handlers={};messageQueue={};constructor(e){this.messages=e;window.addEventListener?.("message",(e=>{"permutive"===e?.data?.origin&&this.handle(e)}),!1),this.messages.once("permutive:api:ready",(function(){window.postMessage?.({origin:"permutive",type:"sdk-init"},"*")}))}listen(e,t){if(e in this.handlers||(this.handlers[e]=[]),this.handlers[e].push(t),e in this.messageQueue){const t=this.messageQueue[e];if(void 0===t)return;for(let e=0;e<t.length;e++){const n=t[e];this.handle(n)}}}handle(e){if(e.data.type in this.handlers)this.handlers[e.data.type].forEach((t=>{t(e)}));else{(this.messageQueue[e.data.type]??=[]).push(e)}}}},8657:(e,t,n)=>{n.d(t,{o:()=>r,s:()=>i});class r extends Error{static errorName="NetworkRequestFailedError";name=(()=>r.errorName)();constructor(){super(r.defaultMessage)}static get defaultMessage(){return"Network request failed"}}class i extends Error{static errorName="NetworkRequestTimeoutError";name=(()=>i.errorName)();constructor(){super(i.defaultMessage)}static get defaultMessage(){return"Network request timed out"}}},3207:(e,t,n)=>{n.d(t,{F:()=>d});var r=n(5654),i=n(2169),o=n(8236),s=n(7812),a=n(9829),u=n(8657),c=n(4694);class l{urls;config;network;metricsCollector;logger;webClient;prefix="[API]";constructor(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>o.YP;this.urls=e,this.config=t,this.network=n,this.metricsCollector=r,this.logger=i,this.webClient=s}async reportError(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;const l=(0,r.w)(e);if(this.logError("Reporting error:\n",l),!this.config.sendClientErrors)return void this.logDebug("Send errors not enabled. Skipping");const d=(0,i.zG)(this.webClient,c.UI(o.fS((()=>({domain:self.location?.hostname??"",referrer:"document"in self?self.document?.referrer:"",url:self.location?.href??"",user_agent:navigator?.userAgent??""})))),c.UI((e=>{const r={error_message:l?.message?.toString()??"",stack_trace:l?.stack?.split("\n")},i=t?{user_id:t}:{};return{platform:"web",sdk_version:"v20.54.0",ql_runtime_version:"v14.1.0",timestamp:n,domain:e.domain,url:(0,a.bk)(e.url),referrer:(0,a.bk)(e.referrer),user_agent:e.user_agent,error_message:r.error_message??String(l),stack_trace:r.stack_trace,...i}}))),f=e=>this.network.req({url:this.urls.getSdkErrorsUrl("/errors",o.G(this.config.sdkErrorsApiVersion)),method:"POST",payload:[e],contentType:"text/plain",dataType:"text",withCredentials:!1}),p=e=>{this.metricsCollector.trackCounter({name:"sdk_http_generic_network_request_fail_count_total",value:1,labels:{network_error_type:e}})};await(0,i.zG)([u.o,u.s],s.Ew((e=>l.name===e.errorName||l.message.indexOf(e.errorName)>=0||l.message.indexOf(e.defaultMessage)>=0)),o.g_((()=>{const e=d();return f(e).catch((0,i.ls)(r.w,(e=>this.logError(e))))}),(async e=>p(e.errorName))))}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(this.prefix,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(this.prefix,...t)}}class d extends l{identifyPromise;identify(e,t,n){const r=()=>this.reqWithMetrics(e,"sdk_http_identify_seconds",{url:this.urls.getEndpointUrl("/identify",o.G(this.config.apiVersion)),method:"POST",payload:{user_id:t.get(),aliases:n},contentType:"text/plain",dataType:"json",withCredentials:!0});return this.identifyPromise?this.identifyPromise=this.identifyPromise.then(r):this.identifyPromise=r()}metrics(e){return this.network.req({url:this.urls.getEndpointUrl("/internal/metrics",o.G(this.config.apiVersion)),method:"POST",payload:e,contentType:"text/plain",dataType:"text",withCredentials:!1})}metricsBeacon(e){return this.network.reqWithBeacon({url:this.urls.getEndpointUrl("/internal/metrics",o.G(this.config.apiVersion)),payload:e})}reset(e){return this.reqWithMetrics(e,"sdk_http_reset_seconds",{url:this.urls.getEndpointUrl("/reset",o.G(this.config.apiVersion)),method:"POST",payload:null,contentType:"text/plain",dataType:"json",withCredentials:!0})}segmentSync(e){return this.network.req({url:`https://${this.config.segmentSyncApiHost}/sync/${e.key}`,method:"POST",payload:`value=${encodeURIComponent(e.value)}`,contentType:"application/x-www-form-urlencoded",dataType:"json",withCredentials:!0})}appnexus(e){return this.network.req({url:e,method:"GET",contentType:"text/plain",dataType:"json",withCredentials:!0,timeout:2e3})}pxid(e){return this.network.req({url:this.urls.makeAuthenticatedUrl(e),method:"GET",contentType:"text/plain",dataType:"json",withCredentials:!0,timeout:2e3})}queries(){const e={addons:{dfp:{activations:{dfp:[],dfp_legacy:{}},auto_init:!0,track_slot_rendered:!1,track_slot_viewable:!1,track_slot_clicked:!1,track_targeting_keys:!1,sync_segments_cookie:!1},web:{auto_init:!1,track_pageview_engagement:!0,track_pageview_complete:!0,track_form_submission:!1,track_link_click:!1,engagement_edge_only:!0,segment_transition_edge_only:!1}},queries:{queries:{},eventSegments:{},eventsLookup:[],literalsLookup:[],subexpressionsLookup:[],stateSyncReplays:[],propertiesLookup:[],ahoCorasickLookup:[]},queries_metadata:{}},t=`${this.config.cdnBaseUrl.startsWith("dev.local:")?"http":"https"}://${this.config.cdnBaseUrl}/queries/681a9fe0-03f0-4efd-84f7-234f21a156cf-amp.json`;return this.network.req({url:t,withCredentials:!1,dataType:"json",method:"GET"}).catch((()=>e))}pxidReset(e){return this.network.req({url:this.urls.makeAuthenticatedUrl(e),method:"POST",payload:null,contentType:"text/plain",dataType:"json",withCredentials:!0})}uploadCohortMemberships(e,t){return this.reqWithMetrics(e,"sdk_http_upload_cohort_memberships_seconds",{url:this.urls.getCCSCohortMembershipEndpointUrl("/amp/cohorts",o.G("alpha"),[["i",t.user_id]]),method:"POST",payload:t,contentType:"text/plain",dataType:"json",withCredentials:!1})}reqWithMetrics(e,t,n){const r=e.startTimer(t,{});return this.network.req(n).then((n=>(0,i.zG)(e.stopTimer(t,r),(e=>n))))}}},183:(e,t,n)=>{n.d(t,{E:()=>y});var r=n(7144),i=n(2169),o=n(8657),s=n(3215),a=n(8236),u=n(8614),c=function(e){return"Left"===e._tag},l=function(e){return"Right"===e._tag};function d(e){return{_tag:"Left",left:e}}function f(e){return{_tag:"Right",right:e}}function p(e,t){return{_tag:"Both",left:e,right:t}}var g=function(e,t,n){return function(r){switch(r._tag){case"Left":return e(r.left);case"Right":return t(r.right);case"Both":return n(r.left,r.right)}}},m=g;m(f,d,(function(e,t){return p(t,e)}));var h=f,v="These",_=(i.yR,i.yR,u.Xl,n(4991));class y{metrics;logger;constructor(e,t){this.metrics=t,this.logger=e.withPrefix("network")}req(e){return this.logger.withPrefix("request").debug(e.method,e.url,..."POST"===e.method?[{payload:e.payload}]:[]),this.reqImpl(e).then((e=>(0,i.MZ)(e))).then((t=>(this.logger.withPrefix("response").debug(e.method,e.url,{response:t}),t)),(t=>{throw this.logger.withPrefix("response").error(e.method,e.url,t),t}))}reqWithBeacon(e){let{url:t,payload:n}=e;const r=JSON.stringify(n),i=navigator?.sendBeacon?.(t,JSON.stringify(n))??!1;return this.trackRequestMetrics({is_beacon:!0,is_error:!i,request:{method:"POST",url:t,content_length:r.length}}),i}reqImpl(e){const t="arraybuffer",{url:n,dataType:c,contentType:l,method:d,withCredentials:g,timeout:m}=e;return new Promise(((h,v)=>{const y=new XMLHttpRequest,w="POST"===e.method?"string"==typeof(b=e.payload)?b:JSON.stringify(b):null;var b;const I=e=>this.trackRequestMetrics({is_beacon:!1,request:{method:d,url:n,content_length:w?.length??0},response:e});y.onload=(0,s.GL)((()=>{return(0,i.zG)(y.status,r.DT((e=>e<400),(()=>{const e="text"===y.responseType||""===y.responseType?y.responseText:"Couldn't access response text";return`Failed ajax request. Status code was ${y.status}. ${e}`})),r.tS((()=>"json"===c?y.responseText?r.Y3((()=>JSON.parse(y.responseText)),(e=>`Failed to parse response as JSON. Response was ${JSON.stringify(y.responseText)}. Got ${e}`)):r.F2(null):"text"===c?r.F2(y.responseText):r.F2(y.response))),(0,_.bw)((0,i.ls)(a.IS,(e={content_length:"text"===y.responseType||""===y.responseType?y.responseText?.length??0:y.responseType===t?y.response.byteLength:0,response_time_ms:self.performance.now()-S,status_code:y.status},function(t){return u.Wi(t)?f(e):p(t.value,e)}),I)),r.EQ(v,h));var e})),y.onerror=(0,s.GL)((()=>{I(r.t$("network error")),v(new o.o)})),y.ontimeout=(0,s.GL)((()=>{I(r.t$("timeout")),v(new o.s)})),y.open(d,n,!0),l&&y.setRequestHeader("content-type",l),y.timeout=m||y.timeout,y.withCredentials=g||y.withCredentials,y.responseType="binary"===c?t:y.responseType;const S=self.performance.now();y.send(w)}))}trackRequestMetrics(e){if(!this.metrics?.isEnabled())return;const t=new URL(e.request.url).pathname;if(t.includes("metrics"))return;const n=n=>this.metrics.track({name:"sdk_http_request_count_total",value:1,labels:{request_method:e.request.method,request_path:t,request_content_length:e.request.content_length,...n}});var r;!0===e.is_beacon?n({is_beacon:!0,is_error:e.is_error}):(0,i.zG)((r=e.response,c(r)?u.YP:(l(r),u.G(r.right))),a.aD((()=>({})),(e=>({response_content_length:e.content_length,response_status:e.status_code,response_time_ms:e.response_time_ms}))),(t=>({is_beacon:!1,is_error:!l(e.response),...t})),n)}}},6131:(e,t,n)=>{n.r(t),n.d(t,{startMaster:()=>ce});var r=n(1561),i=n(2169),o=n(8659),s=n(8236),a=n(7812),u=n(4991),c=n(4694),l=n(6450),d=n(2945),f=n(4327),p=n(4214);var g=n(2678),m=n(6335),h=n(6289),v=n(7049);function _(e,t){return function(n){return e.map(n,t.compact)}}function y(e,t,n){var r=_(e,t),o=(0,h.UI)(e,n);return function(e){return v.s4(r((0,i.zG)(e,o(s.IS))),r((0,i.zG)(e,o(s.EK))))}}function w(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.filter(e,n)}))}}}function b(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.filterMap(e,n)}))}}}function I(e,t){var n=w(e,t);return function(e){var t=n((0,f.ff)(e)),r=n(e);return function(e){return(0,v.s4)(t(e),r(e))}}}function S(e,t){var n=b(e,t);return function(e){return function(t){return(0,v.s4)((0,i.zG)(t,n((function(t){return(0,s.IS)(e(t))}))),(0,i.zG)(t,n((function(t){return(0,s.EK)(e(t))}))))}}}var k=n(8614);function E(e){return(0,i.ls)(s.G,e.of)}function P(e){return(0,i.a9)(e.of(s.YP))}function G(e){return function(t){return e.map(t,s.G)}}function U(e){return(0,i.ls)(s.ij,e.of)}function z(e){var t=U(e);return function(e){return(0,i.ls)(e,t)}}function D(e){var t=L(e),n=z(e);return function(e){return t(n(e))}}function x(e){return function(t){return(0,i.ls)(t,e.of)}}function C(e){var t=L(e),n=x(e);return function(e){return t(n(e))}}function O(e){return function(t){return function(n){return e.of(s.DT(t)(n))}}}function M(e){return(0,i.ls)(s.Uo,e.of)}function T(e){return function(t,n){return function(r){return e.map(r,s.EQ(t,n))}}}function A(e){return function(t,n){return function(r){return e.chain(r,s.EQ(t,n))}}}function R(e){return function(t){return function(n){return e.chain(n,s.EQ(t,e.of))}}}function q(e){return(0,h.UI)(e,s.dO)}function j(e){return(0,d.ap)(e,s.G5)}function L(e){var t=P(e);return function(n){return function(r){return e.chain(r,s.EQ((function(){return t()}),n))}}}function $(e){var t=E(e);return function(n){return function(r){return e.chain(r,s.EQ(n,t))}}}var F=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},N=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},B=E(g.PM),K=(g.PM,g.of,g.PM,g.dO,g.UI(s.Uo)),Y=(g.dO,g.qo,g.UA,g.PM,function(e){return function(){return F(void 0,void 0,void 0,(function(){return N(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e().then(k.G)];case 1:return[2,t.sent()];case 2:return t.sent(),[2,k.YP];case 3:return[2]}}))}))}}),Q=(g.PM,g.UA,g.PM,g.UA,q(g.dO)),W=j(g.Hi),H=B,V=L(g.UA),J=(g.UA,g.PM,g.dO,s.Ri,g.dO,s.Ri,s.dO,g.dO,s.xu,g.dO,s.xu,g.dO,s.xu,g.dO,s.xu,function(e,t){return(0,i.zG)(e,Q(t))}),X=function(e,t){return(0,i.zG)(e,W(t))},Z=function(e,t){return(0,i.zG)(e,V(t))},ee="TaskOption",te={URI:ee,map:J},ne={URI:ee,map:J,ap:X,chain:Z},re=(k.F4,(0,h.YO)(te)),ie=(0,m.a)(ne),oe=(k.Xl,n(3215)),se=n(3643);const ae=(e,t)=>{const[n,o]=r.gS(a.uZ());return(0,i.zG)(t,r.UI(c.UI((t=>{a.Od(t)&&e.all().then((e=>(0,i.zG)(t,a.UI((0,se.H5)((()=>e))),o)))}))),r.UI((e=>e()))),n},ue=(e,t)=>{let n=!1;return r.UI(c.UI((0,u.bw)((r=>{n||(n=(0,i.zG)(r,a.G((e=>{let[,t]=e;return"Pageview"===t.name}))),n&&e.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:t,time_origin:"sdk_init"}))}))))};function ce(e){let{eventsCacheFactory:t,metrics:m,trace:h,migratedStateMaps:v,worker:_,...y}=e;return e=>o.dQ((0,i.ls)((0,u.rO)({previousState:le}),(o=>{let{stopped:u,previousState:w}=o;(0,i.zG)(u,r.YP((e=>e&&_.stop()))),_.send({...y,migratedStateMaps:w.stateMigrated?{external:s.YP,internal:s.YP}:v(),previousState:w.workerState}),h.measureSinceInit("post_worker_config_duration").finish(),m.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"master_sent_worker_config",time_origin:"sdk_init"},performance.now());const b=h.startSpan("worker_config_response_duration"),I=_.next();I.then((()=>{b.finish(),m.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"master_received_worker_config_response",time_origin:"sdk_init"},performance.now())}));const S=((e,t)=>{const o=(0,i.zG)((()=>t),g.UI((e=>s.lo(!e))),V((()=>K(e()))),re("eventsCache"),ie("eventsCacheService",(()=>(0,i.zG)((0,oe.N1)(Y((()=>Promise.resolve().then(n.bind(n,4987))))),Q((e=>e.eventCacheService)))))),u=o();return e=>{let{priorCachedEventsRequests:t,...n}=e;return e=>{let{previousState:o,stopped:l}=e;const d=r.a9(c.of(a.bM())),[f,p]=r.Ue({eventsToPublish:r.a9(c.of(a.bM())),priorCachedEventsResponses:d,state:r.a9(o)});return u.then(s.EQ((()=>p({eventsToPublish:n.eventsToPublish,priorCachedEventsResponses:d,state:r.a9(void 0)})),(e=>{let{eventsCache:r,eventsCacheService:i}=e;const{state:s,value:{newEvents:a}}=i({eventsCache:r,newEvents:n.eventsToPublish})({previousState:o,stopped:l});p({eventsToPublish:a,priorCachedEventsResponses:ae(r,t),state:s})}))),{state:(0,i.zG)(f,r.VS((e=>e.state))),value:(0,i.bc)((0,i.zG)(f,r.VS((e=>e.priorCachedEventsResponses))),{...n,eventsToPublish:(0,i.zG)(f,r.VS((e=>e.eventsToPublish)))})}}}})(t,I.then((e=>e.eventsCachedInWorker)));return(0,i.zG)((()=>_.read()),function(e,t){const n=e=>(0,i.zG)(e,l.Hd((e=>e in t)),(e=>{let{left:t,right:n}=e;return{buffers:n,nonBuffers:t}}));return o=>{const{buffers:s,nonBuffers:a}=n(e),[u,c]=r.Ue({...a,...(0,i.zG)(s,l.Su((e=>()=>{const n=s[e];return s[e]=t[e].empty,n})))});return(async()=>{for(;;){const e=(0,i.zG)(await o(),p.UI(n),p.ur({concat:(e,n)=>({nonBuffers:{...e.nonBuffers,...n.nonBuffers},buffers:(()=>{const r={...e.buffers};for(const e in n.buffers)r[e]=e in r?t[e].concat(r[e],n.buffers[e]):n.buffers[e];return r})()})})),r=(0,i.zG)(e.buffers,l.Su(((e,n)=>(s[e]=t[e].concat(s[e],n),()=>{const n=s[e];return s[e]=t[e].empty,n}))));c({...u.current,...e.nonBuffers,...r})}})(),(0,i.zG)(e,l.Su((e=>(0,i.zG)(u,r.UI((t=>t[e]))))))}}({activations:w.activations,cohorts:w.cohorts,context:{},eventsToPublish:a.cS,eventsToPublishOnPageUnload:a.cS,externalData:{},geoIP:s.YP,metrics:a.cS,priorCachedEventsRequests:a.cS,realtime:!1,state:w.workerState,transitionsSinceInit:{segmentsEntered:a.cS,segmentsExited:a.cS},workerStateFlushed:!1,stateMigratedThisInitialisation:!1,secureSignal:s.YP},{eventsToPublish:a.uZ(),metrics:a.uZ(),priorCachedEventsRequests:a.uZ()}),(e=>{let{metrics:t,...n}=e;return t.onChange((e=>e().forEach((e=>m.track(e))))),n}),(t=>{let{workerStateFlushed:n,stateMigratedThisInitialisation:o,activations:p,cohorts:g,state:h,secureSignal:v,...y}=t;const{value:[b,I],state:k}=S(y)({stopped:u,previousState:w.masterEventsCache});return function(e,t,n){const o=(0,i.zG)(r.vP(t),r.UI((0,i.ls)(l.UI((e=>"function"==typeof e?e:c.of(e))),(0,d.Yt)(c.G5))));let a=o.current();e(a),(0,i.zG)(o,r.YP((t=>{const r=t(),o=(0,i.zG)(r,l.z7(((e,t)=>t!==a[e]&&!n[e]?.isEmpty(t))),s.DT((0,f.ff)(l.xb)));s.pC(o)&&(a={...a,...o.value},e(o.value))})))}(_.send,{consent:e.consent,contextualCohorts:e.contextualCohorts,enrichmentReplacementMap:e.enrichmentReplacementMap,eventSourceId:e.eventSourceId,identities:e.identities,userId:e.userId,userIdIsNewlyGenerated:e.userIdIsNewlyGenerated,newEvents:(0,i.zG)(e.newEvents,ue(m,"pageview_sent_to_worker")),sessionId:e.sessionId,viewId:e.viewId,webClient:e.webClient,pageviewState:e.pageviewState,priorCachedEventsResponses:b},{newEvents:{isEmpty:a.xb},priorCachedEventsResponses:{isEmpty:a.xb}}),m.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"master_sent_worker_input",time_origin:"sdk_init"},performance.now()),{state:r.vP({activations:p,cohorts:g,masterEventsCache:k,workerState:h,stateMigrated:(0,i.zG)(r.vP(n,o),r.Rp(w.stateMigrated,((e,t)=>{let[n,r]=t;return e||n&&r})))}),value:{...I,stateMigratedThisInitialisation:o,activations:p,cohorts:{all:r.UI((e=>e.all),g),ql:r.UI((e=>e.ql),g),qlCustom:r.UI((e=>e.qlCustom),g),qlStandard:r.UI((e=>e.qlStandard),g)},secureSignal:v}}}))})))}const le=e=>me(e)?{activations:de(e.activations),cohorts:pe(e.cohorts),masterEventsCache:e.masterEventsCache,workerState:e.workerState,stateMigrated:!!e.stateMigrated}:{activations:de(null),cohorts:pe(null),masterEventsCache:null,workerState:null,stateMigrated:!1},de=e=>me(e)?{dfp:ge(e.dfp),dfp_contextual:void 0,xandr_ssp:ge(e.xandr_ssp),xandr_ssp_contextual:void 0,adswizz_keyvalue:ge(e.adswizz_keyvalue),adswizz_keyvalue_contextual:void 0}:fe(),fe=()=>({dfp:a.cS,dfp_contextual:void 0,xandr_ssp:a.cS,xandr_ssp_contextual:void 0,adswizz_keyvalue:a.cS,adswizz_keyvalue_contextual:void 0}),pe=e=>me(e)?{all:ge(e.all),ql:ge(e.ql),qlCustom:ge(e.qlCustom),qlStandard:ge(e.qlStandard)}:he(),ge=e=>Array.isArray(e)?e:a.cS,me=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),he=()=>({all:a.cS,ql:a.cS,qlCustom:a.cS,qlStandard:a.cS})},1845:(e,t,n)=>{n.r(t),n.d(t,{runNextGenFeatures:()=>Ct});var r=n(2169),i=n(1561),o=n(8659),s=n(3215),a=n(8236),u=n(4991);function c(e){let{messages:t}=e;const[n,r]=i.Ue(new Set);return t.on("permutive:addon:preinit",(e=>r(new Set([...n.current,e])))),n}function l(){const e=()=>Math.floor(Date.now()/1e3),[t,n]=i.Ue(e());return(0,s.UM)((()=>n(e())),1e3),t}function d(){const[e,t]=i.Ue(!1);return(0,u.aT)((()=>t(!0)),navigator.userAgent),e}var f=n(7812),p=n(5654),g=n(7144),m=n(4214),h=n(5086),v=n(6450),_=n(7049),y=n(1340),w=n(4187),b=n(9144);const I="[PrebidJS]";function S(e){const t=(()=>{const e=["pbjs",...window._pbjsGlobals||[]];return[...new Set(e)]})();e.logger.debug(I,"Found keys",t);return o.K4((()=>(0,r.zG)(t,f.UI((0,r.ls)((e=>(e=>{const t={maxAttempts:100,waitTimeInMs:50};let n;return{windowPropertyKey:e,pbjs:(0,u.a4)((()=>n),(()=>{const t=(0,r.zG)(window,(0,u.vg)(e));return!(!t?.que||"function"!=typeof t?.getEvents||(n=t,0))}),t)}})(e)),(t=>(0,r.zG)(i.p4(t.pbjs),i.UI((n=>{const i=g.pF((n=>(n.message=`Failed to resolve key "${t.windowPropertyKey}". ${n.message}`,e.reportError(`${I} ${n.toString()}`),a.YP)));return(0,r.zG)(n,(0,u.bw)(a.UI((n=>e.logger.debug(I,`Completed check for key "${t.windowPropertyKey}"`,{result:n})))),a.UI(i),a.UI(a.UI((e=>({windowPropertyKey:t.windowPropertyKey,pbjs:e})))))})))))),(e=>i.vP(...e)),i.UI((e=>({completedChecks:e.every(a.pC),pbjsKeyPairs:e.map(a.xH)}))),i.UI((e=>{let{pbjsKeyPairs:t,completedChecks:n}=e;const i=t.filter(a.pC),[o,...s]=i;return{completedChecks:n,mainPair:o??a.YP,otherPairs:(0,r.zG)(s,f.DZ(r.yR))}})))))}const k="[Prebid Monitoring]",E=(e,t)=>{e.metrics.trackCounter({name:"sdk_prebid_monitoring_key_flag_count_total",labels:t,value:1})},P=(e,t)=>{e.metrics.trackCounter({name:"sdk_prebid_monitoring_key_bidder_ortb2_count_total",labels:t,value:1})},G=Math.random()<.05?function(e,t){const n=U(e);return o.K4((()=>(0,r.zG)(t,i.UI((0,r.ls)(a.DT((e=>e.consent)),a.UI((e=>e.prebidJS)))),i.D8(a.Eh((0,u.Or)())),i.bw((0,r.ls)(a.tS((e=>e.completedChecks?e.mainPair:a.YP)),a.UI((t=>E(e,{flag:"prebid_main_key",prebid_key:t.windowPropertyKey}))))),i.UI(a.UI((e=>(0,r.zG)(e.mainPair,a.UI((t=>[t,...e.otherPairs])),a.fS((()=>e.otherPairs)))))),i.Rp(new Set,((t,i)=>(0,r.zG)(i,a.UI(f.hX((e=>!t.has(e.windowPropertyKey)))),a.hX(f.Od),(0,u.bw)(a.EQ((()=>e.logger.debug(k,"Nothing to report")),(t=>e.logger.debug(k,"Reporting",t)))),a.fS((()=>[])),f.UI((t=>(0,r.zG)((t=>(0,r.zG)(g.Y3((function(){const{pbjs:n,windowPropertyKey:i}=t;e.logger.log(k,`Reporting on "${i}"`,t);const o=z(n);e.logger.debug(k,`Version ${n.version} parsed as`,o);const s=(e=>"function"==typeof e.readConfig?e.readConfig():e.getConfig())(n);e.logger.debug(k,"Read config",s);const a=(0,r.zG)(s.realTimeData?.dataProviders??[],f.Ew((e=>"permutive"===e.name)));e.logger.debug(k,"Read data provider config",a);const u=n.installedModules||[];return e.logger.debug(k,"Read initial installed modules",u),{pbjs:n,config:s,dataProviderConfig:a,installedModules:u,version:o,windowPropertyKey:i}}),p.w),g.ak("bidders",(e=>n.sspBidders(e))),g.ak("permutiveRTDProvider",(e=>n.permutiveRTDProvider(e))),g.ak("consent",(e=>n.consent(e))),g.ak("prebidConfig",(e=>n.prebidConfig(e))),g.ak("targeting",(e=>n.targeting(e)))))(t),g.Pd((n=>e.reportError(`[Prebid Monitoring] Failed to report pair "${t.windowPropertyKey}", ${n.message}`)),(()=>t.windowPropertyKey))))),f.hp,(e=>new Set([...t,...e]))))),(e=>({reportedKeys:e})))))}:function(){return o.K4((()=>({reportedKeys:i.a9(new Set)})))};const U=e=>({sspBidders:t=>g.Y3((()=>{(0,w.Hn)("prebid")("data_provider_config",{ac_bidders:[]});const n=[],i=(0,r.zG)(t.dataProviderConfig,a.UI((e=>e?.params?.acBidders??[])),a.fS((()=>[]))),o=[...new Set([...n,...i])];o.forEach((n=>{((e,t)=>{e.metrics.trackCounter({name:"sdk_prebid_monitoring_key_bidder_flag_count_total",labels:t,value:1})})(e,{flag:"prebid_ac_bidder",prebid_key:t.windowPropertyKey,prebid_bidder:n})}));const s=[...new Set([...o])];return e.logger.debug(k,"Determined ssp bidders as",{sspBidders:s,acBidders:o,dynamicBidders:n,staticBidders:i}),{sspBidders:s,acBidders:o,dynamicBidders:n,readBidders:i}}),p.w),consent:t=>g.Y3((()=>{const n=t.windowPropertyKey;t.config.consentManagement&&"object"==typeof t.config.consentManagement&&E(e,{prebid_key:n,flag:"prebid_has_consent_management"});const r=t.installedModules.includes("gdprEnforcement");r&&E(e,{prebid_key:n,flag:"prebid_gdpr_enforcement_module"});const i=t.config?.consentManagement?.gdpr?.rules?.find((e=>"storage"===e?.purpose))?.vendorExceptions?.includes("permutive")||!1;return i&&E(e,{prebid_key:n,flag:"prebid_storage_exception"}),{hasGDPREnforcementModule:r,addedAsStorageException:i}}),p.w),prebidConfig:t=>g.Y3((()=>{const n=t.windowPropertyKey,i=[t.version.major,t.version.minor,t.version.patch].join("."),o=(0,r.zG)(t.dataProviderConfig,a.UI((e=>({waitForIt:e.waitForIt,params:e.params})))),c=(0,r.zG)(a.ij(t.config.realTimeData?.dataProviders?.find((e=>"jwplayer"===e.name))),a.UI((e=>({waitForIt:e.waitForIt})))),l=e=>e.enabled?a.G({bidders:e.bidders||[],aliases:e.extPrebid?.aliases||{}}):a.YP,d=y.n_({bidders:f.jG(),aliases:v.Dv(y.Z$())}),p=(0,r.zG)(a.ij(t.config.s2sConfig),a.tS((e=>Array.isArray(e)?(0,r.zG)(f.DZ(l)(e),m.c2,a.UI(m.ur(d))):l(e))),a.UI((e=>({bidders:e.bidders.join(","),aliases:e.aliases}))),a.tS((0,r.ls)(b.P,a.Uo)),a.FS),g=(0,r.zG)(a.ij(t.config.realTimeData),a.UI((e=>({auctionDelay:e.auctionDelay,permutive:a.FS(o),jwplayer:a.FS(c)}))),a.tS((0,r.ls)(b.P,a.Uo)),a.FS),h=(0,r.zG)((0,b.P)((()=>{if(t.config.consentManagement&&(0,u.Kn)(t.config.consentManagement)){const e=t.config.consentManagement?.gdpr;if(e){const t=(e?.rules||[]).filter((e=>"storage"===e?.purpose));return{gdpr:{cmpApi:e?.cmpApi,rules:t}}}return{}}})()),a.Uo,a.FS);(0,s.HJ)((()=>{((e,t)=>{e.metrics.trackCounter({name:"sdk_prebid_monitoring_config_count_total",labels:t,value:1})})(e,{prebid_key:n,version:i,installed_modules:t.pbjs.installedModules.join(","),rtd_config:g,s2s_config:p,consent_management:h})}),5e3)}),p.w),permutiveRTDProvider:t=>g.Y3((()=>{const n=t.installedModules.includes("permutiveRtdProvider");return n&&E(e,{prebid_key:t.windowPropertyKey,flag:"prebid_permutive_rtd"}),n}),p.w),targeting:t=>{const n=e=>{const t=(()=>{const t=new Set((e.bids||[]).flatMap((e=>(0,u.Kn)(e.mediaTypes)?Object.keys(e.mediaTypes):[])));return Array.from(t).join(",")})(),n=e.ortb2?.user;if(!n)return{has_ortb2_user:!1,media_types:t,user_keywords:"",user_ext_data:"",user_data:""};const r=new Set(["adv","cur"]),i=e=>{const t={everyones:new Set,complete:!1};return{key:e,addIfEveryone:e=>{r.has(e)&&t.everyones.add(e)},isComplete:()=>t.everyones.size===r.size,serialize:()=>t.everyones.size>0?`${e}=${Array.from(t.everyones).sort().join(",")}`:""}},o=i("p_standard"),s=i("p_standard_aud"),a=i("p_standard"),c=i("permutive.com");n.keywords?.split(",").some((e=>{const[t,n]=e.split("=");return t===o.key?o.addIfEveryone(n):t===s.key&&s.addIfEveryone(n),s.isComplete()&&o.isComplete()}));const l=n.ext?.data?.[a.key];Array.isArray(l)&&l.some((e=>(a.addIfEveryone(e),a.isComplete())));const d=n.data?.find((e=>e.name===c.key))?.segment?.map((e=>e.id));return Array.isArray(d)&&d.some((e=>(c.addIfEveryone(e),c.isComplete()))),{has_ortb2_user:!0,media_types:t,user_keywords:[o.serialize(),s.serialize()].filter(Boolean).join("&"),user_data:c.serialize(),user_ext_data:a.serialize()}},i=(0,r.ls)(f.UI((e=>[e,null])),v.sq),o=(t,i)=>(0,r.zG)(t,(0,u.bw)((t=>e.logger.debug(k,`Processing ${t.length} bidder request(s)`,t))),f.hX((e=>i.hasOwnProperty(e.bidderCode)&&null===i[e.bidderCode])),m.vM((e=>e.bidderCode)),v.DZ(f.f2((e=>(0,r.zG)(a.ij(e),a.UI(n))))),(0,u.bw)((t=>e.logger.debug(k,"Bidders targeting method's updated",t)))),s=n=>{e.logger.debug(k,"Bidders found with no targeting method",n);let s=i(n);const a=n=>(0,r.zG)(o([n],s),(0,u.bw)((e=>{s={...s,...e}})),(0,u.bw)(v.Su(((n,r)=>P(e,{prebid_key:t.windowPropertyKey,prebid_bidder:n,...r})))),(0,u.bw)((()=>{Object.values(s).includes(null)||(e.logger.debug(k,`Cleaning up "bidRequested" listener for ${t.windowPropertyKey}`),t.pbjs.offEvent("bidRequested",a))})));t.pbjs.onEvent("bidRequested",a)};return g.Y3((()=>{const n=(0,r.zG)(t.pbjs.getEvents(),f.DZ((0,r.ls)(a.DT((e=>"bidRequested"===e.eventType)),a.UI((0,u.vg)("args")))));return(0,r.zG)(t.bidders.sspBidders,a.DT(f.Od),a.EQ((()=>e.logger.debug(k,"No bidders for targeting")),(0,r.ls)(i,(e=>({...e,...o(n,e)})),v.uK(h.ff((e=>null===e))),_.Pd((0,r.ls)(v.XP,a.DT(f.Od),a.UI(s)),v.Su(((n,r)=>P(e,{prebid_bidder:n,prebid_key:t.windowPropertyKey,...r})))))))}),p.w)}}),z=e=>{const[t,n,r]=e.version.split("-")[0].replace("v","").split(".").map((e=>parseInt(e)));return{major:t,minor:n,patch:r}},D="[monitoring][video_player]";function x(){return function(){const e={name:"brightcove",detect:()=>!!(window?.bc&&"object"==typeof window.bc||window?.brightcove&&"object"==typeof window.brightcove)};return[{name:"jwplayer",detect:()=>!(!window?.jwplayer||"function"!=typeof window.jwplayer||"function"!=typeof window.jwplayer().getConfig)},{name:"kaltura",detect:()=>!!(window?.KalturaPlayer&&"object"==typeof window.KalturaPlayer||window?.kWidget&&"object"==typeof window.kWidget)},e,{name:"videojs",detect:()=>!e.detect()&&!(!window?.videojs||"function"!=typeof window.videojs)}]}().reduce(((e,t)=>({...e,[t.name]:{name:t.name,result:t.detect()}})),{})}function C(e){return{data:e,error:void 0}}function O(e){return{data:void 0,error:e}}function M(e){return void 0===e.error}function T(){return{parse:e=>"string"==typeof e?C(e):O("Expected value to be a string, got "+typeof e)}}function A(e){return{parse:t=>{if(!(0,u.Kn)(t))return O("Expected value to be an object, got "+typeof t);return Object.keys(e).reduce(((n,r)=>{if(!M(n))return n;const i=e[r].parse(t[r]);return M(i)?C({...n.data,[r]:i.data}):i}),C({}))}}}function R(e){return{parse:t=>void 0===t?C(void 0):e.parse(t)}}function q(e){return{parse:t=>{if(!Array.isArray(t))return O("Expected an array, got "+typeof t);const n=t.map((t=>e.parse(t))),r=n.filter((e=>!M(e)));return r.length>0?r[0]:C(n.map((e=>e.data)))}}}function j(e,t){return{parse:n=>{const r=e.parse(n);if(M(r))return r;return t.parse(n)}}}function L(e){const t=window?.jwplayer?.()?.getConfig?.(),n=A({advertising:R(A({client:R(T()),bids:R(A({bidders:R(q(A({name:R(T())}))),settings:R(A({mediationLayerAdServer:R(T())}))})),schedule:R(j(T(),q(A({tag:R(T())}))))}))}).parse(t);return M(n)?n.data:(e.warn("JW Player properties could not be parsed",n.error),null)}function $(e,t){const{metrics:n}=e,s=e.logger.withPrefix(D);return n.isEnabled()&&Math.random()<.8?o.K4((()=>{(0,r.zG)(t.consent,i.UI((e=>{if(e){!function(e){e.track({name:"sdk_video_player_count_total",labels:{},value:1})}(n),x();const e=x();if(function(e,t,n){const r=Object.keys(e).filter((t=>e[t]?.result));n.debug("Currently detected video players:",r),Object.values(e).forEach((e=>{e.result&&t.track({name:"sdk_video_player_sdk_exists_count_total",labels:{video_player:e.name},value:1})}))}(e,n,s),e.jwplayer?.result){const e=L(s);try{!function(e,t,n){if(!e)return n.warn("JW Player properties could not be parsed"),void t.track({name:"sdk_video_player_properties_parse_error_count_total",labels:{video_player:"jwplayer"},value:1});if(e.advertising&&(e.advertising.bids||e.advertising.schedule)){const i=e.advertising,o=i.client||void 0;n.debug("JW Player advertising configuration detected");const s=i.bids?.settings?.mediationLayerAdServer||void 0,u=(0,r.zG)(i.bids?.bidders,a.ij,a.UI((e=>e.filter((e=>e.name&&e.name.trim().length>0)).map((e=>e.name?.trim().slice(0,20))).join(","))),a.FS),c=(0,r.zG)(i.schedule,a.ij,a.UI((e=>"string"==typeof e?[e]:e.map((e=>e.tag)))),a.FS),l=c?.map((e=>e.trim().slice(0,40))).join(",");n.debug("JW Player advertising configuration found"),t.track({name:"sdk_video_player_jwplayer_advertising_count_total",labels:{client:o,schedule_tags:l,mediation_ad_server:s,bidders:u},value:1})}else n.debug("No JW Player advertising configuration detected"),t.track({name:"sdk_video_player_jwplayer_advertising_not_found_count_total",labels:{},value:1})}(e,n,s)}catch(e){s.error("Error tracking JW Player properties",e)}}s.debug(D,"Video player monitoring completed")}else s.debug(D,"No consent given, not tracking")})))})):(s.debug("Video player monitoring disabled or user not sampled"),o.K4((()=>{})))}const F=function(e,t){const n=(0,r.zG)(t.pbjs,i.VS((0,r.ls)(a.tS(a.KQ((e=>e.getUserIdsAsync?.().then((()=>e.getUserIdsAsEids?.()??[]))))),a.UI(i.p4),a.fS((()=>i.a9(a.YP))))),i.UI(a.tS(a.Uo)),i.bw(a.mU((t=>(t.length>0?t.forEach((t=>{e.metrics.trackCounter({name:"sdk_prebid_alternative_identifiers_count_total",labels:{alternative_user_id_name:t.source},value:1})})):e.metrics.trackCounter({name:"sdk_prebid_alternative_identifiers_count_total",labels:{identifier:"NONE"},value:1}),a.YP))))),s=(0,r.zG)(t.pbjs,i.UI(a.tS(a.KQ((e=>e.getUserIdsAsEids?.())))));return o.K4((()=>(0,r.zG)(i.vP(n,s),i.UI((e=>{let[t,n]=e;return(0,r.zG)(t,a.wp((()=>n)))})),i.UI((0,r.ls)(a.UI(f.DZ((e=>"string"==typeof e.uids?.[0]?.id?a.G((0,r.bc)(e.source,{id:e.uids[0].id})):a.YP))),a.tS(m.c2),a.UI(v.sq))),i.bw((t=>{a.pC(t)&&e.logger.debug("[Prebid Identifiers]","Found identifiers",t.value)})))))};const N=function(e){let{externalData:t}=e;return o.K4((()=>{t.removeExternalData(B)}))};const B="_pfws",K=new Set(["AdRequest","Reaction","PageviewEngagement","SegmentEntry","SegmentExit"]);class Y{events;listeners;static highVolumeEvents=(()=>{const e=new Set([...K]);return e.delete("Reaction"),e})();constructor(){this.events=[],this.listeners=[]}newEvent(e,t){Y.highVolumeEvents.has(e.name)||this.events.push([e,t]),[...this.listeners].forEach((n=>{this.handle(e,t,n)}))}addListener(e){this.listeners.push(e);const t={replay:()=>(this.replay(e),t),remove:()=>(this.remove(e),t)};return t}handle(e,t,n){const r="string"==typeof n.name&&e.name===n.name,i=n.name.test&&n.name.test(e.name),o=r||i;if(o)try{n.callback(e,t)}catch(e){window.console&&window.console.error&&window.console.error("callback error: ",e)}o&&n.once&&this.remove(n)}replay(e){let t=-1!==this.listeners.indexOf(e);for(let n=0;n<this.events.length&&t;n++)this.handle(this.events[n][0],this.events[n][1],e),t=-1!==this.listeners.indexOf(e)}remove(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}}var Q=n(4694),W=n(2945);var H=n(3643),V=n(132),J=n(2678);const X="[Event Upload]",Z=(e,t,n,a)=>o.dQ((o=>{let{stopped:c,previousState:l}=o;Array.isArray(l)&&(0,r.zG)(l,f.UI((0,H.H5)((0,u.rO)({event:(0,u.rO)({time:ae})}))),ie(e))();const d=new Set([...K]),[p,{appendUntrackedEvents:m,appendUploadResults:h}]=(0,r.zG)((()=>{const[e,t]=i.gS(f.uZ()),[n,o]=i.gS(f.uZ());return(0,r.bc)({uploadResults:e,untrackedEvents:n},{appendUploadResults:t,appendUntrackedEvents:o})})(),(0,H.pL)((0,r.ls)((function(e){const[t,n]=(0,r.zG)(e.uploadResults,oe(f.bj));return{...e,uploadResults:t,erroredEventsAsJSON:n}}),(function(e){const[t,n]=(0,r.zG)(e.erroredEventsAsJSON,oe(f.UI((0,H.H5)((0,u.rO)({event:(0,u.rO)({time:e=>new Date(e)})})))));return{...e,erroredEventsAsJSON:t,erroredEvents:n}}),(function(e){let{uploadResults:t,untrackedEvents:n,...o}=e;const s=(0,r.zG)(t,i.UI(Q.UI((0,r.ls)(f.hp,f.UI((0,H.H5)((0,u.rO)({time:e=>new Date(e)}))))))),a=(0,r.zG)(i.vP(s,n),i.UI(Q.RD),i.UI(Q.UI((e=>{let[t,n]=e;return n.concat(t)}))));return{...o,successEvents:a}}),(function(e){const[t,n]=(0,r.zG)(e.successEvents,oe(f.UI((0,H.H5)((0,u.rO)({time:e=>e.toISOString()})))));return{...e,successEvents:t,successEventsAsJSON:n}})))),[v,_]=i.Ue(0),[y,w]=i.Ue(0),b=(0,r.zG)(t,i.UI(Q.UI((e=>(0,r.zG)(e,f.uK((e=>{let[,t]=e;return!d.has(t.event.name)})),(e=>{let{left:t,right:n}=e;return(0,r.zG)(t,f.UI((0,H.H5)((e=>e.event))),m),n}))))),i.UI(Q.UI((e=>(e.length>0&&((0,s.HJ)((()=>_(v.current+e.length)),500),(0,s.HJ)((()=>w(y.current+e.length)),5e3)),e))))),I=e=>t=>(0,r.zG)(e,f.hX((e=>{let[n]=e;return!t.closeEventsProcessed.includes(n)})),f.zo(t.queue)),S=(0,r.zG)(i.vP(v,y,b,n,c,a),i.Rp({closeEventsProcessed:f.cS,noQueueItemsProcessed:0,queue:f.cS},((t,n)=>{let[i,o,s,a,c,l]=n;return c?t:(0,r.zG)(t,(0,u.rO)({queue:f.zo(s())}),(t=>l?(0,r.zG)(t,(t=>n=>(0,r.zG)(n,I(t),re(e),(0,u.rO)({right:(0,u.bw)((0,r.ls)(f.UI((0,r.ls)((0,H.H5)((0,u.rO)({time:e=>e.toISOString()})),g.F2)),h))}),(e=>{let{left:t,right:i}=e;return(0,r.zG)(n,(0,u.rO)({closeEventsProcessed:(0,r.zG)(i,f.UI(H.li),f.zo),queue:(0,r.zG)(t.map(H.li),(e=>new Set(e)),(e=>f.hX((t=>{let[n]=t;return e.has(n)})))),noQueueItemsProcessed:e=>e+n.queue.length}))})))(a)):o>t.noQueueItemsProcessed||i===t.noQueueItemsProcessed+t.queue.length?(t=>((0,r.zG)(t.queue,ie(e),J.UI(h))(),{closeEventsProcessed:t.closeEventsProcessed,noQueueItemsProcessed:t.noQueueItemsProcessed+t.queue.length,queue:f.cS}))(t):t))}))),k=(0,r.zG)(n,i.UI(I),i.ap(S),i.D8(f.Eh({equals:(e,t)=>e[0]===t[0]})),i.UI(f.UI((0,H.H5)((0,u.rO)({event:(0,u.rO)({time:se})})))));return{state:k,value:p}})),ee=(e,t)=>e.permutiveUrls.getEndpointUrl("/batch/events",a.G(e.config.apiVersion),[["enrich",JSON.stringify(t.requiresEnrichment)],["sdkp",JSON.stringify(t.sdkProcessed)]]),te=e=>(0,r.zG)(e.events,f.UI((0,r.ls)(H.Yg,(e=>e.event)))),ne=(0,r.ls)(m.vM((e=>{let[t,n]=e;return`${n.requiresEnrichment}${n.sdkProcessed}`})),(e=>Object.values(e)),f.UI((e=>({requiresEnrichment:e[0][1].requiresEnrichment,events:e,sdkProcessed:e[0][1].sdkProcessed})))),re=e=>(0,r.ls)(ne,f.YO("request"),f.Hr("success",(t=>{let{request:n}=t;return e.logger.debug(X,"Uploading via beacon",n),e.permutiveApi.reqWithBeacon({url:ee(e,n),payload:te(n)})})),f.tS((e=>(0,r.zG)(e.request.events,f.UI((t=>{let[n,{event:i}]=t;return e.success?g.F2((0,r.bc)(n,i)):g.t$((0,r.bc)(n,i))}))))),f.UI((0,u.bw)(g.EQ((t=>{let[,n]=t;return e.metrics.trackCounter({name:"sdk_event_beacon_fail_count_total",labels:{event_name:n.name},value:1})}),(t=>{let[,n]=t;return e.metrics.trackCounter({name:"sdk_event_beacon_success_count_total",labels:{event_name:n.name},value:1})})))),f.oh),ie=e=>t=>(0,r.zG)(ne(t),J.uU((t=>(0,r.zG)(t,(e=>t=>(e.logger.debug(X,"Uploading",t),V.Y3((()=>e.permutiveApi.req({payload:te(t),url:ee(e,t),method:"POST",contentType:"text/plain",dataType:"json",withCredentials:!1})),(t=>(e.reportError(`Error sending events batch. Got ${g.KC(t)}`),t)))))(e),V.UI(f.UI((e=>e.body))),V.EQ((e=>(0,r.zG)(t.events,f.UI((()=>g.t$(e))))),f.UI(g.F2)),J.UI(f.$R(t.events))))),J.UI(f.tS(f.UI((t=>{let[n,[i,{event:o}]]=t;return(0,r.zG)(n,g.EQ((e=>g.t$((0,r.bc)(i,{event:{...o,time:o.time.toISOString()},error:e}))),(e=>"request_id"in e?g.t$((0,r.bc)(i,{event:{...o,time:o.time.toISOString()},error:e})):g.F2((0,r.bc)(i,{...o,id:e.id,time:e.time})))),(0,u.bw)(g.EQ((t=>{let[,{event:n}]=t;return e.metrics.trackCounter({name:"sdk_event_upload_fail_count_total",labels:{event_name:n.name},value:1})}),(t=>{let[,n]=t;return e.metrics.trackCounter({name:"sdk_event_upload_success_count_total",labels:{event_name:n.name},value:1})}))))}))))),oe=e=>t=>(0,r.zG)(t,i.En(2,f.uZ()),(0,H.H5)(i.UI(Q.UI(e)))),se=e=>ae(e).toISOString(),ae=e=>{if(null==e)return new Date;if(ue(e))return e;const t=new Date(e);return ue(t)?t:new Date},ue=e=>isFinite(e)&&e instanceof Date,ce=(e,t,n,s)=>(0,r.zG)(o.K4((()=>{const[e,t]=i.Ue(i.a9(Q.of([])));return{eventsToPublishBufferRef:i.xH(e),publishEvents:n=>{(0,r.zG)(i.vP(e.current,n),i.UI(Q.RD),i.UI(Q.UI(f.xH)),t)}}})),o.ak("eventUpload",(t=>{let{eventsToPublishBufferRef:r}=t;return Z(e,r,n,s)})),o.ak("eventHandler",(e=>{let{eventUpload:t}=e;return n=t.successEventsAsJSON,s=t.erroredEventsAsJSON,o.K4((()=>{const e=new Y;return(0,r.zG)(n,i.UI((e=>e())),i.bw((t=>t.forEach((t=>{let[,n]=t;return e.newEvent(n,null)}))))),(0,r.zG)(s,i.UI((e=>e())),i.bw((t=>t.forEach((t=>{let[,{event:n,error:r}]=t;return e.newEvent(n,r)}))))),{eventHandlerAfterUpload:e}}));var n,s})),o.ak("eventResolver",(e=>{let{eventUpload:n}=e;return((e,t,n,s)=>o.K4((()=>{(0,r.zG)(i.vP({unresolvedEvents:t,erroredEvents:s,successEvents:n}),i.UI((0,W.Yt)(Q.G5)),i.Rp({},((e,t)=>{const n=t();return(0,r.zG)(n.unresolvedEvents,a.DT(f.Od),a.UI((0,r.ls)(v.sq,(t=>({...e,...t})))),a.fS((()=>e)),(e=>(0,r.zG)(n.successEvents,f.u4(e,((e,t)=>{let[n,i]=t;return(0,r.zG)(v.P5(n,e),a.UI((t=>(t.succeed(i),v.EG(n)(e)))),a.fS((()=>e)))})))),(e=>(0,r.zG)(n.erroredEvents,f.u4(e,((e,t)=>{let[n,{event:i,error:o}]=t;return(0,r.zG)(v.P5(n,e),a.UI((t=>(t.fail(`Failed to track ${i.name}. ${"error"in o?o.error.message:o.message}`),v.EG(n)(e)))),a.fS((()=>e)))})))))})))})))(0,t,n.successEvents,n.erroredEvents)})),o.UI((e=>{let{publishEvents:t,eventHandler:n}=e;return{eventHandlerAfterUpload:n.eventHandlerAfterUpload,publishEvents:t}}))),le="_pnativo",de=function(e){let{externalData:t}=e;return o.K4((()=>{t.removeExternalData(le)}))};var fe,pe,ge,me,he,ve=-1,_e=function(e){addEventListener("pageshow",(function(t){t.persisted&&(ve=t.timeStamp,e(t))}),!0)},ye=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},we=function(){var e=ye();return e&&e.activationStart||0},be=function(e,t){var n=ye(),r="navigate";return ve>=0?r="back-forward-cache":n&&(document.prerendering||we()>0?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},Ie=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},Se=function(e,t,n,r){var i,o;return function(s){t.value>=0&&(s||r)&&((o=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=o,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},ke=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},Ee=function(e){document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e()}))},Pe=function(e){var t=!1;return function(){t||(e(),t=!0)}},Ge=-1,Ue=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},ze=function(e){"hidden"===document.visibilityState&&Ge>-1&&(Ge="visibilitychange"===e.type?e.timeStamp:0,xe())},De=function(){addEventListener("visibilitychange",ze,!0),addEventListener("prerenderingchange",ze,!0)},xe=function(){removeEventListener("visibilitychange",ze,!0),removeEventListener("prerenderingchange",ze,!0)},Ce=function(){return Ge<0&&(Ge=Ue(),De(),_e((function(){setTimeout((function(){Ge=Ue(),De()}),0)}))),{get firstHiddenTime(){return Ge}}},Oe=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},Me=[1800,3e3],Te=[.1,.25],Ae=function(e,t){t=t||{},function(e,t){t=t||{},Oe((function(){var n,r=Ce(),i=be("FCP"),o=Ie("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(o.disconnect(),e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-we(),0),i.entries.push(e),n(!0)))}))}));o&&(n=Se(e,i,Me,t.reportAllChanges),_e((function(r){i=be("FCP"),n=Se(e,i,Me,t.reportAllChanges),ke((function(){i.value=performance.now()-r.timeStamp,n(!0)}))})))}))}(Pe((function(){var n,r=be("CLS",0),i=0,o=[],s=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=o[0],n=o[o.length-1];i&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,o.push(e)):(i=e.value,o=[e])}})),i>r.value&&(r.value=i,r.entries=o,n())},a=Ie("layout-shift",s);a&&(n=Se(e,r,Te,t.reportAllChanges),Ee((function(){s(a.takeRecords()),n(!0)})),_e((function(){i=0,r=be("CLS",0),n=Se(e,r,Te,t.reportAllChanges),ke((function(){return n()}))})),setTimeout(n,0))})))},Re=0,qe=1/0,je=0,Le=function(e){e.forEach((function(e){e.interactionId&&(qe=Math.min(qe,e.interactionId),je=Math.max(je,e.interactionId),Re=je?(je-qe)/7+1:0)}))},$e=function(){return fe?Re:performance.interactionCount||0},Fe=function(){"interactionCount"in performance||fe||(fe=Ie("event",Le,{type:"event",buffered:!0,durationThreshold:0}))},Ne=[],Be=new Map,Ke=0,Ye=[],Qe=function(e){if(Ye.forEach((function(t){return t(e)})),e.interactionId||"first-input"===e.entryType){var t=Ne[Ne.length-1],n=Be.get(e.interactionId);if(n||Ne.length<10||e.duration>t.latency){if(n)e.duration>n.latency?(n.entries=[e],n.latency=e.duration):e.duration===n.latency&&e.startTime===n.entries[0].startTime&&n.entries.push(e);else{var r={id:e.interactionId,latency:e.duration,entries:[e]};Be.set(r.id,r),Ne.push(r)}Ne.sort((function(e,t){return t.latency-e.latency})),Ne.length>10&&Ne.splice(10).forEach((function(e){return Be.delete(e.id)}))}}},We=function(e){var t=self.requestIdleCallback||self.setTimeout,n=-1;return e=Pe(e),"hidden"===document.visibilityState?e():(n=t(e),Ee(e)),n},He=[200,500],Ve=function(e,t){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(t=t||{},Oe((function(){var n;Fe();var r,i=be("INP"),o=function(e){We((function(){e.forEach(Qe);var t=function(){var e=Math.min(Ne.length-1,Math.floor(($e()-Ke)/50));return Ne[e]}();t&&t.latency!==i.value&&(i.value=t.latency,i.entries=t.entries,r())}))},s=Ie("event",o,{durationThreshold:null!==(n=t.durationThreshold)&&void 0!==n?n:40});r=Se(e,i,He,t.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),Ee((function(){o(s.takeRecords()),r(!0)})),_e((function(){Ke=$e(),Ne.length=0,Be.clear(),i=be("INP"),r=Se(e,i,He,t.reportAllChanges)})))})))},Je=[2500,4e3],Xe={},Ze={passive:!0,capture:!0},et=new Date,tt=function(e,t){pe||(pe=t,ge=e,me=new Date,it(removeEventListener),nt())},nt=function(){if(ge>=0&&ge<me-et){var e={entryType:"first-input",name:pe.type,target:pe.target,cancelable:pe.cancelable,startTime:pe.timeStamp,processingStart:pe.timeStamp+ge};he.forEach((function(t){t(e)})),he=[]}},rt=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){tt(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,Ze),removeEventListener("pointercancel",r,Ze)};addEventListener("pointerup",n,Ze),addEventListener("pointercancel",r,Ze)}(t,e):tt(t,e)}},it=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,rt,Ze)}))},ot=[100,300];const st=function(e){let t=0;const n=n=>{if(0===t)return;const r=at(n);r&&e.metrics.track({name:`sdk_web_vitals_${r.suffix}`,labels:{},value:r.value})},s=(0,u.HP)((()=>{Ae(n),function(e,t){t=t||{},Oe((function(){var n,r=Ce(),i=be("LCP"),o=function(e){t.reportAllChanges||(e=e.slice(-1)),e.forEach((function(e){e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-we(),0),i.entries=[e],n())}))},s=Ie("largest-contentful-paint",o);if(s){n=Se(e,i,Je,t.reportAllChanges);var a=Pe((function(){Xe[i.id]||(o(s.takeRecords()),s.disconnect(),Xe[i.id]=!0,n(!0))}));["keydown","click"].forEach((function(e){addEventListener(e,(function(){return We(a)}),!0)})),Ee(a),_e((function(r){i=be("LCP"),n=Se(e,i,Je,t.reportAllChanges),ke((function(){i.value=performance.now()-r.timeStamp,Xe[i.id]=!0,n(!0)}))}))}}))}(n),function(e,t){t=t||{},Oe((function(){var n,r=Ce(),i=be("FID"),o=function(e){e.startTime<r.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),n(!0))},s=function(e){e.forEach(o)},a=Ie("first-input",s);n=Se(e,i,ot,t.reportAllChanges),a&&(Ee(Pe((function(){s(a.takeRecords()),a.disconnect()}))),_e((function(){var r;i=be("FID"),n=Se(e,i,ot,t.reportAllChanges),he=[],ge=-1,pe=null,it(addEventListener),r=o,he.push(r),nt()})))}))}(n),Ve(n)}));return o.K4((n=>{let{stopped:o}=n;t++,(0,r.zG)(o,i.YP((e=>{e&&t--}))),e.metrics.isEnabled()&&s()}))};const at=e=>(e=>"CLS"===e.name)(e)?{value:e.value,suffix:`${e.name.toLowerCase()}_score`}:(e=>["INP","FID","LCP"].includes(e.name))(e)?{value:e.value/1e3,suffix:`${e.name.toLowerCase()}_seconds`}:void 0;var ut=n(1767);const ct=(e,t)=>{const{activationManager:n,externalData:s,metrics:a,permutiveData:u}=e;return(0,r.zG)(o.of({}),o.ak("psegs",(()=>((e,t)=>o.K4((n=>{let{stopped:o}=n;const s="_psegs";(0,r.zG)(i.vP(t,o),i.YP((t=>{let[n,i]=t;i||(0,r.zG)(n,f.EQ((()=>e.removeExternalData(s)),(t=>e.setExternalJsonData(s,t))))})))})))(e.externalData,t.qlSegments))),o.ak("webVitals",(()=>st(e))),o.ak("nativo",(()=>de({activationManager:n,externalData:s,metrics:a,queryLanguageCohorts:t.qlSegments,...t}))),o.ak("twitterPixel",(()=>(0,ut.eJ)({activationManager:n,metrics:a,permutiveData:u,queryLanguageCohorts:t.qlSegments,...t}))),o.ak("prebidJS",(()=>S(e))))};var lt=n(4575);const dt=()=>{const[e,t]=i.gS(f.uZ());return{trackEvent:e=>{let n,r,{event:i,useBeacon:o}=e;const s=new Promise(((e,t)=>{n=e,r=t}));return t([{localId:(0,u.k$)(),event:i,fail:r,succeed:n,useBeacon:o}]),s},trackedEvents:e}},ft=function(e,t,n){return o.of({replacementMap:i.a9(a.of({$privacy_sandbox_topics_v2:[]}))})};var pt=n(9662),gt=n(3339),mt=n(6289);n(7125);const ht=e=>[e,J.of(e)],vt=H.li,_t=H.Yg,yt=e=>ht(g.F2(e)),wt="RefEventual",bt=e=>t=>i.vP((0,r.zG)(t,i.UI(vt),i.UI(e)),(0,r.zG)(t,i.UI(_t),i.UI(J.UI(e)))),It=e=>t=>i.vP((0,r.zG)(i.vP((0,r.zG)(e,i.UI(vt)),(0,r.zG)(t,i.UI(vt))),i.UI((e=>{let[t,n]=e;return n(t)}))),(0,r.zG)(i.vP((0,r.zG)(e,i.UI(_t)),(0,r.zG)(t,i.UI(_t))),i.UI((e=>{let[t,n]=e;return J.ap(t)(n)})))),St={URI:wt,map:(e,t)=>bt(t)(e)},kt={URI:wt,map:St.map,ap:(e,t)=>It(t)(e)},Et=e=>i.a9(yt(e)),Pt=(g.dO,g.G5,Et(f.bM()),(0,u.mQ)((e=>a.YP)),e=>{const t=i.a9(a.G(f.bM()));return{activations:{gam:t,xandr:t,adswizz_keyvalue:t},cohorts:t,contextualAddon:a.YP,data:i.a9(a.G(void 0)),enrichedEvents:e.events,replacementMap:i.a9(a.G({}))}}),Gt=e=>{const t=e=>{if("number"==typeof e&&!Number.isNaN(e))return e;throw new Error("Received unexpected "+(Number.isNaN(e)?"NaN":"type "+typeof e))},n=e=>Math.max(0,t(e)/1e3);return{compressed:!!e.decodedBodySize&&e.decodedBodySize!==e.encodedBodySize,decoded_body_size:t(e.decodedBodySize),dns_lookup_duration:n(e.domainLookupEnd-e.domainLookupStart),encoded_body_size:t(e.encodedBodySize),fetch_duration:n(e.responseEnd-e.fetchStart),fetch_end:n(e.responseEnd),fetch_start:n(e.fetchStart),redirect_duration:n(e.redirectEnd-e.redirectStart),request_duration:n(e.responseStart-e.requestStart),retrieved:Ut(e),service_worker_duration:n(0===e.workerStart?0:e.fetchStart-e.workerStart),start_time:n(e.startTime),tcp_handshake_duration:n(e.connectEnd-e.connectStart),total_duration:n(e.duration),tls_negotiation:n(e.requestStart-e.secureConnectionStart),transfer_duration:n(e.responseEnd-e.requestStart),transfer_size:t(e.transferSize)}},Ut=e=>0===e.transferSize?"cache":e.transferSize>e.encodedBodySize?"network":"revalidate";a.YP,i.a9(a.YP),i.a9([]),i.a9([]),i.a9([]),i.a9(lt.b()),i.a9(a.YP),i.a9({segmentsEntered:[],segmentsExited:[]}),i.a9(!1),i.a9((e=>{let{event:t}=e;return Promise.resolve(t)})),new Y,i.a9(a.YP),i.a9(!1);function zt(e,t,n){const{addonsLoaded:c,consent:l,currentTimestampSecs:d,enabledAddons:p,identities:h,sdkVariant:v,sessionId:_,userId:y,userIdIsNewlyGenerated:w,viewId:b,pageviewState:I}=t,[S,k]=(0,r.zG)(i.Ue(i.a9(f.cS)),(e=>{let[t,n]=e;return[i.xH(t),n]})),E=a.ij(e.permutiveData.getData("event-source-id")),P=(0,r.zG)(y,i.Rp(-1,(e=>e+1)),i.UI((t=>(0,r.zG)(E,a.hX((()=>0===t)),a.fS((()=>{const t=(0,u.k$)();return e.permutiveData.setData("event-source-id",t),t}))))));return(0,r.zG)(o.vP({computeTimeMetrics:(U=e.metrics,o.K4((e=>{let{stopped:t}=e;const n=(0,s.HJ)((()=>{(0,r.zG)((0,s.iE)(),(0,u.bw)((()=>(0,s.ho)(!1))),f.UI((e=>{let[t,n]=e;return(n-t)/1e3})),(e=>{U.track({name:"sdk_ui_thread_compute_first10s_total_seconds",value:e.reduce(((e,t)=>e+t),0),labels:{}}),U.track({name:"sdk_ui_thread_compute_first10s_total_task_overrun_seconds",value:(0,r.zG)(e,f.hX((e=>e>.05)),f.UI((e=>e-.05)),f.u4(0,((e,t)=>e+t))),labels:{}}),U.track({name:"sdk_ui_thread_compute_first10s_longest_task_seconds",value:Math.max(0,...e),labels:{}})}))}),1e4);(0,r.zG)(t,i.YP((e=>e&&n())))}))),privacySandboxTopics:ft(e,_,l)}),o.UI((t=>{const{reset:n,trackEvent:o,trackedEvents:s}=((e,t)=>{const[n,o]=i.Ue(0),s=(0,r.zG)(i.vP(n,t),i.UI((()=>[]))),a=(0,r.zG)(i.vP(s,e),i.D8(((e,t)=>{let[,n]=e,[,r]=t;return n===r})),i.UI((e=>{let[t]=e;const n=dt();return t.forEach(n.trackEvent),n})));return{reset:()=>o(n.current+1),trackEvent:(0,r.zG)(i.vP(a,s),i.UI((e=>{let[t,n]=e;return e=>(n.push(e),t.trackEvent(e))}))),trackedEvents:(0,r.zG)(a,i.VS((e=>e.trackedEvents)))}})(y,b),{enrichedEvents:a,...u}=(e=>Pt(e))({consent:l,events:s,logger:e.logger,pageUrl:(0,r.zG)((()=>e.clientContext.getClientAsync()),J.UI((e=>e.url))),permutiveApi:e.permutiveApi,permutiveUrls:e.permutiveUrls,viewId:b}),[c,d,p]=(0,r.zG)(a,i.En(3,f.uZ()));return{...t,contextual:u,reset:n,trackEvent:o,unresolvedEvents:(0,r.zG)(c,i.UI(Q.UI(f.UI((e=>(0,r.bc)(e.localId,{fail:e.fail,succeed:e.succeed})))))),eventsToProcessLocally:(0,r.zG)(d,i.UI(Q.UI(f.hX((e=>!e.useBeacon))))),eventsToUploadViaBeacon:(0,r.zG)(p,i.UI(Q.UI(f.hX((e=>e.useBeacon)))))}})),o.ak("eventPublication",(n=>{let{unresolvedEvents:r}=n;return ce(e,r,S,t.sdkClosing)})),o.Hr("enrichmentReplacementMap",(e=>{let{contextual:t,privacySandboxTopics:n}=e;return(0,r.zG)(i.vP(t.replacementMap,n.replacementMap),i.UI((e=>{let[t,n]=e;return(0,W.gz)(a.g1)(t,n)})),i.UI(a.UI((e=>{let[t,n]=e;return{...t,...n}}))))})),o.ak("core",(s=>{let{contextual:u,enrichmentReplacementMap:c,eventPublication:p,eventsToProcessLocally:g}=s;return(0,r.zG)(n({contextualCohorts:(0,r.zG)(i.vP(u.cohorts,u.activations.gam,u.activations.xandr,u.activations.adswizz_keyvalue),i.UI(a.RD),i.UI(a.UI((e=>{let[t,n,r,i]=e;return{all:t,gam:n,xandrSsp:r,adswizz_keyvalue:i}})))),consent:l,currentTimestampSecs:d,enrichmentReplacementMap:c,eventSourceId:P,identities:h,newEvents:(0,r.zG)(g,i.UI(Q.UI(f.UI((e=>(0,r.bc)(e.localId,e.event)))))),sessionId:_,userId:y,userIdIsNewlyGenerated:w,viewId:b,webClient:t.webClient,pageviewState:I}),o.bw((e=>{let{eventsToPublish:t}=e;return(0,r.zG)(t,i.UI(Q.UI(Dt)),p.publishEvents)})),o.bw((e=>{let{eventsToPublishOnPageUnload:t}=e;return(0,r.zG)(t,i.UI(Dt),k)})),o.bw((t=>{let{externalData:n}=t;return(0,r.zG)(n,i.UI((t=>(0,r.zG)(Object.entries(t),f.UI((t=>{let[n,i]=t;return(0,r.zG)(i,a.EQ((()=>e.externalData.removeExternalData(n)),(t=>e.externalData.setExternalJsonData(n,t))))}))))))})),o.bw((t=>{let{context:n}=t;return(0,r.zG)(n,i.UI((t=>{const n=Object.entries(t);e.clientContext.updateContext(...n)})))})))})),o.bw((e=>{let{core:n,eventPublication:o,eventsToUploadViaBeacon:s}=e;return(0,r.zG)(i.vP({cohorts:n.cohorts.all,eventsIO:s,segments:n.cohorts.ql,sessionId:_,userId:y,viewId:b,webClient:t.webClient}),i.UI((e=>{let{webClient:t,...n}=e;return(0,r.zG)(t,a.UI((e=>({...n,webClient:e}))))})),i.UI(a.EQ((()=>Q.of(f.bM())),(e=>{let{cohorts:t,eventsIO:n,segments:i,sessionId:o,userId:s,viewId:a,webClient:u}=e;return(0,r.zG)(n,Q.UI(f.UI((e=>{let{event:n,localId:c}=e;return(0,r.bc)(c,{requiresEnrichment:!0,sdkProcessed:!1,event:{user_id:s,name:n.name,segments:i,cohorts:t,properties:{...n.properties,client:{...u,...n.properties.client??{}}},session_id:o,time:new Date,view_id:a}})}))))}))),o.publishEvents)})),o.ak("metricContext",(e=>{let{core:n}=e;return(0,r.zG)(n.geoIP,i.UI(a.tS((e=>a.ij(e.geo_info)))),(e=>lt.X({geoInfo:e,sampleRate:t.metricSampleRate,sdkVariant:v,sessionId:_,userId:y,viewId:b})))})),o.ak("sdkql",(t=>{let{core:n}=t;return ct(e,{addonsLoaded:c,consent:l,initdAddons:p,qlSegments:n.cohorts.ql})})),o.ak("strategicPartnerships",(t=>{let{sdkql:n}=t;return((e,t)=>o.vP({prebid_identifiers:F(e,t)}))(e,{pbjs:(0,r.zG)(n.prebidJS,i.UI((e=>(0,r.zG)(e.mainPair,a.UI((e=>e.pbjs))))))})})),o.ak("mediaAndEntertainment",(t=>{let{core:n}=t;return((e,t)=>(0,r.zG)(o.vP({freewheel:N({activationManager:e.activationManager,externalData:e.externalData,...t})}),o.UI((0,r.a9)({}))))(e,{addonsLoaded:c,consent:l,initdAddons:p,queryLanguageCohorts:n.cohorts.ql})})),o.ak("advertisers",(t=>{let{sdkql:n}=t;return((e,t)=>(0,r.zG)(o.of(t),o.ak("prebidMonitoring",(t=>{let{consent:n,prebidJS:r}=t;return G(e,i.vP({consent:n,prebidJS:r}))})),o.ak("videoPlayerMonitoring",(t=>{let{consent:n}=t;return $(e,{consent:n})})),o.UI(r.Q1)))(e,{consent:l,prebidJS:n.prebidJS})})),o.ak("identityManager",(t=>{let{core:n}=t;return(0,pt.u6)({...e,consent:l,tcfApiStatus:(0,gt.SD)(window,e.logger).tcfApiStatusRef,currentTimestampSecs:d,geoIP:n.geoIP},h)})),o.bw((function(){(0,r.zG)((0,W.gz)(a.G5)(e.performance,(0,r.zG)(t.currentScript,a.UI((e=>e.src)),a.hX((e=>"string"==typeof e)))),a.UI((n=>{let[i,o]=n;var s;(s={consent:t.consent,logger:e.logger,metrics:e.metrics,name:o,performance:i}).consent.current&&s.metrics.isEnabled()&&(0,r.zG)(m.nI(s.performance.getEntriesByName(s.name,"resource")),a.UI(m.YM),a.hX((e=>self.PerformanceResourceTiming&&e instanceof self.PerformanceResourceTiming)),a.fX((e=>g.Y3((()=>Gt(e)),(0,u.bw)((t=>s.logger.warn("[resource timing] Failed to compute labels",{error:t,entry:e})))))),a.UI((e=>{const{total_duration:t,...n}=e;s.metrics.track({name:"sdk_resource_timing_seconds",value:t,labels:{...n,name:s.name}})})))})))})),o.UI((e=>{let{core:t,contextual:n,metricContext:r,sdkql:o,trackEvent:s,eventPublication:a,strategicPartnerships:u,identityManager:c,reset:l}=e;return{activations:{dfp:i.UI((e=>e.dfp),t.activations),dfp_contextual:i.UI((e=>e.dfp_contextual),t.activations),xandr_ssp:i.UI((e=>e.xandr_ssp),t.activations),xandr_ssp_contextual:i.UI((e=>e.xandr_ssp_contextual),t.activations),adswizz_keyvalue:i.UI((e=>e.adswizz_keyvalue),t.activations),adswizz_keyvalue_contextual:i.UI((e=>e.adswizz_keyvalue_contextual),t.activations)},addons:{contextual:n.contextualAddon,identityManager:c,secureSignal:t.secureSignal},metricContext:r,pbjsPair:i.UI((e=>e.mainPair),o.prebidJS),queryLanguageCohorts:{all:t.cohorts.ql,custom:t.cohorts.qlCustom,standard:t.cohorts.qlStandard},segmentTransitionsSinceInit:t.transitionsSinceInit,trackEvent:s,realtime:t.realtime,eventHandlerAfterUpload:a.eventHandlerAfterUpload,prebidIdentifiers:u.prebid_identifiers,reset:l,stateMigratedThisInitialisation:t.stateMigratedThisInitialisation}})));var U}const Dt=f.UI((0,H.H5)((e=>({event:e,requiresEnrichment:!1,sdkProcessed:!0}))));function xt(e){return(0,r.ls)((0,u.rO)({previousState:e=>{if("string"!=typeof e)return{};try{return JSON.parse(e)}catch{return{}}}}),e,(0,u.rO)({state:i.UI(JSON.stringify)}))}function Ct(e){const t=function(e){const{activationManager:t,api:n,clientContext:r,config:i,externalData:o,logger:s,metrics:u,permutiveData:c,network:l,urls:d,namespace:f,trace:p}=e;return{activationManager:t,api:n,clientContext:r,config:i,externalData:o,logger:s,metrics:u,performance:a.ij(self.performance),permutiveData:c,permutiveApi:l,permutiveUrls:d,reportError:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.reportError(e,t?.userId,t?.timestamp)},namespace:f,trace:p}}(e),n=function(e){const t={addonsLoaded:e.addonsLoaded,currentScript:e.currentScript,consent:(n=e.consentTracking,(0,r.zG)(n,a.EQ((()=>i.a9(!0)),(e=>e.consentRef)))),currentTimestampSecs:l(),enabledAddons:c(e),identities:e.identities,sdkClosing:d(),metricSampleRate:e.config.metricsSamplingPercentage/100,sdkVariant:a.ij(e.sdkVariant),sessionId:i.a9(e.sessionManager.getSessionId()),userId:e.userId.ref,userIdIsNewlyGenerated:e.userId.isNewlyGenerated,viewId:e.viewId.ref,pageviewState:e.pageviewState,webClient:e.webClient};var n;return t}(e);return function(e,t,n,a){const c=5e3,l=(0,r.zG)(e,function(e,t){return n=>o=>{const{value:a,state:u}=n(o),[c,l]=i.Ue(u.current),d=(0,s.UM)((()=>l(u.current)),e),f=(0,r.zG)(i.vP(u,c),i.UI((e=>{let[t,n]=e;return t===n})));return(0,r.zG)(t,i.bw((e=>e&&d()))),{value:(0,r.bc)(f,a),state:(0,r.zG)(i.vP(t,u,c),i.UI((e=>{let[t,n,r]=e;return t?n:r})))}}}(c,a),xt,function(e){return t=>(0,r.ls)((0,u.rO)({previousState:t=>e.current?t:void 0}),t,(0,u.rO)({state:(0,r.ls)((t=>i.vP(e,t)),i.UI((e=>{let[t,n]=e;return t?n:void 0})))}))}(n),function(e){return t=>(0,r.ls)((0,u.rO)({previousState:()=>localStorage.getItem(e)}),t,(0,u.rO)({state:(0,u.bw)(i.YP((t=>{switch(typeof t){case"string":localStorage.setItem(e,t);break;case"undefined":localStorage.removeItem(e);break;case"object":if(null===t){localStorage.removeItem(e);break}throw new Error("Permutive app raised an invalid state.");default:throw new Error("Permutive app raised an invalid state.")}})))}))}(t),o.UI((e=>{let[t,n]=e;return n})));return l({stopped:i.a9(!1)}).value}(zt(t,n,e.core),e.namespace.getNamespacedStorageKey("permutive-app"),n.consent,n.sdkClosing)}},1118:(e,t,n)=>{n.d(t,{B9:()=>g,iq:()=>d,ti:()=>h});var r=n(5654),i=n(842),o=n(7144),s=n(8236),a=n(2169),u=n(4991),c=n(9829);const l="__permutive.",d="__permutiveConfigQueryParams";const f={default:{windowKey:"permutive",environment:"default",apiHost:"api.permutive.com",apiKey:"",apiProtocol:"https",cdnBaseUrl:"cdn.permutive.com",cdnProtocol:"https",pxidHost:"prmutv.co",apiVersion:"v2.0",sdkErrorsApiVersion:"v2",advertiserApiVersion:"v2",classificationModelsApiVersion:"v1",loggingEnabled:!1,tracingEnabled:!1,requestTimeout:5e3,cookieDomain:"."+(0,c._Y)(window.location.hostname),cookieName:"permutive-id",cookieExpiry:function(){const e=new Date;return e.setMonth(e.getMonth()+6),e.toUTCString()}(),eventsTTLInDays:null,permutiveDataMiscKey:"permutive-data-misc",permutiveDataQueriesKey:"permutive-data-queries",stateNamespace:"",sendClientErrors:!0,metricsSamplingPercentage:20,eventsCacheLimitBytes:25e5,segmentSyncApiHost:"681a9fe0-03f0-4efd-84f7-234f21a156cf.partner.permutive.app",consentRequired:!1,sdkType:"stable",viewId:null,localStorageDebouncedKeys:[],localStorageWriteDelay:1e3,localStorageWriteMaxDelay:1500,watson:{enabled:!0},secureSignalsApiHost:"secure-signals.permutive.app",prebidAuctionsRandomDownsamplingThreshold:0},production:{},development:{apiProtocol:"http",loggingEnabled:!0,tracingEnabled:!0,sendClientErrors:!1}},p=e=>{const t={consentRequired:!0,loggingEnabled:!0,sendClientErrors:!0,tracingEnabled:!0},n={eventsTTLInDays:!0,eventsCacheLimitBytes:!0,metricsSamplingPercentage:!0,requestTimeout:!0,localStorageWriteDelay:!0,localStorageWriteMaxDelay:!0,prebidAuctionsRandomDownsamplingThreshold:!0};return Object.keys(e).reduce(((r,i)=>{if(t.hasOwnProperty(i)){const t="true"===e[i];return{...r,[i]:t}}if(n.hasOwnProperty(i)){const t=Number(e[i]);return isNaN(t)?r:{...r,[i]:t}}return{...r,[i]:e[i]}}),{})},g=function(){let{getQueryParams:e=c.zM}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=e=>Object.entries(e).reduce(((e,t)=>{let[n,r]=t;if(!(0===n.indexOf(l)))return e;const i=n.replace(l,"");return[...e,[i,r]]}),[]);return(0,a.zG)(o.Y3((()=>(0,a.zG)(e(),t,(e=>(0,u.m8)(...e)),p,(e=>m({queryConfig:e})))),(e=>`Failed to parse query params. Got ${(0,r.w)(e).message}`)))},m=e=>{let{queryConfig:t}=e;const n=(0,a.zG)(s.Y3((()=>window.sessionStorage.getItem(d))),s.tS(s.ij),s.tS((0,a.ls)(i.A,s.ij)),s.fS((()=>({}))));return(0,u.PM)(n,t)},h=(e,t)=>{const n=(e.environment&&f[e.environment])??{};return(0,u.PM)(f.default,n,e,t)}},1997:(e,t,n)=>{n.d(t,{v:()=>r});const r=(e,t,n)=>function(){const r=n()?t:e;return r(...arguments)}},6583:(e,t,n)=>{n.d(t,{S:()=>m});var r=n(2169),i=n(8236),o=n(9912),s=n(1561),a=n(4474),u=n(3215);var c=n(4991);class l{wait_prev;block_next;task;started;complete;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.wait_prev=t.wait_prev||!1,this.block_next=t.block_next||!1,this.started=!1,this.complete=!1,this.task=e}waits(){return this.wait_prev}blocks(){return this.block_next}execute(e){this.started=!0,this.task((()=>{this.complete=!0,e()}))}}var d=n(9013);n(5869),n(4187);class f{logger;api;activationManager;sessionManager;metrics;viewId;userId;network;clientContext;unprocessedEvents;taskQueue;identities;permutiveReset;messages;addons;trace;permutiveRealtime;state;customProperties;config;permutiveData;externalData;cookies;identitiesIngestor;global;nextGen;pageviewState;tcf;initialisedAddons=[];constructor(e,t,n,r,i,o,s,a,u,c,l,d,f,p,g,m,h,v,_,y,w,b,I,S,k,E,P,G){this.logger=e,this.api=t,this.activationManager=n,this.sessionManager=r,this.metrics=i,this.viewId=o,this.userId=s,this.network=a,this.clientContext=u,this.unprocessedEvents=c,this.taskQueue=l,this.identities=d,this.permutiveReset=f,this.messages=p,this.addons=g,this.trace=m,this.permutiveRealtime=h,this.state=v,this.customProperties=_,this.config=y,this.permutiveData=w,this.externalData=b,this.cookies=I,this.identitiesIngestor=S,this.global=k,this.nextGen=E,this.pageviewState=P,this.tcf=G}identify(e){const t="[Identify]";this.logger.debug("<call> identify",e);const n=(0,c.b2)(),{left:s,right:u}=this.identities.parseCustomerDefinedIdentities(e);if(s.length>0)throw new Error(s.join(" "));const f={...this.identities.getIdentitiesMap(),...u.reduce(((e,t)=>{let{tag:n,id:r,priority:i,expiry:o}=t;return{...e,[n]:{id:r,...void 0!==i?{priority:i}:{},...void 0!==o?{expiry:o}:{}}}}),{})},p=(0,r.zG)(Object.values(f),o.DZ((e=>i.ij(e.id)))),g=this.identities.getPrioritizedIdentities(f);if("string"==typeof e&&(0,a.Bt)("681a9fe0-03f0-4efd-84f7-234f21a156cf","681a9fe0-03f0-4efd-84f7-234f21a156cf",p,window.location.hostname,this.userId.get()))return n.resolve(),n.promise;const m=async e=>{await(0,d.Yj)({clientContext:this.clientContext,global:this.global,identities:this.identities,logger:this.logger,reset:this.permutiveReset,userId:this.userId},e.user_id)};return this.taskQueue.add(new l((async e=>{this.logger.debug("<task> identify",u);const r=async()=>{this.logger.log(t,"request identity");const e=await this.api.identify(this.metrics,this.userId,g);this.userId.isEqual(e.user_id)?this.metrics.track({name:"sdk_identity_remained_total",value:1,labels:{identify_reason:"identify_call"}}):(this.metrics.track({name:"sdk_identity_changed_total",value:1,labels:{identify_reason:"identify_call"}}),await m(e))};this.identities.setIdentities(u).identifyRequestRequired()?await r():this.logger.log(t,"skip request"),this.logger.debug("<done> identify",u),e(),n.resolve(),await this.identitiesIngestor.ingestIfEligible(u).catch((e=>this.api.reportError(`Couldn't ingest identities, got ${e}`,this.userId.get())))}),{wait_prev:!0,block_next:!0})),n.promise}on(e,t){return this.nextGen.eventHandlerAfterUpload.addListener({name:e,callback:t,once:!1})}once(e,t){return this.nextGen.eventHandlerAfterUpload.addListener({name:e,callback:t,once:!0})}pageviewTracked=!1;track(){const[e,t,n]=[arguments.length<=0?void 0:arguments[0],(arguments.length<=1?void 0:arguments[1])||{},(arguments.length<=2?void 0:arguments[2])||{}],r=this.trace.startSpan(`track("${e}")`);this.logger.log("<call> track",e);const i=(0,c.b2)();this.pageviewTracked||"Pageview"!==e||(this.pageviewTracked=!0,this.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"pageview_tracked",time_origin:"sdk_init"})),this.metrics.trackCounter({name:"sdk_event_track_count_total",labels:{event_name:e},value:1}),i.promise.then((()=>{this.metrics.trackCounter({name:"sdk_event_track_success_count_total",labels:{event_name:e},value:1}),r.finish()}),(()=>{this.metrics.trackCounter({name:"sdk_event_track_fail_count_total",labels:{event_name:e},value:1}),r.finish()}));const o=n.unprocessedData??{},s=o.sessionId??this.sessionManager.getSessionId(),a=o.viewId??this.viewId.get(),u={success:n.success||(e=>{}),error:n.error||((e,t)=>{})};return this.taskQueue.add(new l((r=>{this.logger.log("<task> track",e);return(o.client?Promise.resolve(o.client):this.clientContext.getClientAsync()).then((o=>{const l={name:e,properties:{...t,client:t.client?(0,c.PM)(o,t.client):o},session_id:s,view_id:a,time:new Date};return this.nextGen.trackEvent.current({event:l,useBeacon:n.useBeacon??!1}).then((e=>{this.logger.log("<done> track",l.name),u.success(e),i.resolve(l),r()})).catch((e=>{u.error(e),this.api.reportError(e,this.userId.get()),i.reject(e)}))}))}))),i.promise}trigger(e,t,n){const r=(0,c.b2)();this.logger.log("<call> trigger",e);const i=t=>(i,o)=>{if(i.properties.segment_number===e){const s={result:t};this.logger.debug("<fire> trigger",{event:i,error:o,segmentCode:e,payload:s}),n(s),r.resolve(s)}};return this.nextGen.eventHandlerAfterUpload.addListener({name:"SegmentEntry",callback:i(!0),once:!1}),this.nextGen.eventHandlerAfterUpload.addListener({name:"SegmentExit",callback:i(!1),once:!1}),this.logger.log("<done> trigger",e),r.promise}query(){return Promise.resolve({result:!1})}segment(e,t){const n=(0,c.b2)();this.logger.log("<call> segment",e);return this.taskQueue.add(new l((r=>{this.logger.log("<task> segment",e);const i=this.nextGen.queryLanguageCohorts.all.current.includes(e)||!1;t(i),n.resolve(),this.logger.log("<done> segment",e),r()}))),n.promise}segments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";const n=(0,c.b2)();this.logger.log("<call> segments");return this.taskQueue.add(new l((r=>{this.logger.log("<task> segments ("+t+")");const i=i=>{e(i),n.resolve(i),this.logger.log("<done> segments ("+t+")"),r()};"dfp"===t?this.messages.once("permutive:dfp:ready",(()=>{this.addons.dfp&&i([...this.addons.dfp.segments.liveSegments])})):i([...this.nextGen.queryLanguageCohorts.all.current])}))),n.promise}reset(){return Promise.all([this.api.reset(this.metrics),this.identities.reset(),this.permutiveReset.reset(),this.nextGen.reset(),this.userId.reset()]).then((()=>{this.messages.emit("permutive:reset")})).catch((e=>{this.api.reportError(`Error resetting internals. Got ${e}`)}))}addon(e,t){this.logger.debug("[Addon]",`Called for ${e}`,t);const o={...t,permutive:this,api:this.api,activationManager:this.activationManager,network:this.network,clientContext:this.clientContext,logger:this.logger,unprocessedEvents:this.unprocessedEvents,metrics:this.metrics,state:this.state,messages:this.messages,userId:this.userId,viewId:this.viewId,customProperties:this.customProperties,config:this.config,permutiveData:this.permutiveData,sessionManager:this.sessionManager,addons:this.addons,externalData:this.externalData,cookies:this.cookies,nextGenOutput:this.nextGen,identities:this.identities,pageviewState:this.pageviewState,tcf:this.tcf},a=((0,r.zG)(this.nextGen.pbjsPair,s.UI(i.UI((0,c.vg)("pbjs")))),e=>{this.initialisedAddons.push(e),this.messages.emit("permutive:addon:preinit",e)});if("contextual"===e&&i.pC(this.nextGen.addons.contextual))return"contextual"in this.addons||(a(e),this.addons.contextual=this.nextGen.addons.contextual.value),this.addons.contextual(t),this.addons.contextual;if(-1===this.initialisedAddons.indexOf(e))switch(a(e),e){case"web":Promise.resolve().then(n.bind(n,3530)).then((e=>this.addons.web=new e.WebAddon(o))).then((()=>this.messages.emit("permutive:web:ready")));break;case"publishers":case"overlays":case"scriptrunner":case"dfp":case"nativo":case"freewheel":case"facebook_pixel_v2":case"tiktok_pixel":case"eyeota_pixel":case"rubicon":case"rubicon_ssp":case"tracking_pixel":case"twitter_pixel":case"pinterest_pixel":case"local_storage":case"prebid":case"classification_models":case"clean_room":case"prebid_analytics":case"gam_log":case"smart":case"tradedesk":case"ddp":case"dbm":case"pubmatic":case"ssp":0;break;case"appnexus_adserver":Promise.resolve().then(n.bind(n,2097)).then((e=>this.addons.appnexus_adserver=new e.AppNexusAdServerAddon(o)));break;case"appnexus":Promise.resolve().then(n.bind(n,7806)).then((e=>this.tcf.registerVendorOnValidConsent("appnexus",(t=>this.addons.appnexus=new e.AppnexusPixel({...o,tcfStatus:t})))));break;case"amazon_publisher_services":(0,r.zG)(i.YP,i.UI((e=>this.addons.amazon_publisher_services=e)));break;case"adswizz_keyvalue":(0,r.zG)(i.YP,i.UI((e=>this.addons.adswizz_keyvalue=e)))}else"web"===e&&!0!==t.auto_init?((e,t,n,r)=>new Promise(((o,s)=>{const a=(0,i.Y3)(e);if((0,i.pC)(a))return o(a.value);n.once(t,(()=>(0,i.g_)((()=>s(new Error(`Error after waiting for event ${t}`))),o)((0,i.Y3)(e))));const c=r?.timeout??1e4;(0,u.HJ)((()=>s(new Error(`Event ${t} was not received within the timeout period ${c}ms`))),c)})))((()=>{if(!this.addons.web)throw new Error('"web" addon not ready');return this.addons.web.reset(t)}),"permutive:web:ready",this.messages).catch((e=>{this.api.reportError(`Got error while trying to reset web. Got ${e.message}`,this.state.userId.get())})):"appnexus_adserver"===e&&!0!==t?.auto_init&&this.addons.appnexus_adserver&&this.addons.appnexus_adserver.reset()}ready(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"initialised";const n=(0,c.b2)(),r=()=>{e(),n.resolve()};switch(t){case"initialised":this.permutiveRealtime.isReady()?r():this.messages.on("permutive:ready",r);break;case"realtime":this.permutiveRealtime.isRealtime()?r():this.messages.once("permutive:realtime",r)}return n.promise}}var p=n(1997);const g=e=>{const{logger:t,consentTracking:n}=e,i=function(){return t.debug("Methods[track]: Cannot track as consent is revoked"),Promise.resolve(null)};return e=>class extends e{constructor(){super(...arguments),n.isRevoked()&&this.consentRevoked(),n.listenForConsent((()=>this.consentRevoked()),r.Q1)}async consentRevoked(){return await this.sessionManager.reset(),this.reset()}track=(()=>(0,p.v)(super.track.bind(this),i,n.isRevoked))()}},m=(e,t,n,i,o,s,a,u,c,l,d,p,m,h,v,_,y,w,b,I,S,k,E,P,G,U,z,D,x)=>new((0,r.zG)(f,g({consentTracking:U,logger:e})))(e,t,n,i,o,s,a,u,c,l,d,p,m,h,v,_,y,w,b,I,S,k,E,P,G,z,D,x)},9013:(e,t,n)=>{n.d(t,{Yj:()=>u,TZ:()=>a});var r=n(5654),i=n(4991);var o=n(4474);const s=async e=>{await e.identities.thirdParty,await function(e,t){return(0,o.Bt)("681a9fe0-03f0-4efd-84f7-234f21a156cf","681a9fe0-03f0-4efd-84f7-234f21a156cf",e.identities.getPrioritizedIdentities(e.identities.getIdentitiesMap()).map((e=>e.id)),window.location.hostname,e.userId.get())?t.reset():Promise.resolve()}(e,e.permutiveMethods);const t=await function(e){const t=e.trace.startSpan("identify");0;return(async e=>{const t="[Identify Init]",{logger:n,api:r,userId:o,identities:s,metrics:a,identitiesIngestor:u,messages:c,sessionManager:l}=e,d=await s.thirdParty,f=s.extractIdentifyFromQueue(e),p={...s.getIdentitiesMap(),...f.reduce(((e,t)=>{let{tag:n,id:r,priority:i,expiry:o}=t;return{...e,[n]:{id:r,...o?{expiry:o}:{},...void 0!==i?{priority:i}:{}}}}),{})},g=s.setIdentities(Object.entries(p).map((e=>{let[t,{id:n,priority:r,expiry:i}]=e;return{tag:t,id:n,...i?{expiry:i}:{},...void 0!==r?{priority:r}:{}}})));s.setReady();const m=s.getPrioritizedIdentities(p);n.log("Begin identification");const h=e.sessionCount>1&&l.sessionHasChanged()||d.identifyRequestRequired()||g.identifyRequestRequired()?await(n.debug(t,"request identity"),r.identify(a,o,m).then((e=>{const r=e.user_id;return o.isEqual(r)?{identityChanged:!1}:(n.debug(t,"fetch received new user id",r),{identityChanged:!0,userId:r})})).catch((e=>(r.reportError(`${t} Fetch failed. Got ${e}`,o.get()),{identityChanged:!1}))).then((0,i.bw)((t=>e.metrics.track({name:`sdk_identity_${t.identityChanged?"changed":"remained"}_total`,value:1,labels:{identify_reason:"sdk_init"}}))))):(n.debug(t,"skip request"),{identityChanged:!1});return u.ingestIfEligible(m).catch((e=>r.reportError(`Couldn't ingest identities, got ${e}`,h.identityChanged?h.userId:o.get()))),c.emit("permutive:user:ready"),n.debug(t,"result",h),h})(e).catch((t=>(e.api.reportError(`Failed to identify. Got ${(0,r.w)(t)}`),{identityChanged:!1}))).then((e=>(t.finish(),e)))}(e);return t.identityChanged?await u(e,t.userId):e.logger.log("Identity has not changed"),t},a=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{};s(e).then(t),c(e.global,e.clientContext)};async function u(e,t){e.logger.log("Identity has changed"),await e.reset.reset(),e.userId.set(t),c(e.global,e.clientContext),e.identities.setIdentities([])}function c(e,t){return e.context=t.getContext()}},7133:(e,t,n)=>{function r(e,t,n,r){r.debug("set SDK as ready"),e.emit("permutive:api:ready"),e.emit("permutive:queries:initialised"),t.track({name:"sdk_local_storage_byte_total",value:n.getStateSizeInBytes(),labels:{}}),r.warn("sdk_query_states_byte_total metric needs re-implementing")}n.d(t,{R:()=>r})},2365:(e,t,n)=>{n.d(t,{LA:()=>a});var r=n(9912),i=n(856),o=n(4991);const s=(e,t,n)=>{let{api:r,state:i}=n;r.reportError(`Function "permutive.${t.functionName}" caused an error: ${e.message}`,i.userId.get())};function a(e,t,n,r,i,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:d;const c=u(e),l=o.startSpan("queued_methods"),f={api:i,state:t},p=e=>{if(e.functionName in n){n[e.functionName].apply(r,e.arguments)}else s(new Error("Does not exist."),e,f)},g=e=>!a.includes(e);c.forEach((e=>{try{g(e.functionName)&&p(e)}catch(t){const n=t instanceof Error?t:new Error("Unknown error.");s(n,e,f)}})),l.finish()}function u(e){const t=(0,r.uK)((e=>-1!==l.indexOf(e.functionName)))(e),n=t.right,s=t.left.filter((e=>"consent"!==e.functionName)),a=(0,i.Zt)(((e,t)=>c(e)&&c(t)?(0,o.lW)(f).compare(e.arguments[0],t.arguments[0]):(0,o.lW)(l).compare(e.functionName,t.functionName)));return(0,r.DY)(a)(n).concat(s)}const c=e=>"addon"===e.functionName,l=["identify","trigger","addon","track"],d=["identify"],f=["dfp","appnexus_adserver","web"]},9831:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{initialiseWebSDK:()=>initialiseWebSDK});var _permutive_permutive_utils_ts_error__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(5654),fp_ts_Option__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(8236),fp_ts_Either__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(7144),fp_ts_function__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(2169),fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(132),_framework_ref__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1561),_identity_legacy_NeustarFabrickIdentitiesIngestor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1828),_identity_legacy_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4474),_identity_legacy_PermutiveIdentitiesIngestorNoOp__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(86),_sdkql_blockers__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(9424),_core_activations_PermutiveActivationManagerWeb__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5696),_core_activations_PermutiveAddons__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4187),_sdkql_event_collection_events_cache_store_crypto_HashcodeDigest__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(736),_sdkql_event_collection_events_cache_store_crypto_SHA256Digest__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(2528),_sdkql_event_collection_PermutiveEventCustomProps__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(3498),_core_events_unprocessed_UnprocessedPrebidAuctions__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(7911),_core_metrics_MetricReporter__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(7249),_core_state_PermutiveRealtime__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(7311),_core_state_PermutiveReset__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(3697),_core_state_PermutiveStateWeb__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(8295),_core_state_PermutiveViewId__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(5876),_core_store_LocalStorage__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(7499),_core_tcf_TCF__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(3339),_dynamic_addons_LoadAddons__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(3832),_dynamic_messages_PermutiveMessages__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(4883),_http_PermutiveApi__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(3207),_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(4991),_utils_task_queue_PermutiveTaskQueue__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(8291),_Config__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(1118),_initialisation_identity__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(9013),_initialisation_initialisationLifecycle__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(7133),_initialisation_queuedMethods__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(2365),_PermutiveMethodsWeb__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(6583),_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(3215),fp_ts_Task__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(2678),main_core_store_SessionStorage__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(2101),main_http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(183);const prefix="[Initialisation Web]",initialiseWebSDK=_ref=>{let{cookieStore,clientContext,currentScript,consentModule,core,externalData,localStorage,logger,messages,metrics,namespace,pageviewState,partialTagWithKey,permutiveData,sessionManager,tag,trace,configFromQueryParams,urls,userId}=_ref;return(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_21__.Y3)((async()=>{const windowKey=partialTagWithKey.key,permutiveGlobal=window[windowKey],config=tag.config,viewId=(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(pageviewState.ref,_framework_ref__WEBPACK_IMPORTED_MODULE_0__.UI((e=>e.viewId)),(e=>new _core_state_PermutiveViewId__WEBPACK_IMPORTED_MODULE_23__.W(e))),network=new main_http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_20__.E(logger,metrics),sessionStorage=(0,main_core_store_SessionStorage__WEBPACK_IMPORTED_MODULE_19__.u)(namespace,logger,consentModule.consentTracking.consentRef),{consentTracking,consentValidation}=consentModule;(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(consentTracking.consentRef,_framework_ref__WEBPACK_IMPORTED_MODULE_0__.YP((e=>{e?sessionStorage.put(configFromQueryParams,_Config__WEBPACK_IMPORTED_MODULE_14__.iq).then(fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.Q1,(e=>{logger.warn(prefix,`Failed to cache "${_Config__WEBPACK_IMPORTED_MODULE_14__.iq}".`,(0,_permutive_permutive_utils_ts_error__WEBPACK_IMPORTED_MODULE_24__.w)(e))})):sessionStorage.delete(_Config__WEBPACK_IMPORTED_MODULE_14__.iq)}))),window[windowKey].consent=consentValidation;const createInternalsSpan=trace.startSpan("internals");(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(viewId.ref,_framework_ref__WEBPACK_IMPORTED_MODULE_0__.YP((e=>clientContext.updateContext(["view_id",e])))),(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(userId.ref,_framework_ref__WEBPACK_IMPORTED_MODULE_0__.YP((e=>clientContext.updateContext(["user_id",e]))));const api=new _http_PermutiveApi__WEBPACK_IMPORTED_MODULE_11__.F(urls,config,network,metrics,logger),tcf=(0,_core_tcf_TCF__WEBPACK_IMPORTED_MODULE_9__.SD)(window,logger),identityProviderEnv={permutive:permutiveGlobal,network,api,userId,metrics,permutiveData,messages,config,cookies:cookieStore,logger,tcf},identities=new _identity_legacy_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_2__.lg(metrics,trace,permutiveData,identityProviderEnv,logger),identitiesIngestor=new _identity_legacy_PermutiveIdentitiesIngestorNoOp__WEBPACK_IMPORTED_MODULE_25__.z,permutiveRealtime=new _core_state_PermutiveRealtime__WEBPACK_IMPORTED_MODULE_26__.u(trace,metrics,messages),unprocessedArgs={consent:consentTracking.consentRef,logger,namespace},unprocessedEvents={PrebidAuctions:new _core_events_unprocessed_UnprocessedPrebidAuctions__WEBPACK_IMPORTED_MODULE_27__.J(unprocessedArgs)},customProperties=new _sdkql_event_collection_PermutiveEventCustomProps__WEBPACK_IMPORTED_MODULE_7__.X,permutiveReset=new _core_state_PermutiveReset__WEBPACK_IMPORTED_MODULE_28__.a(config,localStorage,logger,permutiveData,cookieStore,externalData),taskQueue=new _utils_task_queue_PermutiveTaskQueue__WEBPACK_IMPORTED_MODULE_13__.i(messages),activationManager=new _core_activations_PermutiveActivationManagerWeb__WEBPACK_IMPORTED_MODULE_3__.v(logger,permutiveGlobal,clientContext),[addonsLoadedRef,setAddonsLoaded]=_framework_ref__WEBPACK_IMPORTED_MODULE_0__.Ue(!1),webClient=(()=>{const[e,t]=_framework_ref__WEBPACK_IMPORTED_MODULE_0__.Ue(Date.now());return(0,_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_18__.UM)((()=>t(Date.now())),1e3),(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(_framework_ref__WEBPACK_IMPORTED_MODULE_0__.vP(viewId.ref,e),_framework_ref__WEBPACK_IMPORTED_MODULE_0__.UI((()=>clientContext.getClient())),_framework_ref__WEBPACK_IMPORTED_MODULE_0__.D8(((e,t)=>e===t||JSON.stringify(e)===JSON.stringify(t))))})(),eventCacheStoreFactory=()=>(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)((0,_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_18__.N1)((0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)((0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_21__.Y3)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,7109))),String),trace.traceTask("import-DBStore-main-thread"))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_21__.UI)((e=>{let{DBStore:t}=e;return new t((0,_core_store_LocalStorage__WEBPACK_IMPORTED_MODULE_29__.E)(namespace,logger,consentTracking.consentRef))}))),eventsCacheFactory=()=>(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)((0,_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_18__.SF)((0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)((0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_21__.Y3)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,9484))),String),trace.traceTask("import-events-cache"))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_21__.tS)((e=>{let{EventsCache:t}=e;return(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(t.initialise(config,logger,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};api.reportError(e,t?.userId,t?.timestamp)}),trace,metrics,userId.ref,eventCacheStoreFactory),trace.traceTask("initialise-events-cache-main-thread"))}))),nextGen=await(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)((0,_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_18__.SF)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,1845)))),trace.traceTask("import-next-gen"),fp_ts_Task__WEBPACK_IMPORTED_MODULE_30__.Qt("configureCore",core),fp_ts_Task__WEBPACK_IMPORTED_MODULE_30__.tS((e=>{let{runNextGenFeatures:t,configureCore:n}=e;return(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)((0,_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_18__.N1)((async()=>t({activationManager,addonsLoaded:addonsLoadedRef,api,currentScript,clientContext,config,consentTracking:fp_ts_Option__WEBPACK_IMPORTED_MODULE_31__.G(consentTracking),core:n({eventsCacheFactory,migratedStateMaps:()=>({internal:(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(permutiveData.getData("internal_query_states"),fp_ts_Option__WEBPACK_IMPORTED_MODULE_31__.DT(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_12__.Kn)),external:(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(permutiveData.getData("external_query_states"),fp_ts_Option__WEBPACK_IMPORTED_MODULE_31__.DT(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_12__.Kn))})}),externalData,identities:identities.ref,logger,messages,metrics,namespace,network,permutiveData,sessionManager,urls,userId,viewId,pageviewState:pageviewState.ref,trace,webClient:(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(webClient,_framework_ref__WEBPACK_IMPORTED_MODULE_0__.UI(fp_ts_Option__WEBPACK_IMPORTED_MODULE_31__.G))}))),trace.traceTask("run-next-gen-features"))})))();(0,_core_metrics_MetricReporter__WEBPACK_IMPORTED_MODULE_8__.p)({api,context:nextGen.metricContext,logger,messages,metrics});const state=new _core_state_PermutiveStateWeb__WEBPACK_IMPORTED_MODULE_32__.u(permutiveData,permutiveReset,userId,viewId,logger),addons={},permutiveMethods=(0,_PermutiveMethodsWeb__WEBPACK_IMPORTED_MODULE_17__.S)(logger,api,activationManager,sessionManager,metrics,viewId,userId,network,clientContext,unprocessedEvents,taskQueue,identities,permutiveReset,messages,addons,trace,permutiveRealtime,state,customProperties,config,permutiveData,externalData,cookieStore,identitiesIngestor,permutiveGlobal,consentTracking,nextGen,pageviewState,tcf);createInternalsSpan.finish();const context=clientContext.getMutableContextUNSAFE();[].forEach((s=>{fp_ts_Either__WEBPACK_IMPORTED_MODULE_33__.Y3((()=>eval(s)),(e=>{api.reportError({...e,message:`Error running custom script ${s}`},userId.get())}))}));const blockers=(0,_sdkql_blockers__WEBPACK_IMPORTED_MODULE_34__.X)({logger,messages});blockers.addBlocker("permutive:queries:initialised");const initialIdentifyResult=(0,_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_12__.b2)();let globalIdentifyBound=!1;messages.on("permutive:user:ready",(()=>{permutiveGlobal.identify=permutiveMethods.identify.bind(permutiveMethods),globalIdentifyBound=!0;const e=identities.extractIdentifyFromQueue({global:permutiveGlobal});e.length>0?initialIdentifyResult.resolve(permutiveGlobal.identify(e)):initialIdentifyResult.resolve()})),messages.on("permutive:blockers:empty",(()=>{if(!globalIdentifyBound){const e=permutiveGlobal.identify;permutiveGlobal.identify=t=>(e(t),initialIdentifyResult.promise)}permutiveGlobal.on=permutiveMethods.on.bind(permutiveMethods),permutiveGlobal.once=permutiveMethods.once.bind(permutiveMethods),permutiveGlobal.track=permutiveMethods.track.bind(permutiveMethods),permutiveGlobal.trigger=permutiveMethods.trigger.bind(permutiveMethods),permutiveGlobal.query=permutiveMethods.query.bind(permutiveMethods),permutiveGlobal.segment=permutiveMethods.segment.bind(permutiveMethods),permutiveGlobal.segments=permutiveMethods.segments.bind(permutiveMethods),permutiveGlobal.reset=permutiveMethods.reset.bind(permutiveMethods),permutiveGlobal.ready=permutiveMethods.ready.bind(permutiveMethods),permutiveGlobal.addon=permutiveMethods.addon.bind(permutiveMethods),permutiveGlobal.context=clientContext.getMutableContextUNSAFE(),permutiveGlobal.addons=addons,permutiveGlobal.config=config,permutiveRealtime.setAsReady(),(0,_initialisation_queuedMethods__WEBPACK_IMPORTED_MODULE_16__.LA)(permutiveGlobal.q,state,permutiveGlobal,permutiveMethods,api,trace),setAddonsLoaded(!0)}));const loadAddonsSpan=trace.startSpan("load_addons");(0,_dynamic_addons_LoadAddons__WEBPACK_IMPORTED_MODULE_10__.C)({extMessages:new _dynamic_messages_PermutiveMessages__WEBPACK_IMPORTED_MODULE_35__.a(messages),nextGen,messages,viewId,state,sessionManager,api,clientContext,externalData,logger,metrics,namespace,network,permutive:permutiveGlobal,q:permutiveGlobal.q,userId}),loadAddonsSpan.finish(),await(0,_initialisation_identity__WEBPACK_IMPORTED_MODULE_15__.TZ)({api,clientContext,externalData,global:permutiveGlobal,identities,identitiesIngestor,logger,messages,metrics,network,permutiveMethods,reset:permutiveReset,trace,userId,sessionManager,sessionCount:nextGen.metricContext.current.session_count}),(0,_initialisation_initialisationLifecycle__WEBPACK_IMPORTED_MODULE_36__.R)(messages,metrics,state,logger),(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_22__.zG)(_framework_ref__WEBPACK_IMPORTED_MODULE_0__.vP(nextGen.realtime,nextGen.queryLanguageCohorts.all),_framework_ref__WEBPACK_IMPORTED_MODULE_0__.D8(((e,t)=>e[0]===t[0])),_framework_ref__WEBPACK_IMPORTED_MODULE_0__.bw((e=>{let[t,n]=e;t&&permutiveRealtime.setAsRealtime(n.length)})))}),(e=>`Exception during initialisation. Got ${e}`))}},9934:(e,t,n)=>{n.r(t),n.d(t,{runSdk:()=>me});var r=n(7144),i=n(2169);var o=n(132),s=n(2678),a=n(8236);const u="Cookie exceeds maximum supported size of 4096 bytes for most browsers.",c="Cookie is missing required parameters.";class l{namespace;config;logger;constructor(e,t,n){this.namespace=e,this.config=t,this.logger=n}makeCookie(e,t,n){return[encodeURIComponent(this.namespace.getNamespacedStorageKey(e)),"=",t?encodeURIComponent(t):"","; expires=",n,"; domain=",this.config.cookieDomain,"; path=/; samesite=none; secure"].join("")}setCookie(e,t){if(!(t&&e&&this.config.cookieExpiry&&this.config.cookieDomain)){const{cookieExpiry:n,cookieDomain:r}=this.config??{};throw this.logger.warn(`Unable to set cookie. ${c}`,{value:t,cookieName:e,cookieExpiry:n,cookieDomain:r}),new Error(c)}const n=this.makeCookie(e,t,this.config.cookieExpiry);if(n.length>4096)throw this.logger.warn(`Unable to set cookie ${this.namespace.getNamespacedStorageKey(e)}. ${u}`),new Error(u);return this.logger.debug(`Setting cookie ${n}`),document.cookie=n,!0}getCookie(e){const t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e:this.namespace.getNamespacedStorageKey(e),n=new RegExp("\\b"+encodeURIComponent(t)+"=([^;]+)").exec(document.cookie);return null!==n?decodeURIComponent(n[1]):null}deleteCookie(e){if(!e||!this.config.cookieDomain)return!1;const t=this.makeCookie(e,void 0,"Thu, 01 Jan 1970 00:00:00 UTC");return this.logger.debug(`Deleting cookie ${t}`),document.cookie=t,!0}}var d=n(1997);const f=e=>{const{logger:t,consentTracking:n}=e,r=e=>(t.debug(`Cookie: Failed to set cookie ${e} as consent is revoked`),!1);return e=>class extends e{setCookie=(()=>(0,d.v)(super.setCookie.bind(this),r,n.isRevoked))()}};var p=n(5654),g=n(842),m=n(9144);class h{namespace;constructor(e){this.namespace=e}getExternalData(e){const t=this.namespace.getNamespacedStorageKey(e);return window.localStorage.getItem(t)}getExternalJsonData(e){const t=this.getExternalData(e);return null===t?null:(0,g.A)(t)}setExternalData(e,t){const n=this.namespace.getNamespacedStorageKey(e);try{window.localStorage.setItem(n,t)}catch(e){}}setExternalJsonData(e,t){return(0,i.zG)((0,m.P)(t),(0,r.UI)((t=>this.setExternalData(e,t))),(0,r.g_)((e=>{throw(0,p.w)(e)}),i.Q1))}removeExternalData(e){const t=this.namespace.getNamespacedStorageKey(e);window.localStorage.removeItem(t)}}const v=e=>{const{logger:t,consentTracking:n}=e,r=e=>{t.debug(`External Data: Failed to set key ${e} as consent is revoked`)},i=r,o=r;return e=>class extends e{setExternalData=(()=>(0,d.v)(super.setExternalData.bind(this),i,n.isRevoked))();setExternalJsonData=(()=>(0,d.v)(super.setExternalJsonData.bind(this),o,n.isRevoked))()}};var _=n(3215),y=n(3643),w=y.li,b=y.Yg;y.Kl,y.Lx,y.u4,y.nq;class I{sdkInitTimestamp;prefix;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I.initialPrefix;this.sdkInitTimestamp=e,this.prefix=t}static initialPrefix=(()=>[k("Permutive"),self.document?k("M","#43dde2"):k("W","#FF5C00")])();get timeDeltaFromInit(){return`[${(new Date).getTime()-this.sdkInitTimestamp}ms]`}log(){return console.log.bind(self.console,`%s${this.prefixTemplate}`,this.timeDeltaFromInit,...this.prefixContent)(...arguments)}debug(){return console.debug.bind(self.console,`%c%s${this.prefixTemplate}`,"color: blue;",this.timeDeltaFromInit,...this.prefixContent)(...arguments)}warn(){return console.warn.bind(self.console,`%s${this.prefixTemplate}`,this.timeDeltaFromInit,...this.prefixContent)(...arguments)}error(){return console.error.bind(self.console,`%s${this.prefixTemplate}`,this.timeDeltaFromInit,...this.prefixContent)(...arguments)}withPrefix(e,t){return new I(this.sdkInitTimestamp,[...this.prefix,k(e,t)])}get prefixTemplate(){return this.prefix.map(w).join("")}get prefixContent(){return this.prefix.map(b).flat()}}class S{log(){}debug(){}warn(){}error(){}withPrefix(){return this}}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#0469d0";const n=[`background-color: ${t}`,"color:white",`border:1px solid ${t}`,"padding: 0px 2px","margin: 0px 1px","border-radius: 2px"].join(";");return["%c%s",[n,e]]}const E="[MESSAGES]";class P{logger;messageListenerMap={};replayQueue={};onceTracker={};defaultMessageOptions={withReplay:!1,once:!1};constructor(e){this.logger=e}on(e,t,n){const r=this.mergeMessageOptions(n);r.withReplay&&this.processReplayQueue(e,t);const i=G(e,this.messageListenerMap).push(t)-1;return r.once&&this.addToOnceTracker(e,i),i}once(e,t){return this.on(e,t,{once:!0})}off(e,t){if(null==t)return this.messageListenerMap[e]=[],void(this.replayQueue[e]=[]);t<0?this.logError('Index for "off" fell out of range',{index:t}):G(e,this.messageListenerMap)[t]=i.Q1}emit(e,t,n){const r=this.mergeMessageOptions(n);G(e,this.messageListenerMap).length>0?(this.logDebug(`Emitting Event: ${e}`),this.emitMessageWithPayload(e,t)):r.withReplay&&this.addToReplayQueue(e,t)}addToReplayQueue(e,t){G(e,this.replayQueue).push(t)}processReplayQueue(e,t){this.replayQueue[e]?.forEach((e=>t(e)))}emitMessageWithPayload(e,t){this.messageListenerMap[e]?.forEach(((n,r)=>{n(t),this.removeListenerIfSetToFireOnlyOnce(e,r)}))}addToOnceTracker(e,t){G(e,this.onceTracker).push(t)}removeListenerIfSetToFireOnlyOnce(e,t){this.onceTracker[e]?.includes(t)&&this.off(e,t)}mergeMessageOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...this.defaultMessageOptions,...e}}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(E,...t)}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(E,...t)}}const G=(e,t)=>t[e]??=[];var U=n(2945);class z{sdkInitTimestamp;timeOriginSdkInit;logger;prefix="[Metrics]";timeOriginForContext=(()=>C())();pendingMetrics=[];pendingCounters={};pendingTimers={};noMetricsTracked=0;constructor(e,t,n){this.sdkInitTimestamp=e,this.timeOriginSdkInit=t,this.logger=n}isEnabled(){return!0}getNoMetricsTracked(){return this.noMetricsTracked}consume(){const e=this.pendingMetrics.concat(Object.values(this.pendingCounters).flat());return this.pendingMetrics=[],this.pendingCounters={},e}track(e){this.noMetricsTracked++,this.logDebug(`Tracking ${e.name}`,{metric:e}),this.pendingMetrics.push(e)}trackCounter(e){if(this.noMetricsTracked++,this.logDebug(`Tracking ${e.name}`,{metric:e}),e.name in this.pendingCounters){const t=Object.keys(e.labels),n=this.pendingCounters[e.name].findIndex((n=>Object.keys(n.labels).length===t.length&&t.every((t=>n.labels[t]===e.labels[t]))));-1===n?this.pendingCounters[e.name].push(e):this.pendingCounters[e.name][n]=x(this.pendingCounters[e.name][n],e.value)}else this.pendingCounters[e.name]=[e]}synchroniseTimeBetweenContexts(e){return(0,i.zG)(U.gz(a.G5)(this.timeOriginForContext,this.timeOriginSdkInit),a.UI((t=>{let[n,r]=t;return e+n-r})))}trackTimeSinceInit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:performance.now();(0,i.zG)(this.synchroniseTimeBetweenContexts(n),a.UI((e=>(e-this.sdkInitTimestamp)/1e3)),a.UI((n=>this.track({name:e,value:n,labels:t}))))}startTimer(e,t){const n=performance.now(),r=this.generateRandomKey(e);return this.pendingTimers[r]={startTime:n,labels:t},r}stopTimer(e,t){const n=this.pendingTimers[t];if(n){const r=(performance.now()-n.startTime)/1e3;this.logDebug("timer stopped",e,r),this.track({name:e,value:r,labels:n.labels}),delete this.pendingTimers[t]}}generateRandomKey(e){return`${e}-${[...Array(24)].map((()=>Math.random().toString(36)[2])).join("")}`}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(this.prefix,...t)}}class D{isEnabled(){return!1}getNoMetricsTracked(){return 0}consume(){return[]}track(e){}trackCounter(e){}trackTimeSinceInit(e,t){}startTimer(e,t){return""}stopTimer(e,t){}}const x=(e,t)=>({...e,value:e.value+t}),C=()=>(0,i.zG)(a.Y3((()=>performance.timeOrigin)),a.hX((e=>"number"==typeof e&&!Number.isNaN(e))));var O=n(4991),M=n(256),T=n(1767);class A{config;namespace;logger;prefix="[Data Store]";permutiveData={};permutiveDataSize=0;localStorageScheduler;localStorageQueue=(()=>new Set)();debouncedStorageKeys;debouncedFlush;constructor(e,t,n){this.config=e,this.namespace=t,this.logger=n,this.localStorageScheduler=new M.b(e.localStorageWriteDelay,e.localStorageWriteMaxDelay),this.debouncedFlush=this.localStorageScheduler.schedule(this.flushLocalStorageQueue.bind(this)),this.debouncedStorageKeys=new Set(e.localStorageDebouncedKeys),this.localStorageScheduler.scheduleForPageUnload(this.flushLocalStorageQueue.bind(this)),this.permutiveData=this.buildData()}reset(){this.permutiveData={}}getDataSize(){return this.permutiveDataSize}getData(e){return this.permutiveData[e]}setData(e,t){this.permutiveData[e]=t,this.requestWrite(e)}deleteKey(e){delete this.permutiveData[e],this.requestWrite(e)}requestWrite(e){this.debouncedStorageKeys.has(e)?(this.localStorageQueue.add(e),this.debouncedFlush()):this.writeData(e)}flushLocalStorageQueue(){for(let e of this.localStorageQueue)this.writeData(e);this.localStorageQueue.clear()}buildData(){return{...this.getDataChunk("misc"),...this.getDataChunk("queries")}}getDataChunk(e){const t=this.namespace.getNamespacedStorageKey(this.chunkKeyToStorageKey(e)),n=window.localStorage.getItem(t),r=null===n?null:(0,g.A)(n);return n&&r?(this.permutiveDataSize+=2*n.length,r):{}}chunkKeyToStorageKey(e){switch(e){case"queries":return this.config.permutiveDataQueriesKey;case"misc":return this.config.permutiveDataMiscKey;default:throw new Error(`Unhandled chunk key "${e}"`)}}writeData(e){this.logger.debug(`Data Store: Writing ${e} to localStorage`);const[t,n]=this.dataKeyToChunkInfo(e);return r.Y3((()=>window.localStorage.setItem(this.namespace.getNamespacedStorageKey(t),JSON.stringify(n))),(t=>{const n=(0,p.w)(t);return this.logError(`Failed to set ${e}. Got ${n}`),n}))}dataKeyToChunkInfo(e){const t=e=>(0,O.eu)(this.permutiveData,e);switch(e){case"internal_query_states":case"external_query_states":case"event-source-id":return[this.chunkKeyToStorageKey("queries"),t(R)];case T.Kd:case"identities":case"amp_ready":case"metricsEnabled":case"addon:tradedesk":case"addon:tracking_pixel":case"addon:eyeota_pixel":case"addon:pinterest_pixel":case"addon:facebook_pixel_v2":case"addon:tiktok_pixel":case"addon:appnexus":case"addon:ddp":case"addon:gigya":case"addon:neustar_fabrick":case"pubmatic":case"lotame":return[this.chunkKeyToStorageKey("misc"),t(q)];default:throw new Error(`Unhandled data key "${e}"`)}}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(this.prefix,...t)}}const R=["internal_query_states","external_query_states","event-source-id"],q=[T.Kd,"identities","amp_ready","metricsEnabled","addon:tradedesk","addon:tracking_pixel","addon:eyeota_pixel","addon:pinterest_pixel","addon:facebook_pixel_v2","addon:tiktok_pixel","addon:appnexus","addon:ddp","addon:gigya","addon:neustar_fabrick","pubmatic","lotame"],j=e=>{const{logger:t,consentTracking:n}=e,i=e=>(t.debug(`Data Store: Failed to write ${e} as consent is revoked`),r.F2(void 0));return e=>class extends e{writeData=(()=>(0,d.v)(super.writeData.bind(this),i,n.isRevoked))()}};class L{config;constructor(e){this.config=e}getNamespacedStorageKey(e){return`${this.config.stateNamespace}${e}`}}var $=n(1561);class F{config;cookies;externalData;ref;isNewlyGenerated;setState;constructor(e,t,n,r){this.config=e,this.cookies=t,this.externalData=n;const[o,s]=$.Ue(this.getOrGenerateUserId());this.ref=(0,i.zG)(o,$.UI((e=>e.userId))),this.isNewlyGenerated=(0,i.zG)(o,$.UI((e=>e.isNewlyGenerated))),this.setState=s,(0,i.zG)($.vP(this.ref,r),$.YP((e=>{let[t,n]=e;n?(this.cookies.setCookie(this.config.cookieName,t),this.externalData.setExternalData(this.config.cookieName,t)):(this.cookies.deleteCookie(this.config.cookieName),this.externalData.removeExternalData(this.config.cookieName))})))}isEqual(e){return this.ref.current===e}get(){return this.ref.current}set(e){this.setState({userId:e,isNewlyGenerated:!1})}reset(){this.setState({userId:(0,O.k$)(),isNewlyGenerated:!0})}getOrGenerateUserId(){return(0,i.zG)(this.getUserIdFromCookie(),a.wp((()=>this.getUserIdFromLocalStorage())),a.UI((e=>({userId:e,isNewlyGenerated:!1}))),a.fS((()=>({userId:(0,O.k$)(),isNewlyGenerated:!0}))))}getUserIdFromCookie(){return this.getUserIdFromStorageIfValid("cookie")}getUserIdFromLocalStorage(){return this.getUserIdFromStorageIfValid("localStorage")}getUserIdFromStorageIfValid(e){const t=a.DT(O.Gz);return(0,i.zG)("cookie"===e?this.cookies.getCookie(this.config.cookieName):this.externalData.getExternalData(this.config.cookieName),a.ij,a.tS(t))}}class N{config;PATH_JOINER_Q="?";PATH_JOINER_A="&";constructor(e){this.config=e}getBaseUrl(){return`${this.config.apiProtocol}://${this.config.apiHost}`}getEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("base",e,t,n)}getSdkErrorsUrl(e,t){return this.getUrl("sdk-errors",e,t,[])}getAdvertiserEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("adv",e,t,n)}getClassificationModelsEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("clm",e,t,n)}getAudienceMatchingEndpointUrl(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const i=`${e}/${n}/audiences`;return this.getUrl("audience-matching",i,t,r)}getCCSCohortMembershipEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("ccs",e,t,n)}makeAuthenticatedUrl(e){return this.makeUrlWithQueryParams(e,[["k",this.config.apiKey]])}getUrlPrefix(e){switch(e){case"base":return"";case"adv":return"/adv";case"sdk-errors":return"/sdk-errors";case"clm":return"/clm";case"audience-matching":return"/audience-matching";case"ccs":return"/ccs"}}getUrl(e,t,n,r){const i=this.getUrlPrefix(e),o=(0,a.g_)((()=>""),(e=>`/${e}`))(n),s=`${this.getBaseUrl()}${i}${o}${t}`;return this.makeUrlWithQueryParams(s,r.concat([["k",this.config.apiKey]]))}makeUrlWithQueryParams(e,t){const n=t.map((e=>{let[t,n]=e;return`${t}=${n}`})).join(this.PATH_JOINER_A),r=e.includes(this.PATH_JOINER_Q)?this.PATH_JOINER_A:this.PATH_JOINER_Q;return`${e}${r}${n}`}}const B=`permutive.${self.document?"main":"worker"}.`;class K{config;shouldUsePerformanceMark=!1;constructor(e){this.config=e,this.shouldUsePerformanceMark=(self.performance?.mark&&this.config.tracingEnabled)??!1}startSpan(e){const t=this.generateSpan(e);return t.start(),{spanId:t.spanId,finish:t.finish}}measureSinceInit(e){const t=this.generateSpan(`${e}_since_init`);return t.start({startTime:_.NC}),{spanId:t.spanId,finish:t.finish}}traceTask(e){return t=>async()=>{const n=this.startSpan(e),r=await t();return n.finish(),r}}measureBetween(e,t,n){const r=this.generateSpan(e);r.start({startTime:t}),r.finish({startTime:n})}generateSpan(e){if(!this.shouldUsePerformanceMark)return{spanId:null,start:()=>{},finish:()=>{}};const{spanName:t,startMarkerName:n,endMarkerName:r}=K.generateUniqueMarkerNames(e);return{spanId:n,start:e=>self.performance?.mark(n,e),finish:e=>{self.performance?.mark(r,{startTime:e?.startTime??performance.now()}),self.performance?.measure?.(t,n,r)}}}static generateUniqueMarkerNames(e){const t=`${B}${e}`,n=`${t}${K.generateId()}`;return{spanName:t,startMarkerName:`${n}_start`,endMarkerName:`${n}_end`}}static generateId(){return"_"+Math.random().toString(36).substr(2,9)}}var Y=n(1118),Q=n(7184);const W="permutive-consent",H=(e,t)=>(0,i.zG)((0,a.ij)(t),(t=>!1===e&&(0,a.Wi)(t)?{isValid:!0,consentData:V()}:(e=>(0,a.pC)(e)&&(e=>null!==e&&"object"==typeof e)(e.value)&&(e=>!0===e.opt_in&&"string"==typeof e.token&&e.token?.length>0)(e.value))(t)?{isValid:!0,consentData:t.value}:{isValid:!1,consentData:J()})),V=()=>({opt_in:!0,token:W}),J=()=>({opt_in:!1,token:""}),X=e=>{return(0,i.ls)((t=e,e=>(0,i.zG)(H(t.consentRequired,e),(e=>{let{consentData:n,isValid:r}=e;return t.consentDatabase.put(n,W),r}))),(e=>{let{logger:t,messages:n}=e;return e=>{const r=e?"given":"revoked";return t.log("Consent has been",r),n.emit(`permutive:consent:${r}`),e}})(e));var t},Z=e=>(t,n)=>{e.on("permutive:consent:revoked",t),e.on("permutive:consent:given",n)},ee=async e=>{const{logger:t,namespace:n,consentRequired:s,messages:a}=e,u=new Q.oP(window.localStorage,n),c=H(s,await u.get(W)),l=await(0,i.zG)(o.Y3((()=>u.put(c.consentData,W)),(e=>new Error(`LocalStorage access is required. ${(0,p.w)(e).message}`))),(e=>e()));if(r.nM(l))return l;const{consentRef:d,giveConsent:f,revokeConsent:g,isRevoked:m,isGiven:h}=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const[t,n]=$.Ue(e),r=()=>!0===t.current;return{consentRef:t,revokeConsent:()=>(n(!1),t.current),giveConsent:()=>(n(!0),t.current),isRevoked:()=>!r(),isGiven:r}}(c.isValid),v={consentRef:d,isGiven:h,isRevoked:m,listenForConsent:Z(a)};v.listenForConsent(g,f);const _=X({consentDatabase:u,consentRequired:s,logger:t,messages:a});return r.F2({consentTracking:v,consentValidation:_,consentDatabase:u})};var te=n(9912),ne=n(9831);const re=e=>{const{partialTagWithKey:t}=e,n=t.key;var o;window[n].consent=(o=e,(0,i.ls)(o.consentModule.consentValidation,a.DT(Boolean),a.UI((0,ne.initialiseWebSDK)(o)),i.Q1));const u=(0,a.EQ)((()=>{return t={consentDatabase:e.consentModule.consentDatabase,consentRequired:e.tag.config.consentRequired},(0,i.zG)((0,i.a9)(t.consentDatabase.get(W)),(0,s.UI)((e=>H(t.consentRequired,e).isValid)));var t}),s.of);return(0,i.zG)((0,i.zG)((e=>{let{consentModule:t,tag:n}=e;const r=(0,te.Ew)((function(e){return"consent"===e.functionName}))(n.q);return(0,a.UI)((e=>t.consentValidation(e.arguments[0])))(r)})(e),u),(0,s.UI)((e=>e?(0,r.F2)(!0):(0,r.t$)("No consent to run on the page"))))},ie=e=>(0,i.zG)((e=>"function"==typeof e.Map?(0,r.F2)(new e.Map([["a",1]])):(0,r.t$)("Maps not supported"))(e),r.tS((e=>1===e.size?(0,r.F2)(null):(0,r.t$)("Iterable Maps not supported")))),oe=e=>(0,i.zG)((e=>"function"==typeof e.Set?(0,r.F2)(new e.Set([1,2])):(0,r.t$)("Sets not supported"))(e),r.tS((e=>2===e.size?(0,r.F2)(null):(0,r.t$)("Iterable Sets not supported")))),se=e=>(0,i.zG)((0,U.gz)(r.G5)(ie(e),oe(e),(e=>e.Worker&&e.Blob?(0,r.F2)(null):(0,r.t$)("WebWorkers not supported"))(e)),(e=>(0,r.UI)(i.Q1)(e)));const ae=()=>{const e=(0,n(1657).Z)(),t=new MessageChannel,r=(e=>{const t=[],n=[],r=()=>{for(;t.length>0&&n.length>0;)n.shift()()},i=e=>new Promise((t=>{n.push((()=>t(e()))),(0,_.HJ)(r)}));return e.onmessage=(0,_.GL)((e=>{null!==e.data&&(t.push(e.data),(0,_.HJ)(r))})),{next:()=>i((()=>t.shift())),read:()=>i((()=>t.splice(0)))}})(t.port1);return e.postMessage({port:t.port2},[t.port2]),o=>function(e){let{worker:t,trace:r,metrics:o,...u}=e;return t.send({...u,globals:self._____workerGlobals,initialTimestampSecs:(0,i.zG)(a.lo(!1),a.UI((()=>Math.floor(Date.now()/1e3)))),metricsEnabled:o.isEnabled(),timeOriginMainContext:C()}),(0,i.zG)((0,_.SF)((()=>Promise.resolve().then(n.bind(n,6131)))),r.traceTask("import-master-low-priority"),s.UI((e=>n=>e.startMaster({...n,metrics:o,trace:r,worker:t}))))}({...o,worker:{...r,send:e=>t.port1.postMessage(e),stop:()=>e.terminate()}})};var ue=n(7499);class ce{db;options;constructor(e,t){this.db=e,this.options=t}getSessionId(){return this.options.session_id}sessionHasChanged(){return this.options.hasChanged}static decodeSessionData(e){return e&&"object"==typeof e&&e.hasOwnProperty("session_id")&&e.hasOwnProperty("last_updated")?{...e,last_updated:new Date(e.last_updated)}:null}reset(){return this.db.delete(this.options.session_data_key)}async persistSessionData(e){const t=e.last_updated.toISOString();await this.db.put({...e,last_updated:t},this.options.session_data_key)}static generateNewSession(e){return{session_id:(0,O.k$)(),last_updated:e}}static hasExpired(e,t,n){if(isNaN(t.getTime()))return!0;return e>new Date(t.getTime()+1e3*n)}static async initialise(e,t,n){const r={timeout_seconds:1800,session_data_key:"permutive-session",hasChanged:!1,logger:n};e.deleteCookie(r.session_data_key);const o=new Date,s=await t.get(r.session_data_key).catch(i.gn),a=ce.decodeSessionData(s),u=null===a||ce.hasExpired(o,a.last_updated,r.timeout_seconds)?{...ce.generateNewSession(o),hasChanged:!0}:{...a,last_updated:o,hasChanged:!1},c=new ce(t,(0,O.PM)(r,u));return await c.persistSessionData(u),c}}var le=n(9829),de=n(7812);class fe{getContextFromEnvironment;context;lastContextFromEnvironment;constructor(e,t){this.getContextFromEnvironment=t,this.lastContextFromEnvironment=t(),this.context=e,this.updateContext(...Object.entries(this.lastContextFromEnvironment),...Object.entries(e))}getMutableContextUNSAFE(){return this.refresh(),this.context}getContext(){return this.refresh(),{...this.context}}getClient(){return this.refresh(),{domain:this.context.domain,referrer:this.context.referrer,title:this.context.title,type:this.context.type,url:this.context.url,user_agent:fe.applyUserAgentExtension(this.context.user_agent)}}static applyUserAgentExtension(e){const t="PermutiveWebSDK/v20.54.0";return e?`${e} ${t}`:t}refresh(){const e=this.getContextFromEnvironment(),t=t=>this.lastContextFromEnvironment[t]===this.context[t]?e[t]:this.context[t]||e[t];this.updateContext(...(0,i.zG)(Object.keys(e),de.UI((e=>(0,i.bc)(e,t(e)))))),this.lastContextFromEnvironment=e}updateContext(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{let[t,n]=e;this.context[t]=n}))}}class pe extends fe{constructor(e,t){super(e,(()=>({type:"web",user_agent:navigator.userAgent,url:(0,le.bk)(window.location.href),domain:window.location.hostname||"",title:document.title,referrer:(0,le.bk)(document.referrer),path:window.location.pathname,view_id:t()})))}async getClientAsync(){return this.getClient()}}const ge=e=>(0,i.zG)(o.Do,(0,i.ls)(o.Qt("support",o.Uo(se(self))),o.Qt("partialTagWithKey",o.Uo((e=>{const t="681a9fe0-03f0-4efd-84f7-234f21a156cf",n=void 0!==e[t]?.q&&void 0!==e[t]?.config?t:"permutive";return(0,i.zG)(e[n],(0,r.ij)("Can't find permutive tag on the page"),(0,r.UI)((e=>({tag:e,key:n}))))})(window))),o.UI((e=>{const t=e.partialTagWithKey.key;return window[t].sdkVersion="v20.54.0",e})),o.Qt("configFromQueryParams",o.Uo((0,Y.B9)())),o.Hr("tag",(e=>((e,t)=>{let{tag:n,key:r}=e;return{...n,config:(0,Y.ti)({...n.config,windowKey:r},t)}})(e.partialTagWithKey,e.configFromQueryParams))),o.UI((e=>e)),o.Hr("trace",(e=>{let{tag:t}=e;return new K(t.config)})),o.Hr("namespace",(e=>{let{tag:t}=e;return new L(t.config)})),o.Hr("logger",(e=>{let{tag:t}=e;return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.RP;return e.loggingEnabled&&void 0!==self.console?.log?new I(t):new S}(t.config)}))),o.Hr("urls",(e=>{let{tag:t}=e;return new N(t.config)})),o.Hr("messages",(e=>{let{logger:t}=e;return new P(t)})),o.Hr("worker",(()=>ae())),o.ak("consentModule",(e=>(0,i.zG)((()=>ee({...e,consentRequired:e.tag.config.consentRequired})),o.Vn((e=>e.message))))),o.Hr("cookieStore",(e=>{let{consentModule:t,logger:n,namespace:r,tag:o}=e;return((e,t,n,r)=>new((0,i.zG)(l,f({consentTracking:r,logger:n})))(e,t,n))(r,o.config,n,t.consentTracking)})),o.Hr("externalData",(e=>{let{consentModule:t,logger:n,namespace:r}=e;return((e,t,n)=>new((0,i.zG)(h,v({consentTracking:n,logger:t})))(e))(r,n,t.consentTracking)})),o.Hr("userId",(e=>{let{cookieStore:t,consentModule:n,externalData:r,tag:i}=e;return new F(i.config,t,r,n.consentTracking.consentRef)})),o.Hr("permutiveData",(e=>{let{tag:t,namespace:n,logger:r,consentModule:o}=e;return((e,t,n,r)=>new((0,i.zG)(A,j({consentTracking:r,logger:n})))(e,t,n))(t.config,n,r,o.consentTracking)})),o.Hr("metrics",(t=>{let{tag:n,logger:r,permutiveData:i}=t;return function(e,t,n,r,i){const o=r.getData("metricsEnabled")??(()=>{const e=Math.random()<=n.metricsSamplingPercentage/100;return r.setData("metricsEnabled",e),e})()?new z(e,t,i):new D;return o.track({name:"sdk_initialisation_start_time_seconds",value:e/1e3,labels:{}}),o}(e.contextsInitTimestampPerformance,C(),n.config,i,r)})),o.Hr("pageviewState",(e=>{let{tag:t}=e;return(e=>{const t={viewId:(0,i.zG)(e.viewId,a.DT((e=>"string"==typeof e&&(0,O.Gz)(e))),a.fS(O.k$)),watsonEnabled:e.watson.enabled};return(0,i.zG)($.Ue(t),(e=>{let[n,r]=e;return{ref:n,setState:(0,i.ls)((e=>e(n.current,t)),r)}}))})(t.config)})),(0,i.ls)(o.Hr("localStorage",(e=>{let{logger:t,namespace:n,consentModule:r}=e;return(0,ue.E)(n,t,r.consentTracking.consentRef)})),o.ak("sessionManager",(e=>{let{cookieStore:t,localStorage:n,logger:r}=e;return o.Y3((()=>ce.initialise(t,n,r)),(e=>`Failed to initialise session manager: ${e.message}`))})),o.Hr("clientContext",(e=>{let{tag:t,pageviewState:n}=e;return new pe(t.context||{},(()=>n.ref.current.viewId))})),o.Hr("core",(t=>{let{clientContext:n,consentModule:r,metrics:o,pageviewState:s,permutiveData:u,sessionManager:c,trace:l,tag:d,userId:f,worker:p}=t;const{eventSourceId:g,isFirstPageview:m}=(0,i.zG)(a.ij(u.getData("event-source-id")),a.hX(O.Gz),a.UI((e=>({eventSourceId:e,isFirstPageview:!1}))),a.fS((()=>({eventSourceId:(0,O.k$)(),isFirstPageview:!0})))),h=r.consentTracking.consentRef;if(m)if(h.current)u.setData("event-source-id",g);else{let e=!1;h.onChange((()=>{e||(e=!0,u.setData("event-source-id",g))}))}return p({consent:h.current,eventSourceId:g,isFirstPageview:m,isSecureContext:(v=d.config,"development"===v.environment?self.isSecureContext:"https:"===self.location.protocol),metrics:o,permutiveConfig:d.config,organizationId:"681a9fe0-03f0-4efd-84f7-234f21a156cf",pageviewState:s.ref.current,sdkInitTimestampPerformance:e.contextsInitTimestampPerformance,sdkInitTimestampDate:e.contextsInitTimestamp,sessionId:c.getSessionId(),trace:l,trackPageviewComplete:!0,userId:f.get(),userIdIsNewlyGenerated:f.isNewlyGenerated.current,webClient:n.getClient()});var v})),o.Hr("currentScript",(()=>a.ij(e.currentScript))),o.ak("consent",(e=>re(e))),o.tS((e=>(0,i.zG)((0,_.SF)((()=>Promise.resolve().then(n.bind(n,9831)))),e.trace.traceTask("permutive.main.import_permutiveWebLowPriority"),s.tS((t=>t.initialiseWebSDK(e)))))))),me=e=>(e=>{e().then((0,r.g_)((e=>console.warn(`Permutive was not initialized. ${e}`)),i.Q1))})(ge(e))},4991:(e,t,n)=>{n.d(t,{Bf:()=>v,G6:()=>I,Gz:()=>y,HP:()=>z,Kn:()=>l,Or:()=>E,PM:()=>d,PQ:()=>S,Z_:()=>G,a4:()=>p,aT:()=>h,b2:()=>f,bw:()=>C,cO:()=>k,eu:()=>g,k$:()=>_,lW:()=>P,lo:()=>O,m8:()=>w,mQ:()=>D,rO:()=>x,vg:()=>U});var r=n(9912),i=n(2169),o=n(8236),s=n(856),a=n(4327),u=n(229),c=n(3215);const l=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e;function d(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>({...e,...t})),{})}a.ff(u.xb);function f(){let e,t;return{promise:new Promise(((n,r)=>{e=n,t=r})),reject:t,resolve:e}}function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={waitTimeInMs:50,exponentialBackOff:!1,maxAttempts:20},{waitTimeInMs:s,exponentialBackOff:a,maxAttempts:u}=d(r,n);let l=0;const f=n=>new Promise((r=>Promise.resolve(t()).then((t=>t?Promise.resolve(e()).then((e=>r((0,o.G)(e)))):(0,i.zG)(l++,(e=>e<u?(0,c.HJ)((()=>r(f(n*(a?2:1)))),n):r(o.YP)))))));return f(s)}function g(e,t){const n=Object.create(null);for(const r of t)n[r]=e[r];return n}let m=[];function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:navigator.userAgent;if(m.unshift(e),m.length>1)return;const n=["beforeunload","pagehide"],r=n.concat(["visibilitychange"]),i=e=>{if(!o&&e){o=!0;const e=m;m=[],e.forEach((e=>{try{e()}catch{}}))}};let o=!1;r.forEach((e=>{window.addEventListener(e,(()=>{const n=("visibilitychange"!==e||document.hidden)&&b(t);i(n)}))})),n.forEach((e=>{window.addEventListener(e,(()=>i(!0)))}))}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t={capture:!0,...t};const n=["visibilitychange","pagehide"];n.forEach((n=>window.addEventListener(n,(()=>o.Y3((()=>{"pagehide"!==n&&"hidden"!==document.visibilityState||e()}))),{capture:t.capture})))}function _(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^(self.crypto||self.msCrypto).getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}function y(e){return 36===e.length&&/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(e)}function w(){const e={},t=arguments.length;for(let n=0;n<t;n++){const[t,r]=n<0||arguments.length<=n?void 0:arguments[n];e[t]=r}return e}function b(e){return/Mobi|Android/i.test(e)}function I(e){return/^((?!chrome|android).)*safari/i.test(e)}function S(e,t){return new Promise((n=>{(0,c.HJ)((()=>{Promise.resolve(e()).then(n)}),t?.timeout??0)}))}function k(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}const E=()=>({equals:(e,t)=>Object.is(e,t)});function P(e){return(0,s.Zt)(((t,n)=>{const r=e.indexOf(t),i=e.indexOf(n);switch(!0){case-1===r&&-1===i:return 0;case-1!==r&&-1===i:return-1;case-1===r&&-1!==i:return 1;default:return r<=i?-1:1}}))}function G(e,t,n){return function(){try{return n(...arguments)}catch(n){e.reportError(n,t.get())}}}function U(e){return t=>null!=t&&e in t?t[e]:void 0}function z(e){let t=o.YP;const n=(0,o.fS)((()=>{const n=e();return t=(0,o.G)(n),n}));return()=>n(t)}const D=e=>{const t=new Map;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))},x=e=>t=>{const n={...t};for(const r in e)n[r]=e[r]?.(t[r]);return n};function C(e){return t=>(e(t),t)}const O=e=>t=>{const n=e.slice(0,-1),s=e.slice(-1)[0];return(0,i.zG)(n,r.f2((e=>{let[n,r]=e;return(0,i.zG)(t,o.DT(n),o.UI(r))})),o.fS((()=>s(t))))},M=e=>t=>{if("number"==typeof t)return t;if("string"==typeof t){const n=e(t);return Number.isNaN(n)?void 0:n}};M(parseInt),M(parseFloat)},256:(e,t,n)=>{n.d(t,{b:()=>o});var r=n(4991),i=n(3215);class o{timeoutDurationInMilliseconds;maxTimeOutDurationInMilliseconds;constructor(e,t){this.timeoutDurationInMilliseconds=e,this.maxTimeOutDurationInMilliseconds=t}schedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeoutDurationInMilliseconds,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.maxTimeOutDurationInMilliseconds;return this.debounce(e,t,n)}scheduleAccumulated(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeoutDurationInMilliseconds,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.maxTimeOutDurationInMilliseconds;return this.debounce(e,n,r,t)}scheduleForPageUnload(e){return(0,r.aT)(e)}debounce(e,t,n,o){let s,a,u,c=[];return l=>{o&&(u=o.concat(u??o.empty,l));const d=(0,r.b2)();c.push(d);return s?.(),s=(0,i.HJ)((()=>{a?.(),a=void 0;const t=e(u||l);c.forEach((e=>e.resolve(t))),u=o?.empty,c=[]}),t),a||(a=(0,i.HJ)((()=>{s?.(),a=void 0;const t=e(u||l);c.forEach((e=>e.resolve(t))),u=o?.empty,c=[]}),n)),d.promise}}}},8291:(e,t,n)=>{n.d(t,{i:()=>i});var r=n(3215);class i{messages;queue=[];nextNotify=null;constructor(e){this.messages=e,e.on("permutive:taskQueue:update",(()=>{this.execute()}))}add(e){this.queue.push(e),this.notify()}notify(){const e=()=>{this.messages.emit("permutive:taskQueue:update")},t=(new Date).getTime();null===this.nextNotify||this.nextNotify<t-50?(this.nextNotify=t,e()):this.nextNotify<=t&&(this.nextNotify=t+50,(0,r.HJ)(e,50))}execute(){if(0===this.queue.length)return;let e=!1,t=!1,n=0;for(let r=0;r<this.queue.length;r++){const i=this.queue[r];if(i.complete)n+=1;else if(i.started)t=!0,e=e||i.blocks();else{if(i.waits()&&t)break;e||(t=!0,e=e||i.blocks(),i.execute((()=>{this.notify()})))}}this.queue.splice(0,n)}size(){return this.queue.length}}},9829:(e,t,n)=>{n.d(t,{_Y:()=>s,bk:()=>o,zM:()=>i});var r=n(2169);const i=()=>{const e=window.location.href.split("?")[1]?.split("#")[0]?.split("&");return void 0===e?{}:e.reduce(((e,t)=>{const[n,r]=t.split("=");return{...e,[n]:r}}),{})},o=e=>{if(!e)return"";return(0,r.zG)(e,(e=>{const t=e.length-1;return"/"===e[t]?e.slice(0,t):e}))};function s(e){const t=e.match(/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/),n=e.match(/[a-z0-9][a-z0-9-]+\.[a-z.]{2,24}$/i),r=e.match(/localhost/);if(n&&n.length>0){const t=e.split(".").reverse();return t.length>=3&&t[1].match(/^(com|edu|gov|net|mil|org|nom|co|ac|name|info|biz)$/i)?t[2]+"."+t[1]+"."+t[0]:t[1]+"."+t[0]}return t&&t?.length>0?t[0]:r&&r?.length>0?"localhost":""}},5869:(e,t,n)=>{n(4187),n(4991),n(3215)},9424:(e,t,n)=>{n.d(t,{X:()=>r});const r=e=>{let t=!0;const n=[];return{addBlocker:r=>{n.push(r),e.logger.log("<blockers> added blocker "+r),e.messages.on(r,(()=>{if(t){const i=n.indexOf(r);i>=0&&(n.splice(i,1),e.logger.log("<blockers> removed blocker "+r)),0===n.length&&(t=!1,e.messages.emit("permutive:blockers:empty"),e.logger.log("<blockers> complete"))}}))}}}},3498:(e,t,n)=>{n.d(t,{X:()=>i});var r=n(1561);class i{ref;setCustomProps;constructor(){const[e,t]=r.Ue({});this.ref=e,this.setCustomProps=t}getCustomProps(){return this.ref.current}}},9484:(e,t,n)=>{n.r(t),n.d(t,{EventsCache:()=>I,RESET_HISTORICAL:()=>y});var r=n(5654),i=n(2945),o=n(7812),s=n(7144),a=n(2169),u=n(8236),c=n(2678),l=n(132);const d=e=>({id:e.id,name:e.name,time:new Date(e.time),properties:e.properties||{},session_id:e.session_id,view_id:e.view_id}),f=e=>({id:e.id,name:e.name,time:(p(e.time)?e.time:new Date).toISOString(),properties:e.properties||{},session_id:e.session_id,view_id:e.view_id}),p=e=>isFinite(e)&&e instanceof Date;var g=n(4991),m=n(256);class h extends Error{constructor(e){super(e),this.name="StoreClosingError"}}const v="permutive-events-cache",_="permutive-events-for-page",y="historical",w="[EVENTSCACHE]",b=e=>"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name;class I{config;logger;reportError;trace;metrics;userId;makeEventsStore;eventStore;eventsCache=(()=>this.makeEventsRepository(v))();eventsForPage=(()=>this.makeEventsRepository(_))();eventsTTLInMilliseconds;readiness;debouncedReportError=(()=>new m.b(5e3,5e3).schedule((e=>this.reportError(e.errorMessage,{userId:e.userId}))))();static initialise(e,t,n,r,i,o,s){return(0,a.zG)(s(),l.UI((a=>new I(e,t,n,r,i,o,s,a))))}constructor(e,t,n,r,i,o,s,l){this.config=e,this.logger=t,this.reportError=n,this.trace=r,this.metrics=i,this.userId=o,this.makeEventsStore=s,this.eventStore=l,this.eventsTTLInMilliseconds=(0,a.zG)((0,u.ij)(this.config.eventsTTLInDays),(0,u.tS)((e=>"number"==typeof e&&e>0?(0,u.G)(24*e*3600):u.YP))),this.eventsCache.events=(0,g.HP)((()=>(0,g.PQ)((0,a.zG)(c.tD((()=>this.trace.startSpan("load_event_cache"))),c.tS((e=>(0,a.zG)(this.loadFromDisk(),c.At((t=>()=>{e.finish(),this.logDebug(`Event cache loaded, #e ${t.length}`)}))))))))),this.readiness=this.eventsCache.events().then((()=>this.migratePreviousPagesEvents())),o.onChange((()=>this.reset()))}async migratePreviousPagesEvents(){const e=this.trace.startSpan("migrate_previous_for_page_events"),t=(0,c.pE)((e=>(0,l.Y3)((()=>e.flush()),r.w)));return(0,a.zG)([this.eventsForPage,this.eventsCache],t,(0,c.UI)((t=>{const n=o.bj(t);return n.length>0&&this.reportError(`Migrate previous events failed. Got:\n${n.join("\n ")}`,{userId:this.userId.current}),e.finish()})),(e=>e()))}all(){return Promise.all([this.eventsCache.events(),this.eventsForPage.events()]).then(o.xH)}async add(e,t){let{persistOnDisk:n}=t;return this.logDebug("Adding to cache",e),this.eventsForPage.events=(0,a.zG)(this.eventsForPage.events,c.UI((t=>[...t,e])),g.HP),n&&this.readiness.then((()=>this.eventsForPage.flush())),e}filterEventsByWorkspace(e){return e}pruneEventsToSizeLimit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.config.eventsCacheLimitBytes;if(n<=0||t<=n)return this.logDebug(`Event size of ${t} less than limit of ${n}`),{events:e,sizeInBytes:t};this.logDebug("Events before pruning",{count:e.length,sizeInBytes:t,byteLimit:n});let r=1,i=[...e];for(;t>n;)i.splice(0,r),r*=2,t=2*JSON.stringify(i).length;return this.logDebug("Events after pruning",{count:i.length,sizeInBytes:t}),{events:i,sizeInBytes:t}}loadFromDisk(){const e=()=>[],t=(0,a.zG)(this.eventsTTLInMilliseconds,u.EQ((()=>a.yR),(e=>o.hX((t=>e>Date.now()-t.time.getTime())))));return(0,a.zG)(c.tD((()=>(this.logLog("Loading event cache..."),this.metrics.startTimer("sdk_load_events_cache_task_duration_seconds",{})))),c.YO("loadEventsCacheTask"),c.ak("eventsFromDisk",(()=>(0,a.zG)(o.nI([this.eventStore.get(v),this.eventStore.get(_)]),o.UI(l.LV((0,g.lo)([[e=>e instanceof h,(0,a.ls)(e,c.of)],t=>(0,a.zG)(c.tD((()=>this.reportError(`Error fetching data from store. Got ${t}`,{userId:this.userId.current}))),c.tS((()=>()=>this.reset("historical"))),c.UI(e))]),(0,a.ls)(u.fS(e),c.of))),o.vP(c.qA)))),c.At((e=>{let{eventsFromDisk:t,loadEventsCacheTask:n}=e;return()=>{this.logDebug("Read events from store:",t),this.metrics.stopTimer("sdk_load_events_cache_task_duration_seconds",n)}})),c.UI((0,a.ls)((0,g.vg)("eventsFromDisk"),o.xH,this.filterEventsByWorkspace,(e=>this.pruneEventsToSizeLimit(e,2*JSON.stringify(e).length)),(e=>(this.eventsCache.sizeInBytes=e.sizeInBytes,this.eventsCache.sizeInBytesLastSuccessfulWrite=e.sizeInBytes,e.events.length>0&&(this.metrics.track({name:"sdk_events_cache_byte_total",value:e.sizeInBytes,labels:{}}),this.metrics.track({name:"sdk_events_cache_size_total",value:e.events.length,labels:{}})),e.events)),o.UI(d),t)))}async reset(e){return(0,a.zG)(c.tD((()=>this.logDebug("Resetting Events Cache"))),c.tS((()=>this.eventStore.deleteStore())),l.tS((()=>this.makeEventsStore())),l.Zl((t=>(this.eventStore=t,e===y?i.gz(l.Ij)(this.eventsCache.reset,this.eventsForPage.flush):i.gz(l.Ij)(this.eventsCache.reset,this.eventsForPage.reset)))),l.wE((()=>()=>this.all())),l.fS((()=>c.of(S()))),(e=>e()))}getStateSizeInBytes(){return this.eventsForPage.sizeInBytes+this.eventsCache.sizeInBytes}makeEventsRepository(e){const t=(()=>{let e=Promise.resolve(s.F2((0,a.Q1)()));return t=>e=e.then(t)})(),n=e=>(0,a.zG)(c.tD((()=>this.logDebug(`Writing ${e.length} events to ${v.key}`))),c.tS((()=>this.eventStore.put(e.map(f),v.key))),l.UI(a.Q1)),i=(0,a.zG)(c.tD((()=>this.logDebug(`Deleting events for ${v.key}`))),c.tS((()=>this.eventStore.delete(v.key))),l.Vn(r.w)),o=(0,a.ls)(c.of,c.At((e=>()=>this.logError(`Events cache failed to put ${v.key}. Got ${e}`))),c.tS((0,g.lo)([[e=>b(e)&&v.retryAttempts<9,()=>(0,a.zG)(c.tD((()=>{v.retryAttempts+=1,this.logDebug(`Attempt #${v.retryAttempts} to write ${v.key} to EventsStore`)})),c.tS((()=>h)),c.tS((()=>d)))],[e=>b(e),e=>(0,a.zG)(c.tD((()=>this.logDebug(`Attempted ${v.retryAttempts} rewrite attempts and reached limit of 9 max writes.`,"Reporting QuotaExceededError to API"))),c.tS((()=>()=>this.debouncedReportError({errorMessage:`Events cache failed to put ${v.key}. Got ${e}`,userId:this.userId.current}))),c.tS((()=>l.t$(e))))],l.t$]))),u=e=>l.tD((()=>{this.logDebug(`Successfully wrote events for ${v.key} after ${v.retryAttempts} attempts`),v.retryAttempts=0,v.sizeInBytes=2*JSON.stringify(e).length,v.sizeInBytesLastSuccessfulWrite=v.sizeInBytes})),d=(0,a.zG)((()=>v.events()),c.tS((e=>(0,a.zG)(n(e),c.mU(s.EQ(o,(()=>u(e)))))))),p=(e,t)=>(0,a.zG)(e.events,c.UI((n=>{const r=2*JSON.stringify(n).length,i=this.pruneEventsToSizeLimit(n,r,t);return e.events=c.of(i.events),e.sizeInBytes=i.sizeInBytes,t-e.sizeInBytes}))),m=(e,t)=>{let[n,...r]=e;return n&&0!==t?(0,a.zG)(p(n,t),c.tS((e=>(this.logDebug(`${e} left after pruning ${n.key}`),m(r,e))))):c.of((0,a.Q1)())},h=(0,a.zG)(l.tD((()=>this.eventsForPage.sizeInBytes-this.eventsForPage.sizeInBytesLastSuccessfulWrite)),l.fX(s.DT((e=>e>0),(e=>new Error(`${this.eventsForPage.key} failed to write the same or smaller events cache of size ${e}`)))),l.tS((e=>{const t=1.2*e,n=[this.eventsCache,this.eventsForPage];return this.logDebug(`Pruning ${t} bytes from`,n),(0,a.zG)(m(n,t),l.fF)}))),v={key:e,events:c.of([]),sizeInBytes:0,sizeInBytesLastSuccessfulWrite:0,retryAttempts:0,flush:()=>(0,a.zG)(c.tD((()=>this.trace.startSpan(`write_${v.key}`))),c.tS((e=>(0,a.zG)(d,c.At((()=>()=>e.finish()))))),t),reset:()=>(0,a.zG)(c.tD((()=>{v.events=c.of([]),v.sizeInBytes=0,v.sizeInBytesLastSuccessfulWrite=0})),c.tS((()=>i)),t)};return v}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(w,...t)}logWarn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warn(w,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(w,...t)}logLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.log(w,...t)}}const S=()=>[]},7109:(e,t,n)=>{n.r(t),n.d(t,{DBStore:()=>s});var r=n(5654),i=n(8236),o=n(132);class s{db;constructor(e){this.db=Promise.resolve(e)}put(e,t){return(0,o.Y3)((()=>this.db.then((n=>n.put(e,t)))),r.w)}get(e){return(0,o.Y3)((()=>this.db.then((t=>t.get(e))).then(i.ij)),r.w)}delete(e){return(0,o.Y3)((()=>this.db.then((t=>t.delete(e)))),(e=>String(e)))}deleteStore(){return(0,o.Y3)((()=>this.db.then((e=>e.deleteStore()))),(e=>String(e)))}}},736:(e,t,n)=>{n(4991)},2528:(e,t,n)=>{n(3215)},4987:(e,t,n)=>{n.r(t),n.d(t,{eventCacheService:()=>c,eventNameBlacklist:()=>l});var r=n(1561),i=n(8659),o=n(4694),s=n(2169),a=n(7812),u=n(4991);const c=e=>i.K4((()=>({newEvents:(0,s.zG)(e.newEvents,r.UI(o.UI((0,u.bw)(a.UI((t=>{let[,n]=t;l.has(n.name)||e.eventsCache.add(n,{persistOnDisk:!0})})))))),priorEvents:()=>e.eventsCache.all()}))),l=new Set(["AdRequest","PageviewEngagement","PrebidAuctions","Reaction","SegmentEntry","SegmentExit","SlotRendered","ThirdPartySegments","VideoEngagement"])},1767:(e,t,n)=>{n.d(t,{Kd:()=>i,eJ:()=>o});n(4187);var r=n(8659);n(1561),n(4991);const i="addon:twitter_pixel",o=function(e){return r.K4((()=>{}))}},1657:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(1005),i=n.n(r);function o(){return i()('/*! @permutive/javascript-sdk v20.54.0 (web) (built 2025-10-28T09:38:00.461Z) */(()=>{"use strict";var __webpack_modules__={654:(e,t,n)=>{function r(e){return e instanceof Error?e:new Error("string"==typeof e?e:JSON.stringify(e))}n.d(t,{w:()=>r})},987:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>runtimeFactory});const runtimeFactory=deps=>{const{provideEnvironment,...lookups}=generateLookupMethods(deps.runtimeInput),env=generateRuntimeEnvironment({lookups,hash:deps.hash});return provideEnvironment(env),{env,locallyLiftedQueries:deps.runtimeInput.queries(env)||{},cloudLiftedQueries:"function"==typeof deps.runtimeInput.interpretOnlyQueries?deps.runtimeInput.interpretOnlyQueries(env):{},queriesByEvent:deps.runtimeInput.eventSegments(env)||{},createCloudLiftQueries:cloudLiftQueries=>{const createQueries=eval?.(`"use strict";${cloudLiftQueries}`);return createQueries(env)}}};function generateRuntimeEnvironment(e){const t=e=>()=>{throw new Error(`${e} lookup has not been provided`)};let n=t("events"),r=t("literals"),i=t("properties"),o=t("ahoCorasick"),s=t("subexpressions"),u=t("rootCompression");function a(e){return c(e)&&!l(e)}function c(e){return Boolean(e&&"object"==typeof e&&!Array.isArray(e))}function l(e){for(const t in e)return!1;return!0}function f(e){return(t,n)=>{const r=null!=t&&null!=n?e(t,n):t||n;return null==r||c(r)&&l(r)?null:r}}function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;const r=i(t);function o(e,t){return e&&null!=e[t]?e[t]:null}const s=r.reduce(o,e);return null===s?null:n(s)}function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;return e.properties?d(e.properties,t,n):null}e.lookups.onReady((e=>{const{ahoCorasick:t,events:a,literals:c,properties:l,subexpressions:f,rootCompression:d}=e;n=e=>"number"==typeof e?a[e]:e,r=e=>"number"==typeof e?c[e]:e,i=e=>"number"==typeof e?l[e]:e,o=e=>t[e],s=e=>f[e],u=e=>d[e]}));let m=e=>e,g=e=>!0;function h(e,t){return function(n){for(let r=0;r<e.length;r++){if((e[r](n)||!1)===t)return t}return!t}}function v(e){return h(e,!0)}function y(e){return h(e,!1)}let _=e=>t=>!e(t),S=(e,t)=>n=>n>=e&&n<=t,I=e=>new Date(e).getTime(),b=e=>d(e,["time"],I),w=(e,t)=>d(t,e,I),G=(e,t,n,r,i,o)=>s=>{const u=d(s,e,(e=>e.filter(r).map((e=>d(e,t))).reduce(i,o)));return n(null===u?o:u)};function z(e,t,n,r){for(const i of e)if(n(i)&&t(i)===r)return r;return!r}let k=e=>t=>("string"==typeof e||"number"==typeof e)&&"string"==typeof t&&t.toLowerCase().indexOf(r(e).toLowerCase())>-1,U=e=>t=>null!=t&&Array.isArray(t)&&t.indexOf(e)>=0;const E=(e,t)=>({l:r=>d(r,["name"])===n(e)&&t(r)?["p",1]:null,a:(e,t)=>["p",e[1]+t[1]],i:e=>e?Array.isArray(e)?e.slice(-1)[0]:e:0,c:e=>Array.isArray(e)&&e[1]?e:null});const P=()=>null,O=e=>({a:{m:P,z:null},r:t=>e(t),d:{a:P,l:P,i:P,c:P}}),C=(e,t,n,r)=>O((i=>function(e,t,n,r,i){const o=d(e.getSegments(),[t,n])||!1;return i&&(r||o)&&e.setSegmentActivation(t,n,i),o}(i,e,t,n,r))),x=C;function D(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:18e5;return r=>{function i(e,t,n){if(a(t)){if(a(n)){const r={...t,...n};for(const i in n)if(t[i]){const s=o(e,t[i],n[i]);null!=s&&(r[i]=s)}return r}return t}return n}function o(e,t,n){if(a(t)){if(a(n)){const i={...t,...n};for(const o in n)if(t[o]){const s=Array.isArray(t[o])?[e,...t[o]]:[e,t[o]],u=Array.isArray(n[o])?[e,...n[o]]:[e,n[o]],a=r.d.a(s,u);if(null!=a){const[e,...t]=a;i[o]=t}}return i}return t}return n}const s=e=>Array.isArray(e)&&"object"==typeof e[3];return{a:{m:(e,t)=>[t[0],r.a.m(null!=e[0]&&e[0][0]===t[0][0]?e[1]:r.a.z,t[1])],z:[[],r.a.z]},r:(t,n)=>r.r(t,0!==n[0].length&&n[0][0]===e(t)?n[1]:r.a.z),d:r.d.sq||{a:(e,t)=>{if(!s(e))return s(t)?t:null;if(!s(t))return s(e)?e:null;const[n,,,r]=e;return[n,"u",null,i(n,r,t[3])]},l:(i,o)=>{let s=d(i,t),u=e(o);if(s!==u)return null;let a=r.d.l(i,o);if(!(Array.isArray(a)&&a.length>1))return null;let[c,...l]=a,f=+(b(i)||o.getCurrentTime()),p=Math.floor(f/n),m={};return m[p]={},m[p][u]=1===l.length?l[0]:l,[c,"u",null,m]},i:(t,n)=>{if(!s(t))return[[],r.a.z];let i=e(n),o=t[3];return[[i],Object.keys(o).map((e=>o[e]?.[i])).filter(M).map((e=>r.d.i([t[0]].concat(e),n))).reduce(r.a.m,r.a.z)]},c:m}}}}let A=D((e=>e.getCurrentSession()),["session_id"],18e5),T=D((e=>e.getCurrentView()),["view_id"],3e5);const M=e=>!!e;function q(e){return function(t){return{d:{i:(n,r)=>{const i=e(r),o=(Array.isArray(n)?n:[])[3]||{},s=Object.keys(o).map((e=>{const t=o[e]?.[i];return Array.isArray(t)?t[0]:t})).filter(M).reduce(((e,t)=>e+t),0);return t.d.i(["p",s],r)},c:m}}}}let R=q((e=>e.getCurrentSession())),j=q((e=>e.getCurrentView()));function L(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return{a:{m:(e,t)=>e.concat(t).slice(-n),z:[]},r:(t,n)=>e.r(t,n.reduce(((t,n)=>e.a.m(t,n)),e.a.z)),d:e.d.ftn||{a:(e,t)=>{const r=Object.entries({...e[3],...t[3]}).sort(((e,t)=>{let[n]=e,[r]=t;return Number(n)-Number(r)})).slice(-n);return[e[0],e[1],null,Object.fromEntries(r)]},l:(t,i)=>{const o=e.d.l(t,i),s=d(t,["time"],I)*r;return o&&[o[0],"x"+n,null,{[s]:2==o.length?o[1]:o.slice(1)}]},i:(t,n)=>t?Object.keys(t[3]||{}).sort().reverse().map((e=>Array.isArray(e)?[t[0],...t[3][e]]:[t[0],t[3][e]])).map((t=>e.d.i(t,n))):[],c:m}}}function F(e,t){return{d:{i:(t,n)=>{const r=Array.isArray(t)?t:[],i=Object.keys(r[3]||{}).reduce(((e,t)=>r[3][t]+e),0);return e.d.i(["p",i],n)},c:m}}}const $=F,Q=F;let Y=(e,t)=>null==e?null==t?null:{b:t}:null==t?{a:e}:{a:e,b:t};function N(e,t){return n=>{if(!n||null==n.a&&null==n.b)return null;const r=null==n.a?void 0:e.d.c(n.a)??void 0,i=null==n.b?void 0:t.d.c(n.b)??void 0;return r===n.a&&i===n.b?n:Y(r,i)}}function B(e,t){return{a:(n,r)=>{const i=null!=n.a&&null!=r.a?e.d.a(n.a,r.a):n.a||r.a,o=null!=n.b&&null!=r.b?t.d.a(n.b,r.b):n.b||r.b;return Y(i,o)},l:(n,r)=>Y(e.d.l(n,r),t.d.l(n,r)),i:(n,r)=>n?[e.d.i(n.a||null,r),t.d.i(n.b||null,r)]:[e.a.z,t.a.z],c:N(e,t)}}function H(e,t,n,r){let i=e,o=t.map(n),s=(e,n)=>r(t[e])(n);for(let e=t.length-1;e>0&&i;e--)i.b&&(o[e]=s(e,i.b)),i.a&&1===e&&(o[0]=s(0,i.a)),i=i.a;return o}const V=e=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length-1;if(!t||null==t.a&&null==t.b)return null;const r=e[n];if(!r)return null;if(1===n)return N(e[0],r)(t);const i=null==t.a?void 0:V(e)(t.a,n-1)??void 0,o=null==t.b?void 0:r.d.c(t.b)??void 0;return i===t.a&&o===t.b?t:Y(i,o)};let K=e=>t=>{function n(e){let t=e[0];for(let n=1;n<e.length;n++)t=[t,e[n]];return t}function r(e){let n=e,r=Array(t.length);for(let e=t.length-1;e>0;e--)r[e]=n[1],n=n[0];return r[0]=n,r}function i(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-1;if(0==r)throw new Error("subquery index out of bounds.");const o=(1==r?f(t[0].d.a)(e?.a,n?.a):i(e?.a,n?.a,r-1))||void 0,s=f(t[r].d.a)(e?.b,n?.b)||void 0;return Y(o,s)}return{r:(n,i)=>{const o=r(i);return e(t.map(((e,t)=>()=>e.r(n,o[t]))))({})},a:{z:n(t.map((e=>e.a.z))),m:(e,i)=>{const o=r(e),s=r(i);return n(t.map(((e,t)=>function(e,t,n){return null===t?n:null===n?t:e.a.m(t,n)}(e,o[t],s[t]))))}},d:{a:(e,n)=>1==t.length?f(t[0].d.a)(e,n):i(e,n),l:(e,n)=>function(e){let t=e[0];for(let n=1;n<e.length;n++)t=Y(t,e[n]);return t}(t.map((t=>t.d.l(e,n)))),i:(e,r)=>((e,r)=>n(H(e,t,(e=>e.a.z),(e=>t=>e.d.i(t,r)))))(e,r),c:V(t)}}},W=K(v),X=K(y);let J=e=>t=>({d:{i:(n,r)=>e(H(n,t,(e=>e.d.i(null,r)),(e=>t=>e.d.i(t,r))).map((e=>t=>e)))({}),c:V(t)}}),Z=J(y),ee=J(v);function te(e,t){let n=o(e);if(!t||!n)return!1;if(!n.length)return!0;let r=0,i=!1,s=(e=>{let t=[];for(let n=0;n<e.length;++n){let r=e.charCodeAt(n);if(r>=55296&&r<=56319){let r=e.charCodeAt(n+1);if(r>=56320&&r<=57343){t.push(e.slice(n,n+2)),++n;continue}}t.push(e.charAt(n))}return t})(t.toLowerCase());for(let e=0;e<s.length;e++){let t=s[e];for(;r>0&&!n[r][t];)r=n[r].su?n[r].su:0;if(n[r][t]&&(r=n[r][t],i=!!n[r].te,i))break}return i}let ne=(t,n)=>{let r,i,o=e.hash(t);if(0===n.length)return!1;if(n[0]===o)return!0;let s=0,u=n.length,a=!1;for(;(a=(r=n[i=s+(u-s>>1)])!==o)&&(r<o?s=i:u=i,!(s>=u-1)););return!a},re=(e,t)=>n=>ne(d(n,e),t),ie=(e,t)=>n=>ne(p(n,e),t);return{q:function(e){return{lift:(t,n)=>e.d.l(t,n),append:f(e.d.a),interpret:(t,n)=>((t,n)=>({result:e.r(t,n)}))(n,e.d.i(t,n)),compact:e.d.c,migrate:m,m:e.a.m,z:e.a.z,r:e.r,i:e.d.i}},i_q:function(e){return{interpret:(t,n)=>({result:e.d.i(t,n)}),compact:e.d.c}},a:y,acq:function(e,t){return{r:(n,r)=>e.r(n,r[0])&&t.r(n,r[1]),a:{z:[e.a.z,t.a.z],m:(n,r)=>[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]},d:B(e,t)}},acqs:X,acs:te,acs_:(e,t)=>n=>te(t,d(n,e)),af_i:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;return r=>d(r,e,(e=>z(e,t,n,!1)))&&!0},af_l:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;return r=>{const i=d(r,e,(e=>e.filter(n).length));return t(null===i?0:i)}},af_m:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g;return i=>{const o=d(i,e,(e=>e.filter(r)));return null===o||0===o.length?n(0):n(o.map((e=>d(e,t))).reduce(((e,t)=>e+t),0)/o.length)}},af_n:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g;return G(e,t,n,r,((e,t)=>Math.min(e,t)),Number.POSITIVE_INFINITY)},af_p:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g;return G(e,t,n,r,((e,t)=>e*t),1)},af_s:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g;return G(e,t,n,r,((e,t)=>e+t),0)},af_u:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;return r=>d(r,e,(e=>z(e,t,n,!0)))||!1},af_x:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g;return G(e,t,n,r,((e,t)=>Math.max(e,t)),Number.NEGATIVE_INFINITY)},as:(e,t,n)=>r=>{const i=p(r,t),o=n.length;let s=!0;for(let t=0;t<o;t++){const r=n[t];if(s=e(r)(i),!s)break}return s},c:U,c_:(e,t)=>n=>U(t)(d(n,e)),cl_:(e,t)=>n=>U(r(t))(d(n,e)),cx:e=>t=>U(r(e))(t),cw:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;return{a:{m:(e,t)=>e+t,z:0},r:(e,t)=>n(t),d:E(e,t)}},cb:function(e,t,r,i){return{a:{m:(e,t)=>Math.min(e+t,i),z:0},r:(e,t)=>r(t),d:{l:r=>d(r,["name"])===n(e)&&t(r)?[`b${i}p`,1]:null,a:(e,t)=>[`b${i}p`,Math.min(e[1]+t[1],i)],i:e=>e?Array.isArray(e)?e.slice(-1)[0]:e:0,c:e=>Array.isArray(e)&&e[1]?e:null}}},e:e=>t=>t===e,e_:(e,t)=>n=>d(n,e)===t,fm:function(e,t){return{r:(n,r)=>e(t.r(n,r)),a:t.a,d:t.d}},frontDecode:function(e){const t=e.split("\\t");if(0===t.length)return[];var n=t[0],r=new Array(Math.ceil(t.length/2));r[0]=t[0];for(var i=1;i<t.length/2;i+=1){const e=t[2*i-1],o=t[2*i];if(""===e)n=o;else{const t=parseInt(e);n=n.slice(0,t)+o}r[i]=n}return r},ftn:function(e,t,n){return{a:{m:(e,t)=>e.concat(t.slice(0,n-e.length)),z:[]},r:(t,n)=>e.r(t,n.reduce(((t,n)=>e.a.m(t,n)),e.a.z)),d:L(e,t,n,-1).d}},g:e=>t=>t>e,g_:(e,t)=>n=>d(n,e)>t,ge:e=>t=>t>=e,ge_:(e,t)=>n=>d(n,e)>=t,bse:(t,n)=>r=>{let i=d(r,t);return e.hash(i)===n},bsne:(t,n)=>r=>{let i=d(r,t);return e.hash(i)!==n},bsc:re,bsnc:(e,t)=>_(re(e,t)),bsc_:ie,bsnc_:(e,t)=>_(ie(e,t)),i_:m,ifp:e=>O((t=>function(e,t,n){return d(e.getSegments(),[t,n])||!1}(t,"1p",e))),isp:x,itp:C,i_cw:function(e){return{d:{i:t=>{let n=t?Array.isArray(t)?t.slice(-1)[0]:t:0;return e(n)},c:e=>Array.isArray(e)&&e[1]?e:null}}},i_acqs:Z,i_ocqs:ee,i_tw:function(e,t,n){const r=n||100,i=Math.ceil(t/r);return{d:{i:(n,r)=>{const o=Array.isArray(n)?n:[],s=r.getCurrentTime(),u=(a=s.getTime()-t,Math.floor(a/i));var a;const c=Object.keys(o[3]||{}).reduce(((e,t)=>parseInt(t)>=u?o[3][t]+e:e),0);return e.d.i(["p",c],r)},c:m}}},i_ltn:$,i_ftn:Q,i_sq:R,i_vq:j,k:d,l:e=>t=>t<e,l_:(e,t)=>n=>{const r=d(n,e);return null!==r&&r<t},le:e=>t=>t<=e,le_:(e,t)=>n=>{const r=d(n,e);return null!==r&&r<=t},lm:(e,t)=>{let n=t=>function(e,t,n){if(void 0===t[n])return NaN;const r=e||{};if(0==(r["1p"]||[]).length)return NaN;const i=t[n]||{};let o=(i["1p"]||{}).const||0;return Object.keys(r).forEach((e=>{r[e].forEach((t=>{const n=(i[e]||{})[t]||0;o+=n}))})),s=o,1/(1+Math.pow(Math.E,-s));var s}(t.getSegmentsArray(),t.getLookalikeModels(),e);return O((e=>t(n(e))))},ltn:L,mnw:function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m;const o=Number.POSITIVE_INFINITY;return{a:{m:(e,t)=>e<t?e:t,z:o},r:(e,t)=>i(t),d:{a:(e,t)=>e[1]<t[1]?e:t,l:i=>d(i,["name"])===n(e)&&t(i)?["n",d(i,r)]:null,i:e=>e?Array.isArray(e)?e.slice(-1)[0]:e:o,c:e=>Array.isArray(e)&&e[1]!==o?e:null}}},mxw:function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m;const o=Number.NEGATIVE_INFINITY;return{a:{m:(e,t)=>e>t?e:t,z:o},r:(e,t)=>i(t),d:{l:i=>d(i,["name"])===n(e)&&t(i)?["v",d(i,r)]:null,a:(e,t)=>e[1]>t[1]?e:t,i:e=>e?Array.isArray(e)?e.slice(-1)[0]:e:o,c:e=>Array.isArray(e)&&e[1]!==o?e:null}}},n0:_(m),n:e=>t=>t!==e,nt:_,n_:(e,t)=>n=>d(n,e)!==t,o:v,ocq:function(e,t){return{r:(n,r)=>e.r(n,r[0])||t.r(n,r[1]),a:{z:[e.a.z,t.a.z],m:(n,r)=>[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]},d:B(e,t)}},ocqs:W,oe:function(e){const t=Object.keys(e);let n=t.length,r=new Array(n);for(;n--;)r[n]=[t[n],e[t[n]]];return r},os:(e,t,n)=>r=>{const i=p(r,t),o=n.length;let s=!1;for(let t=0;t<o;t++){const r=n[t];if(s=e(r)(i),s)break}return s},pacs:(e,t)=>n=>te(t,p(n,e)),pb:(e,t,n)=>r=>S(t,n)(p(r,e)),pc:(e,t)=>n=>{const r=p(n,e);return null!=r&&Array.isArray(r)&&r.indexOf(t)>=0},pc_:(e,t)=>n=>{const i=p(n,e),o=r(t);return null!=i&&Array.isArray(i)&&i.indexOf(o)>=0},pe:(e,t)=>n=>p(n,e)===t,pg:(e,t)=>n=>p(n,e)>t,pge:(e,t)=>n=>p(n,e)>=t,pl:(e,t)=>n=>{let r=p(n,e);return null!==r&&r<t},ple:(e,t)=>n=>{let r=p(n,e);return null!==r&&r<=t},pn:(e,t)=>n=>p(n,e)!==t,ps:(e,t)=>n=>k(t)(p(n,e)),r:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return u(e)(...n)},ref:function(e){return t=>s(e)(t)},rle:function(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];"number"==typeof r?(t+=r,n+=1):t+=1}let n=Array(t),r=0;for(let t=0;t<e.length;t++){let i=e[t];"number"==typeof i?(n.fill(e[t+1],r,r+i),t+=1,r+=i):(n[r]=i,r++)}return n},s:k,s_:(e,t)=>n=>k(t)(d(n,e)),scq:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;return{r:(r,i)=>n(e.r(r,i[0])+t.r(r,i[1])),a:{z:[e.a.z,t.a.z],m:(n,r)=>[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]},d:B(e,t)}},sq:A,dscq:function(e,t,r,i){const o=`x${i}`,s=e=>e?2===e.length?["p",o,"",e[1]]:e:null,u=r=>{const i=(e=>d(e,["session_id"]))(r);return i&&d(r,["name"])===n(e)&&t(r)?["p",o,"",{[i]:1}]:null},a=(e,t)=>{const n=s(e),r=s(t);return n?r?["p",o,"",{...n[3],...r[3]}]:n:r};return{a:{m:a,z:null},r:(e,t)=>{const n=t&&t[3]&&"object"==typeof t[3]?Object.keys(t[3]).length:0;return r(n)},d:{a:f(a),l:(e,t)=>u(e),i:(e,t)=>s(e),c:m}}},sw:function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m;const o=0;let s=e=>e<0?["p2",null,-e]:["p2",e],u=e=>(e[0]||0)-(e[1]||0),a=r=>d(r,["name"])===n(e)&&t(r);return{a:{m:(e,t)=>e+t,z:o},r:(e,t)=>i(t),d:{a:(e,t)=>{const n=new Array(Math.max(e.length,t.length));n[0]="p2";for(let r=1;r<n.length;r++)n[r]=(e[r]??0)+(t[r]??0);return n},l:e=>a(e)?s(d(e,r)):null,i:e=>e?Array.isArray(e)?u("p2"===e[0]?e.slice(1):e):e:o,c:e=>Array.isArray(e)&&(e[1]||e[2])?e:null}}},t:g,tb:(e,t)=>n=>S(e,t)(b(n)),te:e=>t=>b(t)===e,te_:(e,t)=>n=>w(e,n)===t,tg:e=>t=>b(t)>e,tg_:(e,t)=>n=>w(e,n)>t,tge:e=>t=>b(t)>=e,tge_:(e,t)=>n=>w(e,n)>=t,ti:I,tl:e=>t=>b(t)<e,tl_:(e,t)=>n=>w(e,n)<t,tle:e=>t=>b(t)<e,tle_:(e,t)=>n=>w(e,n)<t,tn:e=>t=>b(t)!==e,tn_:(e,t)=>n=>w(e,n)!==t,tw:function(e,t,n){const r=n||100,i=Math.ceil(t/r),o=e=>Math.floor(e/i),s=(e,n,r)=>[o(e.getTime()-t),{[o(n)]:r}],u=(t,n)=>{const r=Math.max(t[0],n[0]),i=Object.keys(t[1]).filter((e=>e>=r)).concat(Object.keys(n[1]).filter((e=>e>=r))).filter(((e,t,n)=>n.indexOf(e)===t)).reduce(((r,i)=>{const o=e.a.m(t[1][i]||e.a.z,n[1][i]||e.a.z);return o!==e.a.z&&(r[i]=o),r}),{});return[r,i]},a=[Number.NEGATIVE_INFINITY,{}],c=e=>{const t=t=>t.map((t=>{let[n,r,i]=t;return s(e.t,i,n)})).reduce(u,a);return u(t(e.in),t(e.out))};return{a:{m:(e,t)=>{const n=e.w?c(e):e;return u(n,t)},z:a},r:(t,n)=>{const r=(n.w?c(n):n)[1];return e.r(t,Object.keys(r).reduce(((t,n)=>e.a.m(t,r[n])),e.a.z))},d:e.d.tw||{a:(e,t)=>{let[n,,...r]=e,[,,...i]=t;return[n,"w",...u(r,i)]},l:(t,n)=>{const r=e.d.l(t,n),i=e.d.i(r,n);return r&&[r[0],"w",...s(n.getCurrentTime(),d(t,["time"],I),i)]},i:(e,n)=>{const r=Array.isArray(e)?e:[],i=n.getCurrentTime(),s=o(i.getTime()-t);return[r[2]||null,Object.keys(r[3]||{}).map((e=>({[e]:r[3][e]}))).reduce(((e,t)=>(Object.keys(t).filter((e=>parseInt(e)>=s)).forEach((n=>e[n]=t[n])),e)),{})]},c:m}}},vq:T,w:e=>t=>t===r(e),x:e=>t=>t!==r(e),y:(e,t)=>n=>p(n,e)===r(t),y_:(e,t)=>n=>d(n,e)===r(t),z:(e,t)=>n=>p(n,e)!==r(t),z_:(e,t)=>n=>d(n,e)!==r(t)}}function generateLookupMethods(e){let t,n=!1,r=[];return{onReady:e=>{n?e(t):r.push(e)},provideEnvironment:i=>{t={events:e.eventsLookup(i),literals:e.literalsLookup(i),properties:e.propertiesLookup(i),ahoCorasick:e.ahoCorasickLookup(i),subexpressions:e.subexpressionsLookup(i),rootCompression:e.rootCompressionLookup(i)},r.forEach((e=>e(t))),r=[],n=!0}}}},945:(e,t,n)=>{n.d(t,{N:()=>s,Qt:()=>a,Yt:()=>m,a1:()=>u,ap:()=>o,gM:()=>c,gz:()=>p});var r=n(169),i=n(614);function o(e,t){return function(n){return function(r){return e.ap(e.map(r,(function(e){return function(n){return t.ap(e,n)}})),n)}}}function s(e){return function(t){return function(n){return e.ap(e.map(n,(function(e){return function(){return e}})),t)}}}function u(e){return function(t){return function(n){return e.ap(e.map(n,(function(){return function(e){return e}})),t)}}}function a(e){return function(t,n){return function(r){return e.ap(e.map(r,(function(e){return function(n){var r;return Object.assign({},e,((r={})[t]=n,r))}})),n)}}}function c(e){return function(t){return{concat:function(n,r){return e.ap(e.map(n,(function(e){return function(n){return t.concat(e,n)}})),r)}}}}function l(e,t,n){return function(r){for(var i=Array(n.length+1),o=0;o<n.length;o++)i[o]=n[o];return i[n.length]=r,0===t?e.apply(null,i):l(e,t-1,i)}}var f={1:function(e){return[e]},2:function(e){return function(t){return[e,t]}},3:function(e){return function(t){return function(n){return[e,t,n]}}},4:function(e){return function(t){return function(n){return function(r){return[e,t,n,r]}}}},5:function(e){return function(t){return function(n){return function(r){return function(i){return[e,t,n,r,i]}}}}}};function d(e){return i.e$.call(f,e)||(f[e]=l(r.bc,e-1,[])),f[e]}function p(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=t.length,i=d(r),o=e.map(t[0],i),s=1;s<r;s++)o=e.ap(o,t[s]);return o}}function m(e){return function(t){for(var n=Object.keys(t),r=n.length,i=function(e){var t=e.length;switch(t){case 1:return function(t){var n;return(n={})[e[0]]=t,n};case 2:return function(t){return function(n){var r;return(r={})[e[0]]=t,r[e[1]]=n,r}};case 3:return function(t){return function(n){return function(r){var i;return(i={})[e[0]]=t,i[e[1]]=n,i[e[2]]=r,i}}};case 4:return function(t){return function(n){return function(r){return function(i){var o;return(o={})[e[0]]=t,o[e[1]]=n,o[e[2]]=r,o[e[3]]=i,o}}}};case 5:return function(t){return function(n){return function(r){return function(i){return function(o){var s;return(s={})[e[0]]=t,s[e[1]]=n,s[e[2]]=r,s[e[3]]=i,s[e[4]]=o,s}}}}};default:return l((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i={},o=0;o<t;o++)i[e[o]]=n[o];return i}),t-1,[])}}(n),o=e.map(t[n[0]],i),s=1;s<r;s++)o=e.ap(o,t[n[s]]);return o}}},340:(e,t,n)=>{n.d(t,{Ce:()=>c,DY:()=>w,Eh:()=>R,GY:()=>b,Gb:()=>m,KB:()=>f,Lx:()=>A,Od:()=>a,Qp:()=>_,Su:()=>P,UI:()=>U,YM:()=>p,f2:()=>S,fw:()=>M,hX:()=>D,ke:()=>g,md:()=>y,oA:()=>x,pR:()=>j,tS:()=>E,yL:()=>G,yW:()=>L,zT:()=>v});var r=n(169),i=(n(289),n(614)),o=n(606),s=n(812),u=(n(49),n(226),function(e){return 0===e.length}),a=o.Od,c=o.Ce,l=(o.ws,o.R3),f=(o.Im,function(e,t){return e<=0?[]:o.KB(t)(e)});var d=o.dC,p=(s.P5,s.YM),m=(s.Z$,function(e){return a(e)?i.G(o.Gb(e)):i.YP}),g=function(e){return function(t){return d(e,t)?I(t):t.slice(0,e)}};var h=function(e,t){for(var n=e.length,r=0;r<n&&t(e[r]);r++);return r};function v(e){return function(t){var n=z(h(t,e))(t);return{init:n[0],rest:n[1]}}}var y=function(e){return function(t){return e<=0||u(t)?I(t):e>=t.length?[]:t.slice(e,t.length)}};function _(e){return function(t){return t.slice(h(t,e))}}s.cx;var S=s.f2;s.JO,s.qr;var I=function(e){return e.slice()},b=function(e){return u(e)?[]:e.slice().reverse()},w=function(e){return function(t){return t.length<=1?I(t):t.slice().sort(e.compare)}},G=function(e,t,n){for(var r=[],i=Math.min(e.length,t.length),o=0;o<i;o++)r[o]=n(e[o],t[o]);return r};s.t9;var z=function(e){return function(t){return e>=1&&a(t)?o.lx(e)(t):u(t)?[I(t),[]]:[[],I(t)]}};s.kp,s.Eq;var k=o.of,U=function(e){return function(t){return t.map((function(t){return e(t)}))}},E=function(e){return function(t){return(0,r.zG)(t,function(e){return function(t){for(var n=[],r=0;r<t.length;r++)n.push.apply(n,e(r,t[r]));return n}}((function(t,n){return e(n)})))}},P=function(e){return function(t){return t.map((function(t,n){return e(n,t)}))}},O=function(e){return function(t){for(var n=[],r=0;r<t.length;r++){var o=e(r,t[r]);i.pC(o)&&n.push(o.value)}return n}},C=function(e){return O((function(t,n){return e(n)}))},x=C(r.yR),D=function(e){return function(t){return t.filter(e)}},A=s.Lx,T=(s.xP,s.u4,s.OE),M=(s.nq,s.iw,function(e){var t=q(e);return function(e){return t((function(t,n){return e(n)}))}}),q=function(e){return function(t){return T(e.of([]),(function(n,i,o){return e.ap(e.map(i,(function(e){return function(t){return(0,r.zG)(e,l(t))}})),t(n,o))}))}},R=(s.ZN,s.Eh),j=s.pR,L=(s.pJ,s.oR,o.oo,s.yW);s.j0,i.F4,o.w6,o.QI,o.Ss},335:(e,t,n)=>{function r(e){return function(t){return function(n){return e.chain(n,(function(n){return e.map(t(n),(function(){return n}))}))}}}function i(e){return function(t,n){return function(r){return e.chain(r,(function(r){return e.map(n(r),(function(e){var n;return Object.assign({},r,((n={})[t]=e,n))}))}))}}}n.d(t,{a:()=>i,m:()=>r})},144:(e,t,n)=>{n.d(t,{g1:()=>S,G5:()=>_,dO:()=>h,Pd:()=>G,ak:()=>Q,YO:()=>$,tS:()=>b,g_:()=>D,ij:()=>q,Yo:()=>E,DT:()=>U,Eh:()=>m,fS:()=>A,nM:()=>P,t$:()=>a,UI:()=>g,Vn:()=>z,EQ:()=>x,aD:()=>C,of:()=>v,vx:()=>M,F2:()=>c,LF:()=>T,KC:()=>F,i$:()=>L,Y3:()=>R,it:()=>j});var r=n(335),i=n(906),o=n(169),s=n(289),u=n(614),a=u.t$,c=u.F2,l=function(e,t){return(0,o.zG)(e,g(t))},f=function(e,t){return(0,o.zG)(e,y(t))},d=function(e,t){return(0,o.zG)(e,b(t))},p="Either",m=function(e,t){return{equals:function(n,r){return n===r||(P(n)?P(r)&&e.equals(n.left,r.left):O(r)&&t.equals(n.right,r.right))}}},g=function(e){return function(t){return P(t)?t:c(e(t.right))}},h={URI:p,map:l},v=c,y=function(e){return function(t){return P(t)?t:P(e)?e:c(t.right(e.right))}},_={URI:p,map:l,ap:f},S={URI:p,map:l,ap:f,of:v},I=function(e){return function(t){return P(t)?t:e(t.right)}},b=I,w={URI:p,map:l,ap:f,chain:d},G=function(e,t){return function(n){return P(n)?a(e(n.left)):c(t(n.right))}},z=function(e){return function(t){return P(t)?a(e(t.left)):t}},k={URI:p,fromEither:o.yR},U=(0,i.DT)(k),E=(0,i.Yo)(k),P=u.nM,O=u.tO,C=function(e,t){return function(n){return P(n)?e(n.left):t(n.right)}},x=C,D=x,A=function(e){return function(t){return P(t)?e(t.left):t.right}},T=function(e){return P(e)?c(e.left):a(e.right)},M=function(e){return function(t){return P(t)?e(t.left):t}},q=function(e){return function(t){return null==t?a(e):c(t)}},R=function(e,t){try{return c(e())}catch(e){return a(t(e))}},j=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return R((function(){return e.apply(void 0,n)}),t)}},L=C(o.yR,o.yR);function F(e){return e instanceof Error?e:new Error(String(e))}u.F4;var $=(0,s.YO)(h),Q=(0,r.a)(w);u.Xl},125:(e,t,n)=>{n.d(t,{EQ:()=>S,F2:()=>u,KQ:()=>d,LF:()=>k,LU:()=>z,LV:()=>I,NG:()=>p,Pd:()=>y,UI:()=>m,Vn:()=>_,ap:()=>g,dQ:()=>G,fS:()=>b,i$:()=>U,ij:()=>f,m8:()=>c,pk:()=>l,t$:()=>a,tS:()=>h,vx:()=>w,wp:()=>v});var r=n(945),i=n(144),o=n(169),s=n(289);function u(e){return(0,o.ls)(i.F2,e.of)}function a(e){return(0,o.ls)(i.t$,e.of)}function c(e){return function(t){return e.map(t,i.F2)}}function l(e){return function(t){return e.map(t,i.t$)}}function f(e){return function(t){return(0,o.ls)(i.ij(t),e.of)}}function d(e){var t=f(e);return function(e){var n=t(e);return function(e){return(0,o.ls)(e,n)}}}function p(e){var t=h(e),n=d(e);return function(e){var r=n(e);return function(e){return t(r(e))}}}function m(e){return(0,s.UI)(e,i.dO)}function g(e){return(0,r.ap)(e,i.G5)}function h(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?e.of(n):t(n.right)}))}}}function v(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?t():e.of(n)}))}}}function y(e){return function(t,n){return function(r){return e.map(r,i.Pd(t,n))}}}function _(e){return function(t){return function(n){return e.map(n,i.Vn(t))}}}function S(e){return function(t,n){return function(r){return e.map(r,i.EQ(t,n))}}}function I(e){return function(t,n){return function(r){return e.chain(r,i.EQ(t,n))}}}function b(e){return function(t){return function(n){return e.chain(n,i.EQ(t,e.of))}}}function w(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?t(n.left):e.of(n)}))}}}function G(e){var t=w(e);return function(n){return t((function(t){return e.map(n(t),(function(e){return i.nM(e)?e:i.t$(t)}))}))}}function z(e){return function(t){return function(n){return e.chain(n,i.EQ((function(n){return e.map(t(n),i.t$)}),(function(t){return e.of(i.F2(t))})))}}}function k(e){return function(t){return e.map(t,i.LF)}}function U(e){return function(t){return e.map(t,i.i$)}}},689:(e,t,n)=>{n.d(t,{MW:()=>a,Uz:()=>s,bc:()=>o,f7:()=>r,n_:()=>i,w4:()=>u});n(169);var r=function(e){return{equals:function(t,n){return t===n||e(t,n)}}},i=function(e){return r((function(t,n){for(var r in e)if(!e[r].equals(t[r],n[r]))return!1;return!0}))},o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r((function(t,n){return e.every((function(e,r){return e.equals(t[r],n[r])}))}))},s=function(e){return function(t){return r((function(n,r){return t.equals(e(n),e(r))}))}},u={equals:function(e,t){return e===t}},a=i;u.equals},906:(e,t,n)=>{n.d(t,{DT:()=>s,Dj:()=>u,Yo:()=>o,fX:()=>a});var r=n(169),i=n(614);function o(e){return function(t){return function(n){return e.fromEither(i.Wi(n)?i.t$(t()):i.F2(n.value))}}}function s(e){return function(t,n){return function(r){return e.fromEither(t(r)?i.F2(r):i.t$(n(r)))}}}function u(e){return function(t){return(0,r.ls)(t,e.fromEither)}}function a(e,t){var n=u(e);return function(e){return function(r){return t.chain(r,n(e))}}}},755:(e,t,n)=>{n.d(t,{At:()=>s,oU:()=>o});var r=n(335),i=n(169);function o(e,t){return function(n){var r=(0,i.ls)(n,e.fromIO);return function(e){return t.chain(e,r)}}}function s(e,t){var n=(0,r.m)(t);return function(t){return n((0,i.ls)(t,e.fromIO))}}},241:(e,t,n)=>{n.d(t,{oU:()=>o,wt:()=>i});var r=n(169);function i(e){return function(t){return(0,r.ls)(t,e.fromTask)}}function o(e,t){return function(n){var i=(0,r.ls)(n,e.fromTask);return function(e){return t.chain(e,i)}}}},289:(e,t,n)=>{function r(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.map(e,n)}))}}}function i(e){return function(t){return function(n){return e.map(n,(function(e){return e(t)}))}}}function o(e){return function(t){return function(n){return e.map(n,(function(e){var n;return(n={})[t]=e,n}))}}}function s(e){return function(t,n){return function(r){return e.map(r,(function(e){var r;return Object.assign({},e,((r={})[t]=n(e),r))}))}}}n.d(t,{Hr:()=>s,OV:()=>i,UI:()=>r,YO:()=>o})},694:(e,t,n)=>{n.d(t,{G5:()=>p,PM:()=>d,RD:()=>_,UA:()=>g,UI:()=>a,dO:()=>f,of:()=>c,qo:()=>m});var r=n(169),i=(n(289),n(614)),o=function(e,t){return function(){return t(e())}},s=function(e,t){return function(){return e()(t())}},u=function(e,t){return function(){return t(e())()}},a=function(e){return function(t){return o(t,e)}},c=r.a9,l="IO",f={URI:l,map:o},d={URI:l,of:c},p={URI:l,map:o,ap:s},m={URI:l,map:o,ap:s,chain:u},g={URI:l,map:o,ap:s,of:c,chain:u},h=(r.yR,r.yR,i.F4,c(i.Xl)),v=function(e){var t=function(e){return function(t){return function(){for(var n=[e(0,i.YM(t))()],r=1;r<t.length;r++)n.push(e(r,t[r])());return n}}}(e);return function(e){return i.Od(e)?t(e):h}},y=function(e){return v((function(t,n){return e(n)}))},_=y(r.yR)},606:(e,t,n)=>{n.d(t,{Ce:()=>l,Eh:()=>b,Gb:()=>G,Im:()=>f,KB:()=>h,Od:()=>u,QI:()=>k,R3:()=>d,Ss:()=>U,dC:()=>a,lx:()=>I,nI:()=>g,of:()=>_,oo:()=>p,ur:()=>z,w6:()=>v,ws:()=>c,yL:()=>S});var r=n(169),i=(n(289),n(614)),o=n(214),s=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},u=function(e){return e.length>0},a=function(e,t){return e<0||e>=t.length},c=function(e){return function(t){return s([e],t,!0)}},l=c,f=function(e){return function(t){return s(s([],t,!0),[e],!1)}},d=f,p=function(e,t,n){if(u(n)){var r=m(n);return r.splice(e,0,t),r}return[t]},m=i.r1,g=function(e){return u(e)?i.G(e):i.YP},h=function(e){return function(t){for(var n=Math.max(0,Math.floor(t)),r=[e(0)],i=1;i<n;i++)r.push(e(i));return r}},v=function(e,t){return e<=t?h((function(t){return e+t}))(t-e+1):[e]};var y=m,_=function(e){return[e]},S=function(e,t,n){for(var r=[n(e[0],t[0])],i=Math.min(e.length,t.length),o=1;o<i;o++)r[o]=n(e[o],t[o]);return r};o.xP,o.Lx;var I=function(e){return function(t){var n=Math.max(1,e);return n>=t.length?[y(t),[]]:[(0,r.zG)(t.slice(1,n),l(w(t))),t.slice(n)]}},b=(o.u4,o.OE,o.nq,o.iw,o.YM,o.ZN,o.Eh),w=(i.F4,o.YM),G=function(e){return e.slice(1)},z=(o.Z$,o.VV,o.Fp,function(e){return function(t){return t.reduce(e.concat)}});o.j0;function k(e,t){return void 0===t?l(e):(0,r.zG)(t,l(e))}var U=function(e,t){return(0,r.zG)(e,d(t))};o.ur},507:(e,t,n)=>{n.d(t,{DT:()=>m,Dj:()=>ce,Do:()=>ye,EK:()=>h,EQ:()=>re,Eh:()=>z,FS:()=>ve,G:()=>p,G5:()=>D,Gk:()=>q,Hr:()=>Se,IS:()=>g,KQ:()=>me,NG:()=>ge,OV:()=>ue,Qt:()=>be,Ri:()=>N,UI:()=>E,Uo:()=>J,WG:()=>he,Wi:()=>te,Y3:()=>de,YO:()=>_e,YP:()=>d,aD:()=>ne,ak:()=>Ie,bM:()=>j,dO:()=>P,fS:()=>se,fX:()=>le,fw:()=>X,g1:()=>A,g_:()=>ie,hX:()=>B,ij:()=>fe,it:()=>pe,lo:()=>F,pC:()=>ee,pF:()=>oe,pR:()=>k,tS:()=>T,uZ:()=>U,wp:()=>R,xH:()=>ae,xu:()=>W});var r=n(945),i=n(335),o=n(906),s=n(169),u=n(289),a=n(614),c=n(327),l=n(49),f=(n(226),n(302)),d=a.YP,p=a.G;function m(e){return function(t){return e(t)?p(t):d}}var g=function(e){return"Right"===e._tag?d:p(e.left)},h=function(e){return"Left"===e._tag?d:p(e.right)},v=function(e,t){return(0,s.zG)(e,E(t))},y=function(e,t){return(0,s.zG)(e,x(t))},_=function(e,t){return(0,s.zG)(e,T(t))},S=function(e,t){return(0,s.zG)(e,B(t))},I=function(e,t){return(0,s.zG)(e,H(t))},b=function(e,t){return(0,s.zG)(e,V(t))},w=function(e,t){return(0,s.zG)(e,K(t))},G="Option",z=function(e){return{equals:function(t,n){return t===n||(te(t)?te(n):!te(n)&&e.equals(t.value,n.value))}}},k=function(e){return{equals:z(e).equals,compare:function(t,n){return t===n?0:ee(t)?ee(n)?e.compare(t.value,n.value):1:-1}}},U=function(e){return{concat:function(t,n){return te(t)?n:te(n)?t:p(e.concat(t.value,n.value))},empty:d}},E=function(e){return function(t){return te(t)?d:p(e(t.value))}},P={URI:G,map:v},O=p,C={URI:G,of:O},x=function(e){return function(t){return te(t)||te(e)?d:p(t.value(e.value))}},D={URI:G,map:v,ap:y},A={URI:G,map:v,ap:y,of:O},T=function(e){return function(t){return te(t)?d:e(t.value)}},M={URI:G,map:v,ap:y,chain:_},q=function(e){return function(t){return te(t)?e():t}},R=q,j=function(){return d},L={URI:G,zero:j},F=(0,f.l)(L,C),$=T(s.yR),Q=(0,l.s4)(d,d),Y=function(e){return te(e)?Q:(0,l.s4)(g(e.value),h(e.value))},N={URI:G,compact:$,separate:Y},B=function(e){return function(t){return te(t)?d:e(t.value)?t:d}},H=function(e){return function(t){return te(t)?d:e(t.value)}},V=function(e){return function(t){return(0,l.s4)(S(t,(0,c.ff)(e)),S(t,e))}},K=function(e){return(0,s.ls)(E(e),Y)},W={URI:G,map:v,compact:$,separate:Y,filter:S,filterMap:I,partition:b,partitionMap:w},X=function(e){return function(t){return function(n){return te(n)?e.of(d):e.map(t(n.value),p)}}},J=h,Z={URI:G,fromEither:J},ee=a.pC,te=function(e){return"None"===e._tag},ne=function(e,t){return function(n){return te(n)?e():t(n.value)}},re=ne,ie=re,oe=function(e){return function(t){return te(t)?e():t.value}},se=oe,ue=(0,u.OV)(P),ae=$,ce=(0,o.Dj)(Z),le=(0,o.fX)(Z,M),fe=function(e){return null==e?d:p(e)},de=function(e){try{return p(e())}catch(e){return d}},pe=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return de((function(){return e.apply(void 0,t)}))}},me=function(e){return(0,s.ls)(e,fe)},ge=function(e){return function(t){return te(t)?d:fe(e(t.value))}},he=re(s.gn,s.yR),ve=re(s.r5,s.yR);var ye=O(a.F4),_e=(0,u.YO)(P),Se=(0,u.Hr)(P),Ie=(0,i.a)(M),be=(0,r.Qt)(D);a.Xl},856:(e,t,n)=>{n.d(t,{Fp:()=>d,Uz:()=>u,VV:()=>f,Zt:()=>s,gf:()=>l,gt:()=>c,lt:()=>a});var r=n(689),i=n(169),o=function(e){return function(t,n){return t===n||0===e(t,n)}},s=function(e){return{equals:o(e),compare:function(t,n){return t===n?0:e(t,n)}}},u=function(e){return function(t){return s((function(n,r){return t.compare(e(n),e(r))}))}},a=(i.W8,function(e){return function(t,n){return-1===e.compare(t,n)}}),c=function(e){return function(t,n){return 1===e.compare(t,n)}},l=function(e){return function(t,n){return-1!==e.compare(t,n)}},f=function(e){return function(t,n){return t===n||e.compare(t,n)<1?t:n}},d=function(e){return function(t,n){return t===n||e.compare(t,n)>-1?t:n}};r.w4.equals},327:(e,t,n)=>{n.d(t,{ff:()=>r,xD:()=>i});n(169);var r=function(e){return function(t){return!e(t)}},i=function(e){return function(t){return function(n){return t(n)&&e(n)}}}},812:(e,t,n)=>{n.d(t,{Ce:()=>g,DZ:()=>X,EQ:()=>_,Eh:()=>de,Eq:()=>$,Ew:()=>E,G:()=>Ge,Hr:()=>ke,JO:()=>O,Lx:()=>re,N7:()=>D,OE:()=>ie,OV:()=>ge,Od:()=>m,P5:()=>I,R3:()=>h,Su:()=>V,UI:()=>H,YM:()=>b,Yo:()=>v,Z$:()=>w,ZN:()=>ce,aD:()=>y,bM:()=>Y,bj:()=>x,cS:()=>be,cx:()=>U,f2:()=>P,hX:()=>K,iw:()=>se,j0:()=>ze,jG:()=>le,jj:()=>T,kp:()=>F,lo:()=>ye,md:()=>k,nI:()=>Ie,nq:()=>oe,oA:()=>J,oR:()=>Se,of:()=>Q,pJ:()=>_e,pO:()=>M,pR:()=>pe,pc:()=>R,qr:()=>C,t9:()=>A,tS:()=>N,u4:()=>ne,uK:()=>Z,uZ:()=>fe,vP:()=>ue,xH:()=>B,xP:()=>te,xb:()=>p,yW:()=>we,zT:()=>z});var r=n(689),i=n(169),o=n(289),s=n(614),u=n(52),a=n(856),c=n(214),l=n(49),f=(n(226),n(302)),d=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},p=function(e){return 0===e.length},m=c.Od,g=c.Ce,h=(c.ws,c.R3);c.Im;var v=function(e){return s.Wi(e)?be:[e.value]},y=function(e,t){return function(n){return m(n)?t(n):e()}},_=y,S=c.dC;function I(e,t){return void 0===t?function(t){return I(e,t)}:S(e,t)?s.YP:s.G(t[e])}var b=function(e){return m(e)?s.G(c.YM(e)):s.YP},w=function(e){return m(e)?s.G(c.Z$(e)):s.YP};var G=function(e,t){for(var n=e.length,r=0;r<n&&t(e[r]);r++);return r};function z(e){return function(t){var n=q(G(t,e))(t);return{init:n[0],rest:n[1]}}}var k=function(e){return function(t){return e<=0||p(t)?t:e>=t.length?be:t.slice(e,t.length)}};var U=function(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return s.G(n);return s.YP}};function E(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return s.G(t[n]);return s.YP}}var P=function(e){return function(t){for(var n=0;n<t.length;n++){var r=e(t[n]);if(s.pC(r))return r}return s.YP}};var O=function(e){return function(t){for(var n=t.length-1;n>=0;n--){var r=e(t[n]);if(s.pC(r))return r}return s.YP}},C=function(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return s.G(n);return s.YP}},x=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"Left"===r._tag&&t.push(r.left)}return t};var D=function(e){for(var t=[],n=[],r=0;r<e.length;r++)t[r]=e[r][0],n[r]=e[r][1];return[t,n]};function A(e){return function(t,n){if(void 0===n){var r=A(e);return function(e){return r(t,e)}}for(var i,o=0;o<n.length;o++)if(i=n[o],e.equals(i,t))return!0;return!1}}var T=function(e){var t=c.jj(e);return function(e){return m(e)?t(e):e}},M=function(e){var t=c.pO(e);return function(e){return m(e)?t(e):be}},q=function(e){return function(t){return e>=1&&m(t)?c.lx(e)(t):p(t)?[t,be]:[be,t]}},R=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return v(e.apply(void 0,t))}};var j=function(e,t){return(0,i.zG)(e,H(t))},L=function(e,t,n){return(0,i.zG)(e,ne(t,n))},F=function(e,t){return(0,i.zG)(e,_e(t))},$=function(e,t){return(0,i.zG)(e,Se(t))},Q=c.of,Y=function(){return be},N=function(e){return function(t){return(0,i.zG)(t,function(e){return function(t){if(p(t))return be;for(var n=[],r=0;r<t.length;r++)n.push.apply(n,e(r,t[r]));return n}}((function(t,n){return e(n)})))}},B=N(i.yR),H=function(e){return function(t){return t.map((function(t){return e(t)}))}},V=function(e){return function(t){return t.map((function(t,n){return e(n,t)}))}},K=function(e){return function(t){return t.filter(e)}},W=function(e){return function(t){for(var n=[],r=0;r<t.length;r++){var i=e(r,t[r]);s.pC(i)&&n.push(i.value)}return n}},X=function(e){return W((function(t,n){return e(n)}))},J=X(i.yR),Z=function(e){return ee((function(t,n){return e(n)}))},ee=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=t[i];e(i,o)?r.push(o):n.push(o)}return(0,l.s4)(n,r)}},te=function(e){return function(t){return function(n){return n.reduce((function(n,r,i){return e.concat(n,t(i,r))}),e.empty)}}},ne=function(e,t){return ie(e,(function(e,n,r){return t(n,r)}))},re=function(e){var t=te(e);return function(e){return t((function(t,n){return e(n)}))}},ie=function(e,t){return function(n){for(var r=n.length,i=e,o=0;o<r;o++)i=t(o,i,n[o]);return i}},oe=function(e,t){return se(e,(function(e,n,r){return t(n,r)}))},se=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}},ue=function(e){return function(t){return L(t,e.of(Y()),(function(t,n){return e.ap(e.map(t,(function(e){return function(t){return(0,i.zG)(e,h(t))}})),n)}))}},ae="ReadonlyArray",ce=function(e){return{show:function(t){return"[".concat(t.map(e.show).join(", "),"]")}}},le=function(){return{concat:function(e,t){return p(e)?t:p(t)?e:e.concat(t)}}},fe=function(){return{concat:le().concat,empty:be}},de=function(e){return(0,r.f7)((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))},pe=function(e){return(0,a.Zt)((function(t,n){for(var r=t.length,i=n.length,o=Math.min(r,i),s=0;s<o;s++){var a=e.compare(t[s],n[s]);if(0!==a)return a}return u.Df.compare(r,i)}))},me={URI:ae,map:j},ge=(0,o.OV)(me),he={URI:ae,of:Q},ve={URI:ae,zero:Y},ye=(0,f.l)(ve,he),_e=function(e){return function(t){for(var n=d([],e(t),!0),r=[];n.length>0;){var i=n.shift();s.nM(i)?n.unshift.apply(n,e(i.left)):r.push(i.right)}return r}},Se=function(e){return function(t){var n=e(t),r=[],i=[];function o(t){s.nM(t)?e(t.left).forEach((function(e){return r.push(e)})):i.push(t.right)}for(var u=0,a=n;u<a.length;u++){o(a[u])}for(;r.length>0;)o(r.shift());return i}},Ie=(c.oo,function(e){return p(e)?be:e.slice()}),be=c.cS;function we(e){return function(t){return t.every(e)}}var Ge=function(e){return function(t){return t.some(e)}},ze=function(e){var t=c.j0(e);return function(n){return _((function(){return e.empty}),t(n))}},ke=(s.F4,(0,o.Hr)(me));c.w6,c.QI,c.Ss},214:(e,t,n)=>{n.d(t,{Ce:()=>d,Eh:()=>T,Fp:()=>F,Im:()=>p,Lx:()=>E,OE:()=>O,Od:()=>c,QI:()=>B,R3:()=>m,Ss:()=>H,UI:()=>z,VV:()=>L,YM:()=>M,Z$:()=>R,ZN:()=>A,aL:()=>Q,c2:()=>v,cS:()=>a,dC:()=>l,iw:()=>x,j0:()=>N,jj:()=>h,lx:()=>w,nq:()=>P,of:()=>G,oo:()=>g,pO:()=>b,u4:()=>U,ur:()=>$,ut:()=>Y,w6:()=>_,ws:()=>f,xP:()=>C});var r=n(689),i=n(169),o=(n(289),n(614)),s=n(794),u=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},a=o.Xl,c=o.Od,l=function(e,t){return e<0||e>=t.length},f=function(e){return function(t){return u([e],t,!0)}},d=f,p=function(e){return function(t){return u(u([],t,!0),[e],!1)}},m=p,g=function(e,t,n){if(c(n)){var r=o.r1(n);return r.splice(e,0,t),r}return[t]},h=function(e){return function(t){if(1===t.length)return t;for(var n=[M(t)],r=function(t){n.every((function(n){return!e.equals(n,t)}))&&n.push(t)},i=0,o=q(t);i<o.length;i++){r(o[i])}return n}},v=function(e){return c(e)?o.G(e):o.YP},y=function(e){return function(t){for(var n=Math.max(0,Math.floor(t)),r=[e(0)],i=1;i<n;i++)r.push(e(i));return r}},_=function(e,t){return e<=t?y((function(t){return e+t}))(t-e+1):[e]};function S(e,t){return t?e.concat(t):function(t){return t.concat(e)}}var I=function(e){return function(t){for(var n=[e,t[0]],r=1;r<t.length;r++)n.push(e,t[r]);return n}},b=function(e){return function(t){for(var n=e(t),r=[n[0]],i=n[1];c(i);){var o=e(i),s=o[0],u=o[1];r.push(s),i=u}return r}},w=function(e){return function(t){var n=Math.max(1,e);return n>=t.length?[t,a]:[(0,i.zG)(t.slice(1,n),d(M(t))),t.slice(n)]}},G=o.ri,z=function(e){return k((function(t,n){return e(n)}))},k=function(e){return function(t){for(var n=[e(0,M(t))],r=1;r<t.length;r++)n.push(e(r,t[r]));return n}},U=function(e,t){return O(e,(function(e,n,r){return t(n,r)}))},E=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r){return e.concat(n,t(r))}),t(n[0]))}}},P=function(e,t){return x(e,(function(e,n,r){return t(n,r)}))},O=function(e,t){return function(n){return n.reduce((function(e,n,r){return t(r,e,n)}),e)}},C=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r,i){return e.concat(n,t(i+1,r))}),t(0,n[0]))}}},x=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}},D=o.YM,A=function(e){return{show:function(t){return"[".concat(t.map(e.show).join(", "),"]")}}},T=function(e){return(0,r.f7)((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))},M=(o.F4,D),q=o.Gb,R=function(e){return e[e.length-1]},j=function(e){return e.slice(0,-1)},L=function(e){var t=s.VV(e);return function(e){return e.reduce(t.concat)}},F=function(e){var t=s.Fp(e);return function(e){return e.reduce(t.concat)}},$=function(e){return function(t){return t.reduce(e.concat)}},Q=function(e){return function(t){return e(M(t),q(t))}},Y=function(e){return function(t){return e(j(t),R(t))}},N=function(e){var t=$(e);return function(e){return(0,i.ls)(function(e){return function(t){var n=q(t);return c(n)?(0,i.zG)(n,I(e),d(M(t))):t}}(e),t)}};function B(e,t){return void 0===t?d(e):(0,i.zG)(t,d(e))}var H=function(e,t){return(0,i.zG)(e,S([t]))}},450:(e,t,n)=>{n.d(t,{Bu:()=>v,CC:()=>j,DZ:()=>ne,EG:()=>h,EW:()=>B,Eh:()=>fe,G:()=>A,HA:()=>M,Hd:()=>E,I8:()=>F,P5:()=>y,RF:()=>L,RJ:()=>Q,SW:()=>V,Su:()=>S,UI:()=>I,Ub:()=>W,V_:()=>N,XP:()=>f,Yz:()=>C,_Y:()=>Y,_r:()=>U,cS:()=>_,dp:()=>a,dx:()=>m,e$:()=>g,hX:()=>te,jt:()=>P,kp:()=>R,mK:()=>Z,mS:()=>$,nn:()=>q,nr:()=>pe,nu:()=>H,oA:()=>ae,oh:()=>ce,qS:()=>J,ri:()=>z,sq:()=>x,t9:()=>T,tV:()=>ie,uK:()=>re,uZ:()=>de,vA:()=>X,vP:()=>k,xb:()=>c,yW:()=>D,z7:()=>O,zV:()=>K});var r=n(689),i=n(169),o=n(614),s=n(49),u=n(229),a=(n(226),function(e){return Object.keys(e).length}),c=function(e){for(var t in e)if(o.e$.call(e,t))return!1;return!0},l=function(e){return function(t){return Object.keys(t).sort(e.compare)}},f=l(u.Df);function d(e){if("function"==typeof e)return d(u.Df)(e);var t=l(e);return function(e){return function(n){for(var r=[],i=0,o=t(n);i<o.length;i++){var s=o[i];r.push(e(s,n[s]))}return r}}}var p=d(u.Df)((function(e,t){return[e,t]}));var m=function(e,t){return function(n){if(o.e$.call(n,e)&&n[e]===t)return n;var r=Object.assign({},n);return r[e]=t,r}},g=function(e,t){return o.e$.call(t,e)};function h(e){return function(t){if(!o.e$.call(t,e))return t;var n=Object.assign({},t);return delete n[e],n}}function v(e){return function(t,n){if(void 0===n){var r=v(e);return function(e){return r(e,t)}}for(var i in t)if(!o.e$.call(n,i)||!e.equals(t[i],n[i]))return!1;return!0}}function y(e,t){return void 0===t?function(t){return y(e,t)}:o.e$.call(t,e)?o.G(t[e]):o.YP}var _={};function S(e){return function(t){var n={};for(var r in t)o.e$.call(t,r)&&(n[r]=e(r,t[r]));return n}}function I(e){return S((function(t,n){return e(n)}))}function b(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2===e.length)return b(u.Df).apply(void 0,e);var n=l(e[0]);return function(e,t){return function(r){for(var i=e,o=n(r),s=o.length,u=0;u<s;u++){var a=o[u];i=t(a,i,r[a])}return i}}}function w(e){if("compare"in e){var t=l(e);return function(e){return function(n){return function(r){for(var i=e.empty,o=t(r),s=o.length,u=0;u<s;u++){var a=o[u];i=e.concat(i,n(a,r[a]))}return i}}}}return w(u.Df)(e)}function G(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2===e.length)return G(u.Df).apply(void 0,e);var n=l(e[0]);return function(e,t){return function(r){for(var i=e,o=n(r),s=o.length-1;s>=0;s--){var u=o[s];i=t(u,r[u],i)}return i}}}var z=function(e,t){var n;return(n={})[e]=t,n};function k(e){return Z(u.Df)(e)}function U(e){return function(t){var n={},r={};for(var i in t)if(o.e$.call(t,i)){var u=e(i,t[i]);switch(u._tag){case"Left":n[i]=u.left;break;case"Right":r[i]=u.right}}return(0,s.s4)(n,r)}}function E(e){return function(t){var n={},r={};for(var i in t)if(o.e$.call(t,i)){var u=t[i];e(i,u)?r[i]=u:n[i]=u}return(0,s.s4)(n,r)}}function P(e){return function(t){var n={};for(var r in t)if(o.e$.call(t,r)){var i=e(r,t[r]);o.pC(i)&&(n[r]=i.value)}return n}}function O(e){return function(t){var n={},r=!1;for(var i in t)if(o.e$.call(t,i)){var s=t[i];e(i,s)?n[i]=s:r=!0}return r?n:t}}var C=p,x=function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[i[0]]=i[1]}return t};function D(e){return function(t){for(var n in t)if(!e(t[n]))return!1;return!0}}function A(e){return function(t){for(var n in t)if(e(t[n]))return!0;return!1}}function T(e){return function(t,n){if(void 0===n){var r=T(e);return function(e){return r(t,e)}}for(var i in n)if(e.equals(n[i],t))return!0;return!1}}var M=function(e,t){return(0,i.zG)(e,I(t))},q=function(e,t){return(0,i.zG)(e,S(t))},R=function(e){var t=oe(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},j=function(e){return function(t){var n=se(e)(t);return function(e,t){return(0,i.zG)(e,n(t))}}},L=function(e){var t=ue(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},F=function(e,t){return(0,i.zG)(e,te(t))},$=function(e,t){return(0,i.zG)(e,ne(t))},Q=function(e,t){return(0,i.zG)(e,re(t))},Y=function(e,t){return(0,i.zG)(e,ie(t))},N=function(e){var t=b(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},B=function(e){var t=w(e);return function(e){var n=t(e);return function(e,t){return(0,i.zG)(e,n(t))}}},H=function(e){var t=G(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},V=function(e,t){return(0,i.zG)(e,U(t))},K=function(e,t){return(0,i.zG)(e,E(t))},W=function(e,t){return(0,i.zG)(e,P(t))},X=function(e,t){return(0,i.zG)(e,O(t))},J=function(e){var t=ee(e);return function(e){var n=t(e);return function(e,t){return n(e,(0,i.ls)(i.SK,t))}}},Z=function(e){var t=J(e);return function(e){var n=t(e);return function(e){return n(e,i.yR)}}},ee=function(e){return function(t){var n=l(e);return function(e,r){var i=n(e);if(0===i.length)return t.of(_);for(var o=t.of({}),s=function(n){o=t.ap(t.map(o,(function(e){return function(t){var r;return Object.assign({},e,((r={})[n]=t,r))}})),r(n,e[n]))},u=0,a=i;u<a.length;u++){s(a[u])}return o}}},te=function(e){return O((function(t,n){return e(n)}))},ne=function(e){return P((function(t,n){return e(n)}))},re=function(e){return E((function(t,n){return e(n)}))},ie=function(e){return U((function(t,n){return e(n)}))};function oe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=b(e[0]);return function(e,t){return n(e,(function(e,n,r){return t(n,r)}))}}return oe(u.Df).apply(void 0,e)}function se(e){if("compare"in e){var t=w(e);return function(e){var n=t(e);return function(e){return n((function(t,n){return e(n)}))}}}return se(u.Df)(e)}function ue(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=G(e[0]);return function(e,t){return n(e,(function(e,n,r){return t(n,r)}))}}return ue(u.Df).apply(void 0,e)}var ae=function(e){var t={};for(var n in e)if(o.e$.call(e,n)){var r=e[n];o.pC(r)&&(t[n]=r.value)}return t},ce=function(e){var t={},n={};for(var r in e)if(o.e$.call(e,r)){var i=e[r];o.nM(i)?t[r]=i.left:n[r]=i.right}return(0,s.s4)(t,n)},le="ReadonlyRecord";function fe(e){var t=v(e);return(0,r.f7)((function(e,n){return t(e)(n)&&t(n)(e)}))}function de(e){return{concat:function(t,n){if(c(t))return n;if(c(n))return t;var r=Object.assign({},t);for(var i in n)o.e$.call(n,i)&&(r[i]=o.e$.call(t,i)?e.concat(t[i],n[i]):n[i]);return r},empty:_}}u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df;function pe(e,t){return o.e$.call(void 0===t?this:t,e)}u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df,u.Df},643:(e,t,n)=>{n.d(t,{H5:()=>u,Kl:()=>a,Lx:()=>l,Pd:()=>o,Yg:()=>i,li:()=>r,nq:()=>f,pL:()=>s,u4:()=>c});n(169);function r(e){return e[0]}function i(e){return e[1]}var o=function(e,t){return function(n){return[t(r(n)),e(i(n))]}},s=function(e){return function(t){return[e(r(t)),i(t)]}},u=function(e){return function(t){return[r(t),e(i(t))]}},a=r,c=function(e,t){return function(n){return t(e,r(n))}},l=function(){return function(e){return function(t){return e(r(t))}}},f=function(e,t){return function(n){return t(r(n),e)}}},794:(e,t,n)=>{n.d(t,{Z$:()=>c,Fp:()=>u,VV:()=>s,n_:()=>a});var r,i=n(614),o=n(856),s=function(e){return{concat:o.VV(e)}},u=function(e){return{concat:o.Fp(e)}},a=function(e){return{concat:function(t,n){var r={};for(var o in e)i.e$.call(e,o)&&(r[o]=e[o].concat(t[o],n[o]));return r}}},c=function(){return{concat:function(e,t){return t}}};r=void 0},49:(e,t,n)=>{n.d(t,{F2:()=>s,Vn:()=>i,s4:()=>r});n(169);var r=function(e,t){return{left:e,right:t}},i=function(e){return function(t){return r(e(o(t)),s(t))}},o=function(e){return e.left},s=function(e){return e.right}},46:(e,t,n)=>{n.d(t,{At:()=>k,Do:()=>U,Hi:()=>S,Hr:()=>P,PM:()=>_,UA:()=>w,UI:()=>p,YO:()=>E,ak:()=>O,ap:()=>m,dO:()=>y,gw:()=>c,mU:()=>G,of:()=>g,pE:()=>T,qA:()=>I,qo:()=>b,tD:()=>a,tS:()=>h,uU:()=>A});var r=n(335),i=n(755),o=n(169),s=n(289),u=n(614),a=function(e){return function(){return Promise.resolve().then(e)}};function c(e){return function(t){return function(){return new Promise((function(n){setTimeout((function(){Promise.resolve().then(t).then(n)}),e)}))}}}var l=function(e,t){return(0,o.zG)(e,p(t))},f=function(e,t){return(0,o.zG)(e,m(t))},d=function(e,t){return(0,o.zG)(e,h(t))},p=function(e){return function(t){return function(){return Promise.resolve().then(t).then(e)}}},m=function(e){return function(t){return function(){return Promise.all([Promise.resolve().then(t),Promise.resolve().then(e)]).then((function(e){return(0,e[0])(e[1])}))}}},g=function(e){return function(){return Promise.resolve(e)}},h=function(e){return function(t){return function(){return Promise.resolve().then(t).then((function(t){return e(t)()}))}}},v="Task";var y={URI:v,map:l},_={URI:v,of:g},S={URI:v,map:l,ap:f},I={URI:v,map:l,ap:f,of:g},b={URI:v,map:l,ap:f,chain:d},w={URI:v,map:l,of:g,ap:f,chain:d},G=(o.yR,(0,r.m)(b)),z={URI:v,fromIO:a},k=(0,i.At)(z,b),U=g(u.F4),E=(0,s.YO)(y),P=(0,s.Hr)(y),O=(0,r.a)(b),C=g(u.Xl),x=function(e){var t=function(e){return function(t){return function(){return Promise.all(t.map((function(t,n){return Promise.resolve().then((function(){return e(n,t)()}))})))}}}(e);return function(e){return u.Od(e)?t(e):C}},D=function(e){var t=function(e){return function(t){return function(){return u.Gb(t).reduce((function(t,n,r){return t.then((function(t){return Promise.resolve().then(e(r+1,n)).then((function(e){return t.push(e),t}))}))}),Promise.resolve().then(e(0,u.YM(t))).then(u.ri))}}}(e);return function(e){return u.Od(e)?t(e):C}},A=function(e){return x((function(t,n){return e(n)}))},T=function(e){return D((function(t,n){return e(n)}))}},6:(e,t,n)=>{n.d(t,{At:()=>te,DT:()=>J,EQ:()=>z,F2:()=>h,Hi:()=>V,Hr:()=>oe,Ij:()=>ae,LV:()=>k,OV:()=>H,Op:()=>S,QM:()=>v,Qt:()=>ue,UI:()=>M,Vn:()=>R,Y3:()=>E,YO:()=>ie,Zl:()=>F,ak:()=>se,dk:()=>_,fF:()=>b,fS:()=>U,fX:()=>X,fj:()=>G,it:()=>P,lk:()=>y,oU:()=>ee,of:()=>Q,t$:()=>g,tD:()=>I,tS:()=>L,wE:()=>re,wp:()=>$});var r=n(945),i=n(335),o=n(125),s=n(906),u=n(755),a=n(241),c=n(169),l=n(289),f=n(614),d=n(46),p=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{a(r.next(e))}catch(e){o(e)}}function u(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},m=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},g=o.t$(d.PM),h=o.F2(d.PM),v=o.m8(d.dO),y=o.pk(d.dO),_=(0,c.ls)(d.tD,v),S=(0,c.ls)(d.tD,y),I=_,b=v,w=d.of,G=d.tD,z=o.EQ(d.dO),k=o.LV(d.UA),U=o.fS(d.UA),E=function(e,t){return function(){return p(void 0,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e().then(f.F2)];case 1:return[2,r.sent()];case 2:return n=r.sent(),[2,f.t$(t(n))];case 3:return[2]}}))}))}},P=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return E((function(){return e.apply(void 0,n)}),t)}},O=(d.dO,d.PM,d.PM,d.UA,d.UA,d.UA,d.UA,d.dO,function(e,t){return(0,c.zG)(e,M(t))}),C=function(e,t){return(0,c.zG)(e,j(t))},x=function(e,t){return(0,c.zG)(e,L(t))},D=function(e,t,n){return(0,c.zG)(e,q(t,n))},A=function(e,t){return(0,c.zG)(e,R(t))},T=function(e,t){return(0,c.zG)(e,$(t))},M=o.UI(d.dO),q=o.Pd(d.dO),R=o.Vn(d.dO),j=o.ap(d.Hi),L=o.tS(d.UA),F=L,$=o.wp(d.UA),Q=h,Y=g,N="TaskEither";var B={URI:N,map:O},H=(0,l.OV)(B),V={URI:N,map:O,ap:C},K={URI:N,map:O,ap:C,chain:x},W={URI:N,fromEither:w},X=(0,s.fX)(W,K),J=(0,s.DT)(W),Z={URI:N,fromIO:I},ee=(0,u.oU)(Z,K),te=(0,u.At)(Z,K),ne={URI:N,fromIO:I,fromTask:b},re=(0,a.oU)(ne,K);f.F4;var ie=(0,l.YO)(B),oe=(0,l.Hr)(B),se=(0,i.a)(K),ue=(0,r.Qt)(V),ae=(f.Xl,{URI:N,bimap:D,mapLeft:A,map:O,of:Q,ap:C,chain:x,alt:T,fromIO:I,fromTask:b,throwError:Y})},644:(e,t,n)=>{n.d(t,{H5:()=>s,Yg:()=>o,li:()=>i});var r=n(643),i=(n(169),r.li),o=r.Yg;var s=function(e){return function(t){return[i(t),e(o(t))]}};r.Kl,r.Lx,r.u4,r.nq},226:(e,t,n)=>{function r(e,t){return function(n){var r=e.traverse(n);return function(e,i){return n.map(r(e,i),t.separate)}}}function i(e,t){return function(n){var r=e.traverse(n);return function(e,i){return n.map(r(e,i),t.compact)}}}n.d(t,{BL:()=>i,Fj:()=>r})},302:(e,t,n)=>{function r(e,t){return function(n){return n?t.of(void 0):e.zero()}}n.d(t,{l:()=>r})},169:(e,t,n)=>{n.d(t,{MZ:()=>o,Q1:()=>l,SK:()=>m,W8:()=>u,a9:()=>s,bc:()=>d,gn:()=>a,ls:()=>f,nn:()=>r,r5:()=>c,yR:()=>i,zG:()=>p});var r=function(e){return function(t){return t(e)}};function i(e){return e}var o=i;function s(e){return function(){return e}}var u=s(!0),a=s(null),c=s(void 0),l=c;function f(e,t,n,r,i,o,s,u,a){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return r(n(t(e.apply(this,arguments))))};case 5:return function(){return i(r(n(t(e.apply(this,arguments)))))};case 6:return function(){return o(i(r(n(t(e.apply(this,arguments))))))};case 7:return function(){return s(o(i(r(n(t(e.apply(this,arguments)))))))};case 8:return function(){return u(s(o(i(r(n(t(e.apply(this,arguments))))))))};case 9:return function(){return a(u(s(o(i(r(n(t(e.apply(this,arguments)))))))))}}}function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}function p(e,t,n,r,i,o,s,u,a){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return i(r(n(t(e))));case 6:return o(i(r(n(t(e)))));case 7:return s(o(i(r(n(t(e))))));case 8:return u(s(o(i(r(n(t(e)))))));case 9:return a(u(s(o(i(r(n(t(e))))))));default:for(var c=arguments[0],l=1;l<arguments.length;l++)c=arguments[l](c);return c}}var m=function(e,t){return t}},614:(e,t,n)=>{n.d(t,{F2:()=>f,F4:()=>v,G:()=>u,Gb:()=>g,Od:()=>p,Wi:()=>i,Xl:()=>h,YM:()=>m,YP:()=>s,e$:()=>y,nM:()=>a,pC:()=>o,r1:()=>_,ri:()=>d,t$:()=>l,tO:()=>c});var r=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},i=function(e){return"None"===e._tag},o=function(e){return"Some"===e._tag},s={_tag:"None"},u=function(e){return{_tag:"Some",value:e}},a=function(e){return"Left"===e._tag},c=function(e){return"Right"===e._tag},l=function(e){return{_tag:"Left",left:e}},f=function(e){return{_tag:"Right",right:e}},d=function(e){return[e]},p=function(e){return e.length>0},m=function(e){return e[0]},g=function(e){return e.slice(1)},h=[],v={},y=Object.prototype.hasOwnProperty,_=function(e){return r([e[0]],e.slice(1),!0)}},52:(e,t,n)=>{n.d(t,{Df:()=>i,Eq:()=>r,Pc:()=>s});var r={equals:function(e,t){return e===t}},i={equals:r.equals,compare:function(e,t){return e<t?-1:e>t?1:0}},o=(r.equals,i.compare,{concat:function(e,t){return e+t}}),s={concat:o.concat,empty:0}},229:(e,t,n)=>{n.d(t,{Df:()=>i,Eq:()=>r,HD:()=>o,xb:()=>s});var r={equals:function(e,t){return e===t}},i={equals:r.equals,compare:function(e,t){return e<t?-1:e>t?1:0}},o=function(e){return"string"==typeof e},s=function(e){return 0===e.length}},215:(e,t,n)=>{n.d(t,{GL:()=>u,HJ:()=>a,N1:()=>f,NC:()=>r,RP:()=>i,UM:()=>c,t_:()=>l});const r=performance.now(),i=(new Date).getTime();let o=[],s=!1;const u=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a((()=>e(...n)))},a=(e,t)=>{if(!s){const n=self.setTimeout(e,t);return()=>self.clearTimeout(n)}let n;const r=()=>{void 0!==n&&s&&o.length<1e4&&o.push([n,performance.now()]),n=void 0},i=[self.setTimeout((()=>{n=performance.now(),self.requestAnimationFrame(r),e()}),t),self.setTimeout(r,t)];return()=>{void 0===n&&i.forEach((e=>self.clearTimeout(e)))}},c=(e,t)=>{if(!s){const n=self.setInterval(e,t);return()=>self.clearInterval(n)}let n=!1,r=()=>{};const i=self.setInterval((()=>{r=a((()=>{n||e()}))}),t);return()=>{n=!0,r(),self.clearInterval(i)}},l=e=>new Promise(((t,n)=>e.then(u(t),u(n)))),f=e=>()=>l(e())},561:(e,t,n)=>{n.d(t,{g1:()=>G,YO:()=>I,oQ:()=>D,a9:()=>v,Ue:()=>m,gS:()=>g,D8:()=>x,VS:()=>z,xH:()=>k,En:()=>h,fF:()=>C,Hr:()=>b,UI:()=>_,u4:()=>U,Rp:()=>E,vP:()=>P,bw:()=>A,YP:()=>y});var r=n(169),i=n(507),o=n(812),s=n(991);function u(e){let t=e,n=[],r=!1;return{addListener(e){if(r)return()=>{};let i=t;const o=()=>{Object.is(t,i)||(i=t,e(t))};n=[...n,o];return()=>{n=n.filter((e=>e!==o))}},notify(e){if(r)throw new Error("Ref bug: Attempted to notify a terminated notifier");Object.is(e,t)||(t=e,n.forEach((e=>e())))},terminate(){r=!0,n=[]}}}function a(e,t){let n=0;return function(){try{if(n++>0)throw new Error(e);return t(...arguments)}finally{n--}}}function c(e,t){let n=[...new Set(e)].filter((e=>"final"!==e.state));if(0===n.length)return{state:"final",onStateChange:()=>()=>{}};const r=()=>0===n.length?"final":n.some((e=>"might_change"===e.state))?"might_change":"nominal",[i,o]=l(r(),(e=>"might_change"!==e&&t())),s=()=>o(r());return n.forEach((t=>{t.onStateChange((t=>{switch(t){case"final":n=e.filter((e=>"final"!==e.state)),s();break;case"might_change":o("might_change");break;case"nominal":s();break;default:throw new Error(`Ref bug: Invalid state ${t}`)}}))})),i}function l(e,t){if("final"===e)return[{state:"final",onStateChange:()=>()=>{}},()=>{}];const{terminate:n,notify:r,addListener:i}=u(e),o={state:e,onStateChange:i},s=a("Disallowed recursion in Branch.",(e=>{if("final"===o.state){if("final"===e)return;throw new Error(`Attempted to change state of final branch to ${e}.`)}try{t?.(e),o.state=e,r(e)}finally{"final"===e&&n()}}));return[o,s]}var f=n(289),d=n(694);const p="Ref";function m(e){const[t,n,r]=function(){const[e,t]=l("nominal"),n=a("Disallowed recursion in Branch.",(n=>{if("final"===e.state)throw new Error("Attempted to mutate a finalized Ref.");const r=e.state;try{t("might_change"),n()}finally{t(r)}}));return[e,n,()=>t("final")]}(),[i,o]=T(t,e);return[i,e=>n((()=>o(e))),r]}function g(e){let t=e.empty;const n=()=>()=>{const n=t;return t=e.empty,n},[r,i,o]=m(n());return[r,r=>{t=e.concat(t,r),i(n())},o]}function h(e,t){return n=>{let i=new Array(e).fill(t.empty);return new Array(e).fill(null).map(((e,o)=>(0,r.zG)(n,_(d.UI((e=>{const n=t.concat(i[o],e);return i=i.map(((n,r)=>r===o?t.empty:t.concat(n,e))),n}))))))}}function v(e){return{get current(){return e},onChange:()=>()=>{},branch:{state:"final",onStateChange:()=>()=>{}}}}function y(e){return t=>{const n=t.onChange(e);return e(t.current),n}}function _(e,t){if(t){const[n,r]=T(t.branch,e(t.current));return t.onChange((t=>r(e(t)))),n}return t=>_(e,t)}const S={URI:p,map:(e,t)=>_(t)(e)},I=f.YO(S),b=f.Hr(S),w=e=>z((t=>_(t)(e))),G={URI:p,of:v,map:S.map,ap:(e,t)=>w(t)(e)};function z(e,t){return t?k(_(e,t)):t=>k(_(e,t))}function k(e){if("final"===e.branch.state)return e.current;const[t,n]=function(e,t){let n=t;const r=[e.state,n.state].includes("might_change")?"might_change":"nominal",[i,o]=l(r),s=e=>t=>{switch(t){case"final":o(e().state);break;case"might_change":o("might_change");break;case"nominal":"might_change"===e().state?o("might_change"):o("nominal");break;default:throw new Error(`Ref bug: Unexpected upstream state ${t}`)}};e.onStateChange(s((()=>n)));const u=s((()=>e));let a=n.onStateChange(u);return[i,e=>{n=e,a(),a=e.onStateChange(u),u(n.state)}]}(e.branch,e.current.branch),[r,i]=T(t,e.current.current);let o=e.current.onChange(i);return e.onChange((e=>{o(),o=e.onChange(i),n(e.branch),i(e.current)})),r}function U(e){return t=>{if("final"===t.branch.state)return t;let n=i.YP;return _((t=>{if(i.Wi(n))return n=i.G(t),t;const r=e(n.value,t);return n=i.G(r),r}),t)}}function E(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{if(2===t.length){let n=t[0];return _((e=>(n=t[1](n,e),n)),e)}let n=i.bM();return _((e=>{const r=t[0](n,e);return n=i.G(r),r}),e)}}function P(){if(0===arguments.length||M(arguments.length<=0?void 0:arguments[0]))return O(...arguments);const e=arguments.length<=0?void 0:arguments[0],t=Object.keys(e);return(0,r.zG)(Object.values(e),(e=>O(...e)),_((0,r.ls)(o.Su(((e,n)=>[t[e],n])),Object.fromEntries)))}function O(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return v([]);if(1===t.length)return _((e=>[e]))(t[0]);let r=!1;t.forEach((e=>e.onChange((()=>{if("might_change"!==e.branch.state)throw new Error("Ref bug: Received a change notification without a `might_change` state.");r=!0}))));const i=t.map((0,s.vg)("branch")),o=()=>{r&&(r=!1,l(t.map((e=>e.current))))},u=c(i,o),[a,l]=T(u,t.map((e=>e.current)));return a}function C(e){const[t,n,o]=m(i.YP);return e().then((0,r.ls)(i.G,n,o)),t}function x(e){const t=e.hasOwnProperty("equals")?e.equals:e;return U(((e,n)=>t(e,n)?e:n))}function D(e){return M(e)?e:v(e)}function A(e){return t=>(y(e)(t),t)}function T(e,t){if("final"===e.state)return[v(t),()=>{}];const n=u(t);e.onStateChange((e=>{"final"===e&&n.terminate()}));let r=t;return[{get current(){return r},onChange:n.addListener,branch:e},a("Disallowed recursion in Ref.",(e=>{r=e,n.notify(r)}))]}function M(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&"function"==typeof e.onChange}},659:(e,t,n)=>{n.d(t,{Hr:()=>h,K4:()=>a,KD:()=>_,UI:()=>f,VS:()=>p,YO:()=>v,ak:()=>g,bw:()=>d,dQ:()=>c,kR:()=>S,of:()=>l,vP:()=>m,yi:()=>y});var r=n(561),i=n(169),o=n(991),s=n(450),u=n(507);const a=e=>(0,i.ls)((t=>{let{previousState:n,...r}=t;return e(r)}),(e=>({value:e,state:r.a9(void 0)}))),c=i.yR,l=(0,i.ls)(i.a9,a),f=e=>t=>(0,i.ls)(t,(0,o.rO)({value:e})),d=e=>t=>(0,i.ls)(t,(0,o.rO)({value:(0,o.bw)(e)}));function p(e){return t=>n=>{let{previousState:i,...o}=n;const s=t({previousState:Array.isArray(i)?i[0]:void 0,...o}),u=e(s.value)({previousState:Array.isArray(i)?i[1]:void 0,...o});return{value:u.value,state:r.vP(s.state,u.state)}}}function m(e){return t=>{let{previousState:n,...o}=t;const u=w(n)?n:{},a=(0,i.zG)(e,s.Su(((e,t)=>t({previousState:u[e],...o}))));return{value:(0,i.zG)(a,s.UI((e=>e.value))),state:(0,i.zG)(a,s.UI((e=>e.state)),(e=>r.vP(e)))}}}function g(e,t){return n=>(0,i.ls)((0,o.rO)({previousState:b}),(o=>{const s=n(o),u=t(s.value)({...o,previousState:o.previousState[e]});return{value:(0,i.zG)([s.value,u.value],(t=>{let[n,r]=t;if(!w(n))throw new Error("Service.bind() was passed an upstream Service with a non-record value.");return{...n,[e]:r}})),state:(0,i.zG)(r.vP(s.state,u.state),r.UI((t=>{let[n,r]=t;if(void 0===n)return{[e]:r};if(!w(n))throw new Error("Service.bind() was passed an upstream Service with a non-record state.");return{...n,[e]:r}})))}}))}const h=(e,t)=>f((n=>({...n,[e]:t(n)})));function v(e){return t=>(0,i.ls)((0,o.rO)({previousState:(0,i.ls)(b,(t=>t[e]))}),t,(0,o.rO)({value:t=>({[e]:t}),state:r.UI((t=>({[e]:t})))}))}const y=(e,t)=>{const n=t||(t=>t===e);return t=>c((s=>{let{previousState:u,...a}=s;const c=Array.isArray(u)&&2===u.length&&n(u[0])?u[1]:void 0;return(0,i.zG)({previousState:c,...a},t,(0,o.rO)({state:r.UI((t=>[e,t]))}))}))},_=e=>{const t=e.slice(0,-1),n=e.slice(-1)[0],r=[...t.map((e=>{let[t,n]=e;return[t,(0,i.a9)(n)]})),(0,i.a9)(n)];return S((0,o.lo)(r))};function S(e){return(0,i.ls)(r.UI(e),I)}function I(e){const t=(0,i.zG)(e,r.Rp(0,(e=>e+1)));return n=>{let{previousState:o,stopped:s,...a}=n;return(0,i.zG)(r.vP(e,t),r.Rp(((e,n)=>{let[c,l]=n;return(0,i.zG)(e,u.UI((e=>e.state.current)),u.fS((()=>o)),(e=>c({previousState:e,stopped:(0,i.zG)(r.vP(s,t),r.UI((e=>{let[t,n]=e;return t||n!==l}))),...a})))})),(e=>({value:r.UI((e=>e.value),e),state:r.VS((e=>e.state),e)})))}}function b(e){return w(e)?e:{}}function w(e){return"object"==typeof e&&null!==e}},882:(e,t,n)=>{n.d(t,{d:()=>f,m:()=>l});var r=n(169),i=n(144),o=n(507),s=n(561),u=n(991),a=n(659),c=n(689);const l=e=>a.dQ((t=>{let{stopped:n,previousState:a}=t;const c=function(e){return h(e)?e:{validityKey:"",lastSuccess:o.YP}}(a),l=(0,r.zG)(c,(e=>({...e,inFlight:o.YP,lastSuccess:(0,r.zG)(e.lastSuccess,o.UI(i.F2))}))),f=(0,r.zG)(e,s.UI((e=>"currentTimestampSecs"in e&&"freshness"in e&&"validity"in e?e:{currentTimestampSecs:0,validity:{key:e.validityKey,maxAge:Number.MAX_SAFE_INTEGER},freshness:{key:e.freshnessKey,maxAge:Number.MAX_SAFE_INTEGER},refresh:e.refresh})),(e=>s.vP(e,n)),s.Rp(s.a9(l),((e,t)=>{let[n,a]=t;if(a)return e;const c=n.validity.key(),l=o.hX((e=>n.currentTimestampSecs-e.timestamp<=n.validity.maxAge)),f=(0,u.HP)(n.freshness.key),d=o.hX((e=>n.currentTimestampSecs-e.timestamp<=n.freshness.maxAge&&e.freshnessKey===f())),p=(0,r.zG)(e,s.UI((0,r.ls)(o.DT((e=>e.validityKey===c)),o.EQ((()=>({validityKey:c,inFlight:o.YP,lastSuccess:o.YP})),(0,u.rO)({inFlight:l,lastSuccess:o.tS(i.EQ((e=>o.G(i.t$(e))),(0,r.ls)(o.G,l,o.UI((e=>i.F2(e))))))})))),s.D8(m()));if((0,r.zG)(p.current,(e=>(0,r.zG)(e.inFlight,o.wp((()=>(0,r.zG)(e.lastSuccess,o.tS(o.Uo)))),d,o.pC))))return p;const g=()=>({timestamp:n.currentTimestampSecs,freshnessKey:f(),output:o.YP});return(0,r.zG)(n.refresh,o.EQ((()=>p),(0,r.ls)((0,r.nn)({previous:(0,r.zG)(p.current.lastSuccess,o.tS(o.Uo),o.tS((e=>e.output)))}),s.fF,s.UI(o.EQ((()=>(0,r.zG)(p,s.UI((0,u.rO)({inFlight:()=>o.G(g())})))),i.EQ((e=>(0,r.zG)(p,s.UI((0,u.rO)({inFlight:()=>o.YP,lastSuccess:(0,r.ls)(o.tS((0,r.ls)(o.Uo,o.hX((e=>o.pC(e.output))))),i.Yo((()=>e)),o.G)})))),(e=>s.a9({validityKey:c,inFlight:o.YP,lastSuccess:o.G(i.F2({...g(),output:o.G(e)}))}))))),s.xH)))})),s.xH,s.D8(m())),d=(0,r.zG)(f,s.UI((e=>({validityKey:e.validityKey,lastSuccess:(0,r.zG)(e.lastSuccess,o.tS(o.Uo))}))),s.D8(g())),p=(0,r.zG)(d,s.Rp(-1,(e=>e+1)));return{value:(0,r.zG)(f,s.UI((0,r.ls)((0,u.vg)("lastSuccess"),o.UI(i.UI((e=>e.output))),o.fS((()=>i.F2(o.YP)))))),state:(0,r.zG)(s.vP(d,p),s.UI((e=>{let[t,n]=e;return n>0?t:g().equals(t,c)?a:t})))}})),f=e=>t=>(0,r.ls)((0,u.rO)({previousState:(0,r.ls)(o.DT(h),o.YO("s1"),o.Hr("s2",(t=>{let{s1:n}=t;return(0,r.zG)(n,(0,u.rO)({lastSuccess:o.UI((0,u.rO)({output:o.tS(e)}))}))})),o.UI((e=>{let{s1:t,s2:n}=e;return g().equals(t,n)?t:n})),o.FS)}),t),d=()=>c.n_({freshnessKey:(0,u.Or)(),timestamp:(0,u.Or)(),output:o.Eh((0,u.Or)())});function p(e){return"object"==typeof e&&null!==e&&(!(!("freshnessKey"in e)||!v(e.freshnessKey))&&("timestamp"in e&&"number"==typeof e.timestamp&&!(!("output"in e)||!(0,u.El)(e.output))))}const m=()=>c.n_({validityKey:(0,u.Or)(),inFlight:o.Eh(d()),lastSuccess:o.Eh(i.Eh((0,u.Or)(),d()))}),g=()=>c.n_({validityKey:(0,u.Or)(),lastSuccess:o.Eh(d())});function h(e){return"object"==typeof e&&null!==e&&(!(!("validityKey"in e)||!v(e.validityKey))&&!!("lastSuccess"in e&&(0,u.El)(e.lastSuccess)&&(0,r.zG)(e.lastSuccess,o.EQ((()=>!0),p))))}function v(e){return null===e||"string"==typeof e||"number"==typeof e}},696:(e,t,n)=>{n.r(t),n.d(t,{PermutiveActivationManagerWeb:()=>s,optimisedActivationsConfig:()=>o});class r{logger;permutive;id;segmentCode;triggerType;config;workspaceLevelConfig;prefix="[Activation]";constructor(e,t,n,r,i,o,s){this.logger=e,this.permutive=t,this.id=n,this.segmentCode=r,this.triggerType=i,this.config=o,this.workspaceLevelConfig=s}getSegmentCode(){return this.segmentCode}getTriggerType(){return this.triggerType}getConfig(){return this.config}getWorkspaceLevelConfig(){return this.workspaceLevelConfig}trackImpression(e){return this.trackActivation("impression",e)}trackConversion(e){return this.trackActivation("conversion",e)}trackActivation(e,t){const n={reaction_id:this.id,type:e};this.permutive.track("Reaction",n,t),this.logger.log(this.prefix,n.type,n)}}var i=n(187);const o={dfp:{dfp:[],dfp_legacy:{}},eyeota_pixel:[],dbm:{omitted:0},appnexus:{244785:41131223,244786:41134074,244787:41154503,245780:41167435,245781:41167450,245782:41167454,245901:41227167,245902:41227170,245903:41227168},appnexus_adserver:[244787,244786,244785,245780,245782,245781,245903,245902,245901],nativo:[],rubicon_ssp:[],smart:[],freewheel:[],adswizz_keyvalue:[],curation_platforms:{adv:["adv"]}};class s{logger;permutive;clientContext;constructor(e,t,n){this.logger=e,this.permutive=t,this.clientContext=n}getSpecializedActivations(e){return o[e]}getActivations(e){return(0,i.Hn)(e)("activationConfigs",[]).filter((e=>this.areContextCriteriaSatisfied(e))).map((e=>new r(this.logger,this.permutive,e.id,e.sc,e.tt,e.c,e.wc)))}areContextCriteriaSatisfied(e){const t=e.cc,n=e=>{const t=this.clientContext.getContext()[e.key];switch(e.comparison){case"EQUALS":return t===e.value;case"NOT_EQUALS":return t!==e.value;case"CONTAINS":return"string"==typeof t&&t.indexOf(e.value)>=0;case"NOT_CONTAINS":return"string"==typeof t&&t.indexOf(e.value)<0}};return!t||("AND"===(r=t).operator?r.criteria.every(n):r.criteria.some(n));var r}}},187:(e,t,n)=>{n.d(t,{Hn:()=>i});const r={web:{auto_init:!1,track_pageview_engagement:!0,track_form_submission:!1,track_link_click:!0,track_pageview_complete:!0,add_alchemy_taxonomy:!1,add_alchemy_entities:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]},appnexus:{auto_init:!0,member_id:977,activationConfigs:[]},appnexus_adserver:{auto_init:!0,activationConfigs:[]}},i=e=>{const t=r[e];return(e,n)=>t?.[e]??n};i("web"),i("dfp"),i("facebook_pixel_v2")},620:(e,t,n)=>{n.d(t,{X:()=>i,k:()=>r});const r=e=>({id:e.id,name:e.name,time:new Date(e.time),properties:e.properties||{},session_id:e.session_id,view_id:e.view_id}),i=e=>({id:e.id,name:e.name,time:(o(e.time)?e.time:new Date).toISOString(),properties:e.properties||{},session_id:e.session_id,view_id:e.view_id}),o=e=>isFinite(e)&&e instanceof Date},823:(e,t,n)=>{n.d(t,{F:()=>c,I:()=>a});var r=n(561),i=n(694),o=n(812),s=n(169),u=n(991);const a=(e,t)=>{let n=!1;return r.UI(i.UI((0,u.bw)((r=>{n||(n=(0,s.zG)(r,o.G((e=>{let[,t]=e;return"Pageview"===t.name}))),n&&e.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:t,time_origin:"sdk_init"}))}))))},c=(e,t)=>{const n=a(e,t);return(0,s.ls)(r.En(2,o.uZ()),(e=>{let[t,i]=e;return(0,s.zG)(i,n,r.UI((e=>e()))),t}))}},936:(e,t,n)=>{n.r(t),n.d(t,{service:()=>So});var r=n(169),i=n(659),o=n(561),s=n(507),u=n(643);const a=e=>{const t=e.current;return(0,r.zG)(e,o.UI((e=>e===t?{segmentsEntered:[],segmentsExited:[]}:{segmentsEntered:(0,r.zG)(e,l(t)),segmentsExited:(0,r.zG)(t,l(e))})))},c=e=>new Set(e),l=e=>t=>(0,r.zG)(t,f((t=>!e.has(t)))),f=e=>t=>{const n=[];return t.forEach((t=>e(t)&&n.push(t))),n};var d=n(694),p=n(215),m=n(991);const g=()=>({kind:"null",value:null}),h=e=>({kind:"string",value:e}),v=e=>({kind:"number",value:e}),y=e=>({kind:"array",value:e}),_=e=>({kind:"object",value:e}),S=e=>e,I=()=>({kind:"bottom"}),b=e=>({kind:"inner",a:e}),w=e=>({kind:"top",error:e}),G=e=>({kind:"unbounded",group:e}),z=(e,t)=>({kind:"windowed",key:t,group:e}),k=(e,t,n)=>({kind:"countLimit",n,limit:t,group:e}),U=(e,t,n)=>({kind:"uniqueLimit",n,limit:t,group:e}),E=e=>({kind:"numberGroup",group:e}),P=e=>({kind:"stringGroup",group:e}),O=e=>({kind:"tuple",tuple:e}),C=e=>({state:e}),x=(e,t)=>({commands:e,payload:t});var D=n(856),A=n(229);const T=(e,t)=>{switch(e.kind){case"bottom":return{kind:"bottom"};case"inner":return b(t(e.a));case"top":return w(e.error)}},M=e=>(0,D.Zt)(((t,n)=>{if("bottom"===t.kind&&"bottom"===n.kind)return 0;if("bottom"===t.kind)return-1;if("bottom"===n.kind)return 1;if("top"===t.kind&&"top"===n.kind)return A.Df.compare(t.error,n.error);if("top"===t.kind)return 1;if("top"===n.kind)return-1;if("inner"===t.kind&&"inner"===n.kind)return e.compare(t.a,n.a);throw new Error("Non exhaustive match in extendedAlgebraOrd")}));var q=n(606),R=n(340),j=n(144),L=function(e){return-1===e?1:1===e?-1:0};function F(e,t){return(0,R.oA)(e.map(t))}function $(e,t,n,r){const i=(e,t)=>{if(0===e.length)return(0,R.oA)(t.map((e=>(0,s.G)({1:e[1],2:n(s.YP,(0,s.G)(e[2]))}))));if(0===t.length)return(0,R.oA)(e.map((e=>(0,s.G)({1:e[1],2:n((0,s.G)(e[2]),s.YP)}))));if(e.length>0&&t.length>0&&(0,D.lt)(r)(e[0][1],t[0][1])){const[r,...o]=e,u=r[1],a=r[2];return(0,R.Ce)({1:u,2:n((0,s.G)(a),s.YP)})(i(o,t))}if(e.length>0&&t.length>0&&(0,D.gt)(r)(e[0][1],t[0][1])){const[r,...o]=t,u=r[1],a=r[2];return(0,R.Ce)({1:u,2:n(s.YP,(0,s.G)(a))})(i(e,o))}if(e.length>0&&t.length>0){const[r,...o]=e,[u,...a]=t,c=r[1],l=r[2],f=u[2];return(0,R.Ce)({1:c,2:n((0,s.G)(l),(0,s.G)(f))})(i(o,a))}throw new Error("Non exhaustive match in mapOption2")},o=(0,D.Uz)((e=>e[1]))(r),u=(e=>{const t=F(e,(e=>(0,s.pC)(e[2])?(0,s.G)({1:e[1],2:e[2].value}):s.YP));return 0===t.length?s.YP:(0,s.G)(t)})(i((0,R.DY)(o)([...e].map((e=>({1:e[0],2:e[1]})))),(0,R.DY)(o)([...t].map((e=>({1:e[0],2:e[1]}))))));return(0,s.UI)((e=>new Map(e.map((e=>[e[1],e[2]])))))(u)}function Q(e,t,n,r){const i=(0,D.Uz)((e=>e[0]))(r),o=(0,R.DY)(i)([...t]).reduceRight(((e,t)=>{if((0,j.nM)(e)){const r=n(t[1],e.left);return(0,s.pC)(r)?(0,j.t$)(r.value):(0,j.F2)(t[0])}return e}),(0,j.t$)(e));return(0,s.Uo)(o)}function Y(e,t){return new Map([...e].map(t))}function N(e,t){return new Map([...e].filter(t))}var B=n(689),H=n(52);function V(e){return JSON.stringify(K(e))}function K(e){switch(e.kind){case"null":return J.encode(e);case"string":return Z.encode(e);case"number":return ee.encode(e);case"array":return te.encode(e);case"object":return ne.encode(e)}}function W(e){return null===e?J.decode(e):"number"==typeof e?ee.decode(e):"string"==typeof e?Z.decode(e):Array.isArray(e)?te.decode(e):ne.decode(e)}const X=(e,t)=>(0,j.t$)(`Failed to decode. Input was ${JSON.stringify(e)}. Codec type was ${t}`),J={encode:e=>null,decode:e=>null===e?(0,j.F2)({kind:"null",value:null}):X(e,"SimpleNull")},Z={encode:e=>e.value,decode:e=>"string"==typeof e?(0,j.F2)(h(e)):X(e,"SimpleString")},ee={encode:e=>e.value,decode:e=>"number"==typeof e?(0,j.F2)(v(e)):X(e,"SimpleNumber")},te={encode:e=>e.value.map(K),decode:e=>{if(Array.isArray(e)){const t=(0,R.fw)(j.g1)(W)(e);return(0,j.UI)(y)(t)}return X(e,"SimpleArray")}},ne={encode:e=>{const t=[...e.value.entries()];return Object.assign({},...Array.from(t,(e=>{let[t,n]=e;return{[t]:K(n)}})))},decode:e=>{if(e&&e.constructor===Object){const t=(0,R.fw)(j.g1)((e=>{let[t,n]=e;return(0,r.zG)(W(n),(0,j.UI)((e=>(0,r.bc)(t,e))))}))(Object.entries(e));return(0,j.UI)((e=>_(new Map([...e]))))(t)}return X(e,"SimpleObject")}};function re(e){return(0,r.zG)(e,oe,(0,s.UI)(V),(0,s.fS)((()=>"<encode error>")))}function ie(e){return(0,s.UI)(fe)(function(e){switch(e.state.kind){case"top":return(0,s.G)(h(e.state.error));case"bottom":return s.YP;case"inner":return oe(e.state.a)}}(e))}function oe(e){return function(e){switch(e.kind){case"numberGroup":case"stringGroup":return se(e.group);case"tuple":return e.tuple.length>0}}(e.payload)?(0,s.G)(y(function(e,t){const n=(0,s.UI)((e=>(0,R.Ce)(e)(t)))(e);return(0,s.fS)((()=>t))(n)}((0,s.UI)((e=>h(function(e){const t=e=>(0,s.EQ)((()=>""),(e=>"b"+JSON.stringify(e)))(e.bound),n=e=>{switch(e.operation){case"add":return"p";case"mul":return"m";case"max":return"v";case"min":return"n"}},r=e=>{const r=t(e[1])+n(e[1]);return 1===e[2]?r:r+JSON.stringify(e[2])};return e.map(r).join("")}(e))))(e.commands),function(e){const t=e=>{switch(e.kind){case"bottom":return{kind:"null",value:null};case"top":return h(e.error);case"inner":return v(e.a)}},n=e=>F([ue,ae,e=>(0,r.zG)(e,le,_,s.G)],(t=>t(e))),i=e=>F([ue,ce,e=>(0,r.zG)(e,le,(e=>Y(e,(e=>{let[t,n]=e;return[JSON.stringify(t),n]}))),_,s.G)],(t=>t(e)));switch(e.kind){case"tuple":return e.tuple.map(t);case"stringGroup":return n(e.group);case"numberGroup":return i(e.group)}}(e.payload)))):s.YP}function se(e){switch(e.kind){case"unbounded":return e.group.size>0;case"windowed":return e.group.size>0||(0,s.pC)(e.key);case"countLimit":case"uniqueLimit":return e.group.size>0||(0,s.pC)(e.limit)}}function ue(e){switch(e.kind){case"unbounded":return s.YP;case"windowed":return(0,s.G)(h("w"));case"countLimit":return(0,s.G)(h(1===e.n?"x":`x${e.n}`));case"uniqueLimit":return(0,s.G)(h(1===e.n?"u":`u${e.n}`))}}function ae(e){switch(e.kind){case"unbounded":return s.YP;case"windowed":return(0,s.G)(h((0,s.pC)(e.key)?e.key.value:""));case"countLimit":case"uniqueLimit":return(0,s.G)(h((0,s.pC)(e.limit)?e.limit.value:""))}}function ce(e){switch(e.kind){case"unbounded":return s.YP;case"windowed":return(0,s.pC)(e.key)?(0,s.G)(v(e.key.value)):(0,s.G)({kind:"null",value:null});case"countLimit":case"uniqueLimit":return(0,s.pC)(e.limit)?(0,s.G)(v(e.limit.value)):(0,s.G)({kind:"null",value:null})}}function le(e){switch(e.kind){case"unbounded":case"windowed":case"countLimit":case"uniqueLimit":return e.group}}function fe(e){switch(e.kind){case"array":return 0===e.value.length?{kind:"null",value:null}:1===e.value.length?fe(e.value[0]):y(e.value.map(fe));case"object":return(0,r.zG)(N(e.value,(e=>{let[t,n]=e;return"null"!==n.kind})),(e=>Y(e,(e=>[e[0],fe(e[1])]))),_);default:return e}}function de(e){const t=e=>{if(0===e.length)return{kind:"bottom"};const t=(e=>{if(4!==e.length)return s.YP;const[t,n,r,i]=e;if("string"===t.kind&&"string"===n.kind&&"object"===i.kind){const e=(0,s.DT)((e=>pe(e[1].value)&&me(e[2].value)))({1:t,2:n});return(0,s.UI)((e=>({prim:e[1].value,grp:e[2].value,cutoff:r,m:i.value})))(e)}return s.YP})(e);if((0,s.pC)(t)){const{prim:e,grp:n,cutoff:r,m:i}=t.value,o=ge(r,i,he(n));return"string"==typeof o?w(o):b(x(ve(e),o))}const n=(e=>{if(3!==e.length)return s.YP;const[t,n,r]=e;if("string"===t.kind&&"object"===r.kind){const e=(0,s.DT)((e=>me(e.value)))(t);return(0,s.UI)((e=>({grp:e.value,cutoff:n,m:r.value})))(e)}return s.YP})(e);if((0,s.pC)(n)){const{grp:e,cutoff:t,m:r}=n.value,i=ge(t,r,he(e));return"string"==typeof i?w(i):b(x(s.YP,i))}const r=(e=>{if(2!==e.length)return s.YP;const[t,n]=e;if("string"===t.kind&&"object"===n.kind){const e=(0,s.DT)((e=>pe(e.value)))(t);return(0,s.UI)((e=>({prim:e.value,m:n.value})))(e)}return s.YP})(e);if((0,s.pC)(r)){const{prim:e,m:t}=r.value;return b(x(ve(e),P(G(t))))}const i=(e=>{if(1!==e.length)return s.YP;const[t]=e;return"object"===t.kind?(0,s.G)({m:t.value}):s.YP})(e);if((0,s.pC)(i)){const{m:e}=i.value;return b(x(s.YP,P(G(e))))}const o=(e=>{if(e.length<1)return s.YP;const[t,...n]=e;if("string"===t.kind){const e=(0,s.DT)((e=>pe(e.value)))(t);return(0,s.UI)((e=>({prim:e.value,rest:n})))(e)}return s.YP})(e);if((0,s.pC)(o)){const{prim:e,rest:t}=o.value;return b(x(ve(e),_e(t)))}return b(x(s.YP,_e(e)))},n=e=>"array"===e.kind?(0,R.tS)(n)(e.value):[e];return"null"===e.kind?C({kind:"bottom"}):C(t(n(e)))}function pe(e){const t=e.split("");if(!0==(0===t.length))return!1;{const[e,...n]=t;return-1!=="bpmvn".indexOf(e)&&n.every((e=>-1!=="bpmvn0123456789.".indexOf(e)))}}function me(e){const t=e.split("");switch(!0){case 0===t.length:return!1;case"w"===t[0]&&void 0===t[1]:return!0;default:{const[e,...n]=t;return-1!=="ux".indexOf(e)&&-1===n.map((e=>!isNaN(parseInt(e)))).indexOf(!1)}}}function ge(e,t,n){switch(e.kind){case"string":return P(n({1:(0,s.G)(e.value),2:t}));case"number":case"null":return E(n({1:"null"===e.kind?s.YP:(0,s.G)(e.value),2:N(Y(t,(e=>{let[t,n]=e;return[Number(t),n]})),(e=>!isNaN(e[0])))}));default:return"{bad cutoff}"}}function he(e){const t=e=>t=>U(t[2],t[1],e),n=e=>t=>k(t[2],t[1],e),r=e.split("");switch(!0){case"w"===r[0]&&void 0===r[1]:return e=>z(e[2],e[1]);case"u"===r[0]&&void 0===r[1]:return t(1);case"u"===r[0]&&void 0!==r[1]:return t(parseInt(r.slice(1).join("")));case"x"===r[0]&&void 0===r[1]:return n(1);case"x"===r[0]&&void 0!==r[1]:return n(parseInt(r.slice(1).join("")));default:throw new Error("This should never happen if you use isGroupCommand")}}function ve(e){const t=e=>(0,s.Wi)(e.bound)||"add"===e.operation||"mul"===e.operation?(0,s.G)(e):s.YP,n=(e,n,i)=>{const o=((e,n)=>(0,r.zG)(e,(e=>{switch(e){case"p":return(0,s.G)("add");case"m":return(0,s.G)("mul");case"v":return(0,s.G)("max");case"n":return(0,s.G)("min");default:return s.YP}}),s.UI((e=>({operation:e,bound:n}))),s.tS(t)))(e,i);return(0,s.UI)((e=>{const{init:t,rest:r}=(0,R.zT)((e=>{return"number"==typeof(t=parseInt(e))&&isFinite(t)&&Math.floor(t)===t;var t}))(n);return{1:{1:e,2:0===t.length?1:parseInt(t.join(""))},2:r.join("")}}))(o)};return(0,s.UI)(S)((0,q.nI)(ye(e,(e=>{const t=e.split("");if(0===t.length)return s.YP;const[i,...o]=t;if("b"===i){const{init:e,rest:t}=(0,r.zG)(o,(0,R.zT)((e=>-1!=="1234567890.".indexOf(e))));if(0===e.length||0===t.length)return s.YP;const i=parseFloat(e.join("")),[u,...a]=t;return n(u,a,(0,s.G)(i))}return n(i,o,s.YP)}))))}function ye(e,t){const n=t(e);return(0,s.fS)((()=>[]))((0,s.UI)((e=>[e[1]].concat(ye(e[2],t))))(n))}function _e(e){return O(e.map(Se))}function Se(e){switch(e.kind){case"number":return b(e.value);case"string":return w(e.value);case"null":return{kind:"bottom"};case"object":return w("{object}");case"array":return w("{array}")}}var Ie=n(945);const be={strategy:(e,t,n)=>r=>{if((0,s.Wi)(n))return t;if("delta"===e&&(0,s.Wi)(t))return s.YP;if((0,s.Wi)(t))return n;if((0,s.pC)(t)&&(0,s.pC)(n))return r(t.value,n.value);throw new Error("Non exhaustive match in combineCommand.strategy")},operation:(e,t,n,i,o,u)=>{const a=(0,R.pR)(M(u)),c=(0,r.zG)(t.bound,s.EQ((()=>r.yR),(e=>t=>(0,D.VV)(u)(o.fromNumber(e),t))));if("append"===e&&"add"===t.operation)return(0,R.yL)(n,i,Pe("append",(0,r.ls)(o.plus,c)));if("append"===e&&"mul"===t.operation)return(0,R.yL)(n,i,Pe("append",(0,r.ls)(o.times,c)));if("append"===e&&"max"===t.operation)return(0,D.Fp)(a)(n,i);if("join"===e&&"add"===t.operation)return(0,R.yL)(n,i,Pe("join",(0,D.Fp)(u)));if("join"===e&&"mul"===t.operation)return(0,R.yL)(n,i,Pe("join",(0,D.Fp)(u)));if("join"===e&&"max"===t.operation)return(0,D.Fp)(a)(n,i);if("min"===t.operation)return be.operation(e,{operation:"max",bound:t.bound},n,i,o,function(e){return(0,D.Zt)(((t,n)=>L(e.compare(t,n))))}(u));if("delta"===e&&"max"===t.operation)return(0,D.gt)(a)(n,i)?n:i.map(I);if("delta"===e)return(0,R.yL)(n,i,((e,t)=>(0,D.gt)(M(u))(e,t)?T(e,c):{kind:"bottom"}));throw new Error("Non exhaustive match in combineCommand.operation")},extend:(e,t,n,r)=>{if("delta"===e&&"top"===n.kind&&"top"===r.kind)return(0,D.gt)(A.Df)(n.error,r.error)?w(n.error):{kind:"bottom"};if("delta"===e&&"bottom"===r.kind)return n;if("delta"===e&&"bottom"===n.kind)return{kind:"bottom"};if("top"===n.kind&&"top"===r.kind)return w((0,D.Fp)(A.Df)(n.error,r.error));if("top"===n.kind)return n;if("top"===r.kind)return r;if("inner"===n.kind&&"inner"===r.kind)return t(n.a,r.a);if("bottom"===n.kind)return r;if("bottom"===r.kind)return n;throw new Error("Non exhaustive match in extend")}},we={fromNumber:r.yR,plus:(e,t)=>e+t,times:(e,t)=>e*t};function Ge(e,t,n,r){if("unbounded"===e.kind&&"unbounded"===t.kind){const i=e.group,o=t.group;return(0,s.fS)(I)((0,s.UI)((e=>b(G(e))))($(i,o,n,r)))}if("windowed"===e.kind&&"windowed"===t.kind){const i=e.key,o=e.group,u=t.key,a=t.group,c=(0,D.Fp)((0,s.pR)(r))(i,u);return(0,s.fS)(I)((0,s.UI)((e=>b(z(e,c))))($(o,a,n,r)))}if("countLimit"===e.kind&&"countLimit"===t.kind){const i=e.n,o=t.n;if(i===o){const o=e.limit,u=e.group,a=t.limit,c=t.group,l=(0,D.Fp)((0,s.pR)(r))(o,a);return(0,s.fS)(I)((0,s.UI)((e=>b(k(e,l,i))))($(u,c,n,r)))}return w("Non matching counts")}if("uniqueLimit"===e.kind&&"uniqueLimit"===t.kind){const i=e.n,o=t.n;if(i===o){const o=e.limit,u=e.group,a=t.limit,c=t.group,l=(0,D.Fp)((0,s.pR)(r))(o,a);return(0,s.fS)(I)((0,s.UI)((e=>b(U(e,l,i))))($(u,c,n,r)))}return w("Non matching counts")}return w("Non matching group types")}function ze(e,t,n){return(0,s.fS)(g)(ke(e,s.YP)(t,n))}function ke(e,t){const n=t=>(n,r)=>be.strategy(e,n,r)(ke(e,t)),i=(t,r,i)=>{if("stringGroup"===r.kind&&"stringGroup"===i.kind){const e=Ge(r.group,i.group,n(t),A.Df);return T(e,(e=>P(Ee(e,A.Df))))}if("numberGroup"===r.kind&&"numberGroup"===i.kind){const e=Ge(r.group,i.group,n(t),H.Df);return T(e,(e=>E(Ee(e,H.Df))))}if("tuple"===r.kind&&"tuple"===i.kind){const n=(0,s.pC)(t)?t.value:[];return b(O(function(e,t,n,r,i,o){const u=(e,t)=>({1:(0,R.ke)(e)(t).concat((0,R.KB)(Math.max(0,e-t.length),I)),2:(0,R.md)(e)(t)}),a=(t,n,r)=>{if(0===t.length)return be.operation(e,{operation:"max",bound:s.YP},n,r,i,o);if(t.length>0){const[s,...c]=t,l=u(s[2],n),f=l[1],d=l[2],p=u(s[2],r),m=p[1],g=p[2];return be.operation(e,s[1],f,m,i,o).concat(a(c,d,g))}throw new Error("Non exhaustive match in recurse")};return(0,R.GY)((0,R.Qp)((e=>"bottom"===e.kind))((0,R.GY)(a(t,n,r))))}(e,n,r.tuple,i.tuple,we,H.Df)))}throw new Error(`Non matching payload. Got ${r.kind} and ${i.kind}`)},o=(e,n)=>{if((0,s.Eh)((0,q.Eh)((0,B.n_)({1:(0,B.n_)({operation:A.Eq,bound:(0,s.Eh)(H.Eq)}),2:H.Eq}))).equals(e.commands,n.commands)){const r=(0,s.Wi)(e.commands)?t:e.commands,o=i(r,e.payload,n.payload);return T(o,(t=>x(e.commands,t)))}if(o=e.commands,u=n.commands,(0,s.Eh)((0,q.Eh)((0,B.n_)({1:(0,B.n_)({operation:A.Eq}),2:H.Eq}))).equals(o,u)){const o=(0,r.zG)(((e,t)=>(0,r.zG)((0,Ie.gz)(s.G5)(e,t),(0,s.UI)((e=>{let[t,n]=e;return q.yL(t,n,((e,t)=>({1:{operation:e[1].operation,bound:(0,r.zG)((0,Ie.gz)(s.G5)(e[1].bound,t[1].bound),s.UI((e=>{let[t,n]=e;return Math.min(t,n)})),s.wp((()=>e[1].bound)),s.wp((()=>t[1].bound)))},2:e[2]})))}))))(e.commands,n.commands),s.wp((()=>t))),u=i(o,e.payload,n.payload);return T(u,(e=>x(o,e)))}throw new Error(`Non matching primitive strings. Got ${re(e)} and ${re(n)}`);var o,u};return(t,n)=>ie(C(be.extend(e,o,de(t).state,de(n).state)))}function Ue(e,t,n){const r=(0,s.UI)((t=>N(e,(e=>{let[r,i]=e;return(0,D.gf)(n)(r,t)}))))(t);return(0,s.fS)((()=>e))(r)}function Ee(e,t){switch(e.kind){case"unbounded":return e;case"windowed":return(0,s.Wi)(e.key)?e:z(Ue(e.group,e.key,t),e.key);case"countLimit":{const n=e.limit,r=e.n,i=e.group,o=Q(r,i,((e,t)=>t<=1?s.YP:(0,s.G)(t-1)),t),u=(0,D.Fp)((0,s.pR)(t))(n,o);return k(Ue(i,u,t),u,r)}case"uniqueLimit":{const n=e.limit,r=e.n,i=e.group,o=(e,t)=>{if("object"===e.kind){const n=[...e.value.keys(),...t.keys()],i=new Set(n);return i.size>=r?s.YP:(0,s.G)(i)}return s.YP},u=Q(new Set,i,o,t),a=(0,D.Fp)((0,s.pR)(t))(n,u);return U(Ue(i,a,t),a,r)}}}function Pe(e,t){return(n,r)=>be.extend(e,((e,n)=>b(t(e,n))),n,r)}function Oe(e,t){return ze("append",e,t)}function Ce(e,t){return ze("join",e,t)}var xe=n(450),De=n(327),Ae=n(6),Te=n(335),Me=n(289),qe=n(49);function Re(e,t){return function(n){return e.map(n,t.compact)}}function je(e,t,n){var i=Re(e,t),o=(0,Me.UI)(e,n);return function(e){return qe.s4(i((0,r.zG)(e,o(s.IS))),i((0,r.zG)(e,o(s.EK))))}}function Le(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.filter(e,n)}))}}}function Fe(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.filterMap(e,n)}))}}}function $e(e,t){var n=Le(e,t);return function(e){var t=n((0,De.ff)(e)),r=n(e);return function(e){return(0,qe.s4)(t(e),r(e))}}}function Qe(e,t){var n=Fe(e,t);return function(e){return function(t){return(0,qe.s4)((0,r.zG)(t,n((function(t){return(0,s.IS)(e(t))}))),(0,r.zG)(t,n((function(t){return(0,s.EK)(e(t))}))))}}}var Ye=n(755),Ne=n(241),Be=n(614);function He(e){return(0,r.ls)(s.G,e.of)}function Ve(e){return(0,r.a9)(e.of(s.YP))}function Ke(e){return function(t){return e.map(t,s.G)}}function We(e){return(0,r.ls)(s.ij,e.of)}function Xe(e){var t=We(e);return function(e){return(0,r.ls)(e,t)}}function Je(e){var t=at(e),n=Xe(e);return function(e){return t(n(e))}}function Ze(e){return function(t){return(0,r.ls)(t,e.of)}}function et(e){var t=at(e),n=Ze(e);return function(e){return t(n(e))}}function tt(e){return function(t){return function(n){return e.of(s.DT(t)(n))}}}function nt(e){return(0,r.ls)(s.Uo,e.of)}function rt(e){return function(t,n){return function(r){return e.map(r,s.EQ(t,n))}}}function it(e){return function(t,n){return function(r){return e.chain(r,s.EQ(t,n))}}}function ot(e){return function(t){return function(n){return e.chain(n,s.EQ(t,e.of))}}}function st(e){return(0,Me.UI)(e,s.dO)}function ut(e){return(0,Ie.ap)(e,s.G5)}function at(e){var t=Ve(e);return function(n){return function(r){return e.chain(r,s.EQ((function(){return t()}),n))}}}function ct(e){var t=He(e);return function(n){return function(r){return e.chain(r,s.EQ(n,t))}}}var lt=n(46),ft=He(lt.PM),dt=(lt.PM,lt.of),pt=(lt.PM,function(e){return mt(lt.tD(e))}),mt=Ke(lt.dO),gt=lt.UI(s.Uo),ht=(lt.dO,it(lt.qo)),vt=(lt.UA,lt.PM,lt.PM,lt.UA,lt.PM,et(lt.UA)),yt=st(lt.dO),_t=ut(lt.Hi),St=ft,It=at(lt.UA),bt=(lt.UA,lt.PM,lt.dO,s.Ri,lt.dO,s.Ri,s.dO,Le(lt.dO,s.xu)),wt=(lt.dO,s.xu,lt.dO,s.xu,lt.dO,s.xu,function(e,t){return(0,r.zG)(e,yt(t))}),Gt=function(e,t){return(0,r.zG)(e,_t(t))},zt=function(e,t){return(0,r.zG)(e,It(t))},kt="TaskOption",Ut={URI:kt,map:wt},Et={URI:kt,map:wt,ap:Gt,chain:zt},Pt={URI:kt,fromIO:pt},Ot=(0,Ye.At)(Pt,Et),Ct={URI:kt,fromIO:pt,fromTask:mt},xt=(0,Ne.wt)(Ct),Dt=(0,Ne.oU)(Ct,Et),At=(Be.F4,(0,Me.Hr)(Ut)),Tt=(0,Te.a)(Et),Mt=(Be.Xl,He(d.PM)),qt=(d.PM,d.of,d.PM,d.dO,s.Uo,d.dO,d.qo,d.UA,d.UI(s.FS),d.UI(s.WG),d.PM,d.PM,d.UA,d.PM,d.UA,d.dO,d.G5,Mt),Rt=(d.UA,ct(d.UA)),jt=(d.PM,d.dO,s.Ri,d.dO,s.Ri,s.dO,d.dO,s.xu,d.dO,s.xu,d.dO,s.xu,d.dO,s.xu,Be.F4,Be.Xl,n(812));const Lt=new Set(["AdRequest","Reaction","PageviewEngagement","SegmentEntry","SegmentExit"]),Ft=e=>i.dQ((t=>{let{previousState:n}=t;const[i,u]=o.Ue(!1);const[a,c]=o.gS({empty:s.YP,concat:(e,t)=>(0,r.zG)(jt.oA([e,t]),s.DT(jt.Od),s.UI((e=>e.reduce(((e,t)=>({...e,...t}))))))}),l=(0,r.zG)((0,m.Kn)(n)?n:{},(0,m.rO)({stateOffset:(0,r.ls)(s.DT(m.BJ),s.fS((()=>0))),fetchUnseenKey:(0,r.ls)(s.DT(m.HD),s.fS((()=>"")))})),f=(0,r.zG)(o.gS(s.uZ({concat:function(e,t){return Object.assign({},e,t)}})),(t=>{let[n,i]=t;return(0,r.zG)(o.vP(e.lastProcessedEvents,e.internalStateDiff,e.queryLanguageProcessing),o.bw((e=>{let[t,n,r]=e;if(r)return;return t().filter((e=>!Lt.has(e.name))).length>0?i(n()):void 0}))),(0,r.zG)(o.vP({internalStateDiff:n,internalStateMap:e.internalStateMap}),o.D8(((e,t)=>e.internalStateDiff===t.internalStateDiff)))})),d=(0,r.zG)(o.vP(e.sessionId,f,i),o.Rp(o.a9({...l,inFlightRequest:!1,previousDecodedState:(0,r.zG)(e.internalStateMap.current,Qt,W,j.fS((()=>_(new Map)))),sendFullStateWithUnseen:!1}),((t,n)=>{let[i,{internalStateDiff:u,internalStateMap:a},l]=n;return(0,r.zG)(t,o.VS((t=>{if(t.inFlightRequest)return o.a9(t);const n=!l&&t.sendFullStateWithUnseen,f=n||!e.groupIdIsNewlyGenerated&&i!==t.fetchUnseenKey;return(0,r.zG)(n?qt(a):u,Rt((()=>()=>(0,r.zG)({},s.DT((()=>f))))),lt.tD,It((0,r.ls)(Nt(t.previousDecodedState),Ae.Vn((0,m.bw)((t=>e.logger.error(t)))),gt)),ht((()=>lt.of({...t,inFlightRequest:!1})),(0,r.ls)(lt.of,lt.ak("processed",(n=>(0,r.zG)(e,$t({delta:n.delta,stateOffset:t.stateOffset,fetchUnseen:f}),lt.UI((0,m.bw)((0,r.ls)(s.UI((0,m.vg)("stateDelta")),s.hX(De.ff(xe.xb)),c)))))),lt.UI((e=>({fetchUnseenKey:i,inFlightRequest:!1,sendFullStateWithUnseen:t.sendFullStateWithUnseen&&!n,previousDecodedState:e.decodedState,stateOffset:(0,r.zG)(e.processed,s.UI((e=>e.response.state_offset)),s.fS((()=>t.stateOffset)))}))))),o.fF,o.UI(s.fS((()=>({...t,inFlightRequest:!0})))))})))})),o.xH,o.UI((e=>({stateOffset:e.stateOffset,fetchUnseenKey:e.fetchUnseenKey}))),o.D8((0,B.MW)({stateOffset:H.Eq,fetchUnseenKey:A.Eq})));return{state:d,value:{externalStateDelta:a}}})),$t=e=>t=>(0,r.zG)(e,s.DT((e=>e.fetchUnseen||De.ff(xe.xb)(e.delta))),dt,It((e=>{return(0,r.zG)(t,(n={event_source_id:t.eventSourceId,fetch_unseen:e.fetchUnseen,group_id:t.groupId,last_seen_offset:e.stateOffset,state:e.delta},e=>Ae.Y3((()=>e.permutiveApi.req({url:e.permutiveUrls.getEndpointUrl("/state",s.G("v1.0"),[["fetch_unseen",JSON.stringify(n.fetch_unseen)]]),method:"POST",payload:{group_id:n.group_id,event_source_id:n.event_source_id,state:JSON.stringify(n.state),last_seen_offset:n.last_seen_offset},contentType:"text/plain",dataType:"json",withCredentials:!1})),(e=>`Error sending state delta. Got ${j.KC(e)}`))),Ae.Vn((0,m.bw)((e=>t.reportError(e)))),gt,bt((e=>!!e)),vt((0,r.ls)(j.of,j.YO("response"),j.ak("stateDelta",(e=>{return t=e.response.state,(0,j.Y3)((function(){return JSON.parse(t)}),r.yR);var t})),j.Vn((0,m.bw)((e=>t.reportError(`Failed to parse State API response, got ${e}`)))),s.Uo)));var n}))),Qt=e=>(0,m.b0)(e,((e,t)=>t.state?s.G({[t.checksum]:t.state}):s.YP)),Yt=e=>t=>{const n=(0,r.zG)(t,Qt,W,j.fS((()=>_(new Map))),(t=>ze("delta",t,e)));return{decodedState:Ce(n,e),delta:(0,r.zG)(n,K,s.ij,s.fS((()=>({}))))}},Nt=e=>t=>()=>new Promise((n=>(0,p.HJ)((()=>(0,r.zG)(t,j.it(Yt(e),(e=>`Failed to compute delta for state sync. Got ${e}`)),n)))));n(226),xe.dp;var Bt=xe.xb,Ht=function(e){return function(t){return Object.keys(t).sort(e.compare)}};A.Df;xe.dx,xe.e$;xe.Bu,xe.P5,xe.Su;var Vt=xe.UI;xe.ri;function Kt(e){return xe.vP(e)}xe._r;xe.jt;xe.yW,xe.G,xe.t9;var Wt=xe.HA,Xt=(xe.nn,xe.kp),Jt=xe.CC,Zt=xe.RF,en=(xe.I8,xe.mS,xe.RJ,xe._Y,xe.V_),tn=xe.EW,nn=xe.nu,rn=(xe.SW,xe.zV,xe.Ub,xe.vA,xe.qS),on=(xe.mK,function(e){return function(t){var n=Ht(e);return function(e,r){var i=n(e);if(0===i.length)return t.of({});for(var o=t.of({}),s=function(n){o=t.ap(t.map(o,(function(e){return function(t){return e[n]=t,e}})),r(n,e[n]))},u=0,a=i;u<a.length;u++){s(a[u])}return o}}}),sn=xe.hX;xe.DZ,xe.uK,xe.tV;xe.oA,xe.oh;var un="Record";xe.Eh,xe.uZ,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,xe.nr,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df,A.Df;var an=n(654),cn=n(214),ln=function(e){return function(t){return[void 0,e(t)]}},fn=function(e){return function(t){return[e(t),t]}},dn=function(e,t){return(0,r.zG)(e,gn(t))},pn=function(e,t){return(0,r.zG)(e,hn(t))},mn=function(e,t){return(0,r.zG)(e,yn(t))},gn=function(e){return function(t){return function(n){var r=t(n),i=r[0],o=r[1];return[e(i),o]}}},hn=function(e){return function(t){return function(n){var r=t(n),i=r[0],o=r[1],s=e(o),u=s[0],a=s[1];return[i(u),a]}}},vn=function(e){return function(t){return[e,t]}},yn=function(e){return function(t){return function(n){var r=t(n),i=r[0],o=r[1];return e(i)(o)}}},_n="State",Sn={URI:_n,map:dn},In={URI:_n,map:dn,ap:pn},bn=(0,Ie.N)(In),wn=(0,Ie.a1)(In),Gn={URI:_n,map:dn,ap:pn,of:vn},zn={URI:_n,map:dn,ap:pn,chain:mn},kn=(0,Te.m)(zn),Un=(r.yR,(0,Me.YO)(Sn)),En=(0,Te.a)(zn),Pn=function(e){var t=function(e){return function(t){return function(n){for(var r=e(0,Be.YM(t))(n),i=[r[0]],o=r[1],s=1;s<t.length;s++){var u=e(s,t[s])(o),a=u[0],c=u[1];i.push(a),o=c}return[i,o]}}}(e);return function(e){return Be.Od(e)?t(e):vn(Be.Xl)}},On=function(e){return Pn((function(t,n){return e(n)}))},Cn=On(r.yR);const xn=e=>({aggregations:{PageviewEngagement:{engaged_time:0},SegmentEntry:new Set,SegmentExit:new Set,CohortEntry:new Set,CohortExit:new Set},customProperties:{},sessionId:e.sessionId,viewId:e.viewId}),Dn=e=>t=>{const n=new Set(t);return n.add(e),n},An=e=>t=>{const n=new Set(t);return n.delete(e),n},Tn=e=>[...e];var Mn,qn,Rn=n(620);!function(e){e.init=function(e){return e&&"object"==typeof e&&"externalStateMap"in e&&"internalStateMap"in e?e:{externalStateMap:s.YP,internalStateMap:{},migrationVersion:mr}}}(Mn||(Mn={})),function(e){e.sequenceNonEmptyArray=e=>{if(1===e.length)return e[0];const t=(0,r.bc)([],{},[]);for(const n of e){t[0].push(...n[0]);for(const e in n[1])t[1][e]=n[1][e];t[2].push(...n[2])}return t},e.sequenceArray=t=>(0,r.zG)(t,s.DT(jt.Od),s.UI(e.sequenceNonEmptyArray)),e.empty=[jt.cS,xe.cS,jt.cS],e.error=e=>[jt.of(e),xe.cS,jt.cS],e.ofOutputEvent=e=>[jt.cS,xe.cS,[e]]}(qn||(qn={}));const jn=e=>pr((t=>(0,r.zG)(Ln((e=>({...e,getCurrentSession:()=>t.environment.sessionId,getCurrentView:()=>t.environment.viewId}))),yn((()=>{return Cn([Fn(e),Nn(t.environment.thirdPartyData),(i=t.environment.lookalikeModels,(0,r.zG)((function(e){return[e,e]}),yn((e=>ur.equals(e.lal,i)?vn(jt.cS):(0,r.zG)(ln((0,m.rO)({lal:(0,r.a9)(i)})),bn(Ln(function(e){const t=(0,r.zG)(e,s.fS((()=>({}))));return e=>({...e,getLookalikeModels:()=>t})}(i))),yn((()=>(0,r.zG)(jt.Yo(i),On((()=>Kn("updateLAL"))),gn(jt.xH))))))))),(0,r.zG)(t.externalStateDelta,s.UI(Vn),s.fS((()=>vn(jt.bM())))),(n=t.cloudLiftedState,(0,r.zG)(n,jt.tS((e=>Object.entries(e))),On((e=>{let[t,n]=e;return fn((e=>(0,r.bc)(t,e.queries.runtime.cloudLiftedQueries[t],n)))})),yn((e=>Jn(j.F2(e)))))),Wn(t.newEvents)]);var n,i})),gn((0,r.ls)(jt.xH,s.DT(jt.Od),s.tS(qn.sequenceArray))),(e=>t=>{let[n,i]=e(t);if(s.pC(n)){let e=n.value,t=0;const o=100;let u;for(u=0;u<o&&e[2].length>t;u++){const n=e[2],[o,s]=(0,r.zG)(Wn(n.slice(t)),gn((t=>qn.sequenceNonEmptyArray([e,...t]))),(0,r.nn)(i));e=o,i=s,t=n.length}u>=o&&(e=qn.sequenceNonEmptyArray([e,qn.error(`Exceeded ${o} iterations when producing transition events`)])),n=s.G(e)}return(0,r.bc)(n,i)}),dr(e,"query_language_process_duration")))),Ln=e=>ln((0,m.rO)({effects:e}));function Fn(e){return(0,r.zG)((function(e){return[e,e]}),yn((t=>{let{bootstrapped:n,effects:i,eventsForReplay:o}=t;return n?vn(jt.cS):(0,r.zG)(ln((e=>({...e,bootstrapped:!0,eventsForReplay:[]}))),kn($n),yn((()=>(0,r.zG)(o,jt.R3(fr(i)),On(Xn("bootstrap")),gn(jt.xH)))),dr(e,"query_language_bootstrap_duration"))})))}const $n=()=>ln((e=>(0,r.zG)(e.invalidatedQueries,jt.EQ((()=>e),Qn(e))))),Qn=e=>t=>{const n=(0,r.zG)(t,jt.UI((t=>(0,r.bc)(t,{checksum:e.queries.metadata[t]}))),(e=>Object.fromEntries(e)));return(0,r.zG)(e,(0,m.rO)({persistentState:(0,m.rO)({internalStateMap:e=>({...n,...e})})}))},Yn=(0,r.zG)(fn((e=>e.tpdQueries)),yn(s.EQ((()=>(0,r.zG)(fn((e=>new Set([...e.queries.runtime.queriesByEvent["!UpdateSecondPartyData"]||[],...e.queries.runtime.queriesByEvent["!UpdateThirdPartyData"]||[]]))),kn((e=>ln((0,m.rO)({tpdQueries:()=>s.G(e)})))))),vn)));function Nn(e){const t=(0,r.zG)(e,s.UI(u.li));return(0,r.zG)((function(e){return[e,e]}),yn((n=>{if(s.Eh(H.Eq).equals(t,n.tpdHashInEffectsObject))return vn(jt.cS);const i=s.FS(t);return(0,r.zG)(ln((0,m.rO)({persistentState:(0,m.rO)({tpdHash:(0,r.a9)(i)}),tpdHashInEffectsObject:(0,r.a9)(t),tpdReady:(0,r.a9)(s.pC(e))})),gn((()=>(0,r.zG)(e,s.UI(u.Yg)))),kn((e=>Ln(function(e){const t=ar((()=>(0,r.zG)(e,s.fS((()=>({"3p":{}}))))));return e=>{const n=ar((()=>({...t(),...e.get1PSegments()})));return{...e,getSegments:n,getSegmentsArray:ar((()=>lr(n()))),get3PSegments:t}}}(e)))),yn(s.fw(Gn)((()=>(0,r.zG)(n.tpdEventsToProcess,jt.EQ((()=>i!==n.persistentState.tpdHash?Kn("updateTPD"):vn(jt.cS)),(0,r.ls)(On(Xn("updateTPD")),bn(ln((e=>({...e,tpdEventsToProcess:[]})))),gn(jt.xH))))))),gn(s.fS((()=>jt.bM()))))})))}const Bn=e=>xe.jt(((t,n)=>(0,r.zG)(xe.P5(t,e.metadata),s.tS((e=>xe.P5(e,n))),s.tS((n=>(0,r.zG)(xe.P5(t,e.runtime.locallyLiftedQueries),s.wp((()=>xe.P5(t,e.runtime.cloudLiftedQueries))),s.NG((e=>e.compact(n)))))),s.tS((0,r.ls)(W,s.Uo))))),Hn=(e,t)=>{if(xe.xb(e))return t;if(xe.xb(t))return e;const n={...e};for(const e in t)n[e]=(0,r.zG)(s.ij(n[e]),s.EQ((()=>t[e]),(n=>(0,r.zG)(s.Y3((()=>Ce(n,t[e]))),s.fS((()=>t[e]))))));return n};function Vn(e){return(0,r.zG)(fn((t=>(0,r.zG)(e,Bn(t.queries),(e=>(0,r.zG)(t.persistentState.externalStateMap,s.UI(xe.DZ((0,r.ls)(W,s.Uo))),s.EQ((()=>e),(t=>Hn(t,e))))),xe.UI(K)))),yn((e=>ln((0,m.rO)({persistentState:(0,m.rO)({externalStateMap:(0,r.a9)(s.G(e))})})))),yn((()=>Kn("updateExternalState"))))}function Kn(e){return(0,r.zG)(fn((e=>fr(e.effects))),yn(Xn(e)))}function Wn(e){return(0,r.zG)(e,jt.EQ((()=>vn(jt.bM())),(0,r.ls)(tr,yn(On((e=>{let[t,n]=e;return(0,r.zG)(n,Xn(t))}))),gn(jt.xH))))}function Xn(e){return(0,r.ls)(vn,kn((e=>"Pageview"!==e.name?vn(void 0):ln((0,m.rO)({pageviewProperties:(0,r.a9)(e.properties)})))),"bootstrap"===e?r.yR:kn((e=>{return ln((0,m.rO)({unprocessedPageviewComplete:(t=e,e=>{switch(t.name){case"Pageview":return t.view_id!==e.viewId?e:{...e,customProperties:t.properties};case"SegmentEntry":{const n=t.properties.segment_number;return(0,r.zG)(e,(0,m.rO)({aggregations:e=>e.SegmentExit.has(n)?(0,r.zG)(e,(0,m.rO)({CohortExit:An(String(n)),SegmentExit:An(n)})):(0,r.zG)(e,(0,m.rO)({CohortEntry:Dn(String(n)),SegmentEntry:Dn(n)}))}))}case"SegmentExit":{const n=t.properties.segment_number;return(0,r.zG)(e,(0,m.rO)({aggregations:e=>e.SegmentEntry.has(n)?(0,r.zG)(e,(0,m.rO)({CohortEntry:An(String(n)),SegmentEntry:An(n)})):(0,r.zG)(e,(0,m.rO)({CohortExit:Dn(String(n)),SegmentExit:Dn(n)}))}))}case"PageviewEngagement":{if(t.view_id!==e.viewId)return e;const n=t.properties;return(0,r.zG)(e,(0,m.rO)({aggregations:(0,m.rO)({PageviewEngagement:()=>({engaged_time:n.total_engaged_time,completion:n.total_completion})})}))}default:return e}})}));var t})),kn((e=>{return ir(e)?Ln((t=e.properties.segment_number,n="SegmentEntry"===e.name,e=>{return(0,r.zG)(e,(i={"1p":{...e.get1PSegments()["1p"],[t]:n}},e=>{const t=ar((()=>({...i,...e.get3PSegments()})));return{...e,getSegments:t,getSegmentsArray:ar((()=>lr(t()))),get1PSegments:()=>i}}));var i})):vn(void 0);var t,n})),Un("event"),En("queriesToProcess",(t=>{let{event:n}=t;return function(e,t){return(0,r.zG)((function(e){return[e,e]}),Un("state"),En("tpdQueriesToReject",(e=>{let{state:{tpdReady:t}}=e;return t?vn(s.bM()):(0,r.zG)(Yn,gn(s.DT((e=>e.size>0))))})),yn((n=>{let{state:i,tpdQueriesToReject:o}=n;const u=(0,r.zG)(o,s.UI((e=>jt.hX((t=>!e.has(t))))),s.fS((()=>e=>e)));switch(e){case"bootstrap":return vn((0,r.zG)(i.queriesForReplay,u));case"event":const e=i.tpdReady?vn(void 0):ln((0,m.rO)({tpdEventsToProcess:jt.R3(t)}));return(0,r.zG)(vn(i.locallyLiftedQueriesByEvent[t.name]||[]),gn(u),bn(e));case"lookalikeTransition":return vn(i.locallyLiftedQueriesByEvent[t.name]||[]);case"transition":const n=i.locallyLiftedQueriesByEvent[t.name]||[];if(s.pC(i.lal)){const e=i.locallyLiftedQueriesByEvent["!UpdateLookalikeModels"]||[];return vn(n.concat(e))}return vn(n);case"updateExternalState":return vn((0,r.zG)(i.persistentState.externalStateMap,s.fS((()=>({}))),xe.XP));case"updateLAL":return vn(i.locallyLiftedQueriesByEvent["!UpdateLookalikeModels"]||[]);case"updateTPD":return vn([...i.locallyLiftedQueriesByEvent["!UpdateSecondPartyData"]||[],...i.locallyLiftedQueriesByEvent["!UpdateThirdPartyData"]||[]]);default:return vn([])}})))}(e,n)})),yn((t=>{let{event:n,queriesToProcess:i}=t;return(0,r.zG)(i,jt.EQ((()=>vn(jt.bM())),(t=>(0,r.zG)(fn((t=>"bootstrap"!==e?t.effects:{...t.effects,getCurrentTime:()=>n.time,getCurrentView:()=>n.view_id,getCurrentSession:()=>n.session_id})),yn((e=>(0,r.zG)(fn((e=>(0,r.zG)(t,jt.DZ((t=>(0,r.zG)(xe.P5(t,e.queries.runtime.locallyLiftedQueries),s.wp((()=>xe.P5(t,e.cloudLiftQueriesForReplay))),s.UI((e=>(0,r.bc)(t,e))))))))),yn((t=>Jn(j.t$((0,r.bc)(t,n)),e))))))))))})))}const Jn=(e,t)=>(0,r.zG)(e,j.EQ((e=>{let[n,i]=e;return(0,r.zG)(n,On((e=>{let[n,r]=e;return Zn(n,j.t$([r,i]),t)})))}),On((e=>{let[t,n,r]=e;return Zn(t,j.F2([n,r]))}))),gn(qn.sequenceArray),kn(s.fw(Gn)((e=>{let[,t]=e;return ln((0,m.rO)({persistentState:(0,m.rO)({internalStateMap:e=>({...e,...t})})}))}))),gn(jt.Yo)),Zn=(e,t,n)=>(0,r.zG)(fn(j.it((i=>{const o=n??i.effects,a=(0,r.zG)(t,j.EQ(u.li,u.li)),[c,l]=(0,r.zG)(t,j.aD((e=>{let[t,n]=e;return(0,r.bc)(t.lift(n,o),sr({null:null,encode:r.yR,decode:j.of,append:t.append}))}),(e=>{let[,t]=e;return(0,r.bc)(t,sr(or()))}))),f=(0,r.zG)(i.persistentState.externalStateMap,s.tS(xe.P5(e))),d=i.persistentState.internalStateMap[e]||{checksum:i.queries.metadata[e]},p=l(e,o,a,d,f,c),m=Boolean(p.result?.result)!==Boolean(i.persistentState.internalStateMap[e]?.result?.result),g=(0,r.zG)(jt.lo(m),jt.UI((()=>({name:p.result?.result?"SegmentEntry":"SegmentExit",time:o.getCurrentTime(),view_id:o.getCurrentView(),session_id:o.getCurrentSession(),properties:{...i.pageviewProperties,segment_number:Number(e)}}))));return(0,r.bc)(p,g)}),(t=>`Failed to interpret query ${e}. Got ${t}`))),yn(j.EQ((e=>vn([[e],xe.cS,jt.cS])),(t=>{let[n,i]=t;return(0,r.zG)(n.dropExternalState?er(e):vn(void 0),gn((()=>[jt.cS,{[e]:n},i])))})))),er=e=>ln((0,m.rO)({persistentState:(0,m.rO)({externalStateMap:s.UI(xe.EG(e))})}));function tr(e){const t=e=>t=>(0,r.bc)(e,t);return fn((n=>(0,r.zG)(e,jt.pO(cn.aL(((e,t)=>{const n=ir(e);return(0,r.zG)(t,jt.zT((e=>ir(e)===n)),(e=>{let{init:t,rest:n}=e;return(0,r.bc)(t,n)}),(0,u.pL)(((e,t)=>n=>(0,r.bc)(e,(0,r.zG)(n,jt.Ce(t))))(n,e)))}))),jt.tS((e=>{let[i,o]=e;if(!i)return(0,r.zG)(o,jt.UI(t("event")));const s=(0,r.zG)(o,jt.yW((e=>n.lookalikeTransitionSegmentNumbers.has(e.properties.segment_number))),(e=>e?"lookalikeTransition":"transition"));return(0,r.zG)(o,cn.ut(((e,n)=>(0,r.zG)(e,jt.UI(t("event")),jt.R3((0,r.zG)(n,t(s)))))))})))))}const nr=(0,r.ls)(xe.hX((e=>Boolean(e.result?.result))),xe.XP,jt.UI(parseInt)),rr=(0,r.ls)(Vt((e=>e.activations??{})),sn((0,r.zG)(Boolean,(0,De.xD)((0,De.ff)(Bt)))));function ir(e){return("SegmentEntry"===e.name||"SegmentExit"===e.name)&&void 0!==e.properties?.segment_number}const or=()=>({null:{kind:"null",value:null},encode:K,decode:W,append:Oe}),sr=e=>(t,n,i,o,u,a)=>{const c={...o.activations},l={...n,setSegmentActivation:(e,n,r)=>{if(r!=t)throw new Error(`QL called setSegmentActivation for query ${r} while interpreting query ${t}`);e in c?c[e].includes(n)||(c[e]=[...c[e],n]):c[e]=[n]}},f=s.ij(o.state),d=s.ij(a),p=(0,r.zG)((0,Ie.gz)(s.G5)(f,d),s.UI((t=>{let[n,i]=t;const o=(0,r.zG)(e.decode(n),j.fS((()=>e.null))),s=(0,r.zG)(e.decode(i),j.fS((()=>e.null)));try{return j.F2(e.append(o,s))}catch(e){throw(0,an.w)(`Failed to append lifted event ${JSON.stringify(i)} to internal state ${JSON.stringify(n)}. Got ${e}`)}})),s.Gk((()=>(0,r.zG)(f,s.wp((()=>d)),s.UI(j.t$))))),g=(0,r.zG)(p,s.UI(j.EQ(r.yR,e.encode)),s.tS(s.ij)),{overallState:h,dropExternalState:v}=(0,r.zG)((0,Ie.gz)(s.G5)(p,u),s.UI((t=>{let[n,i]=t;return(0,r.zG)(s.Uo(e.decode(i)),s.tS((t=>(0,r.zG)(n,j.vx(e.decode),j.fS((()=>e.null)),s.it((n=>e.append(n,t)))))),s.EQ((()=>({overallState:g,dropExternalState:!0})),(t=>({overallState:s.ij(e.encode(t)),dropExternalState:!1}))))})),s.fS((()=>(0,r.zG)(g,s.Gk((()=>u)),(e=>({overallState:e,dropExternalState:!1}))))),(0,m.rO)({overallState:s.WG})),y=i.interpret(h,l);return{checksum:o.checksum,...(0,r.zG)(g,s.aD((()=>({})),(e=>({state:e})))),...!1===y.result?{}:{result:y},...Bt(c)?{}:{activations:c},...!1===v?{}:{dropExternalState:v}}},ur=s.Eh({equals:(e,t)=>e===t});function ar(e){let t,n=!1;return()=>(n||(t=e(),n=!0),t)}function cr(e){const t=ar((()=>(0,r.zG)(e,xe.hX((e=>Boolean(e.result?.result))),xe.UI((()=>!0)),(e=>({"1p":e}))))),n={"3p":{}},i=ar((()=>({...t(),...n})));return{getSegments:i,getSegmentsArray:ar((()=>lr(i()))),get1PSegments:t,get3PSegments:()=>n}}function lr(e){return Object.keys(e).reduce(((t,n)=>{const r=Object.keys(e[n]),i=[];return r.forEach((t=>{!0===e[n][t]&&i.push(t)})),t[n]=i,t}),{})}const fr=e=>({name:"",properties:{},session_id:e.getCurrentSession(),view_id:e.getCurrentView(),time:e.getCurrentTime()}),dr=(e,t)=>n=>r=>{const i=e.startSpan(t),o=n(r);return i.finish(),o},pr=e=>t=>(0,r.zG)(ln((0,m.rO)({unprocessedPageviewComplete:(0,r.ls)(s.DT((e=>e.viewId===t.environment.viewId)),s.fS((()=>xn(t.environment))))})),wn(fn((e=>(0,r.zG)(s.ij(e.persistentState.unprocessedPVC),s.hX((e=>e.view_id!==t.environment.viewId)),s.UI(Rn.k))))),Un("flushedPvc"),En("processingResult",(n=>{let{flushedPvc:i}=n;return e({...t,newEvents:(0,r.zG)(i,s.EQ((()=>t.newEvents),(e=>[...t.newEvents,e])))})})),kn((()=>ln((e=>{return{...e,persistentState:{...e.persistentState,unprocessedPVC:(0,Rn.X)((t=new Date,n=e.unprocessedPageviewComplete,{name:"PageviewComplete",time:t,session_id:n.sessionId,view_id:n.viewId,properties:{...n.customProperties,aggregations:(0,r.zG)(n.aggregations,(0,m.rO)({SegmentEntry:Tn,SegmentExit:Tn,CohortEntry:Tn,CohortExit:Tn}))}}))}};var t,n})))),gn((e=>{let{flushedPvc:t,processingResult:n}=e;const i=(0,r.zG)(t,s.UI(qn.ofOutputEvent));return(0,r.zG)((0,Ie.gz)(s.G5)(i,n),s.UI(qn.sequenceNonEmptyArray),s.wp((()=>i)),s.wp((()=>n)))}))),mr=2,gr=e=>t=>{const n=t.migrationVersion??(t.stateIsCompact?1:0);return(0,r.zG)([hr,vr],jt.md(n),jt.EQ((()=>t),(0,r.ls)(jt.OV(e),jt.u4(t,((e,t)=>t(e))),(0,m.rO)({migrationVersion:()=>mr}))))},hr=e=>(0,m.rO)({externalStateMap:s.UI(xe.jt(((t,n)=>(0,r.zG)(xe.P5(t,e.locallyLiftedQueries),s.wp((()=>xe.P5(t,e.cloudLiftedQueries))),s.NG((e=>e.compact(n))))))),internalStateMap:xe.Su(((t,n)=>{if(null==n?.state)return n;const r=e.locallyLiftedQueries[t]||e.cloudLiftedQueries[t];return{...n,state:r.compact(n.state)}}))}),vr=e=>{const t=new Set(e.queriesByEvent.PageviewEngagement??[]),n=new Set(e.queriesByEvent.PageviewComplete??[]);return(0,m.rO)({internalStateMap:xe.z7((0,De.ff)((e=>t.has(e)&&n.has(e))))})},yr=(e,t)=>xe.xb(t)?e:(0,r.zG)(e,xe.z7((e=>!(e in t))));var _r=n(644),Sr=n(823);const Ir=()=>e=>((0,r.zG)(e,o.UI((e=>e()))),o.a9({newResults:d.of(jt.cS),pendingEvents:jt.cS})),br=()=>()=>Ae.of((()=>({}))),wr=e=>[e,lt.of(e)],Gr=u.li,zr=u.Yg,kr=e=>t=>(0,r.zG)(zr(t),(t=>()=>new Promise((n=>{const r=t();r.then(s.G).then(n);const i=(0,p.HJ)((()=>n(s.YP)),e);r.then(i)})))),Ur="RefEventual",Er=o.UI(wr),Pr=e=>t=>o.vP((0,r.zG)(t,o.UI(Gr),o.UI(e)),(0,r.zG)(t,o.UI(zr),o.UI(lt.UI(e)))),Or=e=>t=>o.vP((0,r.zG)(o.vP((0,r.zG)(e,o.UI(Gr)),(0,r.zG)(t,o.UI(Gr))),o.UI((e=>{let[t,n]=e;return n(t)}))),(0,r.zG)(o.vP((0,r.zG)(e,o.UI(zr)),(0,r.zG)(t,o.UI(zr))),o.UI((e=>{let[t,n]=e;return lt.ap(t)(n)})))),Cr=e=>t=>(0,r.zG)(t.current,kr(e),lt.UI(s.fS((()=>(e=>Gr(e.current))(t))))),xr=o.UI(Gr),Dr=o.UI(zr),Ar={URI:Ur,map:(e,t)=>Pr(t)(e)},Tr={URI:Ur,map:Ar.map,ap:(e,t)=>Or(t)(e)},Mr=e=>i.dQ((t=>{let{previousState:n}=t;const[i,a]=(0,r.zG)(e.newEvents,o.En(2,jt.uZ()),(0,_r.H5)(Ir(e.permutiveApi,e.permutiveUrls,(c=e.customQueries.runtime,(0,r.zG)(Object.entries(c.queriesByEvent),jt.hX((e=>{let[,t]=e;return(0,r.zG)(t,jt.G((e=>e in c.cloudLiftedQueries)))})),jt.UI(u.li))))));var c;const l=o.vP({lookalikeModels:e.lookalikeModels,sessionId:e.sessionId,thirdPartyData:(0,r.zG)(e.thirdPartyData,o.UI(s.UI((0,_r.H5)(xe.UI((e=>{const t={};return e.forEach((e=>t[e]=!0)),t})))))),viewId:e.viewId}),f=(0,r.zG)(o.vP({cloudLiftedState:(0,r.zG)(a,o.UI((e=>e.newResults))),environment:l,externalStateDelta:e.externalStateDelta,newEvents:(0,r.zG)(i,(0,Sr.I)(e.metrics,"query_language_began_processing_pageview"))}),o.UI((0,m.rO)({environment:e=>d.of(e)})),o.UI((0,Ie.Yt)(d.G5))),p=Mn.init(n);const g=br(e.permutiveApi,e.permutiveUrls),h=(0,r.zG)(n?lt.of({processedState:p,stateMigratedThisInitialisation:!1}):(e.metrics.track({name:"sdk_query_state_migrated_workerisation_count_total",labels:{},value:1}),(0,r.zG)(e.migratedStateMaps,lt.UI((e=>{let{internal:t,external:n}=e;return{stateMigratedThisInitialisation:!0,processedState:{externalStateMap:n,internalStateMap:(0,r.zG)(t,s.fS((()=>({}))))}}})))),lt.Hr("environment",(()=>l.current)),lt.ak("process",(t=>{let{environment:n,processedState:i}=t;return(0,r.zG)((o={downloadCloudLiftQueries:g,environment:n,initialState:i,pastEvents:e.priorEvents,queries:e.customQueries},(0,r.zG)(lt.Do,lt.Hr("persistentState",(()=>(0,r.zG)(o.initialState,(0,m.rO)({internalStateMap:xe.z7(((e,t)=>t.checksum===o.queries.metadata[e]))}),gr(o.queries.runtime)))),lt.Hr("invalidatedLocalQueries",(e=>{let{persistentState:{internalStateMap:t}}=e;return yr(o.queries.runtime.locallyLiftedQueries,t)})),lt.Hr("invalidatedCloudLiftQueries",(e=>{let{persistentState:{internalStateMap:t}}=e;return yr(o.queries.runtime.cloudLiftedQueries,t)})),lt.Hr("hasInvalidatedQueries",(e=>{let{invalidatedCloudLiftQueries:t,invalidatedLocalQueries:n}=e;return!(xe.xb(t)&&xe.xb(n))})),lt.ak("eventsForReplay",(e=>{let{hasInvalidatedQueries:t}=e;return t?o.pastEvents:lt.of(jt.bM())})),lt.ak("cloudLiftQueriesForReplay",(0,r.ls)(s.DT((e=>e.eventsForReplay.length>0)),s.UI((e=>Object.keys(e.invalidatedCloudLiftQueries))),s.hX(jt.Od),s.UI((0,r.ls)(o.downloadCloudLiftQueries,Ae.OV(o.queries.runtime),lt.UI(j.fS((()=>({})))))),s.fS((()=>lt.of({}))))),lt.Hr("queriesForReplay",(e=>{let{cloudLiftQueriesForReplay:t,invalidatedLocalQueries:n}=e;return[...Object.keys(n),...Object.keys(t)]})),lt.UI((e=>{let{cloudLiftQueriesForReplay:t,eventsForReplay:n,invalidatedCloudLiftQueries:i,invalidatedLocalQueries:u,queriesForReplay:a,persistentState:c}=e;return{bootstrapped:!1,cloudLiftQueriesForReplay:t,effects:{getCurrentTime:()=>new Date,getCurrentSession:()=>o.environment.sessionId,getCurrentView:()=>o.environment.viewId,getLookalikeModels:()=>({}),setSegmentActivation:(e,t,n)=>{throw new Error(`setSegmentActivation() called for segment ${n} without being overridden first.`)},...cr(c.internalStateMap)},eventsForReplay:n,invalidatedQueries:[...Object.keys(i),...Object.keys(u)],lal:s.YP,locallyLiftedQueriesByEvent:(0,r.zG)(o.queries.runtime.queriesByEvent,xe.DZ(s.KQ(jt.hX((e=>e in o.queries.runtime.locallyLiftedQueries))))),lookalikeTransitionSegmentNumbers:(0,r.zG)(o.queries.runtime.queriesByEvent["!UpdateLookalikeModels"]||jt.cS,jt.UI(parseInt),(e=>new Set(e))),pageviewProperties:{},numEventsForReplay:n.length,queries:o.queries,queriesForReplay:a,persistentState:c,tpdEventsToProcess:jt.cS,tpdHashInEffectsObject:s.YP,tpdQueries:s.YP,tpdReady:!1,unprocessedPageviewComplete:xn({sessionId:o.environment.sessionId,viewId:o.environment.viewId})}})))),e.trace.traceTask("query_language_initialisation_duration"),lt.UI((0,m.bw)((t=>{var n;e.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"query_language_ready",time_origin:"sdk_init"},performance.now()),e.metrics.trackCounter({name:"sdk_queries_to_replay_count",value:(n=t,0===n.numEventsForReplay?0:n.queriesForReplay.length),labels:{}})}))),lt.UI((t=>{let n=t;const i=(0,r.zG)(e.validationService,s.OV({downloadCloudLiftQueries:g,externalState:t.persistentState.externalStateMap}));return t=>{const[o,u]=(0,r.zG)(t,jn(e.trace))(n);return(0,r.zG)(i,s.OV((0,r.bc)(t,u))),n=u,[o,u.persistentState]}})));var o})),o.fF),v=(0,r.zG)(h,o.UI(s.UI((e=>e.process)))),y=(0,r.zG)(h,o.UI(s.EQ((()=>!1),(e=>e.stateMigratedThisInitialisation))));let _=jt.bM();const S=(0,r.zG)(o.vP({processInput:v,inputIO:(0,r.zG)(f,o.UI(s.G))}),o.UI((0,Ie.Yt)(s.G5)),o.UI(s.UI((e=>{let{processInput:t,inputIO:n}=e;const i=n(),[o,a]=(0,r.zG)(i,(0,m.rO)({newEvents:jt.UI(u.Yg),cloudLiftedState:jt.UI((e=>e.state))}),(e=>t({...e}))),c=(0,r.zG)(o,s.EQ((()=>({errors:[],events:i.newEvents,internalStateDiff:s.YP})),(e=>{let[t,n,r]=e;return{errors:t,events:i.newEvents.concat(r.map((e=>[(0,m.k$)(),e]))),internalStateDiff:s.G(n)}})));return _=(0,r.zG)(_,jt.R3(c)),{consumeDeltas:()=>{const e=_;return _=jt.cS,e},modelState:a}})))),I=(0,r.zG)(S,o.UI(s.UI((e=>e.modelState)))),b=(0,r.zG)(S,o.UI(s.UI((e=>e.consumeDeltas))),o.UI(s.fS((()=>d.of(jt.bM()))))),w=(0,r.zG)(o.vP(I,a),o.Rp(((e,t)=>{let[n,i]=t;const o=(0,r.zG)(e,s.UI((e=>{let[,t]=e;return(0,r.zG)(n,s.EQ((()=>t),(e=>(0,r.zG)(t,jt.hX((t=>!t(e,i.pendingEvents)))))))})),s.fS((()=>jt.bM())));if(s.pC(n)&&jt.xb(i.pendingEvents))return[wr(n.value),o];const u=(0,m.b2)(),a=(0,r.zG)(n,s.fS((()=>p)));var c;return[(0,r.zG)((()=>u.promise),(c=a,e=>[c,e])),(0,r.zG)(o,jt.R3(((e,t)=>{const n=jt.xb(t)||(0,r.zG)(i.pendingEvents,jt.yW((e=>!t.includes(e))));return n&&u.resolve(e),n})))]})),o.UI(u.li)),G=(0,r.zG)(b,o.En(3,jt.uZ()),(t=>{let[n,i,u]=t;return{errors:(0,r.zG)(n,o.UI(d.UI(jt.tS((e=>e.errors))))),events:(0,r.zG)(i,o.UI(d.UI(jt.tS((e=>e.events)))),(0,Sr.F)(e.metrics,"query_language_processed_pageview")),internalStateDiff:(0,r.zG)(u,o.UI(d.UI((0,r.ls)(jt.DZ((e=>e.internalStateDiff)),s.DT(jt.Od),s.UI((e=>e.reduce(((e,t)=>({...e,...t})))))))))}})),z=(0,r.zG)(w,Pr((e=>e.internalStateMap))),k=xr(z);return{state:xr(w),value:{...G,stateMigratedThisInitialisation:y,internalStateMap:k,processing:(0,r.zG)(o.vP(S,a),o.UI((e=>{let[t,n]=e;return s.Wi(t)||jt.Od(n.pendingEvents)}))),segments:(0,r.zG)(z,Pr(qr)),tpdUsage:(0,r.zG)(o.vP(e.thirdPartyData,k),o.UI((e=>{let[t,n]=e;return(0,r.zG)(t,s.UI((()=>rr(n))))}))),unprocessedPageviewComplete:(0,r.zG)(I,o.UI(s.NG((e=>e.unprocessedPVC))),o.UI(s.UI(Rn.k)))}}})),qr=e=>(0,r.zG)(nr(e),(e=>(0,r.zG)(e,jt.uK((e=>e<1e7)),(t=>{let{left:n,right:r}=t;return{all:e,custom:r,standard:n}}))));var Rr=n(125);const jr=e=>wr(j.F2(e)),Lr="RefEventualEither",Fr=e=>o.a9(jr(e)),$r=Me.UI(Ar,j.dO),Qr=Ie.ap(Tr,j.G5),Yr=e=>Pr(j.F2)(e),Nr=e=>Pr(j.fS(e)),Br={URI:Lr,map:(e,t)=>$r(t)(e)},Hr={URI:Lr,map:Br.map,ap:(e,t)=>Qr(t)(e)},Vr=Ie.gM(Hr),Kr=e=>xr(e.all),Wr=(e,t)=>n=>({all:(0,r.zG)(n,$r(e)),byAdServer:(0,m.mQ)((0,r.ls)(t,s.UI((e=>(0,r.zG)(n,$r(e))))))}),Xr=e=>(0,r.zG)(e,Pr(j.F2),Wr(r.yR,(e=>s.G(e.filterCohorts)))),Jr=e=>({all:(0,r.zG)(e.all,Nr((()=>jt.bM()))),byAdServer:(0,m.mQ)((0,r.ls)(e.byAdServer,s.UI(Nr((()=>jt.bM())))))}),Zr=e=>(0,r.zG)(e,Jr,Kr),ei={empty:{all:Fr(jt.bM()),byAdServer:(0,m.mQ)((e=>s.YP))},concat:(e,t)=>({all:(0,r.zG)((0,Ie.gz)(Hr)(e.all,t.all),$r(jt.xH)),byAdServer:(0,m.mQ)((n=>(0,r.zG)(jt.oA([e.byAdServer(n),t.byAdServer(n)]),cn.c2,s.UI((e=>e.reduce(((e,t)=>(0,r.zG)((0,Ie.gz)(Hr)(e,t),$r(jt.xH)))))))))})},ti=new Set(["AdRequest","PageviewEngagement","PrebidAuctions","Reaction","SegmentEntry","SegmentExit","SlotRendered","ThirdPartySegments","VideoEngagement"]),ni=function(){return(0,r.bc)(...arguments)};var ri=n(794);const ii=e=>{let{queries:t,...n}=e;const[i,a]=o.Ue("pending");let c=s.G([]);const l=e=>{const t=Math.ceil(Math.random()*e.length);return(0,r.zG)(e,R.ke(t))};(0,r.zG)((()=>new Promise((e=>setTimeout(e,n.processingDelayMs)))),lt.UI((()=>performance.now())),lt.UI((e=>(0,r.zG)(c,s.UI(l),s.hX(R.Od),s.UI(q.ur(ri.n_({events:jt.jG(),externalStateDeltas:jt.jG(),lookalikeModels:ri.Z$(),modelState:ri.Z$(),thirdPartyData:ri.Z$()}))),(0,m.bw)((()=>{c=s.YP})),s.Hr("startTime",(()=>e))))),lt.UI((0,m.bw)(s.EQ((()=>a("skipped")),(()=>a("in_progress"))))),Tt("historicalEvents",(()=>mt(n.historicalEvents))),Tt("cloudLiftQueries",(()=>(0,r.zG)(Object.keys(t.runtime.cloudLiftedQueries),jt.aD((()=>lt.of(xe.cS)),(e=>(0,r.zG)(n.downloadCloudLiftQueries(e),Ae.OV(t.runtime),lt.UI(j.fS((()=>xe.cS)))))),mt))),Tt("expectedSegmentMemberships",xt((e=>ai({events:{historical:e.historicalEvents,new:e.events},externalState:{historical:n.externalState,deltas:e.externalStateDeltas},lookalikeModels:e.lookalikeModels,queries:{cloudLiftQueries:e.cloudLiftQueries,metadata:t.metadata,runtime:t.runtime},thirdPartyData:e.thirdPartyData})))),At("report",(e=>{let{expectedSegmentMemberships:n,modelState:i}=e;return function(e){const t=new Set(e.expectedSegmentMemberships);return(0,r.zG)(function(e){const t=function(e){const t=(0,r.zG)(Object.keys(e.runtime.queriesByEvent),jt.Su(((e,t)=>[t,2**e]))),n={},i=Object.fromEntries(t);for(const t in e.runtime.queriesByEvent){const r=e.runtime.queriesByEvent[t];for(const e of r)n[e]?n[e]+=i[t]:n[e]=i[t]}const o={};for(const e in n){const t=n[e];o[t]?o[t].push(e):o[t]=[e]}return(0,r.zG)(Object.entries(o),jt.UI((0,r.ls)((0,u.pL)((e=>Number(e))),(0,u.pL)((e=>(0,r.zG)(t,jt.DZ((0,r.ls)(s.DT((t=>{let[,n]=t;return(e&n)>0})),s.UI(u.li)))))))))}(e),n=new Set(Object.keys(e.runtime.cloudLiftedQueries));if(0===n.size)return(0,r.zG)(t,jt.UI((0,u.pL)((e=>({triggers:e,cloudLifted:!1})))));return(0,r.zG)(t,jt.tS((e=>{let[t,i]=e;const{left:o,right:s}=(0,r.zG)(i,jt.uK((e=>n.has(e))));return[[{triggers:t,cloudLifted:!1},o],[{triggers:t,cloudLifted:!0},s]]})))}(e.queries),jt.UI((0,u.H5)((n=>({actualSegments:(0,r.zG)(n,jt.hX((t=>Boolean(e.modelState.persistentState.internalStateMap[t]?.result?.result)))),expectedSegments:(0,r.zG)(n,jt.hX((e=>t.has(e))))})))))}({expectedSegmentMemberships:n,modelState:i,queries:t})})),Ot((e=>{let{startTime:t}=e;return()=>n.metrics.track({name:"sdk_segmentation_validation_duration_seconds",value:(performance.now()-t)/1e3,labels:{}})})),yt((e=>e.report)),yt(si(n.metrics)),yt((()=>a("finished"))))();return[i,e=>{let[t,n]=e;(0,r.zG)((0,Ie.gz)(s.g1)(c,t.environment.lookalikeModels,(0,r.zG)(t.environment.thirdPartyData,s.UI(u.Yg))),s.UI((e=>{let[r,i,o]=e;r.push({externalStateDeltas:jt.Yo(t.externalStateDelta),lookalikeModels:i,events:t.newEvents,modelState:n,thirdPartyData:o})})))}]};const oi=new Set(["SegmentEntry","SegmentExit","PageviewEngagement","PageviewComplete","Pageview","LinkClick","SlotViewable","SlotRendered","UpdateLookalikeModels","UpdateSecondPartyData","UpdateThirdPartyData"]),si=e=>t=>{for(const[n,{expectedSegments:i,actualSegments:o}]of t){if(0===i.length&&0===o.length)continue;const{correct:t,incorrect:s,missing:u}=ui(i,o),a=(0,r.zG)(n.triggers,jt.UI((e=>e.startsWith("!")?e.slice(1):e)),jt.UI((e=>oi.has(e)?e:"misc")),(e=>[...new Set(e)]),jt.UI((e=>(0,r.bc)(`trigger_${e}`,!0))),jt.R3((0,r.bc)("is_cloud_lifted",n.cloudLifted)),(e=>Object.fromEntries(e))),c=(t,n)=>n.length>0&&e.trackCounter({name:t,value:n.length,labels:a});c("sdk_segmentation_validation_correct_count_total",t),c("sdk_segmentation_validation_incorrect_count_total",s),c("sdk_segmentation_validation_missing_count_total",u)}},ui=(e,t)=>{if(0===t.length)return{correct:[],incorrect:[],missing:e};if(0===e.length)return{correct:[],incorrect:t,missing:[]};const n=new Set(t),i=new Set(e),{right:o,left:s}=(0,r.zG)(t,jt.uK((e=>i.has(e))));return{correct:o,incorrect:s,missing:(0,r.zG)(e,jt.hX((e=>!n.has(e))))}};const ai=e=>fi(50,(function*(){const t={...e.queries.runtime.locallyLiftedQueries,...e.queries.cloudLiftQueries},n=(0,r.zG)(e.queries.runtime.queriesByEvent,xe.DZ((0,r.ls)(s.ij,s.UI(jt.UI((e=>(0,r.bc)(e,t[e]))))))),i=(0,r.zG)(e.externalState.historical,s.fS((()=>({}))),xe.DZ(s.Dj(W)),(t=>(0,r.zG)(e.externalState.deltas,jt.UI(Bn(e.queries)),jt.u4(t,Hn))),xe.UI(K)),o={},u=new li(e.lookalikeModels,e.thirdPartyData),a=e=>(u.processEvent(e),(0,r.zG)(n[e.name]??[],jt.DZ((t=>{let[n,i]=t;return(0,r.zG)(s.ij(i.lift(e,u.effects)),s.fX((e=>o[n]?(0,r.zG)(e,ci(i,o[n])):j.F2(e))),s.UI((e=>(o[n]=e,n))))})))),c=e=>(0,r.zG)((e=>(0,r.zG)(o[e]??null,(n=>e in i?(0,r.zG)(i[e],ci(t[e],n),j.fS((()=>n))):n),(n=>t[e].interpret(n,u.effects)),(e=>e.result)))(e),s.DT((t=>t!==u.getSegmentResult(e))),s.UI((t=>({name:t?"SegmentEntry":"SegmentExit",properties:{segment_number:Number(e)},time:u.effects.getCurrentTime(),session_id:u.effects.getCurrentSession(),view_id:u.effects.getCurrentView()})))),l=e=>{if(0==e.length)return;const t=(0,r.zG)(e,jt.tS((0,r.ls)(c,s.UI(a),s.fS((()=>jt.bM())))));l(t)};for(const t of e.events.historical)yield,a(t);(0,r.zG)(Object.keys(t),l);for(const t of e.events.new)switch(yield,t.name){case"SegmentEntry":case"SegmentExit":case"PageviewComplete":break;default:a(t)}return(0,r.zG)(Object.keys(t),l),u.effects.getSegmentsArray()["1p"]})),ci=(e,t)=>n=>j.Y3((()=>e.append(t,n)),(e=>`Failed to append lifted state: ${e}`));class li{segments;segmentsArray=void 0;lastEvent=(()=>s.YP)();effects;constructor(e,t){const n=(0,r.zG)(t,xe.UI(xe.hX((e=>!0===e))));this.segments={...n,"1p":{}};const i=(0,r.zG)(this.segments,xe.UI(Object.keys));this.effects={getLookalikeModels:()=>e,getSegments:()=>this.segments,getSegmentsArray:()=>(this.segmentsArray||(this.segmentsArray={...i,"1p":Object.keys(this.segments["1p"])}),this.segmentsArray),setSegmentActivation:()=>{},getCurrentTime:()=>(0,r.zG)(this.lastEvent,s.EQ((()=>new Date),(e=>e.time))),getCurrentSession:()=>(0,r.zG)(this.lastEvent,s.EQ((()=>""),(e=>e.session_id))),getCurrentView:()=>(0,r.zG)(this.lastEvent,s.EQ((()=>""),(e=>e.view_id)))}}get1pSegments(){return this.effects.getSegmentsArray()["1p"]}getSegmentResult(e){return this.segments["1p"][e]??!1}processEvent(e){if("SegmentEntry"===e.name){const t=e.properties.segment_number;t&&this.processSegmentEntry([t])}else if("SegmentExit"===e.name){const t=e.properties.segment_number;t&&this.processSegmentExit([t])}else if("PageviewComplete"===e.name){const t=e.properties.aggregations;t?.SegmentEntry&&this.processSegmentEntry(t.SegmentEntry),t?.SegmentExit&&this.processSegmentExit(t.SegmentExit)}this.lastEvent=s.G(e)}processSegmentEntry(e){for(const t of e)t in this.segments["1p"]||(this.segments["1p"][t]=!0,this.segmentsArray=void 0)}processSegmentExit(e){for(const t of e)t in this.segments["1p"]&&(delete this.segments["1p"][t],this.segmentsArray=void 0)}}const fi=(e,t)=>async()=>{let n=performance.now();const r=t();for(;;){performance.now()-n>e&&(await new Promise((e=>setTimeout(e))),n=performance.now());const t=r.next();if(t.done)return t.value}},di=e=>i.dQ((e=>{let{previousState:t}=e;return{value:s.YP,state:o.a9(t)}})),pi=e=>i.dQ((t=>{let{previousState:n}=t;const i=(0,r.zG)(n,s.DT(m.El),s.xH,s.hX(A.HD)),u=(0,r.zG)(i,s.EQ((()=>!1),(t=>t===e.sessionId)));if(!e.metrics.isEnabled()||Math.random()>.1||u)return{value:s.YP,state:o.a9(n)};const[a,c]=o.Ue(o.a9("pending"));return{value:s.G((t=>{let{downloadCloudLiftQueries:n,externalState:r}=t;const[i,o]=ii({downloadCloudLiftQueries:n,externalState:r,historicalEvents:e.priorEvents,metrics:e.metrics,processingDelayMs:6e4,queries:e.customQueries});return c(i),o})),state:(0,r.zG)(o.xH(a),o.UI((0,r.ls)(s.DT((e=>"in_progress"===e||"finished"===e)),s.UI((()=>e.sessionId)),s.wp((()=>i)))))}})),mi=e=>(0,r.zG)(i.K4((t=>{let{stopped:n}=t;const[i,u]=o.Ue(o.a9(d.of(s.YP)));let a;const c=new Promise((e=>{a=e}));return{priorEvents:()=>c.then((e=>e())),externalStateDelta:o.xH(i),newEvents:(0,r.zG)(o.vP(e.newEvents,n),o.UI((e=>{let[t,n]=e;return n?()=>[]:t}))),setCachedPriorEvents:a,setExternalStateDelta:u}})),i.ak("segmentationValidation",(t=>{let{priorEvents:n}=t;return(0,r.zG)(e.eventsCache,j.EQ((()=>di),(()=>pi)),(t=>t({...e,sessionId:e.sessionId.current,priorEvents:n})))})),i.ak("segmentationService",(t=>{let{newEvents:n,priorEvents:s,externalStateDelta:u,segmentationValidation:a}=t;return(0,r.zG)(Mr({...e,externalStateDelta:u,newEvents:n,priorEvents:s,validationService:a}),i.bw((t=>(0,r.zG)(t.errors,o.UI((t=>(0,r.zG)(t(),jt.UI((t=>e.reportError(`Query Language: ${t}`,{userId:e.groupId}))))))))))})),i.UI((t=>(0,r.zG)(t.segmentationService.events,o.En(4,jt.uZ()),(n=>{let[i,a,c,l]=n;return{...t,newEvents:i,realtime:(0,r.zG)(a,o.Rp(!1,((e,t)=>{const n=t();return e||n.some((e=>{let[,t]=e;return"Pageview"===t.name}))})),(e=>o.vP(e,t.segmentationService.processing)),o.UI((e=>{let[t,n]=e;return t&&!n})),o.u4(((e,t)=>e||t))),currentPageviewSegments:(f={processedEvents:(0,r.zG)(c,o.UI(d.UI(jt.UI(u.Yg)))),segments:t.segmentationService.segments,viewId:e.viewId},(0,r.zG)(o.vP(f.processedEvents,f.viewId,f.segments),o.Rp({pageviewProcessed:!1,resolvePageviewSegments:e=>{},segments:wr({all:[],custom:[],standard:[]}),viewId:""},((e,t)=>{let[n,i,o]=t;const u=n();return(0,r.zG)(e,s.DT((e=>e.viewId===i)),s.EQ((()=>{if((0,r.zG)(u,jt.G((e=>"Pageview"===e.name&&e.view_id===i))))return{pageviewProcessed:!0,resolvePageviewSegments:()=>{},segments:o,viewId:i};{const e=(0,m.b2)();return{pageviewProcessed:!1,resolvePageviewSegments:t=>e.resolve(zr(t)()),segments:ni(Gr(o),(()=>e.promise)),viewId:i}}}),(e=>e.pageviewProcessed?{...e,segments:o}:(0,r.zG)(u,jt.G((e=>"Pageview"===e.name&&e.view_id===i)))?(e.resolvePageviewSegments(o),{pageviewProcessed:!0,resolvePageviewSegments:()=>{},segments:o,viewId:i}):{...e,segments:o})))})),o.UI((e=>e.segments)))),lastProcessedEvents:(0,r.zG)(l,o.UI(d.UI(jt.UI(u.Yg))))};var f})))),i.Hr("cohorts",(t=>{let{segmentationService:n}=t;return(0,r.zG)(o.fF(e.nonQlCohorts),o.UI(s.UI((e=>(0,r.zG)(n.segments,Pr((e=>e.all)),Pr(jt.UI(String)),Xr,(t=>({query_language:t,...e})))))))})),i.ak("stateSync",(t=>{let{segmentationService:n,lastProcessedEvents:r}=t;return Ft({eventSourceId:e.eventSourceId,groupId:e.groupId,groupIdIsNewlyGenerated:e.groupIdIsNewlyGenerated,internalStateDiff:n.internalStateDiff,internalStateMap:n.internalStateMap,lastProcessedEvents:r,logger:e.logger,permutiveApi:e.permutiveApi,permutiveUrls:e.permutiveUrls,queryLanguageProcessing:n.processing,reportError:e.reportError,sessionId:e.sessionId,viewId:e.viewId})})),i.bw((e=>{let{stateSync:t,setExternalStateDelta:n}=e;return n(t.externalStateDelta)})),i.ak("segmentTransitions",(t=>{let{segmentationService:n}=t;return(e=>(0,r.zG)(i.vP({currentSegmentsSet:i.K4((()=>(0,r.zG)(e.segments,o.UI(c))))}),i.ak("transitionsSinceInit",(e=>{let{currentSegmentsSet:t}=e;return i.of(a(t))})),i.UI((e=>{let{currentSegmentsSet:t,...n}=e;return n}))))({segments:(0,r.zG)(xr(n.segments),o.UI((e=>e.all))),viewId:e.viewId})})),i.Hr("cohortsRef",(e=>{let{cohorts:t}=e;return(0,r.zG)(t,o.VS(s.EQ((()=>o.a9(jt.bM())),(0,r.ls)((e=>Object.values(e)),jt.UI((0,r.ls)(Jr,(e=>e.all),xr,o.D8(jt.Eh(A.Eq)))),jt.vP(o.g1),o.UI(jt.xH)))))})),i.Hr("createTrackRequest",(t=>{let{cohortsRef:n,segmentationService:i}=t;return(0,r.zG)(o.vP({cohorts:(0,r.zG)(n,o.UI(s.G)),qlSegments:(0,r.zG)(xr(i.segments),o.UI(s.G)),webClient:e.webClient}),o.UI((0,Ie.Yt)(s.G5)),o.UI(s.UI((t=>{let{cohorts:n,qlSegments:r,webClient:i}=t;return t=>({...t,segments:r.all,user_id:e.groupId,cohorts:n,properties:{...t.properties,client:{...i,...t.properties.client??{}}}})}))))})),i.Hr("eventsToPublishOnPageUnload",(t=>e.trackPageviewComplete?(0,r.zG)(t.segmentationService.unprocessedPageviewComplete,o.UI(jt.pc(s.UI((e=>(0,r.bc)(`PageviewComplete-${e.view_id}`,e))))),(e=>o.vP(t.createTrackRequest,e)),o.UI((e=>{let[t,n]=e;return(0,r.zG)(t,s.EQ((()=>jt.cS),(e=>(0,r.zG)(n,jt.UI((0,u.H5)(e))))))}))):o.a9(jt.cS))),i.ak("eventCache",(t=>{let{newEvents:n,setCachedPriorEvents:s}=t;return(0,r.zG)(e.eventsCache,j.EQ((e=>(s(e),i.of({newEvents:n}))),(e=>(0,r.zG)((e=>i.K4((()=>({newEvents:(0,r.zG)(e.newEvents,o.UI(d.UI((0,m.bw)(jt.UI((t=>{let[,n]=t;ti.has(n.name)||e.eventsCache.add(n,{persistOnDisk:!0})})))))),priorEvents:()=>e.eventsCache.all()}))))({eventsCache:e,newEvents:n}),i.UI((e=>{let{newEvents:t,priorEvents:n}=e;return s(n),{newEvents:t}}))))))})),i.UI((e=>({...e,newEvents:e.eventCache.newEvents}))),i.Hr("eventsToPublish",(t=>{let{cohorts:n,newEvents:i,segmentationService:a}=t;return(0,r.zG)(o.vP(i,e.webClient,a.segments,(0,r.zG)(n,o.UI(s.UI((0,r.ls)((e=>Object.values(e)),jt.UI(Jr),jt.UI((e=>e.all)))))),(0,r.zG)(e.viewId,o.Rp(new Set,((e,t)=>new Set([...e,t]))))),o.UI((t=>{let[n,i,o,a,c]=t;return(0,r.zG)(s.Do,s.Qt("webClient",i),s.Qt("cohorts",a),s.ak("events",(()=>(0,r.zG)(n(),jt.hX((e=>{let[,t]=e;return"PageviewComplete"!==t.name||c.has(t.view_id)})),s.DT(jt.Od)))),dt,Tt("segments",(()=>(0,r.zG)(zr(o),mt))),Dt((e=>(0,r.zG)(e.cohorts,lt.uU(Cr(1e3)),lt.UI(jt.xH),lt.UI((t=>({...e,cohorts:t})))))),yt((t=>{let{cohorts:n,events:i,segments:o,webClient:s}=t;return(0,r.zG)(i,jt.UI((0,u.H5)((t=>({...t,segments:o.all,user_id:e.groupId,cohorts:n,properties:{...t.properties,client:{...s,...t.properties.client??{}}}})))))})),lt.UI(s.fS((()=>jt.bM()))))})),(e=>{const[t,n]=o.gS(jt.uZ());return(0,r.zG)(e,o.UI((e=>e().then(n)))),t}))})));var gi=n(28);function hi(e){return t=>(0,r.zG)(o.oQ(e),o.UI((0,m.rO)({backoffAfterErrorMs:e=>e??0,backoffAfterSuccessMs:e=>e??0})),(e=>i.dQ((n=>{let{previousState:i}=n;const[u,a]=o.Ue(function(e){if("object"!=typeof e||null===e)return{lastSuccess:0,lastError:0};return e}(i)),c=(0,r.zG)(o.vP(u,e),o.UI((e=>{let[t,n]=e;return Math.max(t.lastError+n.backoffAfterErrorMs,t.lastSuccess+n.backoffAfterSuccessMs)})));return{state:u,value:(0,r.ls)(s.DT((()=>Date.now()>=c.current)),s.UI(t),s.UI((0,m.bw)((e=>e.then((()=>a({...u.current,lastSuccess:Date.now()})),(()=>a({...u.current,lastError:Date.now()})))))))}}))))}const vi=function(e,t){return i.of(s.YP)};var yi=n(882);const _i=function(e,t){return(0,r.zG)(Si(e),hi({backoffAfterErrorMs:6e5}),i.VS((e=>yi.m((0,r.zG)(t,o.UI((0,m.rO)({tpdUsage:s.UI((0,r.ls)(xe.UI(xe.z7((e=>[].includes(e)))),xe.hX((0,De.ff)(xe.xb))))})),o.UI((t=>{let{tpdUsage:n,userId:i}=t;return{validityKey:()=>i,freshnessKey:(0,r.ls)((()=>n),s.EQ((()=>0),(0,r.ls)(JSON.stringify,m.vp))),refresh:(0,r.zG)(n,s.hX((e=>Object.keys(e).length>0)),s.UI((t=>()=>Ae.Y3((()=>(0,r.zG)(e({user_id:i,time:new Date,tpd_segments:t}),s.fS((()=>Promise.reject("Blocked by backoff."))))),(e=>`Failed to report TPD usage. Got ${e}`)))))}})))))),i.UI(r.Q1))};const Si=e=>t=>{const{config:n,metrics:r,permutiveApi:i,permutiveUrls:o}=e,u=r.startTimer("sdk_http_tpd_usage_seconds",{});return i.req({url:o.getEndpointUrl("/tpd/usage",s.G(n.apiVersion)),method:"POST",payload:t,contentType:"text/plain",dataType:"json",withCredentials:!1}).then((e=>(r.stopTimer("sdk_http_tpd_usage_seconds",u),e)))};var Ii=function(e){return function(t){return function(n){return e(t(n))}}},bi=r.a9;Be.F4,Be.Xl;function wi(e){return function(t){return function(){return e.of(t)}}}function Gi(e){return function(t){return function(n){return function(r){return e.map(n(r),t)}}}}function zi(e){return function(t){return function(n){return function(r){return e.ap(n(r),t(r))}}}}function ki(e){return function(t){return function(n){return function(r){return e.chain(n(r),(function(e){return t(e)(r)}))}}}}function Ui(e){return function(t){return(0,r.ls)(t,e.of)}}lt.PM;var Ei=bi,Pi=(lt.tD,Ii(lt.tD),function(e,t){return(0,r.zG)(e,Oi(t))}),Oi=Gi(lt.dO),Ci=(lt.Hi,wi(lt.PM)),xi=(lt.UA,"ReaderTask"),Di={URI:xi,map:Pi},Ai={URI:xi,of:Ci};Be.F4,Be.Xl;var Ti=bi,Mi=Rr.F2(Ai),qi=(Ae.QM,Ae.lk,Ae.dk,Ae.Op,Ae.fj,Rr.UI(Di)),Ri=Mi;Be.F4,Be.Xl;function ji(e,t){const n=["amp","gigya","pxid","sailthru"],u=(0,r.zG)(t.identities,o.UI(s.UI(xe.z7((e=>!n.includes(e)))))),a=e=>(0,m.vp)(JSON.stringify(e)),c=e=>[a(e),e];return(0,r.zG)(i.vP({fetchFromNewEndpoint:(0,r.zG)(Li(e),hi({backoffAfterErrorMs:6e5})),fetchFromLegacyEndpoint:(0,r.zG)(Fi(e),hi({backoffAfterErrorMs:6e5}))}),i.VS((n=>{let{fetchFromNewEndpoint:a,fetchFromLegacyEndpoint:l}=n;return(0,r.zG)(yi.m((0,r.zG)(o.vP(t.userId,t.sessionId,u),o.UI((t=>{let[n,i,o]=t;return{validityKey:()=>n,freshnessKey:()=>`${$i(o)},${i}`,refresh:(0,r.zG)(o,s.UI((t=>()=>xe.xb(t)?Ae.of({}):Ae.Y3((()=>(0,r.zG)((t=>(0,r.zG)(a(t),s.UI((e=>e.catch((()=>(0,r.zG)(l(t.identities),s.fS((()=>e))))))),s.wp((()=>l(t.identities))),s.UI((0,m.bw)((t=>{const n=e.metrics.startTimer("sdk_get_third_party_data_task_duration_seconds",{});t.catch(r.Q1).then((()=>{e.metrics.stopTimer("sdk_get_third_party_data_task_duration_seconds",n)}))})))))({userId:n,identities:t}),s.fS((()=>Promise.reject("Blocked by persistent backoff"))))),(e=>`Error fetching TPD. Got ${e}`)))),s.UI(qi(c)))}})))),yi.d((e=>s.G((e=>Array.isArray(e)?e:c(e))(e)))),i.UI(o.UI(j.fS((t=>(e.logger.warn("[TPD]",`Failed to retrieve usable value, using zero value. ${t}`),s.G(c({}))))))),i.bw((0,r.ls)(o.UI(s.pC),o.UI((t=>{t&&e.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"audience_matching_ready",time_origin:"sdk_init"})})))))})))}const Li=e=>async t=>{const n=e.metrics.startTimer("sdk_http_audience_matching_seconds",{}),i=await e.permutiveApi.req({url:e.permutiveUrls.getAudienceMatchingEndpointUrl("/id",s.G("v1"),t.userId),payload:{identities:(0,r.zG)(t.identities,xe.Yz,jt.UI((e=>{let[t,n]=e;return{tag:t,id:n}})))},method:"POST",withCredentials:!1,dataType:"json"});return e.metrics.stopTimer("sdk_http_audience_matching_seconds",n),i.items},Fi=e=>async t=>{const n=e.metrics.startTimer("sdk_http_tpd_seconds",{}),r=await e.permutiveApi.req({url:e.permutiveUrls.getEndpointUrl("/tpd",s.G(e.config.apiVersion)),method:"POST",payload:{user_id:t},contentType:"text/plain",dataType:"json",withCredentials:!1});return e.metrics.stopTimer("sdk_http_tpd_seconds",n),r},$i=(0,r.ls)(JSON.stringify,m.vp);const Qi=(e,t)=>(0,r.zG)(i.vP({data:ji(e,{identities:t.identities,sessionId:t.sessionId,userId:t.userId}),usageReporting:_i(e,o.vP({tpdUsage:t.tpdUsage,userId:t.userId}))}),i.ak("analytics",(e=>{let{data:n}=e;return function(e){return i.dQ((t=>{let{previousState:n}=t;const[i,u]=o.gS(jt.uZ());var a;return{state:(0,r.zG)(o.vP(e.userId,e.providerSegments,e.sessionId,e.viewId),o.D8(((e,t)=>{let[n,r]=e,[i,o]=t;return n===i&&r===o})),o.Rp(null!==(a=n)&&"object"==typeof a?a:{userId:"",providerHashes:{}},((e,t)=>{let[n,i,o,a]=t;const c=(0,r.zG)(i,s.fS((()=>({})))),l=(0,r.zG)(c,xe.UI((0,m.SL)(m.vp))),f=(0,r.zG)(e,s.DT((e=>e.userId===n)),s.UI((e=>e.providerHashes)),s.fS((()=>({}))));return(0,r.zG)(c,xe.z7((e=>l[e]!==(f[e]||0))),(e=>Object.entries(e)),jt.UI((e=>{let[t,n]=e;return(0,r.bc)((0,m.k$)(),{name:"ThirdPartySegments",properties:{data_provider:t,segments:[...n]},session_id:o,time:new Date,view_id:a})})),u),{userId:n,providerHashes:l}}))),value:i}}))}({providerSegments:(0,r.zG)(n,o.UI(s.UI(_r.Yg))),sessionId:t.sessionId,userId:t.userId,viewId:t.viewId})})),i.UI((e=>{let{data:t,analytics:n}=e;return{data:t,analyticsEvents:n}}))),Yi=function(e){const t={include_geo:!0,include_isp:!0,include_ip_hash:!0,include_ip:!1},n=e.trace.startSpan("geoip_data_retrieval");return(0,r.zG)(yi.m((0,r.zG)(e.sessionId,o.UI((n=>({validityKey:()=>(0,m.vp)(JSON.stringify(t)),freshnessKey:()=>n,refresh:s.G((()=>Ae.Y3((()=>Ni(e.permutiveApi,e.metrics,e.config,t,e.permutiveUrls)),(e=>`Error fetching geoip. Got ${e}`))))}))))),i.UI(o.UI(j.fS((t=>(e.logger.warn("[geoip]",`Failed to retrieve usable value, using zero value. ${t}`),s.G({})))))),i.bw((0,r.ls)(o.UI(s.pC),o.UI((t=>{t&&(e.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"geoip_data_ready",time_origin:"sdk_init"},performance.now()),n.finish())})))))};const Ni=(e,t,n,r,i)=>{const o=[];r.include_geo&&o.push(["include","geo"]),r.include_isp&&o.push(["include","isp"]),r.include_ip&&o.push(["include","ip"]),r.include_ip_hash&&o.push(["include","ip_hash"]);const u=t.startTimer("sdk_http_geoip_seconds",{});return e.req({url:i.getEndpointUrl("/geoip",s.G(n.apiVersion),o),method:"GET",contentType:"text/plain",dataType:"json",withCredentials:!1}).then((e=>(t.stopTimer("sdk_http_geoip_seconds",u),e)))},Bi=e=>t=>{const n=r=>{const i={...r};for(let o in r){const s=r[o];t.hasOwnProperty(s)?e?.dropUnenriched&&void 0===t[s]?delete i[o]:i[o]=t[s]:null!==s&&"object"==typeof s&&s.constructor===Object&&(i[o]=n(s))}return i};return n};var Hi=n(787),Vi=n(187);const Ki=function(e,t,n,r,u){return i.of({cohorts:s.YP,externalData:{[Wi]:o.a9(s.YP)}})};const Wi="_pssps",Xi=(e,t)=>(0,r.zG)(Ki(e.permutiveApi,e.permutiveUrls,e.reportError,e.logger,t),i.UI((e=>{let{cohorts:t,externalData:n}=e;return{ssp:t,externalData:n}}))),Ji="_pssps",Zi=(e,t)=>({ssp:s.uZ(ei).concat(e.ssp,t.ssp),externalData:{[Ji]:(0,r.zG)(o.vP(e.externalData._pssps,t.externalData._pssps),o.UI((e=>{let[t,n]=e;return s.uZ(eo).concat(t,n)})))}}),eo={concat:(e,t)=>({cohorts:e.cohorts.concat(t.cohorts),ssps:Array.from(new Set(e.ssps.concat(t.ssps)))})};const to=(e,t)=>i.K4((()=>({ssp:s.YP,externalData:{[Ji]:o.a9(s.YP)}})));(0,Vi.Hn)("appnexus_adserver")("auto_init",!1);const no=e=>{const t=(0,r.zG)(Object.values(e)??[],jt.UI(String),(e=>new Set(e)));return{id:"xandr_ssp",filterCohorts:jt.hX((e=>t.has(e)))}};const ro=e=>{if(!e.metrics.isEnabled())return()=>{};const t=(0,r.zG)(e.adServers,jt.UI((e=>(0,r.bc)(e.id,e))),xe.sq,xe.UI((t=>{const n=(0,r.zG)(e.cohorts,xe.DZ((e=>e.byAdServer(t))),(e=>o.vP(e)),o.UI(xe.UI((i=5e3,u="Timeout",e=>(0,r.zG)(e,kr(i),lt.UI(s.pF((()=>j.t$(u)))))))),o.UI((0,Ie.Yt)(lt.Hi)),o.UI(lt.UI((0,r.ls)(xe.oh,qe.Vn(xe.Su(((t,n)=>{e.logger.warn("[Targeting Metrics]",`[${t}]`,n)}))),qe.F2))),(e=>()=>e.current));var i,u;return(0,r.ls)(jt.of,jt.UI((e=>e.cohorts)),oo,jt.UI((e=>{let[t,n]=e;return{allCohorts:new Set(t),cohortCountByType:io(t),requestCount:n}})),(i=>(0,r.zG)(n(),lt.UI(xe.Su(((t,n)=>(i,o)=>{(0,r.zG)(n,jt.Hr("actualCohortCount",(e=>{let{cohortCountByType:t}=e;return(0,r.zG)(t,xe.P5(i))})),jt.UI((n=>{const u={cohort_type:i,target:t},a=o.reduce(((e,t)=>n.allCohorts.has(t)?e+1:e),0),c=o.length-a;e.metrics.track({name:"sdk_ad_request_missed_cohorts",labels:u,value:n.requestCount*c}),e.metrics.track({name:"sdk_ad_request_successful_cohorts",labels:u,value:n.requestCount*a}),(0,r.zG)(n.actualCohortCount,s.UI((t=>{const r=t-a;e.metrics.track({name:"sdk_ad_request_superfluous_cohorts",labels:u,value:n.requestCount*r})})))})))})(t.id,i))))),(e=>e()))})));return e=>{if("AdRequest"===e.name)(n=e.properties).ad_server_id in t&&t[n.ad_server_id](n);var n}},io=e=>({ql:(0,r.zG)(e,jt.u4(0,((e,t)=>isNaN(parseInt(t))?e:e+1)))}),oo=e=>(0,r.zG)(e,jt.pO((e=>{const{init:t,rest:n}=(0,r.zG)(e,jt.zT((t=>t===e[0])));return[t,n]})),jt.UI((e=>[e[0],e.length]))),so=e=>s.YP;const uo=B.n_({cohorts:jt.Eh((0,m.Or)()),ctx:(0,m.Or)()}),ao=jt.cS;Promise.resolve(j.F2(ao)),B.n_({userId:(0,m.Or)(),lastSuccess:{equals:(e,t)=>e&&t&&uo.equals(e,t)||e===t}});const co=B.n_({cohorts:R.Eh(B.n_({code:A.Eq,groups:R.Eh(H.Eq)})),groups:R.Eh(H.Eq)}),lo=(B.n_({userId:(0,m.Or)(),lastSuccess:{equals:(e,t)=>e===t||!!e&&!!t&&B.bc(A.Eq,co).equals(e,t)}}),(e,t)=>{const n=(0,r.zG)(t,s.UI((e=>e.all)),s.fS((()=>Fr(jt.cS))),xr,o.UI(s.Uo));return{_pcrdbs:o.a9(s.YP),_pcrprs:n}});const fo=function(e,t){return i.of({cohorts:s.YP,externalData:lo(e.logger,s.YP)})},po=function(){return i.of(s.YP)};const mo=i.K4((()=>{}));const go=e=>t=>(0,r.zG)(e,xe.UI((e=>t.reduce(((t,n)=>t+Number(e.has(n))),0))));const ho=function(e,t){return i.K4((()=>({signalRef:o.a9(s.YP)})))};const vo=e=>t=>i.dQ((n=>{const i=_o(e.performance),u=(0,r.zG)(n.previousState,s.DT((e=>"string"==typeof e))),a={key:(0,r.zG)(u,s.fS((()=>e.sessionId.current))),reporting:!1},c=(0,r.zG)(e.sessionId,o.Rp(o.a9(a),((n,u)=>(0,r.zG)(n,o.VS((n=>{if(n.reporting)return o.a9(n);if(n.key===u)return o.a9(n);return(0,r.zG)(t,lt.gw(3e4),lt.tS((e=>i(50,(()=>function*(e,t){const n=Date.now(),i={},o=20;let s=0;for(const r of e){if(r.session_id===t)continue;s++,i[r.name]??={age_ms:0,count:0,eventName:r.name,size_bytes:0};const e=i[r.name].age_ms,u=n-r.time.getTime();u>e&&(i[r.name].age_ms=u),i[r.name].size_bytes+=2*JSON.stringify(r).length,i[r.name].count+=1,s%o==0&&(yield)}const u=Object.values(i);if(0===u.length)return[];const a=(0,r.zG)(u,jt.u4({size_bytes:0,count:0,age_ms:0},((e,t)=>({size_bytes:e.size_bytes+t.size_bytes,count:e.count+t.count,age_ms:Math.max(e.age_ms,t.age_ms)}))),(e=>({...e,eventName:"*"})));return(0,r.zG)([...u,a],jt.UI((e=>({...e,used_size_bytes:a.size_bytes}))))}(e,u))))),lt.UI((t=>(t.forEach((t=>{e.metrics.track({name:"sdk_event_cache_age_seconds",labels:{event_count:t.count,event_name:t.eventName,size_bytes:t.size_bytes,used_size_bytes:t.used_size_bytes},value:Math.ceil(t.age_ms/1e3)})})),{key:u,reporting:!1}))),o.fF,o.UI(s.fS((()=>({...n,reporting:!0})))))}))))),o.xH);return{value:void 0,state:o.UI((e=>e.key),c)}})),yo=()=>i.dQ((e=>{let{previousState:t}=e;return{value:void 0,state:o.a9(t)}}));const _o=e=>(t,n)=>async()=>{let r=e.now();const i=n();for(;;){e.now()-r>t&&(await new Promise((e=>setTimeout(e))),r=e.now());const n=i.next();if(n.done)return n.value}},So=e=>t=>{const{consent:n,currentTimestampSecs:a,identities:c,sessionId:l,userId:f,viewId:g,pageviewState:h}=t;return(0,r.zG)(i.K4((()=>{let n;const r=new Promise((e=>{n=e})),[i,u]=o.Ue(o.a9(s.YP));return{...t,adServers:[no(e.optimisedActivationsConfig.appnexus_adserver)],nonQlCohortsT:()=>r,setNonQlCohorts:n,setTpdUsage:u,tpdUsage:o.xH(i)}})),i.ak("geoip",(()=>(e=>(0,r.zG)(e,Yi,i.YO("data"),i.Hr("replacementMap",(e=>{let{data:t}=e;return(0,r.zG)(t,o.UI(s.UI((e=>({$ip_geo_info:e.geo_info,$ip_geo_info_continent:e.geo_info?.continent,$ip_isp_info:e.isp_info,$ip_address:e.ip,$ip_address_hash:e.ip_hash})))))})),i.Hr("permutiveContext",(e=>{let{data:t}=e;return(0,r.zG)(t,o.UI(s.EQ((()=>({})),(e=>({isp:e.isp_info?.isp,organization:e.isp_info?.organization,autonomous_system_number:e.isp_info?.autonomous_system_number,autonomous_system_organization:e.isp_info?.autonomous_system_organization,continent:e.geo_info?.continent,country:e.geo_info?.country,city:e.geo_info?.city,province:e.geo_info?.province,postal_code:e.geo_info?.postal_code})))))}))))({...e,sessionId:l}))),i.Hr("watson",(t=>{let{webClient:n}=t;return(0,r.zG)(e.watson,s.fS((()=>(0,r.zG)(n,o.UI(s.UI((e=>e.url))),o.D8(s.Eh(A.Eq)),(t=>(0,Hi.watson)({...e,pageUrl:t,watsonEnabled:(0,r.zG)(h,o.UI((e=>e.watsonEnabled)))}))))))})),i.ak("audienceMatching",(t=>{let{tpdUsage:n}=t;return Qi(e,{identities:c,sessionId:l,tpdUsage:n,userId:f,viewId:g})})),i.UI((e=>{let{audienceMatching:{analyticsEvents:t,...n},newEvents:i,...s}=e;return{...s,audienceMatching:n,newEvents:(0,r.zG)(o.vP(i,t),o.UI(d.RD),o.UI(d.UI(jt.xH)))}})),i.UI((e=>{const[t,n,i]=o.Ue(s.bM()),[u,a]=(0,r.zG)(e.newEvents,o.En(2,jt.uZ())),c=(0,r.zG)(o.vP(u,t),o.UI((e=>{let[t,n]=e;return(0,r.zG)(n,s.UI((e=>(0,r.zG)(t,d.UI(jt.UI((0,m.bw)((t=>{let[,n]=t;return e(n)}))))))),s.fS((()=>d.of(jt.bM()))))})));return{...e,newEvents:c,newEventsForAdvertiserSegmentation:a,collectTargetingSuccessMetrics:e=>{n(s.G(e)),i()}}})),i.ak("enrichedEvents",(t=>{let{enrichmentReplacementMap:n,geoip:a,newEvents:c,watson:l}=t;return(0,r.zG)(o.vP({misc:n,geoip:a.replacementMap,watson:l.replacementMap}),o.UI((0,Ie.Yt)(s.G5)),o.UI(s.UI((e=>{let{misc:t,geoip:n,watson:r}=e;return{...t,...n,...r}}))),(t=>i.K4((()=>((e,t,n,i)=>((0,r.zG)(t,o.UI(s.pC),o.YP((t=>{t&&e.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"event_enrichment_ready",time_origin:"sdk_init"})}))),(0,r.zG)(n,o.VS((()=>(0,r.zG)(o.vP((0,r.zG)(t,o.UI(s.UI(Bi({dropUnenriched:!0})))),i),o.UI((0,r.ls)((e=>{let[t,n]=e;return()=>(0,r.zG)(t,s.EQ((()=>[]),(e=>(0,r.zG)(n(),jt.UI((0,u.H5)((0,m.rO)({properties:e})))))))})))))))))(e.metrics,t,f,c)))))})),i.UI((0,m.rO)({enrichedEvents:(0,Sr.F)(e.metrics,"pageview_enriched")})),i.ak("lookalikeModels",(()=>(0,r.zG)(e.lookalikeModels,s.EQ((()=>(0,gi.lookalikeModelsService)({...e,consent:n,currentTimestampSecs:a})),i.of)))),i.ak("userGroupCohorts",(()=>po(e,o.vP({currentTimestampSecs:a,userId:f})))),i.ak("queryLanguage",(n=>{let{audienceMatching:s,nonQlCohortsT:u,enrichedEvents:a,lookalikeModels:c,setTpdUsage:l,userIdIsNewlyGenerated:d}=n;return(0,r.zG)((p={...e,...t,newEvents:a,thirdPartyData:s.data,groupId:f,groupIdIsNewlyGenerated:d,nonQlCohorts:u,lookalikeModels:c,migratedStateMaps:e.migratedStateMaps},(0,r.zG)(o.vP(p.eventSourceId,p.groupId,p.groupIdIsNewlyGenerated),o.D8((0,r.zG)(A.Eq,B.Uz((e=>{let[t]=e;return t})))),i.kR((e=>{let[t,n,o]=e;return(0,r.zG)(mi({...p,eventSourceId:t,groupId:n,groupIdIsNewlyGenerated:o,migratedStateMaps:p.migratedStateMaps}),i.yi(t))})),i.UI((e=>({stateMigratedThisInitialisation:(0,r.zG)(e,o.VS((e=>e.segmentationService.stateMigratedThisInitialisation))),cohorts:(0,r.zG)(e,o.VS((e=>e.cohortsRef))),currentPageviewSegments:{all:(0,r.zG)(e,o.VS((e=>e.currentPageviewSegments)),Pr((e=>e.all))),custom:(0,r.zG)(e,o.VS((e=>e.currentPageviewSegments)),Pr((e=>e.custom))),standard:(0,r.zG)(e,o.VS((e=>e.currentPageviewSegments)),Pr((e=>e.standard)))},eventsToPublish:(0,r.zG)(e,o.VS((e=>e.eventsToPublish))),eventsToPublishOnPageUnload:(0,r.zG)(e,o.VS((e=>e.eventsToPublishOnPageUnload))),realtime:(0,r.zG)(e,o.VS((e=>e.realtime)),o.Rp(!1,((e,t)=>e||t)),o.bw((e=>{e&&p.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"worker_realtime",time_origin:"sdk_init"},performance.now())}))),segments:{all:(0,r.zG)(e,o.VS((e=>xr(e.segmentationService.segments))),o.UI((e=>e.all))),custom:(0,r.zG)(e,o.VS((e=>xr(e.segmentationService.segments))),o.UI((e=>e.custom))),standard:(0,r.zG)(e,o.VS((e=>xr(e.segmentationService.segments))),o.UI((e=>e.standard)))},thirdPartyDataUsage:(0,r.zG)(e,o.VS((e=>e.segmentationService.tpdUsage))),transitionsSinceInit:(0,r.zG)(e,o.VS((e=>e.segmentTransitions.transitionsSinceInit)))}))))),i.bw((e=>{let{thirdPartyDataUsage:t}=e;return l(t)})));var p})),i.ak("classificationModels",(t=>{let{queryLanguage:r}=t;return vi(e,o.vP({consent:n,currentTimestampSecs:a,queryLanguageCohorts:Dr(r.currentPageviewSegments.all),realtime:r.realtime,userId:f}))})),i.ak("advertiserSegmentation",(t=>{let{queryLanguage:r,newEventsForAdvertiserSegmentation:i}=t;return fo(e,o.vP({consent:n,customCohorts:Dr(r.currentPageviewSegments.custom),realtime:r.realtime,sessionId:l,standardCohorts:Dr(r.currentPageviewSegments.standard),userId:f,viewId:g,events:i}))})),i.ak("demandPartnersAndCuration",(n=>{let{queryLanguage:u,advertiserSegmentation:a}=n;const c=Vr(jt.jG()),l=(0,r.zG)(a.cohorts,s.UI((e=>e.all)),s.fS((()=>Fr(jt.cS)))),f=(0,r.zG)(u.currentPageviewSegments.all,Yr);return(0,r.zG)(i.vP({demandPartners:Xi(e,{cohorts:f,consent:t.consent,url:(0,r.zG)(t.webClient,o.UI(s.UI((e=>e.url))))}),curation:to(0,(e.optimisedActivationsConfig.curation_platforms,c.concat(l,f)))}),i.UI((e=>{let{demandPartners:t,curation:n}=e;return Zi(t,n)})))})),i.ak("ipIdentifier",(e=>{let{userId:t,geoip:n}=e;return(0,r.zG)(n.data,o.UI(s.tS(s.KQ((e=>e.ip))))),mo})),i.ak("secureSignal",(t=>{let{advertiserSegmentation:n,demandPartnersAndCuration:s}=t;return(0,r.zG)(ho(e,(0,r.zG)(f,o.UI((e=>({userId:e,advertiserCohorts:n.cohorts,stdAudienceCohorts:s.ssp}))))),i.UI((e=>{let{signalRef:t}=e;return t})))})),i.Hr("nonQlCohorts",(e=>{let{advertiserSegmentation:t,classificationModels:n,contextualCohorts:i,userGroupCohorts:o,setNonQlCohorts:s,demandPartnersAndCuration:u,viewId:a}=e;return(0,r.zG)(xe.oA({advertiser:t.cohorts,userGroup:o,classificationModel:n,contextual:so({contextualCohorts:i,viewId:a}),ssp:u.ssp}),(0,m.bw)(s))})),i.Hr("qlCohorts",(e=>{let{queryLanguage:t}=e;return(0,r.zG)(t.segments.all,o.UI(jt.UI(String)))})),i.bw((t=>{return t.collectTargetingSuccessMetrics(ro({adServers:t.adServers,cohorts:{...t.nonQlCohorts,query_language:(n=t.qlCohorts,(0,r.zG)(n,Er,Xr))},logger:e.logger,metrics:e.metrics}));var n})),(0,r.ls)(i.Hr("eventsToPublish",(t=>{let{qlCohorts:n,queryLanguage:i,nonQlCohorts:s}=t;const u=(e=>{if(!e.metrics.isEnabled())return e=>{};const t=(0,r.zG)(e.cohortsByType,xe.UI(o.Rp(new Set,((e,t)=>new Set([...e,...t])))),(e=>o.vP(e)));return n=>{"Pageview"===n.name&&(0,p.HJ)((()=>(0,r.zG)(n.cohorts,go(t.current),xe.Su(((t,n)=>e.metrics.track({name:"sdk_pageview_cohort_count",labels:{cohort_type:t},value:n}))))))}})({cohortsByType:(0,r.zG)(s,xe.UI(Zr),xe.dx("query_language",n)),metrics:e.metrics});return(0,r.zG)(i.eventsToPublish,o.UI(d.UI(jt.UI((0,m.bw)((e=>{let[,t]=e;return u(t)}))))))})),i.ak("eventsCacheReports",(()=>(0,r.zG)(e.eventsCache,j.EQ((()=>lt.of(jt.cS)),(e=>()=>e.all())),(e=>{if(e.metrics.isEnabled()&&s.pC(e.performance)){const t=e.performance.value;return vo({...e,performance:t})}return yo})({metrics:e.metrics,sessionId:t.sessionId,performance:e.performance})))),i.UI((e=>{let{adServers:t,advertiserSegmentation:n,demandPartnersAndCuration:i,eventsToPublish:s,geoip:u,queryLanguage:a,nonQlCohorts:c,watson:l,secureSignal:f}=e;return{activations:(0,r.zG)(t,jt.UI((e=>(0,r.zG)(Object.values(c),jt.UI(Jr),jt.DZ((t=>t.byAdServer(e))),jt.UI(xr),jt.UI(o.D8(jt.Eh(A.Eq))),(e=>o.vP(...e)),o.UI(jt.xH),o.UI((t=>(0,r.bc)(e.id,t)))))),(e=>o.vP(...e)),o.UI(xe.sq)),cohorts:{all:a.cohorts,ql:a.segments.all,qlCustom:a.segments.custom,qlStandard:a.segments.standard},context:(0,r.zG)(o.vP(l.permutiveContext,u.permutiveContext),o.UI((e=>{let[t,n]=e;return{...t,...n}}))),eventsToPublish:s,eventsToPublishOnPageUnload:a.eventsToPublishOnPageUnload,externalData:o.vP({...n.externalData,...i.externalData}),geoIP:u.data,realtime:a.realtime,stateMigratedThisInitialisation:a.stateMigratedThisInitialisation,transitionsSinceInit:a.transitionsSinceInit,secureSignal:f}}))))}},991:(e,t,n)=>{n.d(t,{BJ:()=>f,El:()=>O,G6:()=>S,HD:()=>l,HP:()=>G,Kn:()=>c,Or:()=>b,PQ:()=>I,SL:()=>p,aT:()=>h,b0:()=>y,b2:()=>m,bw:()=>U,k$:()=>v,lo:()=>E,mQ:()=>z,rO:()=>k,vg:()=>w,vp:()=>d});var r=n(340),i=n(169),o=n(507),s=n(327),u=n(229),a=n(215);const c=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,l=e=>"string"==typeof e,f=e=>"number"==typeof e&&!Number.isNaN(e);function d(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function p(e){return t=>{let n=0;for(let r of t){n=n+e(r)|0}return n}}s.ff(u.xb);function m(){let e,t;return{promise:new Promise(((n,r)=>{e=n,t=r})),reject:t,resolve:e}}let g=[];function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:navigator.userAgent;if(g.unshift(e),g.length>1)return;const n=["beforeunload","pagehide"],r=n.concat(["visibilitychange"]),i=e=>{if(!o&&e){o=!0;const e=g;g=[],e.forEach((e=>{try{e()}catch{}}))}};let o=!1;r.forEach((e=>{window.addEventListener(e,(()=>{const n=("visibilitychange"!==e||document.hidden)&&_(t);i(n)}))})),n.forEach((e=>{window.addEventListener(e,(()=>i(!0)))}))}function v(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^(self.crypto||self.msCrypto).getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}function y(e,t){const n=Object.keys(e),r=n.length,i={};for(let s=0;s<r;s++){const r=n[s],u=t(r,e[r]);(0,o.pC)(u)&&(i[r]=u.value)}return i}function _(e){return/Mobi|Android/i.test(e)}function S(e){return/^((?!chrome|android).)*safari/i.test(e)}function I(e,t){return new Promise((n=>{(0,a.HJ)((()=>{Promise.resolve(e()).then(n)}),t?.timeout??0)}))}const b=()=>({equals:(e,t)=>Object.is(e,t)});function w(e){return t=>null!=t&&e in t?t[e]:void 0}function G(e){let t=o.YP;const n=(0,o.fS)((()=>{const n=e();return t=(0,o.G)(n),n}));return()=>n(t)}const z=e=>{const t=new Map;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))},k=e=>t=>{const n={...t};for(const r in e)n[r]=e[r]?.(t[r]);return n};function U(e){return t=>(e(t),t)}const E=e=>t=>{const n=e.slice(0,-1),s=e.slice(-1)[0];return(0,i.zG)(n,r.f2((e=>{let[n,r]=e;return(0,i.zG)(t,o.DT(n),o.UI(r))})),o.fS((()=>s(t))))},P=e=>t=>{if("number"==typeof t)return t;if("string"==typeof t){const n=e(t);return Number.isNaN(n)?void 0:n}};P(parseInt),P(parseFloat);function O(e){return"object"==typeof e&&null!==e&&"_tag"in e&&["None","Some"].includes(e._tag)}},28:(e,t,n)=>{n.r(t),n.d(t,{lookalikeModelsService:()=>S,realService:()=>b,stubService:()=>I});var r=n(169),i=n(507);const o=(e,t,n,r)=>t+(n-t)*r/(Math.pow(2,e)-1),s=(e,t)=>{const n=(e,t)=>{const n=e.toString(16);return("0".repeat(t)+n).slice(Math.min(-t,-n.length))};return`${n(e.getUint32(t),8)}-${n(e.getUint16(t+4),4)}-${n(e.getUint16(t+6),4)}-${n(e.getUint16(t+8),4)}-${n(e.getUint32(t+10),8)}${n(e.getUint16(t+14),4)}`},u=e=>{const t=[1,2],n=e.getInt8(0);if(1===n)return a(e);if(2===n)return c(e);{const r=(0,i.Y3)((()=>s(e,1))),o=(0,i.g_)((()=>"Couldn\'t decode model id"),(e=>`Model id was ${e}`))(r);throw new Error(`Decoding only supported for version(s): ${t}; Supplied version was ${n}; ${o}`)}},a=e=>l(e,1),c=e=>l(e,2),l=(e,t)=>{const n=s(e,1),r=((e,t)=>{switch(String.fromCharCode(e.getInt8(t))){case"1":return"1p";case"3":return"3p"}})(e,17),i=e.getInt8(18),o=e.getFloat32(19),u=e.getFloat32(23),[a,c]=((e,t,n,r,i,o)=>{const s={};let u=0;do{let n;1===o?(u=e.getUint16(t),n=e.getUint16(t+2),t+=4):(u=e.getUint32(t),n=e.getUint16(t+4),t+=6),s[0===u?"const":u]=n.toString(36)}while(0!==u);return[s,t]})(e,27,0,0,0,t);return[{version:t,id:n,data_preference:r,weights:a,precision:i,min:o,max:u},c]};var f=n(6),d=n(46),p=n(215),m=n(659),g=n(561),h=n(144),v=n(882),y=n(991);const _=()=>i.G({}),S=b;function I(e){return m.K4((()=>g.a9(_())))}function b(e){e.logger.warn("add cleanup of legacy LAL cache");const t=e.trace.startSpan("lookalike_models_data_retrieval_duration");return(0,r.zG)(v.m((0,r.zG)(g.vP(e.consent,e.currentTimestampSecs),g.UI((t=>{let[n,s]=t;return{currentTimestampSecs:s,validity:{maxAge:604800,key:()=>"_"},freshness:{maxAge:86400,key:()=>"_"},refresh:(0,r.zG)(n,i.DT(Boolean),i.UI((()=>()=>f.fF(function(e){const t="Failed fetching binary models, reverting to JSON.\\nError: ",n="Failed fetching json models.\\nError: ";return(0,r.zG)(f.Y3((()=>G(e)),(e=>e.message)),p.N1,f.oU((e=>()=>function(e){const t=[];let n=0;for(;n<e.byteLength;){const[r,i]=u(new DataView(e,n));t.push(r),n+=i}return t}(e))),p.N1,f.UI(w((e=>{let{precision:t,max:n,min:r}=e;return{"1p":{},precision:t,min:r,max:n}}))),f.Vn((n=>(e.logger.log(t+n),e.metrics.track({name:"sdk_binary_models_missing_count",value:1,labels:{}}),n))),f.wp((()=>(0,r.zG)(f.Y3((()=>z(e)),(e=>e.message)),f.UI((e=>e.models)),f.UI(w((()=>({"1p":{}}))))))),f.UI((e=>(e=>{const t=Object.keys(e);return t.length>0&&e[t[0]].hasOwnProperty("precision")})(e)?(e=>{const t={},n=Object.keys(e),r=e=>{const t={"1p":{}},{precision:n,min:r,max:i}=e,s=e["1p"],u=Object.keys(s);for(let e=0;e<u.length;e++){const a=u[e],c=parseInt(s[a],36);t["1p"][a]=o(n,r,i,c)}return t};for(let i=0;i<n.length;i++){const o=n[i],s=e[o];t[o]=r(s)}return t})(e):e)),f.fS((t=>(e.reportError(n+t),d.of({})))))}(e)))))}})))),m.UI(g.UI((0,r.ls)(h.fS((t=>(e.logger.warn("[LAL]",`Failed to refresh, using zero value. ${t}`),_()))),(0,y.bw)(i.UI((()=>{t.finish(),e.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"lookalike_models_ready",time_origin:"sdk_init"})})))))))}function w(e){return t=>{const n={};for(let r=0;r<t.length;r++){const i=t[r],{id:o,weights:s}=i;if(void 0===o||void 0===s)continue;const u=e(i);Object.keys(s).forEach((e=>{u["1p"][e]=s[e]})),n[o]=u}return n}}const G=e=>{const{permutiveApi:t,config:n,metrics:r}=e,i=r.startTimer("sdk_http_models_seconds",{});return t.req({url:k(n.cdnProtocol,n.cdnBaseUrl,"binary"),method:"GET",contentType:"text/plain",dataType:"binary",withCredentials:!1}).then((e=>(r.stopTimer("sdk_http_models_seconds",i),e)))},z=e=>{const{permutiveApi:t,config:n,metrics:r}=e,i=r.startTimer("sdk_http_models_seconds",{});return t.req({url:k(n.cdnProtocol,n.cdnBaseUrl,"json"),method:"GET",contentType:"text/plain",dataType:"json",withCredentials:!1}).then((e=>(r.stopTimer("sdk_http_models_seconds",i),e)))};function k(e,t,n){const r=`${e}://${t}`;switch(n){case"binary":return`${r}/models/v2/681a9fe0-03f0-4efd-84f7-234f21a156cf-models.bin`;case"json":return`${r}/models/681a9fe0-03f0-4efd-84f7-234f21a156cf-models.json`}}},748:(e,t,n)=>{n.d(t,{K:()=>E,O:()=>k});let r,i;const o=new WeakMap,s=new WeakMap,u=new WeakMap,a=new WeakMap,c=new WeakMap;let l={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(m(this),n),p(o.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return p(e.apply(m(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const o=e.call(m(this),t,...r);return u.set(o,t.sort?t.sort():[t]),p(o)}}function d(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));s.set(e,t)}(e),t=e,(r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,l):e);var t}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(p(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),c.set(t,e),t}(e);if(a.has(e))return a.get(e);const t=d(e);return t!==e&&(a.set(e,t),c.set(t,e)),t}const m=e=>c.get(e);const g=["get","getKey","getAll","getAllKeys","count"],h=["put","add","delete","clear"],v=new Map;function y(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(v.get(t))return v.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=h.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!g.includes(n))return;const o=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let o=t.store;for(var s=arguments.length,u=new Array(s>1?s-1:0),a=1;a<s;a++)u[a-1]=arguments[a];return r&&(o=o.index(u.shift())),(await Promise.all([o[n](...u),i&&t.done]))[0]};return v.set(t,o),o}l=(e=>({...e,get:(t,n,r)=>y(t,n)||e.get(t,n,r),has:(t,n)=>!!y(t,n)||e.has(t,n)}))(l);var _=n(654),S=n(144),I=n(169),b=n(46),w=n(6),G=n(991),z=n(215);const k="[IDB]",U=(e,t,n,r,i,o)=>(0,I.zG)((0,b.of)(e.getNamespacedStorageKey(i)),(0,b.tS)((e=>(0,w.Y3)((async()=>n.put(r,o,e)),_.w))),(0,b.UI)((0,S.g_)((e=>{throw t.error(k,`Failed to store crypto key to ${r} due to unexpected error,\\n`,e),e}),(()=>o))),(e=>e()));class E{namespace;logger;cryptoAlg;idb;mainObjectStore;keyObjectStore;keyObjectKey;cryptoKey;MAX_CONSECUTIVE_PUTS=30;puts=1;hasForcedCompaction=!1;constructor(e,t,n,r,i,o,s,u){this.namespace=e,this.logger=t,this.cryptoAlg=n,this.idb=r,this.mainObjectStore=i,this.keyObjectStore=o,this.keyObjectKey=s,this.cryptoKey=u,this.logDebug("Created",this.idb)}static initialise(e,t,n,r,i,o,s,u,a,c){const l=(0,G.G6)(navigator.userAgent)&&!1,f=[c,r.isAvailable(),!l].every((e=>!0===e)),d=async(t,i,o)=>(0,I.zG)(await t.get(o,e.getNamespacedStorageKey(i)),(async e=>e??r.generateKey(!1)),(async r=>U(e,n,t,s,u,await r))).catch((e=>{const t=(0,_.w)(e);throw n.error(k,"Get crypto key failed. Got\\n",t),t})),p=(e,t,n)=>t.includes(n)?(0,I.Q1)():e.createObjectStore(n),m=()=>P(i,a,{upgrade:e=>{const t=[...e.objectStoreNames];p(e,t,o),p(e,t,s)}}).then((e=>{const t=[...e.objectStoreNames];return t.includes(o)&&t.includes(s)?e:Promise.reject(new Error("Object store(s) missing."))})),g=f?(0,S.Y3)((()=>function(e){if(!(0,G.G6)(navigator.userAgent)||!indexedDB.databases)return Promise.resolve();let t=()=>{},n=0;return new Promise((e=>{const r=()=>(n++,indexedDB.databases().finally((0,z.GL)(e)));t=(0,z.UM)(r,100),r()})).finally((()=>{t(),e.track({name:"sdk_idb_conn_attempt_safari_count",value:n,labels:{}})}))}(t).then((()=>m())).catch((e=>(n.error(`Re-creating IDB database ${i} due to error`,e),O(i).then((()=>m())))))),String):(0,S.t$)("Connection not attempted. Default to localStorage");return(0,S.g_)((e=>(0,w.t$)(e)),(t=>(0,I.zG)((0,w.Y3)((()=>t.then((async e=>({db:e,cryptoKey:await d(e,u,s)})))),String),(0,w.UI)((t=>{let{db:i,cryptoKey:a}=t;return new E(e,n,r,i,o,s,u,a)})))))(g)}async put(e,t){return(0,I.zG)((async()=>(0,I.bc)(JSON.stringify(e),this.cryptoKey)),(0,b.tS)((e=>{let[t,n]=e;return(0,b.of)(this.cryptoAlg.encrypt(n,t))})),(0,b.tS)((e=>async()=>(await this.recreateIfNecessary(this.puts++),e))),(0,b.tS)((e=>(0,w.Y3)((()=>this.idb.put(this.mainObjectStore,e,this.namespace.getNamespacedStorageKey(String(t)))),_.w))),(0,b.UI)((0,S.g_)((n=>{throw this.logError(`Failed to put "${t.toString()}" value`,e,". Got \\n",n),"QuotaExceededError"===n.name&&this.forceCompaction(),n}),(()=>t))),(e=>e()))}get(e){return(0,I.zG)(this.namespace.getNamespacedStorageKey(String(e)),(t=>this.idb.get(this.mainObjectStore,t).then((async e=>e?JSON.parse(await this.cryptoAlg.decrypt(this.cryptoKey,e)):null)).catch((t=>{const n=(0,_.w)(t);throw this.logError(`Get ${e.toString()} failed. Got`,n),n}))))}delete(e){return(0,I.zG)(this.namespace.getNamespacedStorageKey(String(e)),(e=>this.idb.delete(this.mainObjectStore,e)))}deleteStore(){return this.logDebug("Deleting",this.idb),this.idb.close(),O(this.idb.name)}forceCompaction(){if(this.hasForcedCompaction)return null;this.hasForcedCompaction=!0,this.logDebug("Attempting to force compaction");const e=`__${this.mainObjectStore}`;return P(e).then((t=>(t.close(),O(e))))}recreateIfNecessary(e){return(0,G.G6)(navigator.userAgent)&&e%this.MAX_CONSECUTIVE_PUTS==0?this.recreate():Promise.resolve()}async recreate(){const e=this.idb.name,t=this.idb.version,n=await this.idb.getAllKeys(this.mainObjectStore),r=[];for(const e of n)r.push([e,await this.idb.get(this.mainObjectStore,e)]);await this.deleteStore(),this.idb=await P(e,t,{upgrade:e=>{e.createObjectStore(this.mainObjectStore),e.createObjectStore(this.keyObjectStore)}}),await Promise.all(r.map((e=>{let[t,n]=e;return this.idb.put(this.mainObjectStore,n,t)}))),await U(this.namespace,this.logger,this.idb,this.keyObjectStore,this.keyObjectKey,this.cryptoKey),this.logDebug("Reset to",this.idb)}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(k,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(k,...t)}}const P=(0,I.ls)((function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),u=p(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(p(s.result),e.oldVersion,e.newVersion,p(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),u.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),u}),z.t_,(e=>e.then((e=>({close:e.close.bind(e),createObjectStore:(0,I.ls)(e.createObjectStore.bind(e),I.Q1),delete:(0,I.ls)(e.delete.bind(e),z.t_),get:(0,I.ls)(e.get.bind(e),z.t_),getAllKeys:(0,I.ls)(e.getAllKeys.bind(e),z.t_),get name(){return e.name},get objectStoreNames(){return e.objectStoreNames},put:(0,I.ls)(e.put.bind(e),z.t_),get version(){return e.version}}))))),O=(0,I.ls)((function(e){let{blocked:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(()=>t())),p(n).then((()=>{}))}),z.t_)},120:(e,t,n)=>{n.r(t),n.d(t,{make:()=>s});var r=n(169),i=n(748);const o=e=>{const{logger:t,consent:n,prefix:r}=e,i=(e,n)=>(t.debug(`${r} Failed to write ${String(n)} as consent is revoked`),Promise.resolve(n));return e=>class extends e{put=(()=>{return e=super.put.bind(this),t=i,r=()=>!n.current,function(){return(r()?t:e)(...arguments)};var e,t,r})()}},s=(e,t,n,s,u,a,c,l,f,d,p)=>(0,r.zG)(i.K,o({logger:f,consent:d,prefix:i.O})).initialise(e,t,f,n,s,u,a,c,l,p)},787:(e,t,n)=>{n.r(t),n.d(t,{watson:()=>a});var r=n(561),i=n(169),o=n(507),s=n(812),u=n(229);const a=e=>(0,i.zG)(l(e),r.YO("data"),r.Hr("replacementMap",(e=>{let{data:t}=e;return(0,i.zG)(t,o.YO("data"),o.Hr("taxonomyLabels",(e=>{let{data:t}=e;return function(e){const t=e=>{const t=e.split("/").filter((e=>e));return t.map(((e,n)=>"/"+t.slice(0,n+1).join("/")))},n=s.xH(e.filter(Boolean).map((e=>t(e.label))));return s.jj(u.Eq)(n)}(t.taxonomy??[])})),o.UI((e=>{let{data:t,taxonomyLabels:n}=e;return{$alchemy_concepts:t.concepts??[],$alchemy_document_emotion:t.emotion?.document?.emotion??null,$alchemy_document_sentiment:t.sentiment?.document??null,$alchemy_entities:t.entities??[],$alchemy_entity_names:(0,i.zG)(t.entities??[],s.UI((e=>e.text))),$alchemy_keywords:t.keywords??[],$alchemy_taxonomy:t.taxonomy??[],$alchemy_taxonomy_labels:n,$taxonomy_labels:n}})))})),r.Hr("permutiveContext",(e=>{let{data:t}=e;return(0,i.zG)(t,o.EQ((()=>({})),(e=>({watson:e}))))})),(e=>({permutiveContext:(0,i.zG)(e,r.UI((e=>e.permutiveContext))),replacementMap:(0,i.zG)(e,r.UI((e=>e.replacementMap)))}))),c=()=>r.a9(o.G({})),l=c}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{var e=__webpack_require__(215),t=__webpack_require__(561),n=__webpack_require__(169),r=__webpack_require__(659),i=__webpack_require__(507),o=__webpack_require__(812),s=__webpack_require__(991),u=__webpack_require__(6);function a(e,r){return(0,n.zG)(u.Y3((()=>e.get(r)),(e=>`Failed to read previous state from IndexedDB: ${e}.`)),u.UI((e=>e??void 0)),u.UI((i=>o=>(0,n.ls)((0,s.rO)({previousState:()=>i}),o,(o=>{let{value:u,state:a}=o;const[c,l]=t.Ue(!1),f=(0,n.zG)(a,t.Rp(-1,(e=>e+1)));return{value:(0,n.bc)(c,u),state:(0,n.zG)(t.vP(a,f),(0,s.bw)(t.YP((t=>{let[n,o]=t;if(0!==o||n!==i)switch(l(!1),typeof n){case"undefined":e.delete(r).then((()=>l(!0)));break;case"object":null===n?e.delete(r).then((()=>l(!0))):e.put(n,r).then((()=>l(!0)));break;default:e.put(n,r).then((()=>l(!0)))}}))))}})))))}function c(e){return r=>(0,n.ls)((0,s.rO)({previousState:t=>e.current?t:void 0}),r,(0,s.rO)({state:(0,n.ls)((n=>t.vP(e,n)),t.UI((e=>{let[t,n]=e;return t?n:void 0})))}))}var l=__webpack_require__(144);class f extends Error{static errorName="NetworkRequestFailedError";name=(()=>f.errorName)();constructor(){super(f.defaultMessage)}static get defaultMessage(){return"Network request failed"}}class d extends Error{static errorName="NetworkRequestTimeoutError";name=(()=>d.errorName)();constructor(){super(d.defaultMessage)}static get defaultMessage(){return"Network request timed out"}}var p=__webpack_require__(614),m=function(e){return"Left"===e._tag},g=function(e){return"Right"===e._tag};function h(e){return{_tag:"Left",left:e}}function v(e){return{_tag:"Right",right:e}}function y(e,t){return{_tag:"Both",left:e,right:t}}var _=function(e,t,n){return function(r){switch(r._tag){case"Left":return e(r.left);case"Right":return t(r.right);case"Both":return n(r.left,r.right)}}},S=_;S(v,h,(function(e,t){return y(t,e)}));var I=v,b="These";n.yR,n.yR,p.Xl;class w{metrics;logger;constructor(e,t){this.metrics=t,this.logger=e.withPrefix("network")}req(e){return this.logger.withPrefix("request").debug(e.method,e.url,..."POST"===e.method?[{payload:e.payload}]:[]),this.reqImpl(e).then((e=>(0,n.MZ)(e))).then((t=>(this.logger.withPrefix("response").debug(e.method,e.url,{response:t}),t)),(t=>{throw this.logger.withPrefix("response").error(e.method,e.url,t),t}))}reqWithBeacon(e){let{url:t,payload:n}=e;const r=JSON.stringify(n),i=navigator?.sendBeacon?.(t,JSON.stringify(n))??!1;return this.trackRequestMetrics({is_beacon:!0,is_error:!i,request:{method:"POST",url:t,content_length:r.length}}),i}reqImpl(t){const r="arraybuffer",{url:o,dataType:u,contentType:a,method:c,withCredentials:m,timeout:g}=t;return new Promise(((h,_)=>{const S=new XMLHttpRequest,I="POST"===t.method?"string"==typeof(b=t.payload)?b:JSON.stringify(b):null;var b;const w=e=>this.trackRequestMetrics({is_beacon:!1,request:{method:c,url:o,content_length:I?.length??0},response:e});S.onload=(0,e.GL)((()=>{return(0,n.zG)(S.status,l.DT((e=>e<400),(()=>{const e="text"===S.responseType||""===S.responseType?S.responseText:"Couldn\'t access response text";return`Failed ajax request. Status code was ${S.status}. ${e}`})),l.tS((()=>"json"===u?S.responseText?l.Y3((()=>JSON.parse(S.responseText)),(e=>`Failed to parse response as JSON. Response was ${JSON.stringify(S.responseText)}. Got ${e}`)):l.F2(null):"text"===u?l.F2(S.responseText):l.F2(S.response))),(0,s.bw)((0,n.ls)(i.IS,(e={content_length:"text"===S.responseType||""===S.responseType?S.responseText?.length??0:S.responseType===r?S.response.byteLength:0,response_time_ms:self.performance.now()-G,status_code:S.status},function(t){return p.Wi(t)?v(e):y(t.value,e)}),w)),l.EQ(_,h));var e})),S.onerror=(0,e.GL)((()=>{w(l.t$("network error")),_(new f)})),S.ontimeout=(0,e.GL)((()=>{w(l.t$("timeout")),_(new d)})),S.open(c,o,!0),a&&S.setRequestHeader("content-type",a),S.timeout=g||S.timeout,S.withCredentials=m||S.withCredentials,S.responseType="binary"===u?r:S.responseType;const G=self.performance.now();S.send(I)}))}trackRequestMetrics(e){if(!this.metrics?.isEnabled())return;const t=new URL(e.request.url).pathname;if(t.includes("metrics"))return;const r=n=>this.metrics.track({name:"sdk_http_request_count_total",value:1,labels:{request_method:e.request.method,request_path:t,request_content_length:e.request.content_length,...n}});var o;!0===e.is_beacon?r({is_beacon:!0,is_error:e.is_error}):(0,n.zG)((o=e.response,m(o)?p.YP:(g(o),p.G(o.right))),i.aD((()=>({})),(e=>({response_content_length:e.content_length,response_status:e.status_code,response_time_ms:e.response_time_ms}))),(t=>({is_beacon:!1,is_error:!g(e.response),...t})),r)}}class G{config;PATH_JOINER_Q="?";PATH_JOINER_A="&";constructor(e){this.config=e}getBaseUrl(){return`${this.config.apiProtocol}://${this.config.apiHost}`}getEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("base",e,t,n)}getSdkErrorsUrl(e,t){return this.getUrl("sdk-errors",e,t,[])}getAdvertiserEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("adv",e,t,n)}getClassificationModelsEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("clm",e,t,n)}getAudienceMatchingEndpointUrl(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const i=`${e}/${n}/audiences`;return this.getUrl("audience-matching",i,t,r)}getCCSCohortMembershipEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("ccs",e,t,n)}makeAuthenticatedUrl(e){return this.makeUrlWithQueryParams(e,[["k",this.config.apiKey]])}getUrlPrefix(e){switch(e){case"base":return"";case"adv":return"/adv";case"sdk-errors":return"/sdk-errors";case"clm":return"/clm";case"audience-matching":return"/audience-matching";case"ccs":return"/ccs"}}getUrl(e,t,n,r){const o=this.getUrlPrefix(e),s=(0,i.g_)((()=>""),(e=>`/${e}`))(n),u=`${this.getBaseUrl()}${o}${s}${t}`;return this.makeUrlWithQueryParams(u,r.concat([["k",this.config.apiKey]]))}makeUrlWithQueryParams(e,t){const n=t.map((e=>{let[t,n]=e;return`${t}=${n}`})).join(this.PATH_JOINER_A),r=e.includes(this.PATH_JOINER_Q)?this.PATH_JOINER_A:this.PATH_JOINER_Q;return`${e}${r}${n}`}}var z=__webpack_require__(748),k=__webpack_require__(945);class U{sdkInitTimestamp;timeOriginSdkInit;logger;prefix="[Metrics]";timeOriginForContext=(()=>O())();pendingMetrics=[];pendingCounters={};pendingTimers={};noMetricsTracked=0;constructor(e,t,n){this.sdkInitTimestamp=e,this.timeOriginSdkInit=t,this.logger=n}isEnabled(){return!0}getNoMetricsTracked(){return this.noMetricsTracked}consume(){const e=this.pendingMetrics.concat(Object.values(this.pendingCounters).flat());return this.pendingMetrics=[],this.pendingCounters={},e}track(e){this.noMetricsTracked++,this.logDebug(`Tracking ${e.name}`,{metric:e}),this.pendingMetrics.push(e)}trackCounter(e){if(this.noMetricsTracked++,this.logDebug(`Tracking ${e.name}`,{metric:e}),e.name in this.pendingCounters){const t=Object.keys(e.labels),n=this.pendingCounters[e.name].findIndex((n=>Object.keys(n.labels).length===t.length&&t.every((t=>n.labels[t]===e.labels[t]))));-1===n?this.pendingCounters[e.name].push(e):this.pendingCounters[e.name][n]=P(this.pendingCounters[e.name][n],e.value)}else this.pendingCounters[e.name]=[e]}synchroniseTimeBetweenContexts(e){return(0,n.zG)(k.gz(i.G5)(this.timeOriginForContext,this.timeOriginSdkInit),i.UI((t=>{let[n,r]=t;return e+n-r})))}trackTimeSinceInit(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:performance.now();(0,n.zG)(this.synchroniseTimeBetweenContexts(r),i.UI((e=>(e-this.sdkInitTimestamp)/1e3)),i.UI((n=>this.track({name:e,value:n,labels:t}))))}startTimer(e,t){const n=performance.now(),r=this.generateRandomKey(e);return this.pendingTimers[r]={startTime:n,labels:t},r}stopTimer(e,t){const n=this.pendingTimers[t];if(n){const r=(performance.now()-n.startTime)/1e3;this.logDebug("timer stopped",e,r),this.track({name:e,value:r,labels:n.labels}),delete this.pendingTimers[t]}}generateRandomKey(e){return`${e}-${[...Array(24)].map((()=>Math.random().toString(36)[2])).join("")}`}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(this.prefix,...t)}}class E{isEnabled(){return!1}getNoMetricsTracked(){return 0}consume(){return[]}track(e){}trackCounter(e){}trackTimeSinceInit(e,t){}startTimer(e,t){return""}stopTimer(e,t){}}const P=(e,t)=>({...e,value:e.value+t}),O=()=>(0,n.zG)(i.Y3((()=>performance.timeOrigin)),i.hX((e=>"number"==typeof e&&!Number.isNaN(e))));var C=__webpack_require__(644);class x{sdkInitTimestamp;prefix;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.initialPrefix;this.sdkInitTimestamp=e,this.prefix=t}static initialPrefix=(()=>[A("Permutive"),self.document?A("M","#43dde2"):A("W","#FF5C00")])();get timeDeltaFromInit(){return`[${(new Date).getTime()-this.sdkInitTimestamp}ms]`}log(){return console.log.bind(self.console,`%s${this.prefixTemplate}`,this.timeDeltaFromInit,...this.prefixContent)(...arguments)}debug(){return console.debug.bind(self.console,`%c%s${this.prefixTemplate}`,"color: blue;",this.timeDeltaFromInit,...this.prefixContent)(...arguments)}warn(){return console.warn.bind(self.console,`%s${this.prefixTemplate}`,this.timeDeltaFromInit,...this.prefixContent)(...arguments)}error(){return console.error.bind(self.console,`%s${this.prefixTemplate}`,this.timeDeltaFromInit,...this.prefixContent)(...arguments)}withPrefix(e,t){return new x(this.sdkInitTimestamp,[...this.prefix,A(e,t)])}get prefixTemplate(){return this.prefix.map(C.li).join("")}get prefixContent(){return this.prefix.map(C.Yg).flat()}}class D{log(){}debug(){}warn(){}error(){}withPrefix(){return this}}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#0469d0";const n=[`background-color: ${t}`,"color:white",`border:1px solid ${t}`,"padding: 0px 2px","margin: 0px 1px","border-radius: 2px"].join(";");return["%c%s",[n,e]]}class T{crypto=(()=>self.crypto||self.msCrypto)();ALG_NAME="AES-GCM";isAvailable(){return!!this.crypto?.subtle}generateKey(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,e.t_)(this.crypto.subtle.generateKey({name:this.ALG_NAME,length:256},t,["encrypt","decrypt"]))}encrypt(e,t){const[n,r]=this._encrypt(e,this.str2bytes(t));return n.then((e=>{const t=new Uint8Array(16+e.byteLength);return t.set(r,0),t.set(new Uint8Array(Uint32Array.of(e.byteLength).buffer),12),t.set(new Uint8Array(e),16),t.buffer}))}decrypt(e,t){const n=new Uint8Array(t,0,12),r=new Uint32Array(t,12,1)[0],i=t.slice(16,16+r);return this._decrypt(e,n,i).then(this.bytes2str)}_encrypt(t,n){const r=this.crypto.getRandomValues(new Uint8Array(12));return[(0,e.t_)(this.crypto.subtle.encrypt({name:this.ALG_NAME,iv:r},t,n)),r]}_decrypt(t,n,r){return(0,e.t_)(this.crypto.subtle.decrypt({name:this.ALG_NAME,iv:n},t,r))}str2bytes(e){return(new TextEncoder).encode(e).buffer}bytes2str(e){return(new TextDecoder).decode(e)}}class M{config;constructor(e){this.config=e}getNamespacedStorageKey(e){return`${this.config.stateNamespace}${e}`}}var q=__webpack_require__(46),R=__webpack_require__(694),j=__webpack_require__(450),L=__webpack_require__(327),F=__webpack_require__(214);var $=__webpack_require__(654),Q=__webpack_require__(620);class Y{timeoutDurationInMilliseconds;maxTimeOutDurationInMilliseconds;constructor(e,t){this.timeoutDurationInMilliseconds=e,this.maxTimeOutDurationInMilliseconds=t}schedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeoutDurationInMilliseconds,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.maxTimeOutDurationInMilliseconds;return this.debounce(e,t,n)}scheduleAccumulated(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeoutDurationInMilliseconds,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.maxTimeOutDurationInMilliseconds;return this.debounce(e,n,r,t)}scheduleForPageUnload(e){return(0,s.aT)(e)}debounce(t,n,r,i){let o,u,a,c=[];return l=>{i&&(a=i.concat(a??i.empty,l));const f=(0,s.b2)();c.push(f);return o?.(),o=(0,e.HJ)((()=>{u?.(),u=void 0;const e=t(a||l);c.forEach((t=>t.resolve(e))),a=i?.empty,c=[]}),n),u||(u=(0,e.HJ)((()=>{o?.(),u=void 0;const e=t(a||l);c.forEach((t=>t.resolve(e))),a=i?.empty,c=[]}),r)),f.promise}}}class N extends Error{constructor(e){super(e),this.name="StoreClosingError"}}const B="permutive-events-cache",H="permutive-events-for-page",V="[EVENTSCACHE]",K=e=>"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name;class W{config;logger;reportError;trace;metrics;userId;makeEventsStore;eventStore;eventsCache=(()=>this.makeEventsRepository(B))();eventsForPage=(()=>this.makeEventsRepository(H))();eventsTTLInMilliseconds;readiness;debouncedReportError=(()=>new Y(5e3,5e3).schedule((e=>this.reportError(e.errorMessage,{userId:e.userId}))))();static initialise(e,t,r,i,o,s,a){return(0,n.zG)(a(),u.UI((n=>new W(e,t,r,i,o,s,a,n))))}constructor(e,t,r,o,u,a,c,l){this.config=e,this.logger=t,this.reportError=r,this.trace=o,this.metrics=u,this.userId=a,this.makeEventsStore=c,this.eventStore=l,this.eventsTTLInMilliseconds=(0,n.zG)((0,i.ij)(this.config.eventsTTLInDays),(0,i.tS)((e=>"number"==typeof e&&e>0?(0,i.G)(24*e*3600):i.YP))),this.eventsCache.events=(0,s.HP)((()=>(0,s.PQ)((0,n.zG)(q.tD((()=>this.trace.startSpan("load_event_cache"))),q.tS((e=>(0,n.zG)(this.loadFromDisk(),q.At((t=>()=>{e.finish(),this.logDebug(`Event cache loaded, #e ${t.length}`)}))))))))),this.readiness=this.eventsCache.events().then((()=>this.migratePreviousPagesEvents())),a.onChange((()=>this.reset()))}async migratePreviousPagesEvents(){const e=this.trace.startSpan("migrate_previous_for_page_events"),t=(0,q.pE)((e=>(0,u.Y3)((()=>e.flush()),$.w)));return(0,n.zG)([this.eventsForPage,this.eventsCache],t,(0,q.UI)((t=>{const n=o.bj(t);return n.length>0&&this.reportError(`Migrate previous events failed. Got:\\n${n.join("\\n ")}`,{userId:this.userId.current}),e.finish()})),(e=>e()))}all(){return Promise.all([this.eventsCache.events(),this.eventsForPage.events()]).then(o.xH)}async add(e,t){let{persistOnDisk:r}=t;return this.logDebug("Adding to cache",e),this.eventsForPage.events=(0,n.zG)(this.eventsForPage.events,q.UI((t=>[...t,e])),s.HP),r&&this.readiness.then((()=>this.eventsForPage.flush())),e}filterEventsByWorkspace(e){return e}pruneEventsToSizeLimit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.config.eventsCacheLimitBytes;if(n<=0||t<=n)return this.logDebug(`Event size of ${t} less than limit of ${n}`),{events:e,sizeInBytes:t};this.logDebug("Events before pruning",{count:e.length,sizeInBytes:t,byteLimit:n});let r=1,i=[...e];for(;t>n;)i.splice(0,r),r*=2,t=2*JSON.stringify(i).length;return this.logDebug("Events after pruning",{count:i.length,sizeInBytes:t}),{events:i,sizeInBytes:t}}loadFromDisk(){const e=()=>[],t=(0,n.zG)(this.eventsTTLInMilliseconds,i.EQ((()=>n.yR),(e=>o.hX((t=>e>Date.now()-t.time.getTime())))));return(0,n.zG)(q.tD((()=>(this.logLog("Loading event cache..."),this.metrics.startTimer("sdk_load_events_cache_task_duration_seconds",{})))),q.YO("loadEventsCacheTask"),q.ak("eventsFromDisk",(()=>(0,n.zG)(o.nI([this.eventStore.get(B),this.eventStore.get(H)]),o.UI(u.LV((0,s.lo)([[e=>e instanceof N,(0,n.ls)(e,q.of)],t=>(0,n.zG)(q.tD((()=>this.reportError(`Error fetching data from store. Got ${t}`,{userId:this.userId.current}))),q.tS((()=>()=>this.reset("historical"))),q.UI(e))]),(0,n.ls)(i.fS(e),q.of))),o.vP(q.qA)))),q.At((e=>{let{eventsFromDisk:t,loadEventsCacheTask:n}=e;return()=>{this.logDebug("Read events from store:",t),this.metrics.stopTimer("sdk_load_events_cache_task_duration_seconds",n)}})),q.UI((0,n.ls)((0,s.vg)("eventsFromDisk"),o.xH,this.filterEventsByWorkspace,(e=>this.pruneEventsToSizeLimit(e,2*JSON.stringify(e).length)),(e=>(this.eventsCache.sizeInBytes=e.sizeInBytes,this.eventsCache.sizeInBytesLastSuccessfulWrite=e.sizeInBytes,e.events.length>0&&(this.metrics.track({name:"sdk_events_cache_byte_total",value:e.sizeInBytes,labels:{}}),this.metrics.track({name:"sdk_events_cache_size_total",value:e.events.length,labels:{}})),e.events)),o.UI(Q.k),t)))}async reset(e){return(0,n.zG)(q.tD((()=>this.logDebug("Resetting Events Cache"))),q.tS((()=>this.eventStore.deleteStore())),u.tS((()=>this.makeEventsStore())),u.Zl((t=>(this.eventStore=t,"historical"===e?k.gz(u.Ij)(this.eventsCache.reset,this.eventsForPage.flush):k.gz(u.Ij)(this.eventsCache.reset,this.eventsForPage.reset)))),u.wE((()=>()=>this.all())),u.fS((()=>q.of(X()))),(e=>e()))}getStateSizeInBytes(){return this.eventsForPage.sizeInBytes+this.eventsCache.sizeInBytes}makeEventsRepository(e){const t=(()=>{let e=Promise.resolve(l.F2((0,n.Q1)()));return t=>e=e.then(t)})(),r=e=>(0,n.zG)(q.tD((()=>this.logDebug(`Writing ${e.length} events to ${m.key}`))),q.tS((()=>this.eventStore.put(e.map(Q.X),m.key))),u.UI(n.Q1)),i=(0,n.zG)(q.tD((()=>this.logDebug(`Deleting events for ${m.key}`))),q.tS((()=>this.eventStore.delete(m.key))),u.Vn($.w)),o=(0,n.ls)(q.of,q.At((e=>()=>this.logError(`Events cache failed to put ${m.key}. Got ${e}`))),q.tS((0,s.lo)([[e=>K(e)&&m.retryAttempts<9,()=>(0,n.zG)(q.tD((()=>{m.retryAttempts+=1,this.logDebug(`Attempt #${m.retryAttempts} to write ${m.key} to EventsStore`)})),q.tS((()=>p)),q.tS((()=>c)))],[e=>K(e),e=>(0,n.zG)(q.tD((()=>this.logDebug(`Attempted ${m.retryAttempts} rewrite attempts and reached limit of 9 max writes.`,"Reporting QuotaExceededError to API"))),q.tS((()=>()=>this.debouncedReportError({errorMessage:`Events cache failed to put ${m.key}. Got ${e}`,userId:this.userId.current}))),q.tS((()=>u.t$(e))))],u.t$]))),a=e=>u.tD((()=>{this.logDebug(`Successfully wrote events for ${m.key} after ${m.retryAttempts} attempts`),m.retryAttempts=0,m.sizeInBytes=2*JSON.stringify(e).length,m.sizeInBytesLastSuccessfulWrite=m.sizeInBytes})),c=(0,n.zG)((()=>m.events()),q.tS((e=>(0,n.zG)(r(e),q.mU(l.EQ(o,(()=>a(e)))))))),f=(e,t)=>(0,n.zG)(e.events,q.UI((n=>{const r=2*JSON.stringify(n).length,i=this.pruneEventsToSizeLimit(n,r,t);return e.events=q.of(i.events),e.sizeInBytes=i.sizeInBytes,t-e.sizeInBytes}))),d=(e,t)=>{let[r,...i]=e;return r&&0!==t?(0,n.zG)(f(r,t),q.tS((e=>(this.logDebug(`${e} left after pruning ${r.key}`),d(i,e))))):q.of((0,n.Q1)())},p=(0,n.zG)(u.tD((()=>this.eventsForPage.sizeInBytes-this.eventsForPage.sizeInBytesLastSuccessfulWrite)),u.fX(l.DT((e=>e>0),(e=>new Error(`${this.eventsForPage.key} failed to write the same or smaller events cache of size ${e}`)))),u.tS((e=>{const t=1.2*e,r=[this.eventsCache,this.eventsForPage];return this.logDebug(`Pruning ${t} bytes from`,r),(0,n.zG)(d(r,t),u.fF)}))),m={key:e,events:q.of([]),sizeInBytes:0,sizeInBytesLastSuccessfulWrite:0,retryAttempts:0,flush:()=>(0,n.zG)(q.tD((()=>this.trace.startSpan(`write_${m.key}`))),q.tS((e=>(0,n.zG)(c,q.At((()=>()=>e.finish()))))),t),reset:()=>(0,n.zG)(q.tD((()=>{m.events=q.of([]),m.sizeInBytes=0,m.sizeInBytesLastSuccessfulWrite=0})),q.tS((()=>i)),t)};return m}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(V,...t)}logWarn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warn(V,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(V,...t)}logLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.log(V,...t)}}const X=()=>[],J=`permutive.${self.document?"main":"worker"}.`;class Z{config;shouldUsePerformanceMark=!1;constructor(e){this.config=e,this.shouldUsePerformanceMark=(self.performance?.mark&&this.config.tracingEnabled)??!1}startSpan(e){const t=this.generateSpan(e);return t.start(),{spanId:t.spanId,finish:t.finish}}measureSinceInit(t){const n=this.generateSpan(`${t}_since_init`);return n.start({startTime:e.NC}),{spanId:n.spanId,finish:n.finish}}traceTask(e){return t=>async()=>{const n=this.startSpan(e),r=await t();return n.finish(),r}}measureBetween(e,t,n){const r=this.generateSpan(e);r.start({startTime:t}),r.finish({startTime:n})}generateSpan(e){if(!this.shouldUsePerformanceMark)return{spanId:null,start:()=>{},finish:()=>{}};const{spanName:t,startMarkerName:n,endMarkerName:r}=Z.generateUniqueMarkerNames(e);return{spanId:n,start:e=>self.performance?.mark(n,e),finish:e=>{self.performance?.mark(r,{startTime:e?.startTime??performance.now()}),self.performance?.measure?.(t,n,r)}}}static generateUniqueMarkerNames(e){const t=`${J}${e}`,n=`${t}${Z.generateId()}`;return{spanName:t,startMarkerName:`${n}_start`,endMarkerName:`${n}_end`}}static generateId(){return"_"+Math.random().toString(36).substr(2,9)}}class ee{db;static version=3;static connect(t,r,i,o,s,a,c,l,f,d){return(0,n.zG)(u.Y3((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,120))),String),e.N1,u.tS((e=>e.make(t,r,i,o,s,a,c,ee.version,l,f,d))),u.UI((e=>new ee(Promise.resolve(e)))))}constructor(e){this.db=e}shouldThrowStoreClosingError(e){return"NotFoundError"===e.name||"InvalidStateError"===e.name}makeStoreClosingDuringOpertationError(e){return new N(`Attempted ${e} when the current store is closing.`)}put(e,t){return(0,u.Y3)((()=>this.db.then((n=>n.put(e,t)))),(e=>{const t=(0,$.w)(e);return this.shouldThrowStoreClosingError(t)?this.makeStoreClosingDuringOpertationError("put"):t}))}get(e){return(0,u.Y3)((()=>this.db.then((t=>t.get(e))).then(i.ij)),(e=>{const t=(0,$.w)(e);return this.shouldThrowStoreClosingError(t)?this.makeStoreClosingDuringOpertationError("get"):t}))}delete(e){return(0,u.Y3)((()=>this.db.then((t=>t.delete(e)))),(e=>String(e)))}deleteStore(){return(0,u.Y3)((()=>this.db.then((e=>e.deleteStore()))),(e=>String(e)))}}const te=e=>{if(!e)return"";return(0,n.zG)(e,(e=>{const t=e.length-1;return"/"===e[t]?e.slice(0,t):e}))};class ne{urls;config;network;metricsCollector;logger;webClient;prefix="[API]";constructor(e,t,n,r,o){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>i.YP;this.urls=e,this.config=t,this.network=n,this.metricsCollector=r,this.logger=o,this.webClient=s}async reportError(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;const s=(0,$.w)(e);if(this.logError("Reporting error:\\n",s),!this.config.sendClientErrors)return void this.logDebug("Send errors not enabled. Skipping");const u=(0,n.zG)(this.webClient,R.UI(i.fS((()=>({domain:self.location?.hostname??"",referrer:"document"in self?self.document?.referrer:"",url:self.location?.href??"",user_agent:navigator?.userAgent??""})))),R.UI((e=>{const n={error_message:s?.message?.toString()??"",stack_trace:s?.stack?.split("\\n")},i=t?{user_id:t}:{};return{platform:"web",sdk_version:"v20.54.0",ql_runtime_version:"v14.1.0",timestamp:r,domain:e.domain,url:te(e.url),referrer:te(e.referrer),user_agent:e.user_agent,error_message:n.error_message??String(s),stack_trace:n.stack_trace,...i}}))),a=e=>this.network.req({url:this.urls.getSdkErrorsUrl("/errors",i.G(this.config.sdkErrorsApiVersion)),method:"POST",payload:[e],contentType:"text/plain",dataType:"text",withCredentials:!1}),c=e=>{this.metricsCollector.trackCounter({name:"sdk_http_generic_network_request_fail_count_total",value:1,labels:{network_error_type:e}})};await(0,n.zG)([f,d],o.Ew((e=>s.name===e.errorName||s.message.indexOf(e.errorName)>=0||s.message.indexOf(e.defaultMessage)>=0)),i.g_((()=>{const e=u();return a(e).catch((0,n.ls)($.w,(e=>this.logError(e))))}),(async e=>c(e.errorName))))}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(this.prefix,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(this.prefix,...t)}}var re=__webpack_require__(987);const ie=e=>{const t=oe(e.javaScriptInput),{env:n,...r}=(0,re.N)({hash:e.hash,runtimeInput:t});return r},oe=e=>{if(e&&"object"==typeof e)return e;throw new Error("Invalid runtime input specified.")},se=("undefined"!=typeof globalThis?globalThis:void 0)?.crypto||("undefined"!=typeof global?global:void 0)?.crypto||("undefined"!=typeof window?window:void 0)?.crypto||("undefined"!=typeof self?self:void 0)?.crypto||("undefined"!=typeof frames?frames:void 0)?.[0]?.crypto;let ue;ue=se?e=>{const t=[];for(let n=0;n<e;n+=4)t.push(se.getRandomValues(new Uint32Array(1))[0]);return new ce(t,e)}:e=>{const t=[],n=e=>{let t=e,n=987654321;const r=4294967295;return()=>{n=36969*(65535&n)+(n>>16)&r,t=18e3*(65535&t)+(t>>16)&r;let e=(n<<16)+t&r;return e/=4294967296,e+=.5,e*(Math.random()>.5?1:-1)}};for(let r,i=0;i<e;i+=4){const e=n(4294967296*(r||Math.random()));r=987654071*e(),t.push(4294967296*e()|0)}return new ce(t,e)};class ae{static create(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new this(...t)}mixIn(e){return Object.assign(this,e)}clone(){const e=new this.constructor;return Object.assign(e,this),e}}class ce extends ae{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4*e.length;super();let n=e;if(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),(n instanceof Int8Array||n instanceof Uint8ClampedArray||n instanceof Int16Array||n instanceof Uint16Array||n instanceof Int32Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array)&&(n=new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),n instanceof Uint8Array){const e=n.byteLength,t=[];for(let r=0;r<e;r+=1)t[r>>>2]|=n[r]<<24-r%4*8;this.words=t,this.sigBytes=e}else this.words=e,this.sigBytes=t}static random=(()=>ue)();toString(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:le).stringify(this)}concat(e){const t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(let e=0;e<i;e+=1){const i=n[e>>>2]>>>24-e%4*8&255;t[r+e>>>2]|=i<<24-(r+e)%4*8}else for(let e=0;e<i;e+=4)t[r+e>>>2]=n[e>>>2];return this.sigBytes+=i,this}clamp(){const{words:e,sigBytes:t}=this;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}clone(){const e=super.clone.call(this);return e.words=this.words.slice(0),e}}const le={stringify(e){const{words:t,sigBytes:n}=e,r=[];for(let e=0;e<n;e+=1){const n=t[e>>>2]>>>24-e%4*8&255;r.push((n>>>4).toString(16)),r.push((15&n).toString(16))}return r.join("")},parse(e){const t=e.length,n=[];for(let r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new ce(n,t/2)}},fe={stringify(e){const{words:t,sigBytes:n}=e,r=[];for(let e=0;e<n;e+=1){const n=t[e>>>2]>>>24-e%4*8&255;r.push(String.fromCharCode(n))}return r.join("")},parse(e){const t=e.length,n=[];for(let r=0;r<t;r+=1)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new ce(n,t)}},de={stringify(e){try{return decodeURIComponent(escape(fe.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:e=>fe.parse(unescape(encodeURIComponent(e)))};class pe extends ae{constructor(){super(),this._minBufferSize=0}reset(){this._data=new ce,this._nDataBytes=0}_append(e){let t=e;"string"==typeof t&&(t=de.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(e){let t;const{_data:n,blockSize:r}=this,i=n.words,o=n.sigBytes;let s=o/(4*r);s=e?Math.ceil(s):Math.max((0|s)-this._minBufferSize,0);const u=s*r,a=Math.min(4*u,o);if(u){for(let e=0;e<u;e+=r)this._doProcessBlock(i,e);t=i.splice(0,u),n.sigBytes-=a}return new ce(t,a)}clone(){const e=super.clone.call(this);return e._data=this._data.clone(),e}}class me extends pe{constructor(e){super(),this.blockSize=16,this.cfg=Object.assign(new ae,e),this.reset()}static _createHelper(e){return(t,n)=>new e(n).finalize(t)}static _createHmacHelper(e){return(t,n)=>new ge(e,n).finalize(t)}reset(){super.reset.call(this),this._doReset()}update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e);return this._doFinalize()}}class ge extends ae{constructor(e,t){super();const n=new e;this._hasher=n;let r=t;"string"==typeof r&&(r=de.parse(r));const i=n.blockSize,o=4*i;r.sigBytes>o&&(r=n.finalize(t)),r.clamp();const s=r.clone();this._oKey=s;const u=r.clone();this._iKey=u;const a=s.words,c=u.words;for(let e=0;e<i;e+=1)a[e]^=1549556828,c[e]^=909522486;s.sigBytes=o,u.sigBytes=o,this.reset()}reset(){const e=this._hasher;e.reset(),e.update(this._iKey)}update(e){return this._hasher.update(e),this}finalize(e){const t=this._hasher,n=t.finalize(e);t.reset();return t.finalize(this._oKey.clone().concat(n))}}const he=[];class ve extends me{_doReset(){this._hash=new ce([1732584193,4023233417,2562383102,271733878,3285377520])}_doProcessBlock(e,t){const n=this._hash.words;let r=n[0],i=n[1],o=n[2],s=n[3],u=n[4];for(let n=0;n<80;n+=1){if(n<16)he[n]=0|e[t+n];else{const e=he[n-3]^he[n-8]^he[n-14]^he[n-16];he[n]=e<<1|e>>>31}let a=(r<<5|r>>>27)+u+he[n];a+=n<20?1518500249+(i&o|~i&s):n<40?1859775393+(i^o^s):n<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,u=s,s=o,o=i<<30|i>>>2,i=r,r=a}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+u|0}_doFinalize(){const e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}const ye=me._createHelper(ve),_e=(me._createHmacHelper(ve),{stringify(e){const{words:t,sigBytes:n}=e,r=this._map;e.clamp();const i=[];for(let e=0;e<n;e+=3){const o=(t[e>>>2]>>>24-e%4*8&255)<<16|(t[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|t[e+2>>>2]>>>24-(e+2)%4*8&255;for(let t=0;t<4&&e+.75*t<n;t+=1)i.push(r.charAt(o>>>6*(3-t)&63))}const o=r.charAt(64);if(o)for(;i.length%4;)i.push(o);return i.join("")},parse(e){let t=e.length;const n=this._map;let r=this._reverseMap;if(!r){this._reverseMap=[],r=this._reverseMap;for(let e=0;e<n.length;e+=1)r[n.charCodeAt(e)]=e}const i=n.charAt(64);if(i){const n=e.indexOf(i);-1!==n&&(t=n)}return((e,t,n)=>{const r=[];let i=0;for(let o=0;o<t;o+=1)if(o%4){const t=n[e.charCodeAt(o-1)]<<o%4*2|n[e.charCodeAt(o)]>>>6-o%4*2;r[i>>>2]|=t<<24-i%4*8,i+=1}return ce.create(r,i)})(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="});const Se=function(e){let t=i.YP;const n=i.fS((()=>{const n=e();return t=i.G(n),n}));return()=>n(t)}((()=>({metadata:{244777:"0c8b70cdb7",244785:"16bab71b3b",244786:"c7b39dde34",244787:"22e12efe24",245780:"92cf8a1997",245781:"8bbb5cc50a",245782:"632f05855e",245901:"61ef928d52",245902:"7d543dcfd6",245903:"e48bb4bf1a"},runtime:ie({hash:function(e){return ye(e).toString(_e).slice(0,8)},javaScriptInput:{ahoCorasickLookup:e=>[],eventSegments:e=>({"!UpdateLookalikeModels":["245780","245781","245782","245901","245902","245903"],Pageview:["244777","244785","244786","244787"],SegmentEntry:[],SegmentExit:[]}),eventsLookup:e=>["Pageview"],interpretOnlyQueries:e=>({}),literalsLookup:e=>[],propertiesLookup:e=>[],queries:e=>({244777:e.r(3,1,1),244785:e.q(e.cb(0,e.t,e.e(1),2)),244786:e.q(e.acqs([e.cb(0,e.t,e.ge(2),2),e.cb(0,e.t,e.le(4),5)])),244787:e.r(3,5,5),245780:e.r(2,.07526948),245781:e.r(0,.12118841),245782:e.r(1,.108226225),245901:e.r(2,.058977466),245902:e.r(0,.04156463),245903:e.r(1,.046128795)}),rootCompressionLookup:e=>[t=>e.q(e.acqs([e.lm("2cf276dd-7450-49c1-b290-cb8094044f9b",e.ge(t)),e.fm(e.n0,e.ifp("244786"))])),t=>e.q(e.acqs([e.lm("450d72fc-416b-4061-b92c-35ea2e3adfbd",e.ge(t)),e.fm(e.n0,e.ifp("244787"))])),t=>e.q(e.acqs([e.lm("de1b6ef1-5205-4e07-96d7-49b9e3edb80a",e.ge(t)),e.fm(e.n0,e.ifp("244785"))])),(t,n)=>e.q(e.cb(0,e.t,e.ge(n),t))],stateSyncReplays:e=>[],subexpressionsLookup:e=>[]}})})));var Ie=__webpack_require__(823),be=__webpack_require__(229);async function we(f){let{contextsInitTimestampPerformance:d,master:p}=f;const m=await p.next(),g=performance.now();Object.entries(m.globals??{}).forEach((e=>{let[t,n]=e;Object.defineProperty(self,t,{value:n})}));const h=new Z(m.permutiveConfig);h.measureBetween("waiting_worker_high_priority_config",d,g);const v=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.RP;return t.loggingEnabled&&void 0!==self.console?.log?new x(n):new D}(m.permutiveConfig,m.sdkInitTimestampDate),y=m.metricsEnabled?new U(m.sdkInitTimestampPerformance,m.timeOriginMainContext,v):new E;y.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"worker_evaluated",time_origin:"sdk_init"},d),y.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"worker_received_high_priority_config",time_origin:"sdk_init"},g);const _=(0,n.zG)(p.next,h.traceTask("waiting_worker_low_priority_config"))();_.then((()=>y.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"worker_received_low_priority_config",time_origin:"sdk_init"})));const S=(0,n.zG)((()=>p.read()),function(e,r){const i=e=>(0,n.zG)(e,j.Hd((e=>e in r)),(e=>{let{left:t,right:n}=e;return{buffers:n,nonBuffers:t}}));return o=>{const{buffers:s,nonBuffers:u}=i(e),[a,c]=t.Ue({...u,...(0,n.zG)(s,j.Su((e=>()=>{const t=s[e];return s[e]=r[e].empty,t})))});return(async()=>{for(;;){const e=(0,n.zG)(await o(),F.UI(i),F.ur({concat:(e,t)=>({nonBuffers:{...e.nonBuffers,...t.nonBuffers},buffers:(()=>{const n={...e.buffers};for(const e in t.buffers)n[e]=e in n?r[e].concat(n[e],t.buffers[e]):t.buffers[e];return n})()})})),t=(0,n.zG)(e.buffers,j.Su(((e,t)=>(s[e]=r[e].concat(s[e],t),()=>{const t=s[e];return s[e]=r[e].empty,t}))));c({...a.current,...e.nonBuffers,...t})}})(),(0,n.zG)(e,j.Su((e=>(0,n.zG)(a,t.UI((t=>t[e]))))))}}({contextualCohorts:i.YP,consent:m.consent,enrichmentReplacementMap:i.YP,eventSourceId:m.eventSourceId,identities:i.YP,newEvents:o.cS,pageviewState:m.pageviewState,priorCachedEventsResponses:o.cS,sessionId:m.sessionId,userId:m.userId,userIdIsNewlyGenerated:m.userIdIsNewlyGenerated,viewId:m.pageviewState.viewId,webClient:i.G(m.webClient)},{newEvents:o.uZ(),priorCachedEventsResponses:o.uZ()}),(0,s.rO)({newEvents:(0,Ie.F)(y,"pageview_received_by_worker")}),(e=>({...e,currentTimestampSecs:Ge((0,n.zG)(m.initialTimestampSecs,i.EQ((()=>0),(e=>e-Date.now()/1e3))))}))),{eventsCachedInWorker:I,coreService:b}=await function(s,f,d,p,m,g){p.debug("SDK core started",s);const h=500,v=new w(p,g),y=new G(s.permutiveConfig),_=new ne(y,s.permutiveConfig,v,g,p,(()=>d.webClient.current)),S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_.reportError(e,t?.userId,t?.timestamp)},I=(0,n.zG)(u.Y3((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,787)).then((e=>e.watson))),(()=>"Failed to import watson.")),u.UI((e=>(0,n.zG)(d.webClient,t.UI(i.UI((e=>e.url))),t.D8(i.Eh(be.Eq)),(r=>e({config:s.permutiveConfig,metrics:g,permutiveApi:v,permutiveUrls:y,pageUrl:r,trace:m,watsonEnabled:(0,n.zG)(d.pageviewState,t.UI((e=>e.watsonEnabled)))})))))),b=(0,n.zG)(W.initialise(s.permutiveConfig,p,S,m,g,d.userId,(()=>(0,n.zG)(ee.connect(new M(s.permutiveConfig),g,new T,s.organizationId,`events_${d.userId.current}`,`keys_${d.userId.current}`,"events",p,d.consent,s.isSecureContext),m.traceTask("connect_idb_events_cache")))),m.traceTask("initialise_events_cache"),u.At((()=>()=>g.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"events_cache_initialised",time_origin:"sdk_init"},performance.now()))),u.EQ((e=>{p.error(`Worker failed to initialise IndexedDB event cache: ${e}`);const r={},[i,s]=t.gS(o.uZ()),u=()=>new Promise((e=>{const t=String(Math.random());r[t]=n=>{delete r[t],e(n)},s([[t,void 0]])}));return(0,n.zG)(d.priorCachedEventsResponses,t.UI((e=>(0,n.zG)(e(),o.UI((e=>{let[t,n]=e;return r[t]?.(n)})))))),{eventsCachedInWorker:!1,coreOutput:{priorCachedEventsRequests:i},coreConfig:{eventsCache:l.t$(u)}}}),(e=>({eventsCachedInWorker:!0,coreOutput:{priorCachedEventsRequests:t.a9(R.of(o.bM()))},coreConfig:{eventsCache:l.F2(e)}})))),U=(0,n.zG)(!0,u.DT(n.yR,(()=>"IndexedDB disabled.")),u.tS((()=>(0,n.zG)(z.K.initialise(new M(s.permutiveConfig),g,p,new T,`worker_${s.organizationId}`,"core_service_state","keys","core_service_state",4,s.isSecureContext),m.traceTask("initialise-core-idb")))),u.tS((e=>(0,k.Yt)(u.Hi)({persistCoreState:a(e,"core"),persistLalState:a(e,"lal")})))),E=()=>new Promise((e=>(0,n.zG)(d.consent,t.YP((t=>{t&&e()}))))),P=o=>(0,n.zG)(u.fF(U),u.YO("servicePersistence"),u.Qt("eventsCache",u.fF((()=>o))),u.Qt("coreService",(0,n.zG)(u.Y3((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,936)).then((e=>e.service))),(e=>`Failed to import core service: ${e}`)),m.traceTask("import-core-service"))),u.Qt("lookalikeModelsService",u.Y3((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,28)).then((e=>e.lookalikeModelsService))),(()=>"Failed to import lookalike models."))),u.Qt("optimisedActivationsConfig",u.Y3((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,696)).then((e=>e.optimisedActivationsConfig))),(()=>"Failed to import lookalike models."))),u.Qt("watson",I),q.mU((()=>E)),u.UI((o=>{let{coreService:u,eventsCache:a,lookalikeModelsService:_,optimisedActivationsConfig:I,servicePersistence:b,watson:w}=o;const G={config:s.permutiveConfig,customQueries:Se(),logger:p,metrics:g,optimisedActivationsConfig:I,permutiveApi:v,permutiveUrls:y,reportError:S,trackPageviewComplete:s.trackPageviewComplete,migratedStateMaps:(0,n.zG)(i.lo(!s.isFirstPageview),i.EQ((()=>q.of({external:i.bM(),internal:i.bM()})),(()=>R.of(f.then((e=>e.migratedStateMaps)))))),trace:m,watson:i.G(w),performance:i.ij(self.performance)};return(0,n.zG)(b,l.UI((o=>{let{persistCoreState:s,persistLalState:l}=o;return(0,n.zG)(_({...G,...d}),l,r.VS((o=>{let[l,f]=o;return(0,n.zG)(d,u({...G,...a.coreConfig,lookalikeModels:i.G(f)}),(p=h,m=t.a9(!1),r=>i=>{const{value:o,state:s}=r(i),[u,a]=t.Ue(s.current),c=(0,e.UM)((()=>a(s.current)),p),l=(0,n.zG)(t.vP(s,u),t.UI((e=>{let[t,n]=e;return t===n})));return(0,n.zG)(m,t.bw((e=>e&&c()))),{value:(0,n.bc)(l,o),state:(0,n.zG)(t.vP(m,s,u),t.UI((e=>{let[t,n,r]=e;return t?n:r})))}}),c(d.consent),s,r.UI((e=>{let[r,[i,o]]=e;return{...o,stateFlushed:(0,n.zG)(t.vP(l,r,i),t.UI((e=>{let[t,n,r]=e;return t&&n&&r})))}})));var p,m})),(e=>{const{value:n}=e({stopped:t.a9(!1),previousState:{}});return e=>({value:n,state:t.a9(void 0)})}))})),l.fS((e=>(p.warn("Worker running in non-persistent mode.",e),(0,n.zG)(d,u({...G,...a.coreConfig,lookalikeModels:i.YP}),r.Hr("stateFlushed",(()=>t.a9(!0))),c(d.consent))))),r.UI((e=>({...e,...a.coreOutput}))))})));return async()=>{const e=b(),t=P(e)(),{eventsCachedInWorker:n}=await e;return{eventsCachedInWorker:n,coreService:t}}}(m,_,S,v,h,y)();p.send({eventsCachedInWorker:I});const P=await b;if(l.nM(P))return v.error(`Failed to start worker: ${P.left}`),void self.close?.();const O=P.right,C=await _,A=(await O)({stopped:t.a9(!1),previousState:C.previousState}),[$,Q]=t.Ue(y.getNoMetricsTracked());(0,e.UM)((()=>Q(y.getNoMetricsTracked())),100),function(e,r,o){const s=(0,n.zG)(t.vP(r),t.UI((0,n.ls)(j.UI((e=>"function"==typeof e?e:R.of(e))),(0,k.Yt)(R.G5))));let u=s.current();e(u),(0,n.zG)(s,t.YP((t=>{const r=t(),s=(0,n.zG)(r,j.z7(((e,t)=>t!==u[e]&&!o[e]?.isEmpty(t))),i.DT((0,L.ff)(j.xb)));i.pC(s)&&(u={...u,...s.value},e(s.value))})))}(p.send,{activations:A.value.activations,cohorts:t.vP(A.value.cohorts),context:A.value.context,eventsToPublish:A.value.eventsToPublish,eventsToPublishOnPageUnload:A.value.eventsToPublishOnPageUnload,externalData:A.value.externalData,geoIP:A.value.geoIP,metrics:(0,n.zG)($,t.UI((()=>()=>y.consume()))),priorCachedEventsRequests:A.value.priorCachedEventsRequests,realtime:A.value.realtime,state:A.state,transitionsSinceInit:A.value.transitionsSinceInit,workerStateFlushed:A.value.stateFlushed,stateMigratedThisInitialisation:A.value.stateMigratedThisInitialisation,secureSignal:A.value.secureSignal},{eventsToPublish:{isEmpty:o.xb},metrics:{isEmpty:o.xb}})}function Ge(n){const r=()=>Math.floor(Date.now()/1e3)+n,[i,o]=t.Ue(r());return(0,e.UM)((()=>o(r())),1e3),i}!async function(){const t=self,n=await new Promise((e=>{const n=r=>{const i=function(e){return e&&"object"==typeof e&&"port"in e?e:void 0}(r.data);i&&(t.removeEventListener("message",n),e(i.port))};t.addEventListener("message",n)})),r=(t=>{const n=[],r=[],i=()=>{for(;n.length>0&&r.length>0;)r.shift()()},o=t=>new Promise((n=>{r.push((()=>n(t()))),(0,e.HJ)(i)}));return t.onmessage=(0,e.GL)((t=>{null!==t.data&&(n.push(t.data),(0,e.HJ)(i))})),{next:()=>o((()=>n.shift())),read:()=>o((()=>n.splice(0)))}})(n);we({contextsInitTimestampPerformance:e.NC,master:{...r,send:e=>n.postMessage(e)}})}()})()})();',"Worker",void 0,void 0)}},1005:e=>{e.exports=function(e,t,n,r){var i=self||window;try{try{var o;try{o=new i.Blob([e])}catch(t){(o=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),o=o.getBlob()}var s=i.URL||i.webkitURL,a=s.createObjectURL(o),u=new i[t](a,n);return s.revokeObjectURL(a),u}catch(r){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch(e){if(!r)throw Error("Inline worker is not supported");return new i[t](r,n)}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{var e=__webpack_require__(3215);const t=(()=>{try{return self.document.currentScript}catch{return null}})();(()=>{(0,e.ho)(!0);const n="permutive.main.import_runWebSdk",r=`${n}_start`;performance?.mark?.(r),(0,e.SF)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,9934))))().then((i=>{performance?.measure?.(n,r),i.runSdk({contextsInitTimestampPerformance:e.NC,contextsInitTimestamp:e.RP,currentScript:t})})).catch(console.error)})()})()})();